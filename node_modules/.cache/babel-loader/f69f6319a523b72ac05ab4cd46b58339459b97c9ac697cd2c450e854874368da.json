{"ast":null,"code":"import _objectSpread from\"C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useCallback,useEffect,useRef,forwardRef}from'react';import{convertAllPromptoDysUrlsToBlobs,getCurrentProject}from'../utils/promptoDysManager';import{loadImage,saveImage,requestPersistentStorage}from'../utils/imageStore';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Editor=/*#__PURE__*/forwardRef((_ref,ref)=>{let{content,setContent,viewMode,onInput,currentFormat,onFormatChange,mathJaxReady,ignoreSelectionChangeRef,selectedImage,onImageClick,onEditorClick,onDeleteSelectedImage,onSelectionChange,storeBlobForUrl,editorRef}=_ref;// Utilise editorRef pass√©e en props (pas de ref locale)\nconst isInitializedRef=useRef(false);const previousContentRef=useRef('');// Fonction pour cr√©er des blobs uniques (mutualisation avec Toolbar)\nconst createUniqueBlob=useCallback((file,storeBlobForUrl)=>{const uniqueId=\"\".concat(Date.now(),\"_\").concat(Math.random().toString(36).substr(2,9));const uniqueName=\"\".concat(uniqueId,\"_\").concat(file.name);const uniqueFile=new File([file],uniqueName,{type:file.type});const blobUrl=URL.createObjectURL(uniqueFile);console.log('üéØ [createUniqueBlob] Cr√©ation blob unique:',uniqueName,'->',blobUrl);storeBlobForUrl(blobUrl,uniqueFile);return{blobUrl,uniqueFile};},[]);// Fonction de v√©rification force de la persistance des images\nconst forceVerifyImagePersistence=useCallback(async container=>{console.log('üîç [forceVerify] V√©rification persistance images...');const imagesWithId=container.querySelectorAll('img[data-image-id]');console.log(\"\\uD83D\\uDD0D [forceVerify] \".concat(imagesWithId.length,\" images avec data-image-id trouv\\xE9es\"));for(const img of imagesWithId){const imageId=img.getAttribute('data-image-id');try{const blob=await loadImage(imageId);if(blob){console.log(\"\\u2705 [forceVerify] Image \".concat(imageId,\" OK en IndexedDB (\").concat(Math.round(blob.size/1024),\"KB)\"));}else{console.error(\"\\u274C [forceVerify] Image \".concat(imageId,\" MANQUANTE en IndexedDB\"));// Re-sauvegarder depuis l'URL actuelle si possible\nif(img.src.startsWith('blob:')){try{const response=await fetch(img.src);const newBlob=await response.blob();await saveImage(imageId,newBlob);console.log(\"\\uD83D\\uDD04 [forceVerify] Re-sauvegarde OK pour \".concat(imageId));}catch(error){console.error(\"\\u274C [forceVerify] \\xC9chec re-sauvegarde \".concat(imageId,\":\"),error);}}}}catch(error){console.error(\" [forceVerify] Erreur v\\xE9rification \".concat(imageId,\":\"),error);}}},[]);// Fonction de r√©hydratation des images depuis IndexedDB\nconst rehydrateImages=useCallback(async container=>{console.log(' [rehydrateImages] D√©but r√©hydratation des images...');if(!container){console.warn(' [rehydrateImages] Pas de conteneur fourni');return;}// Trouver toutes les images avec data-image-id\nconst images=container.querySelectorAll('img[data-image-id]');console.log(\" [rehydrateImages] \".concat(images.length,\" images avec data-image-id trouv\\xE9es\"));// Traiter chaque image\nfor(const img of images){const imageId=img.getAttribute('data-image-id');console.log(' [rehydrateImages] Traitement image:',imageId);try{// Charger l'image depuis IndexedDB\nconst objectUrl=await loadImage(imageId);if(objectUrl){// Conserver les attributs existants\nconst width=img.getAttribute('width');const height=img.getAttribute('height');const alt=img.getAttribute('alt')||'';console.log(' [rehydrateImages] Image charg√©e:',{imageId,oldSrc:img.src,newSrc:objectUrl,width,height,alt});// Mettre √† jour la source\nimg.src=objectUrl;console.log(' [rehydrateImages] Image r√©hydrat√©e avec succ√®s:',imageId);}else{console.warn(' [rehydrateImages] Image non trouv√©e en IndexedDB:',imageId);// On garde l'image avec son data-image-id pour un essai ult√©rieur\n}}catch(error){console.error(' [rehydrateImages] Erreur r√©hydratation:',imageId,error);}}console.log(' [rehydrateImages] R√©hydratation termin√©e');},[]);// Fonction mutualis√©e pour traiter les images coll√©es et les rendre uniques\nconst processImageBlobs=useCallback(async(container,storeBlobForUrl)=>{console.log(' [processImageBlobs] Traitement des images...');// Traiter les images blob: temporaires\nconst blobImages=container.querySelectorAll('img[src^=\"blob:\"]');console.log('üîç [processImageBlobs] Images blob trouv√©es:',blobImages.length);for(const img of blobImages){const originalUrl=img.src;try{console.log('üì• [processImageBlobs] Traitement blob:',originalUrl);// R√©cup√©rer le blob original\nconst response=await fetch(originalUrl);const blob=await response.blob();// Cr√©er un nouveau File avec un nom unique\nconst file=new File([blob],'pasted-image.png',{type:blob.type});const{blobUrl}=createUniqueBlob(file,storeBlobForUrl);// Remplacer l'URL dans l'image\nimg.src=blobUrl;console.log('‚úÖ [processImageBlobs] Image blob mise √† jour:',originalUrl,'->',blobUrl);}catch(error){console.error('‚ùå [processImageBlobs] Erreur blob pour:',originalUrl,error);}}// Traiter les images base64 coll√©es (copie d'√©cran Windows)\nconst base64Images=container.querySelectorAll('img[src^=\"data:image/\"]');console.log('üîç [processImageBlobs] Images base64 trouv√©es:',base64Images.length);for(const img of base64Images){const dataUrl=img.src;try{console.log('üì• [processImageBlobs] Traitement base64 (longueur:',dataUrl.length,'chars)');// Convertir data URL en blob\nconst response=await fetch(dataUrl);const blob=await response.blob();// G√©n√©rer nom de fichier unique\nconst timestamp=new Date().toISOString().replace(/[:.]/g,'-').slice(0,-5);const filename=\"pasted-screenshot-\".concat(timestamp,\".png\");// G√©n√©rer ID unique et stocker dans IndexedDB\nconst imageId=crypto.randomUUID();await saveImage(imageId,blob);// Cr√©er blob URL temporaire pour affichage\nconst blobUrl=URL.createObjectURL(blob);// Stocker le mapping URL->File pour compatibilit√©\nconst file=new File([blob],filename,{type:blob.type});if(storeBlobForUrl){storeBlobForUrl(blobUrl,file);}// Remplacer l'image base64 par blob + data-image-id\nimg.src=blobUrl;img.setAttribute('data-image-id',imageId);img.setAttribute('alt',filename);console.log(' [processImageBlobs] Image base64 convertie:',dataUrl.substring(0,50)+'...','->',blobUrl,'ID:',imageId);}catch(error){console.error(' [processImageBlobs] Erreur base64 pour:',dataUrl.substring(0,50),error);}}// OPTION B: Force v√©rification + double check apr√®s processus\nconsole.log(' [processImageBlobs] OPTION B - Force v√©rification persistance...');await forceVerifyImagePersistence(container);// Double r√©hydratation apr√®s 500ms\nsetTimeout(async()=>{console.log(' [processImageBlobs] OPTION B - Double r√©hydratation...');await rehydrateImages(container);},500);console.log(' [processImageBlobs] Traitement termin√©');},[forceVerifyImagePersistence,rehydrateImages,createUniqueBlob]);// Fonction de migration des anciennes images blob: vers IndexedDB\nconst migrateOldBlobImages=useCallback(async container=>{console.log(' [migrateOldBlobImages] D√©but migration des anciennes images...');if(!container){console.warn('‚ö†Ô∏è [migrateOldBlobImages] Pas de conteneur fourni');return;}// Trouver toutes les images avec src blob: SANS data-image-id (anciennes)\nconst oldImages=container.querySelectorAll('img[src^=\"blob:\"]:not([data-image-id])');console.log(\"\\uD83D\\uDD0D [migrateOldBlobImages] \".concat(oldImages.length,\" anciennes images blob trouv\\xE9es\"));if(oldImages.length===0){console.log('‚úÖ [migrateOldBlobImages] Aucune migration n√©cessaire');return;}// Traiter chaque ancienne image\nfor(const img of oldImages){const oldBlobUrl=img.src;console.log('üîÑ [migrateOldBlobImages] Migration image:',oldBlobUrl);try{// R√©cup√©rer le blob depuis l'URL\nconst response=await fetch(oldBlobUrl);if(!response.ok){console.warn('‚ö†Ô∏è [migrateOldBlobImages] Impossible de r√©cup√©rer le blob:',response.status);continue;}const blob=await response.blob();console.log('üì¶ [migrateOldBlobImages] Blob r√©cup√©r√©:',{size:\"\".concat(Math.round(blob.size/1024),\"KB\"),type:blob.type});// Cr√©er un File pour saveImage()\nconst fileName=img.alt||\"migrated_image_\".concat(Date.now(),\".png\");const file=new File([blob],fileName,{type:blob.type});// G√©n√©rer UUID et sauvegarder en IndexedDB\nconst imageId=crypto.randomUUID();await saveImage(imageId,file);console.log('üíæ [migrateOldBlobImages] Image migr√©e vers IndexedDB:',imageId);// Mettre √† jour l'√©l√©ment img avec data-image-id\nimg.setAttribute('data-image-id',imageId);// Cr√©er nouvelle Object URL\nconst newObjectUrl=URL.createObjectURL(blob);img.src=newObjectUrl;// R√©voquer l'ancienne URL si possible\ntry{URL.revokeObjectURL(oldBlobUrl);console.log('üßπ [migrateOldBlobImages] Ancienne URL r√©voqu√©e:',oldBlobUrl);}catch(revokeError){console.warn('‚ö†Ô∏è [migrateOldBlobImages] Impossible de r√©voquer ancienne URL:',revokeError);}console.log('‚úÖ [migrateOldBlobImages] Image migr√©e avec succ√®s:',{oldUrl:oldBlobUrl,newImageId:imageId,fileName});}catch(error){console.error('‚ùå [migrateOldBlobImages] Erreur migration:',oldBlobUrl,error);// On garde l'ancienne image m√™me en cas d'erreur\n}}console.log('‚úÖ [migrateOldBlobImages] Migration termin√©e');// D√©clencher une sauvegarde du contenu apr√®s migration\nif(onInput&&container.innerHTML){console.log('üíæ [migrateOldBlobImages] D√©clenchement sauvegarde apr√®s migration...');const event=new Event('input',{bubbles:true});container.dispatchEvent(event);}},[onInput]);// Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\nconst handleTextareaResize=useCallback(textarea=>{if(textarea){textarea.style.height='auto';textarea.style.height=Math.max(384,textarea.scrollHeight)+'px';}},[]);// Effect pour la r√©hydratation des images au chargement\nuseEffect(()=>{console.log(' [Editor] Effect r√©hydratation - Chargement initial');const initImageSystem=async()=>{console.log(' [Editor] Demande stockage persistant...');// Demander le stockage persistant\nawait requestPersistentStorage();// R√©hydrater les images si l'√©diteur est pr√™t\nif(editorRef.current){console.log(' [Editor] D√©clenchement r√©hydratation...');await rehydrateImages(editorRef.current);console.log(' [Editor] D√©clenchement migration anciennes images...');await migrateOldBlobImages(editorRef.current);}else{console.warn(' [Editor] editorRef pas encore pr√™t pour r√©hydratation');}};initImageSystem();},[rehydrateImages,migrateOldBlobImages]);// Effect pour r√©hydrater quand le contenu change (nouveau document charg√©)\nuseEffect(()=>{if(content&&content!==previousContentRef.current&&editorRef.current){console.log(' [Editor] Contenu chang√© - V√©rification r√©hydratation...');previousContentRef.current=content;// D√©lai pour laisser le DOM se mettre √† jour (plus long en production)\nconst rehydrationDelay=process.env.NODE_ENV==='production'?1000:100;console.log(\" [Editor] D\\xE9lai r\\xE9hydratation: \".concat(rehydrationDelay,\"ms (env: \").concat(process.env.NODE_ENV,\")\"));setTimeout(async()=>{await rehydrateImages(editorRef.current);await migrateOldBlobImages(editorRef.current);},rehydrationDelay);}},[content,rehydrateImages,migrateOldBlobImages]);// Fonction pour formater le HTML avec des retours √† la ligne et indentation\nconst formatHtmlForSource=useCallback(html=>{let indentLevel=0;const indentSize=2;// 2 espaces par niveau\nreturn html.replace(/<br\\s*\\/?>/gi,'<br>\\n').replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi,match=>{if(match.startsWith('</')){// Balise fermante : diminuer l'indentation puis ajouter la balise\nindentLevel=Math.max(0,indentLevel-1);return match+'\\n';}else{// Balise ouvrante : ajouter la balise puis augmenter l'indentation\nconst result='\\n'+' '.repeat(indentLevel*indentSize)+match;// Augmenter l'indentation pour les balises conteneurs\nif(match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)){indentLevel++;}return result;}}).split('\\n').map((line,index)=>{if(index===0)return line.trim();// Premi√®re ligne sans indentation\nif(line.trim()==='')return'';// Ligne vide\nif(line.trim().startsWith('</')){// Balise fermante : r√©duire l'indentation\nconst currentIndent=Math.max(0,indentLevel-1);return' '.repeat(currentIndent*indentSize)+line.trim();}// Contenu texte : utiliser l'indentation actuelle\nreturn line.startsWith(' ')?line:' '.repeat(indentLevel*indentSize)+line.trim();}).join('\\n').replace(/^\\n+/,'')// Supprimer les retours √† la ligne en d√©but\n.replace(/\\n{2,}/g,'\\n')// Supprimer toutes les lignes vides multiples\n.trim();},[]);// Gestionnaire unifi√© WYSIWYG - connect√© directement √† onInput\nconst handleWysiwygChange=useCallback(e=>{console.log('üìù handleWysiwygChange d√©clench√©');if(!editorRef.current)return;// Nettoyer les spans vides et les &nbsp; en trop\nconst cleanContent=html=>{return html.replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g,'')// Supprimer spans vides SAUF les spans color√©s\n.replace(/(&nbsp;\\s*){2,}/g,'&nbsp;')// R√©duire les &nbsp; multiples\n.replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g,'<span style=\"color: $1;\">$2</span>')// Convertir font en span\n.replace(/<b\\b[^>]*>(.*?)<\\/b>/g,'<strong>$1</strong>')// Convertir b en strong\n.replace(/<i\\b[^>]*>(.*?)<\\/i>/g,'<em>$1</em>');// Convertir i en em\n};const newContent=cleanContent(editorRef.current.innerHTML);console.log('üîç Contenu actuel vs nouveau:',content.length,'vs',newContent.length);// Appel direct vers onInput du hook useEditor\nif(newContent!==content){console.log('‚úÖ WYSIWYG Changement - Appel onInput direct');onInput({target:{innerHTML:newContent}});}// D√©clencher mise √† jour du formatage apr√®s un d√©lai\nif(onSelectionChange&&!(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current)){console.log('üîÑ EDITOR handleWysiwygChange - Va appeler onSelectionChange dans 50ms');setTimeout(onSelectionChange,50);}else{console.log('‚ùå EDITOR handleWysiwygChange - onSelectionChange BLOQU√â - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);}},[content,onInput,onSelectionChange]);// Gestionnaire pour les √©v√©nements de s√©lection/curseur\nconst handleSelectionChange=useCallback(()=>{console.log('üìç EDITOR handleSelectionChange - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);if(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current){console.log('‚ùå EDITOR handleSelectionChange - BLOQU√â par ignoreFlag');return;}if(viewMode==='wysiwyg'&&document.activeElement===editorRef.current){console.log('‚úÖ EDITOR handleSelectionChange - VA APPELER onSelectionChange');onSelectionChange();}else{console.log('‚ö†Ô∏è EDITOR handleSelectionChange - SKIP conditions');}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,onSelectionChange,ignoreSelectionChangeRef]);// Initialiser le contenu uniquement si n√©cessaire\nuseEffect(()=>{const initializeContent=async()=>{if(viewMode==='wysiwyg'&&editorRef.current&&editorRef.current.innerHTML!==content){// Ne pas modifier le contenu si l'utilisateur interagit activement\nconst hasFocus=document.activeElement===editorRef.current;const hasSelection=window.getSelection().rangeCount>0;// √âviter les mises √† jour pendant l'interaction utilisateur\nif(hasFocus&&hasSelection){return;// Ne pas perturber l'utilisateur\n}// Convertir les URLs relatives PromptoDYS en Blob URLs pour affichage\nconst currentProject=getCurrentProject();let displayContent=content;if(currentProject.directory){displayContent=await convertAllPromptoDysUrlsToBlobs(content,currentProject.directory);}// Mise √† jour avec le contenu converti\neditorRef.current.innerHTML=displayContent;// Re-rendre MathJax apr√®s mise √† jour du contenu\nif(window.MathJax&&window.MathJax.typesetPromise){window.MathJax.typesetPromise([editorRef.current]).catch(err=>{console.warn('Erreur MathJax:',err);});}// SOLUTION F5: Forcer le retraitement des poign√©es apr√®s initialisation\nsetTimeout(()=>{var _editorRef$current,_editorRef$current2;console.log('üîÑ [F5 Fix] Retraitement forc√© des poign√©es d\\'images apr√®s initialisation');const images=(_editorRef$current=editorRef.current)===null||_editorRef$current===void 0?void 0:_editorRef$current.querySelectorAll('img');if(images&&(_editorRef$current2=editorRef.current)!==null&&_editorRef$current2!==void 0&&_editorRef$current2.addResizeHandlesToImage){images.forEach(img=>{// Retirer le marqueur data-resizable pour forcer le retraitement\nimg.removeAttribute('data-resizable');// Retirer le wrapper s'il existe d√©j√†\nconst existingWrapper=img.closest('.resizable-image');if(existingWrapper){const parent=existingWrapper.parentNode;parent.insertBefore(img,existingWrapper);existingWrapper.remove();}// Retraiter l'image\neditorRef.current.addResizeHandlesToImage(img);});console.log('‚úÖ [F5 Fix] Poign√©es retrait√©es pour',images.length,'image(s)');}},300);// D√©lai pour s'assurer que tout est bien initialis√©\n}};initializeContent();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,content]);// Gestionnaire pour la copie - convertir HTML en texte propre et g√©rer les images s√©lectionn√©es\nconst handleCopy=useCallback(e=>{if(viewMode==='wysiwyg'&&editorRef.current){// Priorit√© 1: Si une image est s√©lectionn√©e, copier l'image\nif(selectedImage){try{// Cr√©er un √©l√©ment temporaire avec l'image\nconst tempDiv=document.createElement('div');const clonedImg=selectedImage.cloneNode(true);tempDiv.appendChild(clonedImg);// Copier au format HTML pour pr√©server la structure\ne.clipboardData.setData('text/html',tempDiv.innerHTML);// Copier aussi le src comme texte de fallback\ne.clipboardData.setData('text/plain',selectedImage.src);e.preventDefault();return;}catch(error){console.warn('Erreur copie image:',error);}}// Priorit√© 2: S√©lection de texte classique\nconst selection=window.getSelection();if(selection.rangeCount>0){const range=selection.getRangeAt(0);const selectedContent=range.cloneContents();const tempDiv=document.createElement('div');tempDiv.appendChild(selectedContent);// Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\nconst htmlContent=tempDiv.innerHTML;const textContent=htmlContent.replace(/<div[^>]*>/gi,'').replace(/<\\/div>/gi,'\\n').replace(/<br\\s*\\/?>/gi,'\\n').replace(/<p[^>]*>/gi,'').replace(/<\\/p>/gi,'\\n').replace(/<[^>]+>/g,'')// Supprimer toutes les autres balises\n.replace(/&nbsp;/g,' ').replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'\"').replace(/&#39;/g,\"'\").replace(/\\n+$/,'');// Supprimer les retours √† la ligne en fin\n// Mettre le texte propre dans le presse-papier\ne.clipboardData.setData('text/plain',textContent);e.preventDefault();}}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,selectedImage]);// Gestionnaire pour forcer le refresh apr√®s coller\nconst handlePaste=useCallback(e=>{console.log('üìã [DEBUG] handlePaste D√âCLENCH√â!',{viewMode,hasEditor:!!editorRef.current});if(viewMode==='wysiwyg'&&editorRef.current){// Attendre que le contenu soit coll√©\nsetTimeout(async()=>{console.log('üîÑ Refresh forc√© apr√®s coller');// Traiter les images coll√©es pour leur donner des URLs blob uniques\nif(storeBlobForUrl){await processImageBlobs(editorRef.current,storeBlobForUrl);}console.log('‚úÖ [handlePaste] Images trait√©es par processImageBlobs (Option B incluse)');// Ajouter les poign√©es aux nouvelles images coll√©es\nconst newImages=editorRef.current.querySelectorAll('img:not([data-resizable])');newImages.forEach(img=>{if(editorRef.current.addResizeHandlesToImage){editorRef.current.addResizeHandlesToImage(img);}});// D√©clencher sauvegarde\nif(onInput){const event=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(event);}},100);// setTimeout\n}console.log('üìã [DEBUG] handlePaste termin√©');// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,handleSelectionChange,handleCopy]);// Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\nuseEffect(()=>{if(viewMode!=='wysiwyg'&&editorRef.current){handleTextareaResize(editorRef.current);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[content,viewMode,handleTextareaResize]);// Effect pour attacher les gestionnaires d'√©v√©nements\nuseEffect(()=>{console.log('üîó [DEBUG] Attachement events, viewMode:',viewMode,'editorRef:',!!editorRef.current);if(viewMode==='wysiwyg'&&editorRef.current){// Debug g√©n√©rique pour TOUS les events paste\nconst debugPaste=e=>{console.log('üî• [DEBUG] PASTE EVENT D√âTECT√â!',{target:e.target.tagName,currentTarget:e.currentTarget.tagName,hasClipboardData:!!e.clipboardData});};document.addEventListener('selectionchange',handleSelectionChange);editorRef.current.addEventListener('copy',handleCopy);editorRef.current.addEventListener('paste',handlePaste);editorRef.current.addEventListener('paste',debugPaste);// DEBUG GLOBAL\nconsole.log('‚úÖ [DEBUG] Event paste attach√© √† editorRef.current + debug global');return()=>{var _editorRef$current3,_editorRef$current4,_editorRef$current5;console.log('üóëÔ∏è [DEBUG] Nettoyage events');document.removeEventListener('selectionchange',handleSelectionChange);(_editorRef$current3=editorRef.current)===null||_editorRef$current3===void 0?void 0:_editorRef$current3.removeEventListener('copy',handleCopy);(_editorRef$current4=editorRef.current)===null||_editorRef$current4===void 0?void 0:_editorRef$current4.removeEventListener('paste',handlePaste);(_editorRef$current5=editorRef.current)===null||_editorRef$current5===void 0?void 0:_editorRef$current5.removeEventListener('paste',debugPaste);};}},[viewMode,handleSelectionChange,handleCopy]);// Effect pour appliquer le style de s√©lection d'image\nuseEffect(()=>{if(viewMode==='wysiwyg'&&editorRef.current){// Supprimer la classe de toutes les images\nconst allImages=editorRef.current.querySelectorAll('img');allImages.forEach(img=>{const wrapper=img.closest('.resizable-image');if(wrapper){wrapper.classList.remove('image-selected');}});// Ajouter la classe √† l'image s√©lectionn√©e\nif(selectedImage){const wrapper=selectedImage.closest('.resizable-image');if(wrapper){wrapper.classList.add('image-selected');}}}},[selectedImage,viewMode,content]);// Gestion des poign√©es de redimensionnement pour les images\nuseEffect(()=>{if(viewMode==='wysiwyg'&&editorRef.current){const addResizeHandlesToImage=img=>{var _img$parentElement;// Exposer la fonction pour r√©utilisation\neditorRef.current.addResizeHandlesToImage=addResizeHandlesToImage;// Toutes les images sont trait√©es normalement\n// V√©rifier si d√©j√† trait√©\nif(img.getAttribute('data-resizable')||(_img$parentElement=img.parentElement)!==null&&_img$parentElement!==void 0&&_img$parentElement.classList.contains('resizable-image')){return;}// Attendre que l'image soit charg√©e\nif(!img.complete||img.naturalWidth===0){img.addEventListener('load',()=>addResizeHandlesToImage(img),{once:true});return;}img.setAttribute('data-resizable','true');// Wrapper l'image dans un conteneur redimensionnable\nconst wrapper=document.createElement('div');wrapper.className='resizable-image';// Ajouter gestionnaire de clic pour s√©lection d'image\nimg.addEventListener('click',e=>{e.stopPropagation();if(onImageClick){onImageClick(img);}});// Extraire les dimensions depuis le style inline ou les attributs\nlet currentWidth,currentHeight;// Priorit√© 1: attributs HTML (ex: width=\"300px\")\nconst attrWidth=img.getAttribute('width');const attrHeight=img.getAttribute('height');// Priorit√© 2: style inline (ex: style=\"width: 300px\")\nconst styleWidth=img.style.width;const styleHeight=img.style.height;if(attrWidth&&attrHeight){currentWidth=parseInt(attrWidth);currentHeight=parseInt(attrHeight);console.log('üìè Dimensions depuis attributs:',currentWidth,'x',currentHeight);}else if(styleWidth&&styleHeight){currentWidth=parseInt(styleWidth);currentHeight=parseInt(styleHeight);console.log('üìè Dimensions depuis style:',currentWidth,'x',currentHeight);}else{// Fallback: dimensions naturelles\ncurrentWidth=img.naturalWidth||300;currentHeight=img.naturalHeight||200;console.log('üìè Dimensions naturelles:',currentWidth,'x',currentHeight);}// Limiter la hauteur maximale √† 300px en pr√©servant le ratio d'aspect\nconst MAX_HEIGHT=300;if(currentHeight>MAX_HEIGHT){const aspectRatio=currentWidth/currentHeight;currentHeight=MAX_HEIGHT;currentWidth=Math.round(currentHeight*aspectRatio);console.log('üîÑ Image redimensionn√©e pour hauteur max 300px:',currentWidth,'x',currentHeight);// Appliquer les nouvelles dimensions √† l'image\nimg.setAttribute('width',currentWidth+'px');img.setAttribute('height',currentHeight+'px');img.style.width=currentWidth+'px';img.style.height=currentHeight+'px';}wrapper.style.width=currentWidth+'px';wrapper.style.height=currentHeight+'px';// Ins√©rer le wrapper\nimg.parentNode.insertBefore(wrapper,img);wrapper.appendChild(img);// Cr√©er les 4 poign√©es\n['nw','ne','sw','se'].forEach(corner=>{const handle=document.createElement('div');handle.className=\"resize-handle \".concat(corner);handle.dataset.corner=corner;handle.addEventListener('mousedown',e=>{e.preventDefault();e.stopPropagation();const startX=e.clientX;const startY=e.clientY;const startWidth=wrapper.offsetWidth;const startHeight=wrapper.offsetHeight;const aspectRatio=startWidth/startHeight;const handleMouseMove=e=>{const deltaX=e.clientX-startX;const deltaY=e.clientY-startY;let newWidth=startWidth;let newHeight=startHeight;// Calculer les nouvelles dimensions selon le coin\nswitch(corner){case'se':// Sud-Est\nnewWidth=Math.max(50,startWidth+deltaX);newHeight=newWidth/aspectRatio;break;case'sw':// Sud-Ouest\nnewWidth=Math.max(50,startWidth-deltaX);newHeight=newWidth/aspectRatio;break;case'ne':// Nord-Est\nnewWidth=Math.max(50,startWidth+deltaX);newHeight=newWidth/aspectRatio;break;case'nw':// Nord-Ouest\nnewWidth=Math.max(50,startWidth-deltaX);newHeight=newWidth/aspectRatio;break;}// Appliquer les nouvelles dimensions\nwrapper.style.width=newWidth+'px';wrapper.style.height=newHeight+'px';img.style.width='100%';img.style.height='100%';// Ajouter les attributs HTML width/height pour persistance lors des conversions\nimg.setAttribute('width',Math.round(newWidth)+'px');img.setAttribute('height',Math.round(newHeight)+'px');};const handleMouseUp=()=>{document.removeEventListener('mousemove',handleMouseMove);document.removeEventListener('mouseup',handleMouseUp);// D√©clencher l'√©v√©nement de changement pour sauvegarder\nif(onInput){const event=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(event);}};document.addEventListener('mousemove',handleMouseMove);document.addEventListener('mouseup',handleMouseUp);});wrapper.appendChild(handle);});};// Observer pour d√©tecter les nouvelles images\nconst handleMutation=mutations=>{mutations.forEach(mutation=>{mutation.addedNodes.forEach(node=>{if(node.nodeName==='IMG'){addResizeHandlesToImage(node);}else if(node.querySelectorAll){node.querySelectorAll('img').forEach(addResizeHandlesToImage);}});});};const observer=new MutationObserver(handleMutation);observer.observe(editorRef.current,{childList:true,subtree:true});// Traiter les images existantes\neditorRef.current.querySelectorAll('img').forEach(addResizeHandlesToImage);return()=>observer.disconnect();}},[viewMode,onInput,content]);// Effect supprim√© - La gestion des poign√©es est maintenant dans l'effect pr√©c√©dent\n// Rendu conditionnel avec switch/case pour garantir une seule vue\nconsole.log('üîÑ Editor.js - Rendu switch/case, viewMode:',viewMode);switch(viewMode){case'wysiwyg':console.log('üéØ SWITCH - Vue WYSIWYG');return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"style\",{children:\"\\n            .editor-content h1 { \\n              font-size: 2em; \\n              font-weight: bold; \\n              margin: 0.67em 0; \\n              line-height: 1.2;\\n            }\\n            .editor-content h2 { \\n              font-size: 1.5em; \\n              font-weight: bold; \\n              margin: 0.75em 0; \\n              line-height: 1.3;\\n            }\\n            .editor-content h3 { \\n              font-size: 1.17em; \\n              font-weight: bold; \\n              margin: 0.83em 0; \\n              line-height: 1.4;\\n            }\\n            .editor-content p {\\n              margin: 0.5em 0;\\n            }\\n            .editor-content ul {\\n              margin: 0.5em 0;\\n              padding-left: 2em;\\n              list-style-type: disc;\\n            }\\n            .editor-content ol {\\n              margin: 0.5em 0;\\n              padding-left: 2em;\\n              list-style-type: decimal;\\n            }\\n            .editor-content ol[style*=\\\"lower-alpha\\\"] {\\n              list-style-type: lower-alpha;\\n            }\\n            .editor-content li {\\n              margin: 0.25em 0;\\n            }\\n            \\n            /* Styles pour images redimensionnables */\\n            .editor-content img {\\n              max-width: 100%;\\n              height: auto;\\n              position: relative;\\n              cursor: pointer;\\n            }\\n            \\n            .resizable-image {\\n              position: relative;\\n              display: inline-block;\\n              border: 2px solid transparent;\\n            }\\n            \\n            .resizable-image:hover {\\n              border: 2px solid #3b82f6;\\n            }\\n            \\n            /* Style pour image s\\xE9lectionn\\xE9e - SOLUTION RADICALE */\\n            .image-selected {\\n              position: relative;\\n            }\\n            \\n            .image-selected::after {\\n              content: '';\\n              position: absolute;\\n              top: -4px;\\n              left: -4px;\\n              right: -4px;\\n              bottom: -4px;\\n              border: 4px solid #1d4ed8;\\n              box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.3), 0 0 12px rgba(29, 78, 216, 0.4);\\n              background: rgba(29, 78, 216, 0.05);\\n              outline: 2px solid #ffffff;\\n              outline-offset: 2px;\\n              pointer-events: none;\\n              z-index: 1;\\n            }\\n            \\n            .resizable-image img {\\n              width: 100%;\\n              height: 100%;\\n              display: block;\\n              position: relative;\\n              z-index: 0;\\n            }\\n            \\n            .resizable-image .resize-handle {\\n              position: absolute;\\n              width: 10px;\\n              height: 10px;\\n              background: #3b82f6;\\n              border: 2px solid white;\\n              border-radius: 50%;\\n              opacity: 0;\\n              cursor: nw-resize;\\n              transition: opacity 0.2s;\\n            }\\n            \\n            .resizable-image:hover .resize-handle,\\n            .image-selected .resize-handle {\\n              opacity: 1;\\n            }\\n            \\n            .resize-handle.nw { top: -2px; left: -2px; cursor: nw-resize; }\\n            .resize-handle.ne { top: -2px; right: -2px; cursor: ne-resize; }\\n            .resize-handle.sw { bottom: -2px; left: -2px; cursor: sw-resize; }\\n            .resize-handle.se { bottom: -2px; right: -2px; cursor: se-resize; }\\n          \"}),/*#__PURE__*/_jsx(\"div\",{ref:el=>{editorRef.current=el;},contentEditable:\"true\",suppressContentEditableWarning:true,spellCheck:false,onInput:e=>{console.log('üéØ WYSIWYG onInput d√©clench√©!');handleWysiwygChange(e);},onKeyUp:e=>{console.log('‚å®Ô∏è WYSIWYG onKeyUp d√©clench√©! Touche:',e.key);handleWysiwygChange(e);},onPaste:e=>{console.log('üìã WYSIWYG onPaste d√©clench√©!');setTimeout(()=>handleWysiwygChange(e),10);// D√©lai pour laisser le paste s'appliquer\n},onMouseUp:e=>{console.log('üñ±Ô∏è WYSIWYG onMouseUp - S√©lection chang√©e - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);if(onSelectionChange&&!(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current)){console.log('‚úÖ EDITOR onMouseUp - VA APPELER onSelectionChange dans 10ms');setTimeout(onSelectionChange,10);}else{console.log('‚ùå EDITOR onMouseUp - onSelectionChange BLOQU√â');}},onKeyDown:e=>{// Protection contre les √©v√©nements undefined\nif(!e||!e.key){console.warn('‚ö†Ô∏è √âv√©nement onKeyDown invalide:',e);return;}console.log('üîΩ WYSIWYG onKeyDown d√©clench√©! Touche:',e.key);// Gestion des touches pour les images s√©lectionn√©es\nif(selectedImage){if(e.key==='Delete'||e.key==='Backspace'){e.preventDefault();// Supprimer l'image directement\nconst wrapper=selectedImage.closest('.resizable-image');const elementToRemove=wrapper||selectedImage;elementToRemove.remove();// D√©s√©lectionner l'image\nif(onImageClick){onImageClick(null);}// D√©clencher la sauvegarde\nif(onInput){const event=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(event);}return;}else if(e.key==='Enter'){e.preventDefault();// Ins√©rer une nouvelle ligne apr√®s l'image s√©lectionn√©e\nconst wrapper=selectedImage.closest('.resizable-image');if(wrapper){const newParagraph=document.createElement('p');newParagraph.innerHTML='<br>';wrapper.parentNode.insertBefore(newParagraph,wrapper.nextSibling);console.log('üìç ENTER Image - Cr√©ation du paragraphe:',newParagraph);// Attendre que tous les √©v√©nements (onInput, handleWysiwygChange, etc.) se stabilisent\nsetTimeout(()=>{var _editorRef$current6;console.log('üìç ENTER Image - Positionnement curseur APR√àS stabilisation');const selection=window.getSelection();const range=document.createRange();console.log('üìç ENTER Image - Selection avant (delayed):',selection.rangeCount);// Positionner au d√©but du paragraphe\nrange.setStart(newParagraph,0);range.collapse(true);console.log('üìç ENTER Image - Range (delayed) startContainer:',range.startContainer);console.log('üìç ENTER Image - Range (delayed) startOffset:',range.startOffset);selection.removeAllRanges();selection.addRange(range);console.log('üìç ENTER Image - Selection (delayed) apr√®s:',selection.rangeCount);// Focus pour s'assurer que le curseur est visible\n(_editorRef$current6=editorRef.current)===null||_editorRef$current6===void 0?void 0:_editorRef$current6.focus();console.log('üìç ENTER Image - Positionnement termin√© avec succ√®s!');},100);// D√©lai pour laisser les √©v√©nements se stabiliser\n// D√©clencher la sauvegarde\nif(onInput){const event=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(event);}// D√©s√©lectionner l'image\nif(onImageClick){onImageClick(null);}}return;}}// Mise √† jour du formatage pour les touches de navigation\nif(e&&e.key&&(e.key==='ArrowUp'||e.key==='ArrowDown'||e.key==='ArrowLeft'||e.key==='ArrowRight')){setTimeout(()=>{console.log('üîº EDITOR onKeyDown Navigation - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);if(onSelectionChange&&!(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current)){console.log('‚úÖ EDITOR Navigation - VA APPELER onSelectionChange');onSelectionChange();}else{console.log('‚ùå EDITOR Navigation - onSelectionChange BLOQU√â');}},10);}},onFocus:e=>{console.log('üîç WYSIWYG onFocus - Mise √† jour formatage - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);if(onSelectionChange&&!(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current)){console.log('‚úÖ EDITOR onFocus - VA APPELER onSelectionChange dans 10ms');setTimeout(onSelectionChange,10);}else{console.log('‚ùå EDITOR onFocus - onSelectionChange BLOQU√â');}},onChange:e=>{console.log('üîÑ onChange d√©clench√©!');},onClick:onEditorClick,style:{minHeight:'384px',outline:'none',padding:'20px',lineHeight:'var(--dys-line-height)',fontFamily:'var(--dys-font-family)',fontSize:'var(--dys-font-size)',color:'var(--dys-text-color)',backgroundColor:'var(--dys-bg-color)',overflow:'auto',wordWrap:'break-word',whiteSpace:'pre-wrap',border:'1px solid #e5e7eb'}})]},\"wysiwyg\");case'markdown':{console.log('üìù SWITCH - Vue MARKDOWN');const displayContent=content;return/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"textarea\",{ref:el=>{if(editorRef)editorRef.current=el;},value:displayContent,onChange:e=>{const newValue=e.target.value;const originalContent=content;if(newValue!==originalContent){onInput(_objectSpread(_objectSpread({},e),{},{target:_objectSpread(_objectSpread({},e.target),{},{value:newValue})}));}},spellCheck:false,className:\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",style:{fontFamily:'var(--dys-font-family)',fontSize:'var(--dys-font-size)',lineHeight:'var(--dys-line-height)',color:'var(--dys-text-color)',backgroundColor:'var(--dys-bg-color)',overflow:'auto',wordWrap:'break-word',whiteSpace:'pre-wrap',paddingBottom:'2rem'},placeholder:\"\\xC9crivez en Markdown... # Titre 1\\n## Titre 2\\n### Titre 3 **Gras** *Italique* - Liste \\xE0 puces\\n1. Liste num\\xE9rot\\xE9e\\na. Liste alphab\\xE9tique $E = mc^2$ (formule inline)\\n$$\\\\\\\\int_{-\\\\\\\\infty}^{\\\\\\\\infty} e^{-x^2} dx = \\\\\\\\sqrt{\\\\\\\\pi}$$ (formule block)\"})},\"markdown\");}case'html':{console.log('üîß SWITCH - Vue HTML');const htmlDisplayContent=formatHtmlForSource(content);return/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"textarea\",{ref:el=>{if(editorRef)editorRef.current=el;},value:htmlDisplayContent,onChange:e=>{const newValue=e.target.value;const originalWithCollapse=formatHtmlForSource(content);if(newValue!==originalWithCollapse){onInput(_objectSpread(_objectSpread({},e),{},{target:_objectSpread(_objectSpread({},e.target),{},{value:newValue})}));}},className:\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",style:{fontFamily:'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',overflow:'auto',wordWrap:'break-word',whiteSpace:'pre-wrap',border:'1px solid #e5e7eb',paddingBottom:'2rem'},placeholder:\"Code source HTML...\"})},\"html\");}default:console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:',viewMode);return null;}});export default Editor;","map":{"version":3,"names":["React","useCallback","useEffect","useRef","forwardRef","convertAllPromptoDysUrlsToBlobs","getCurrentProject","loadImage","saveImage","requestPersistentStorage","jsx","_jsx","jsxs","_jsxs","Editor","_ref","ref","content","setContent","viewMode","onInput","currentFormat","onFormatChange","mathJaxReady","ignoreSelectionChangeRef","selectedImage","onImageClick","onEditorClick","onDeleteSelectedImage","onSelectionChange","storeBlobForUrl","editorRef","isInitializedRef","previousContentRef","createUniqueBlob","file","uniqueId","concat","Date","now","Math","random","toString","substr","uniqueName","name","uniqueFile","File","type","blobUrl","URL","createObjectURL","console","log","forceVerifyImagePersistence","container","imagesWithId","querySelectorAll","length","img","imageId","getAttribute","blob","round","size","error","src","startsWith","response","fetch","newBlob","rehydrateImages","warn","images","objectUrl","width","height","alt","oldSrc","newSrc","processImageBlobs","blobImages","originalUrl","base64Images","dataUrl","timestamp","toISOString","replace","slice","filename","crypto","randomUUID","setAttribute","substring","setTimeout","migrateOldBlobImages","oldImages","oldBlobUrl","ok","status","fileName","newObjectUrl","revokeObjectURL","revokeError","oldUrl","newImageId","innerHTML","event","Event","bubbles","dispatchEvent","handleTextareaResize","textarea","style","max","scrollHeight","initImageSystem","current","rehydrationDelay","process","env","NODE_ENV","formatHtmlForSource","html","indentLevel","indentSize","match","result","repeat","split","map","line","index","trim","currentIndent","join","handleWysiwygChange","e","cleanContent","newContent","target","handleSelectionChange","document","activeElement","initializeContent","hasFocus","hasSelection","window","getSelection","rangeCount","currentProject","displayContent","directory","MathJax","typesetPromise","catch","err","_editorRef$current","_editorRef$current2","addResizeHandlesToImage","forEach","removeAttribute","existingWrapper","closest","parent","parentNode","insertBefore","remove","handleCopy","tempDiv","createElement","clonedImg","cloneNode","appendChild","clipboardData","setData","preventDefault","selection","range","getRangeAt","selectedContent","cloneContents","htmlContent","textContent","handlePaste","hasEditor","newImages","debugPaste","tagName","currentTarget","hasClipboardData","addEventListener","_editorRef$current3","_editorRef$current4","_editorRef$current5","removeEventListener","allImages","wrapper","classList","add","_img$parentElement","parentElement","contains","complete","naturalWidth","once","className","stopPropagation","currentWidth","currentHeight","attrWidth","attrHeight","styleWidth","styleHeight","parseInt","naturalHeight","MAX_HEIGHT","aspectRatio","corner","handle","dataset","startX","clientX","startY","clientY","startWidth","offsetWidth","startHeight","offsetHeight","handleMouseMove","deltaX","deltaY","newWidth","newHeight","handleMouseUp","handleMutation","mutations","mutation","addedNodes","node","nodeName","observer","MutationObserver","observe","childList","subtree","disconnect","children","el","contentEditable","suppressContentEditableWarning","spellCheck","onKeyUp","key","onPaste","onMouseUp","onKeyDown","elementToRemove","newParagraph","nextSibling","_editorRef$current6","createRange","setStart","collapse","startContainer","startOffset","removeAllRanges","addRange","focus","onFocus","onChange","onClick","minHeight","outline","padding","lineHeight","fontFamily","fontSize","color","backgroundColor","overflow","wordWrap","whiteSpace","border","value","newValue","originalContent","_objectSpread","paddingBottom","placeholder","htmlDisplayContent","originalWithCollapse"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/components/Editor.js"],"sourcesContent":["import React, { useCallback, useEffect, useRef, forwardRef } from 'react';\nimport { convertAllPromptoDysUrlsToBlobs, getCurrentProject } from '../utils/promptoDysManager';\nimport { loadImage, saveImage, requestPersistentStorage } from '../utils/imageStore';\n\nconst Editor = forwardRef(({ \n  content, \n  setContent, \n  viewMode, \n  onInput, \n  currentFormat, \n  onFormatChange, \n  mathJaxReady, \n  ignoreSelectionChangeRef,\n  selectedImage,\n  onImageClick,\n  onEditorClick,\n  onDeleteSelectedImage,\n  onSelectionChange,\n  storeBlobForUrl,\n  editorRef\n}, ref) => {\n  \n  \n  // Utilise editorRef pass√©e en props (pas de ref locale)\n  const isInitializedRef = useRef(false);\n  const previousContentRef = useRef('');\n  \n  // Fonction pour cr√©er des blobs uniques (mutualisation avec Toolbar)\n  const createUniqueBlob = useCallback((file, storeBlobForUrl) => {\n    const uniqueId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    const uniqueName = `${uniqueId}_${file.name}`;\n    const uniqueFile = new File([file], uniqueName, { type: file.type });\n    const blobUrl = URL.createObjectURL(uniqueFile);\n    \n    console.log('üéØ [createUniqueBlob] Cr√©ation blob unique:', uniqueName, '->', blobUrl);\n    storeBlobForUrl(blobUrl, uniqueFile);\n    \n    return { blobUrl, uniqueFile };\n  }, []);\n\n  // Fonction de v√©rification force de la persistance des images\n  const forceVerifyImagePersistence = useCallback(async (container) => {\n    console.log('üîç [forceVerify] V√©rification persistance images...');\n    \n    const imagesWithId = container.querySelectorAll('img[data-image-id]');\n    console.log(`üîç [forceVerify] ${imagesWithId.length} images avec data-image-id trouv√©es`);\n    \n    for (const img of imagesWithId) {\n      const imageId = img.getAttribute('data-image-id');\n      try {\n        const blob = await loadImage(imageId);\n        if (blob) {\n          console.log(`‚úÖ [forceVerify] Image ${imageId} OK en IndexedDB (${Math.round(blob.size/1024)}KB)`);\n        } else {\n          console.error(`‚ùå [forceVerify] Image ${imageId} MANQUANTE en IndexedDB`);\n          // Re-sauvegarder depuis l'URL actuelle si possible\n          if (img.src.startsWith('blob:')) {\n            try {\n              const response = await fetch(img.src);\n              const newBlob = await response.blob();\n              await saveImage(imageId, newBlob);\n              console.log(`üîÑ [forceVerify] Re-sauvegarde OK pour ${imageId}`);\n            } catch (error) {\n              console.error(`‚ùå [forceVerify] √âchec re-sauvegarde ${imageId}:`, error);\n            }\n          }\n        }\n      } catch (error) {\n        console.error(` [forceVerify] Erreur v√©rification ${imageId}:`, error);\n      }\n    }\n  }, []);\n\n  // Fonction de r√©hydratation des images depuis IndexedDB\n  const rehydrateImages = useCallback(async (container) => {\n    console.log(' [rehydrateImages] D√©but r√©hydratation des images...');\n    \n    if (!container) {\n      console.warn(' [rehydrateImages] Pas de conteneur fourni');\n      return;\n    }\n\n    // Trouver toutes les images avec data-image-id\n    const images = container.querySelectorAll('img[data-image-id]');\n    console.log(` [rehydrateImages] ${images.length} images avec data-image-id trouv√©es`);\n\n    // Traiter chaque image\n    for (const img of images) {\n      const imageId = img.getAttribute('data-image-id');\n      console.log(' [rehydrateImages] Traitement image:', imageId);\n\n      try {\n        // Charger l'image depuis IndexedDB\n        const objectUrl = await loadImage(imageId);\n        \n        if (objectUrl) {\n          // Conserver les attributs existants\n          const width = img.getAttribute('width');\n          const height = img.getAttribute('height');\n          const alt = img.getAttribute('alt') || '';\n          \n          console.log(' [rehydrateImages] Image charg√©e:', {\n            imageId,\n            oldSrc: img.src,\n            newSrc: objectUrl,\n            width,\n            height,\n            alt\n          });\n          \n          // Mettre √† jour la source\n          img.src = objectUrl;\n          \n          console.log(' [rehydrateImages] Image r√©hydrat√©e avec succ√®s:', imageId);\n        } else {\n          console.warn(' [rehydrateImages] Image non trouv√©e en IndexedDB:', imageId);\n          // On garde l'image avec son data-image-id pour un essai ult√©rieur\n        }\n      } catch (error) {\n        console.error(' [rehydrateImages] Erreur r√©hydratation:', imageId, error);\n      }\n    }\n\n    console.log(' [rehydrateImages] R√©hydratation termin√©e');\n  }, []);\n\n  // Fonction mutualis√©e pour traiter les images coll√©es et les rendre uniques\n  const processImageBlobs = useCallback(async (container, storeBlobForUrl) => {\n    console.log(' [processImageBlobs] Traitement des images...');\n    \n    // Traiter les images blob: temporaires\n    const blobImages = container.querySelectorAll('img[src^=\"blob:\"]');\n    console.log('üîç [processImageBlobs] Images blob trouv√©es:', blobImages.length);\n    \n    for (const img of blobImages) {\n      const originalUrl = img.src;\n      \n      try {\n        console.log('üì• [processImageBlobs] Traitement blob:', originalUrl);\n        \n        // R√©cup√©rer le blob original\n        const response = await fetch(originalUrl);\n        const blob = await response.blob();\n        \n        // Cr√©er un nouveau File avec un nom unique\n        const file = new File([blob], 'pasted-image.png', { type: blob.type });\n        const { blobUrl } = createUniqueBlob(file, storeBlobForUrl);\n        \n        // Remplacer l'URL dans l'image\n        img.src = blobUrl;\n        console.log('‚úÖ [processImageBlobs] Image blob mise √† jour:', originalUrl, '->', blobUrl);\n        \n      } catch (error) {\n        console.error('‚ùå [processImageBlobs] Erreur blob pour:', originalUrl, error);\n      }\n    }\n    \n    // Traiter les images base64 coll√©es (copie d'√©cran Windows)\n    const base64Images = container.querySelectorAll('img[src^=\"data:image/\"]');\n    console.log('üîç [processImageBlobs] Images base64 trouv√©es:', base64Images.length);\n    \n    for (const img of base64Images) {\n      const dataUrl = img.src;\n      \n      try {\n        console.log('üì• [processImageBlobs] Traitement base64 (longueur:', dataUrl.length, 'chars)');\n        \n        // Convertir data URL en blob\n        const response = await fetch(dataUrl);\n        const blob = await response.blob();\n        \n        // G√©n√©rer nom de fichier unique\n        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n        const filename = `pasted-screenshot-${timestamp}.png`;\n        \n        // G√©n√©rer ID unique et stocker dans IndexedDB\n        const imageId = crypto.randomUUID();\n        await saveImage(imageId, blob);\n        \n        // Cr√©er blob URL temporaire pour affichage\n        const blobUrl = URL.createObjectURL(blob);\n        \n        // Stocker le mapping URL->File pour compatibilit√©\n        const file = new File([blob], filename, { type: blob.type });\n        if (storeBlobForUrl) {\n          storeBlobForUrl(blobUrl, file);\n        }\n        \n        // Remplacer l'image base64 par blob + data-image-id\n        img.src = blobUrl;\n        img.setAttribute('data-image-id', imageId);\n        img.setAttribute('alt', filename);\n        \n        console.log(' [processImageBlobs] Image base64 convertie:', dataUrl.substring(0, 50) + '...', '->', blobUrl, 'ID:', imageId);\n        \n      } catch (error) {\n        console.error(' [processImageBlobs] Erreur base64 pour:', dataUrl.substring(0, 50), error);\n      }\n    }\n    \n    // OPTION B: Force v√©rification + double check apr√®s processus\n    console.log(' [processImageBlobs] OPTION B - Force v√©rification persistance...');\n    await forceVerifyImagePersistence(container);\n    \n    // Double r√©hydratation apr√®s 500ms\n    setTimeout(async () => {\n      console.log(' [processImageBlobs] OPTION B - Double r√©hydratation...');\n      await rehydrateImages(container);\n    }, 500);\n    \n    console.log(' [processImageBlobs] Traitement termin√©');\n  }, [forceVerifyImagePersistence, rehydrateImages, createUniqueBlob]);\n\n\n  // Fonction de migration des anciennes images blob: vers IndexedDB\n  const migrateOldBlobImages = useCallback(async (container) => {\n    console.log(' [migrateOldBlobImages] D√©but migration des anciennes images...');\n    \n    if (!container) {\n      console.warn('‚ö†Ô∏è [migrateOldBlobImages] Pas de conteneur fourni');\n      return;\n    }\n\n    // Trouver toutes les images avec src blob: SANS data-image-id (anciennes)\n    const oldImages = container.querySelectorAll('img[src^=\"blob:\"]:not([data-image-id])');\n    console.log(`üîç [migrateOldBlobImages] ${oldImages.length} anciennes images blob trouv√©es`);\n\n    if (oldImages.length === 0) {\n      console.log('‚úÖ [migrateOldBlobImages] Aucune migration n√©cessaire');\n      return;\n    }\n\n    // Traiter chaque ancienne image\n    for (const img of oldImages) {\n      const oldBlobUrl = img.src;\n      console.log('üîÑ [migrateOldBlobImages] Migration image:', oldBlobUrl);\n\n      try {\n        // R√©cup√©rer le blob depuis l'URL\n        const response = await fetch(oldBlobUrl);\n        if (!response.ok) {\n          console.warn('‚ö†Ô∏è [migrateOldBlobImages] Impossible de r√©cup√©rer le blob:', response.status);\n          continue;\n        }\n        \n        const blob = await response.blob();\n        console.log('üì¶ [migrateOldBlobImages] Blob r√©cup√©r√©:', {\n          size: `${Math.round(blob.size/1024)}KB`,\n          type: blob.type\n        });\n\n        // Cr√©er un File pour saveImage()\n        const fileName = img.alt || `migrated_image_${Date.now()}.png`;\n        const file = new File([blob], fileName, { type: blob.type });\n        \n        // G√©n√©rer UUID et sauvegarder en IndexedDB\n        const imageId = crypto.randomUUID();\n        await saveImage(imageId, file);\n        console.log('üíæ [migrateOldBlobImages] Image migr√©e vers IndexedDB:', imageId);\n        \n        // Mettre √† jour l'√©l√©ment img avec data-image-id\n        img.setAttribute('data-image-id', imageId);\n        \n        // Cr√©er nouvelle Object URL\n        const newObjectUrl = URL.createObjectURL(blob);\n        img.src = newObjectUrl;\n        \n        // R√©voquer l'ancienne URL si possible\n        try {\n          URL.revokeObjectURL(oldBlobUrl);\n          console.log('üßπ [migrateOldBlobImages] Ancienne URL r√©voqu√©e:', oldBlobUrl);\n        } catch (revokeError) {\n          console.warn('‚ö†Ô∏è [migrateOldBlobImages] Impossible de r√©voquer ancienne URL:', revokeError);\n        }\n        \n        console.log('‚úÖ [migrateOldBlobImages] Image migr√©e avec succ√®s:', {\n          oldUrl: oldBlobUrl,\n          newImageId: imageId,\n          fileName\n        });\n        \n      } catch (error) {\n        console.error('‚ùå [migrateOldBlobImages] Erreur migration:', oldBlobUrl, error);\n        // On garde l'ancienne image m√™me en cas d'erreur\n      }\n    }\n\n    console.log('‚úÖ [migrateOldBlobImages] Migration termin√©e');\n    \n    // D√©clencher une sauvegarde du contenu apr√®s migration\n    if (onInput && container.innerHTML) {\n      console.log('üíæ [migrateOldBlobImages] D√©clenchement sauvegarde apr√®s migration...');\n      const event = new Event('input', { bubbles: true });\n      container.dispatchEvent(event);\n    }\n  }, [onInput]);\n  \n  // Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\n  const handleTextareaResize = useCallback((textarea) => {\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.max(384, textarea.scrollHeight) + 'px';\n    }\n  }, []);\n\n  // Effect pour la r√©hydratation des images au chargement\n  useEffect(() => {\n    console.log(' [Editor] Effect r√©hydratation - Chargement initial');\n    \n    const initImageSystem = async () => {\n      console.log(' [Editor] Demande stockage persistant...');\n      // Demander le stockage persistant\n      await requestPersistentStorage();\n      \n      // R√©hydrater les images si l'√©diteur est pr√™t\n      if (editorRef.current) {\n        console.log(' [Editor] D√©clenchement r√©hydratation...');\n        await rehydrateImages(editorRef.current);\n        \n        console.log(' [Editor] D√©clenchement migration anciennes images...');\n        await migrateOldBlobImages(editorRef.current);\n      } else {\n        console.warn(' [Editor] editorRef pas encore pr√™t pour r√©hydratation');\n      }\n    };\n    \n    initImageSystem();\n  }, [rehydrateImages, migrateOldBlobImages]);\n\n  // Effect pour r√©hydrater quand le contenu change (nouveau document charg√©)\n  useEffect(() => {\n    if (content && content !== previousContentRef.current && editorRef.current) {\n      console.log(' [Editor] Contenu chang√© - V√©rification r√©hydratation...');\n      previousContentRef.current = content;\n      \n      // D√©lai pour laisser le DOM se mettre √† jour (plus long en production)\n      const rehydrationDelay = process.env.NODE_ENV === 'production' ? 1000 : 100;\n      console.log(` [Editor] D√©lai r√©hydratation: ${rehydrationDelay}ms (env: ${process.env.NODE_ENV})`);\n      \n      setTimeout(async () => {\n        await rehydrateImages(editorRef.current);\n        await migrateOldBlobImages(editorRef.current);\n      }, rehydrationDelay);\n    }\n  }, [content, rehydrateImages, migrateOldBlobImages]);\n\n  // Fonction pour formater le HTML avec des retours √† la ligne et indentation\n  const formatHtmlForSource = useCallback((html) => {\n    let indentLevel = 0;\n    const indentSize = 2; // 2 espaces par niveau\n    \n    return html\n      .replace(/<br\\s*\\/?>/gi, '<br>\\n')\n      .replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi, (match) => {\n        if (match.startsWith('</')) {\n          // Balise fermante : diminuer l'indentation puis ajouter la balise\n          indentLevel = Math.max(0, indentLevel - 1);\n          return match + '\\n';\n        } else {\n          // Balise ouvrante : ajouter la balise puis augmenter l'indentation\n          const result = '\\n' + ' '.repeat(indentLevel * indentSize) + match;\n          // Augmenter l'indentation pour les balises conteneurs\n          if (match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)) {\n            indentLevel++;\n          }\n          return result;\n        }\n      })\n      .split('\\n')\n      .map((line, index) => {\n        if (index === 0) return line.trim(); // Premi√®re ligne sans indentation\n        if (line.trim() === '') return ''; // Ligne vide\n        if (line.trim().startsWith('</')) {\n          // Balise fermante : r√©duire l'indentation\n          const currentIndent = Math.max(0, indentLevel - 1);\n          return ' '.repeat(currentIndent * indentSize) + line.trim();\n        }\n        // Contenu texte : utiliser l'indentation actuelle\n        return line.startsWith(' ') ? line : ' '.repeat(indentLevel * indentSize) + line.trim();\n      })\n      .join('\\n')\n      .replace(/^\\n+/, '') // Supprimer les retours √† la ligne en d√©but\n      .replace(/\\n{2,}/g, '\\n') // Supprimer toutes les lignes vides multiples\n      .trim();\n  }, []);\n\n  // Gestionnaire unifi√© WYSIWYG - connect√© directement √† onInput\n  const handleWysiwygChange = useCallback((e) => {\n    console.log('üìù handleWysiwygChange d√©clench√©');\n    \n    if (!editorRef.current) return;\n    \n    // Nettoyer les spans vides et les &nbsp; en trop\n    const cleanContent = (html) => {\n      return html\n        .replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g, '') // Supprimer spans vides SAUF les spans color√©s\n        .replace(/(&nbsp;\\s*){2,}/g, '&nbsp;') // R√©duire les &nbsp; multiples\n        .replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g, '<span style=\"color: $1;\">$2</span>') // Convertir font en span\n        .replace(/<b\\b[^>]*>(.*?)<\\/b>/g, '<strong>$1</strong>') // Convertir b en strong\n        .replace(/<i\\b[^>]*>(.*?)<\\/i>/g, '<em>$1</em>'); // Convertir i en em\n    };\n    \n    const newContent = cleanContent(editorRef.current.innerHTML);\n    console.log('üîç Contenu actuel vs nouveau:', content.length, 'vs', newContent.length);\n    \n    // Appel direct vers onInput du hook useEditor\n    if (newContent !== content) {\n      console.log('‚úÖ WYSIWYG Changement - Appel onInput direct');\n      onInput({ target: { innerHTML: newContent } });\n    }\n    \n    // D√©clencher mise √† jour du formatage apr√®s un d√©lai\n    if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n      console.log('üîÑ EDITOR handleWysiwygChange - Va appeler onSelectionChange dans 50ms');\n      setTimeout(onSelectionChange, 50);\n    } else {\n      console.log('‚ùå EDITOR handleWysiwygChange - onSelectionChange BLOQU√â - ignoreFlag:', ignoreSelectionChangeRef?.current);\n    }\n  }, [content, onInput, onSelectionChange]);\n\n  // Gestionnaire pour les √©v√©nements de s√©lection/curseur\n  const handleSelectionChange = useCallback(() => {\n    console.log('üìç EDITOR handleSelectionChange - ignoreFlag:', ignoreSelectionChangeRef?.current);\n    if (ignoreSelectionChangeRef?.current) {\n      console.log('‚ùå EDITOR handleSelectionChange - BLOQU√â par ignoreFlag');\n      return;\n    }\n    if (viewMode === 'wysiwyg' && document.activeElement === editorRef.current) {\n      console.log('‚úÖ EDITOR handleSelectionChange - VA APPELER onSelectionChange');\n      onSelectionChange();\n    } else {\n      console.log('‚ö†Ô∏è EDITOR handleSelectionChange - SKIP conditions');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, onSelectionChange, ignoreSelectionChangeRef]);\n\n\n  // Initialiser le contenu uniquement si n√©cessaire\n  useEffect(() => {\n    const initializeContent = async () => {\n      if (viewMode === 'wysiwyg' && editorRef.current && editorRef.current.innerHTML !== content) {\n        // Ne pas modifier le contenu si l'utilisateur interagit activement\n        const hasFocus = document.activeElement === editorRef.current;\n        const hasSelection = window.getSelection().rangeCount > 0;\n        \n        // √âviter les mises √† jour pendant l'interaction utilisateur\n        if (hasFocus && hasSelection) {\n          return; // Ne pas perturber l'utilisateur\n        }\n        \n        // Convertir les URLs relatives PromptoDYS en Blob URLs pour affichage\n        const currentProject = getCurrentProject();\n        let displayContent = content;\n        \n        if (currentProject.directory) {\n          displayContent = await convertAllPromptoDysUrlsToBlobs(content, currentProject.directory);\n        }\n        \n        // Mise √† jour avec le contenu converti\n        editorRef.current.innerHTML = displayContent;\n        \n        // Re-rendre MathJax apr√®s mise √† jour du contenu\n        if (window.MathJax && window.MathJax.typesetPromise) {\n          window.MathJax.typesetPromise([editorRef.current]).catch((err) => {\n            console.warn('Erreur MathJax:', err);\n          });\n        }\n        \n        // SOLUTION F5: Forcer le retraitement des poign√©es apr√®s initialisation\n        setTimeout(() => {\n          console.log('üîÑ [F5 Fix] Retraitement forc√© des poign√©es d\\'images apr√®s initialisation');\n          const images = editorRef.current?.querySelectorAll('img');\n          if (images && editorRef.current?.addResizeHandlesToImage) {\n            images.forEach(img => {\n              // Retirer le marqueur data-resizable pour forcer le retraitement\n              img.removeAttribute('data-resizable');\n              // Retirer le wrapper s'il existe d√©j√†\n              const existingWrapper = img.closest('.resizable-image');\n              if (existingWrapper) {\n                const parent = existingWrapper.parentNode;\n                parent.insertBefore(img, existingWrapper);\n                existingWrapper.remove();\n              }\n              // Retraiter l'image\n              editorRef.current.addResizeHandlesToImage(img);\n            });\n            console.log('‚úÖ [F5 Fix] Poign√©es retrait√©es pour', images.length, 'image(s)');\n          }\n        }, 300); // D√©lai pour s'assurer que tout est bien initialis√©\n      }\n    };\n    \n    initializeContent();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, content]);\n\n  // Gestionnaire pour la copie - convertir HTML en texte propre et g√©rer les images s√©lectionn√©es\n  const handleCopy = useCallback((e) => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Priorit√© 1: Si une image est s√©lectionn√©e, copier l'image\n      if (selectedImage) {\n        try {\n          // Cr√©er un √©l√©ment temporaire avec l'image\n          const tempDiv = document.createElement('div');\n          const clonedImg = selectedImage.cloneNode(true);\n          tempDiv.appendChild(clonedImg);\n          \n          // Copier au format HTML pour pr√©server la structure\n          e.clipboardData.setData('text/html', tempDiv.innerHTML);\n          // Copier aussi le src comme texte de fallback\n          e.clipboardData.setData('text/plain', selectedImage.src);\n          e.preventDefault();\n          return;\n        } catch (error) {\n          console.warn('Erreur copie image:', error);\n        }\n      }\n      \n      // Priorit√© 2: S√©lection de texte classique\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const selectedContent = range.cloneContents();\n        const tempDiv = document.createElement('div');\n        tempDiv.appendChild(selectedContent);\n        \n        // Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\n        const htmlContent = tempDiv.innerHTML;\n        const textContent = htmlContent\n          .replace(/<div[^>]*>/gi, '')\n          .replace(/<\\/div>/gi, '\\n')\n          .replace(/<br\\s*\\/?>/gi, '\\n')\n          .replace(/<p[^>]*>/gi, '')\n          .replace(/<\\/p>/gi, '\\n')\n          .replace(/<[^>]+>/g, '') // Supprimer toutes les autres balises\n          .replace(/&nbsp;/g, ' ')\n          .replace(/&amp;/g, '&')\n          .replace(/&lt;/g, '<')\n          .replace(/&gt;/g, '>')\n          .replace(/&quot;/g, '\"')\n          .replace(/&#39;/g, \"'\")\n          .replace(/\\n+$/, ''); // Supprimer les retours √† la ligne en fin\n        \n        // Mettre le texte propre dans le presse-papier\n        e.clipboardData.setData('text/plain', textContent);\n        e.preventDefault();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, selectedImage]);\n\n\n  // Gestionnaire pour forcer le refresh apr√®s coller\n  const handlePaste = useCallback((e) => {\n    console.log('üìã [DEBUG] handlePaste D√âCLENCH√â!', { viewMode, hasEditor: !!editorRef.current });\n    \n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Attendre que le contenu soit coll√©\n      setTimeout(async () => {\n        console.log('üîÑ Refresh forc√© apr√®s coller');\n        \n        // Traiter les images coll√©es pour leur donner des URLs blob uniques\n        if (storeBlobForUrl) {\n          await processImageBlobs(editorRef.current, storeBlobForUrl);\n        }\n        \n        console.log('‚úÖ [handlePaste] Images trait√©es par processImageBlobs (Option B incluse)');\n        \n        // Ajouter les poign√©es aux nouvelles images coll√©es\n        const newImages = editorRef.current.querySelectorAll('img:not([data-resizable])');\n        newImages.forEach(img => {\n          if (editorRef.current.addResizeHandlesToImage) {\n            editorRef.current.addResizeHandlesToImage(img);\n          }\n        });\n        \n        // D√©clencher sauvegarde\n        if (onInput) {\n          const event = new Event('input', { bubbles: true });\n          editorRef.current.dispatchEvent(event);\n        }\n      }, 100); // setTimeout\n    }\n    console.log('üìã [DEBUG] handlePaste termin√©');\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, handleSelectionChange, handleCopy]);\n\n  // Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\n  useEffect(() => {\n    if (viewMode !== 'wysiwyg' && editorRef.current) {\n      handleTextareaResize(editorRef.current);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [content, viewMode, handleTextareaResize]);\n\n\n\n  // Effect pour attacher les gestionnaires d'√©v√©nements\n  useEffect(() => {\n    console.log('üîó [DEBUG] Attachement events, viewMode:', viewMode, 'editorRef:', !!editorRef.current);\n    \n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Debug g√©n√©rique pour TOUS les events paste\n      const debugPaste = (e) => {\n        console.log('üî• [DEBUG] PASTE EVENT D√âTECT√â!', { \n          target: e.target.tagName, \n          currentTarget: e.currentTarget.tagName,\n          hasClipboardData: !!e.clipboardData \n        });\n      };\n      \n      document.addEventListener('selectionchange', handleSelectionChange);\n      editorRef.current.addEventListener('copy', handleCopy);\n      editorRef.current.addEventListener('paste', handlePaste);\n      editorRef.current.addEventListener('paste', debugPaste); // DEBUG GLOBAL\n      \n      console.log('‚úÖ [DEBUG] Event paste attach√© √† editorRef.current + debug global');\n      \n      return () => {\n        console.log('üóëÔ∏è [DEBUG] Nettoyage events');\n        document.removeEventListener('selectionchange', handleSelectionChange);\n        editorRef.current?.removeEventListener('copy', handleCopy);\n        editorRef.current?.removeEventListener('paste', handlePaste);\n        editorRef.current?.removeEventListener('paste', debugPaste);\n      };\n    }\n  }, [viewMode, handleSelectionChange, handleCopy]);\n\n// Effect pour appliquer le style de s√©lection d'image\nuseEffect(() => {\n  if (viewMode === 'wysiwyg' && editorRef.current) {\n    // Supprimer la classe de toutes les images\n    const allImages = editorRef.current.querySelectorAll('img');\n    allImages.forEach(img => {\n      const wrapper = img.closest('.resizable-image');\n      if (wrapper) {\n        wrapper.classList.remove('image-selected');\n      }\n    });\n\n    // Ajouter la classe √† l'image s√©lectionn√©e\n    if (selectedImage) {\n      const wrapper = selectedImage.closest('.resizable-image');\n      if (wrapper) {\n        wrapper.classList.add('image-selected');\n      }\n    }\n  }\n}, [selectedImage, viewMode, content]);\n\n  // Gestion des poign√©es de redimensionnement pour les images\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      const addResizeHandlesToImage = (img) => {\n        // Exposer la fonction pour r√©utilisation\n        editorRef.current.addResizeHandlesToImage = addResizeHandlesToImage;\n        // Toutes les images sont trait√©es normalement\n        \n        // V√©rifier si d√©j√† trait√©\n        if (img.getAttribute('data-resizable') || img.parentElement?.classList.contains('resizable-image')) {\n          return;\n        }\n        \n        // Attendre que l'image soit charg√©e\n        if (!img.complete || img.naturalWidth === 0) {\n          img.addEventListener('load', () => addResizeHandlesToImage(img), { once: true });\n          return;\n        }\n        \n        img.setAttribute('data-resizable', 'true');\n        \n        // Wrapper l'image dans un conteneur redimensionnable\n        const wrapper = document.createElement('div');\n        wrapper.className = 'resizable-image';\n        \n        // Ajouter gestionnaire de clic pour s√©lection d'image\n        img.addEventListener('click', (e) => {\n          e.stopPropagation();\n          if (onImageClick) {\n            onImageClick(img);\n          }\n        });\n        \n        // Extraire les dimensions depuis le style inline ou les attributs\n        let currentWidth, currentHeight;\n        \n        // Priorit√© 1: attributs HTML (ex: width=\"300px\")\n        const attrWidth = img.getAttribute('width');\n        const attrHeight = img.getAttribute('height');\n        \n        // Priorit√© 2: style inline (ex: style=\"width: 300px\")\n        const styleWidth = img.style.width;\n        const styleHeight = img.style.height;\n        \n        if (attrWidth && attrHeight) {\n          currentWidth = parseInt(attrWidth);\n          currentHeight = parseInt(attrHeight);\n          console.log('üìè Dimensions depuis attributs:', currentWidth, 'x', currentHeight);\n        } else if (styleWidth && styleHeight) {\n          currentWidth = parseInt(styleWidth);\n          currentHeight = parseInt(styleHeight);\n          console.log('üìè Dimensions depuis style:', currentWidth, 'x', currentHeight);\n        } else {\n          // Fallback: dimensions naturelles\n          currentWidth = img.naturalWidth || 300;\n          currentHeight = img.naturalHeight || 200;\n          console.log('üìè Dimensions naturelles:', currentWidth, 'x', currentHeight);\n        }\n        \n        // Limiter la hauteur maximale √† 300px en pr√©servant le ratio d'aspect\n        const MAX_HEIGHT = 300;\n        if (currentHeight > MAX_HEIGHT) {\n          const aspectRatio = currentWidth / currentHeight;\n          currentHeight = MAX_HEIGHT;\n          currentWidth = Math.round(currentHeight * aspectRatio);\n          console.log('üîÑ Image redimensionn√©e pour hauteur max 300px:', currentWidth, 'x', currentHeight);\n          \n          // Appliquer les nouvelles dimensions √† l'image\n          img.setAttribute('width', currentWidth + 'px');\n          img.setAttribute('height', currentHeight + 'px');\n          img.style.width = currentWidth + 'px';\n          img.style.height = currentHeight + 'px';\n        }\n        \n        wrapper.style.width = currentWidth + 'px';\n        wrapper.style.height = currentHeight + 'px';\n          \n          // Ins√©rer le wrapper\n          img.parentNode.insertBefore(wrapper, img);\n          wrapper.appendChild(img);\n          \n          // Cr√©er les 4 poign√©es\n          ['nw', 'ne', 'sw', 'se'].forEach((corner) => {\n            const handle = document.createElement('div');\n            handle.className = `resize-handle ${corner}`;\n            handle.dataset.corner = corner;\n            \n            handle.addEventListener('mousedown', (e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              \n              const startX = e.clientX;\n              const startY = e.clientY;\n              const startWidth = wrapper.offsetWidth;\n              const startHeight = wrapper.offsetHeight;\n              const aspectRatio = startWidth / startHeight;\n              \n              const handleMouseMove = (e) => {\n                const deltaX = e.clientX - startX;\n                const deltaY = e.clientY - startY;\n                \n                let newWidth = startWidth;\n                let newHeight = startHeight;\n                \n                // Calculer les nouvelles dimensions selon le coin\n                switch(corner) {\n                  case 'se': // Sud-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'sw': // Sud-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'ne': // Nord-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'nw': // Nord-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                }\n                \n                // Appliquer les nouvelles dimensions\n                wrapper.style.width = newWidth + 'px';\n                wrapper.style.height = newHeight + 'px';\n                img.style.width = '100%';\n                img.style.height = '100%';\n                \n                // Ajouter les attributs HTML width/height pour persistance lors des conversions\n                img.setAttribute('width', Math.round(newWidth) + 'px');\n                img.setAttribute('height', Math.round(newHeight) + 'px');\n              };\n              \n              const handleMouseUp = () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n                \n                // D√©clencher l'√©v√©nement de changement pour sauvegarder\n                if (onInput) {\n                  const event = new Event('input', { bubbles: true });\n                  editorRef.current.dispatchEvent(event);\n                }\n              };\n              \n              document.addEventListener('mousemove', handleMouseMove);\n              document.addEventListener('mouseup', handleMouseUp);\n            });\n            \n            wrapper.appendChild(handle);\n          });\n      };\n      \n      // Observer pour d√©tecter les nouvelles images\n      const handleMutation = (mutations) => {\n        mutations.forEach(mutation => {\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeName === 'IMG') {\n              addResizeHandlesToImage(node);\n            } else if (node.querySelectorAll) {\n              node.querySelectorAll('img').forEach(addResizeHandlesToImage);\n            }\n          });\n        });\n      };\n      \n      const observer = new MutationObserver(handleMutation);\n      observer.observe(editorRef.current, {\n        childList: true,\n        subtree: true\n      });\n      \n      // Traiter les images existantes\n      editorRef.current.querySelectorAll('img').forEach(addResizeHandlesToImage);\n      \n      return () => observer.disconnect();\n    }\n  }, [viewMode, onInput, content]);\n  \n  // Effect supprim√© - La gestion des poign√©es est maintenant dans l'effect pr√©c√©dent\n\n  // Rendu conditionnel avec switch/case pour garantir une seule vue\n  console.log('üîÑ Editor.js - Rendu switch/case, viewMode:', viewMode);\n  \n  switch (viewMode) {\n    case 'wysiwyg':\n      console.log('üéØ SWITCH - Vue WYSIWYG');\n      return (\n        <div key=\"wysiwyg\">\n          <style>{`\n            .editor-content h1 { \n              font-size: 2em; \n              font-weight: bold; \n              margin: 0.67em 0; \n              line-height: 1.2;\n            }\n            .editor-content h2 { \n              font-size: 1.5em; \n              font-weight: bold; \n              margin: 0.75em 0; \n              line-height: 1.3;\n            }\n            .editor-content h3 { \n              font-size: 1.17em; \n              font-weight: bold; \n              margin: 0.83em 0; \n              line-height: 1.4;\n            }\n            .editor-content p {\n              margin: 0.5em 0;\n            }\n            .editor-content ul {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: disc;\n            }\n            .editor-content ol {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: decimal;\n            }\n            .editor-content ol[style*=\"lower-alpha\"] {\n              list-style-type: lower-alpha;\n            }\n            .editor-content li {\n              margin: 0.25em 0;\n            }\n            \n            /* Styles pour images redimensionnables */\n            .editor-content img {\n              max-width: 100%;\n              height: auto;\n              position: relative;\n              cursor: pointer;\n            }\n            \n            .resizable-image {\n              position: relative;\n              display: inline-block;\n              border: 2px solid transparent;\n            }\n            \n            .resizable-image:hover {\n              border: 2px solid #3b82f6;\n            }\n            \n            /* Style pour image s√©lectionn√©e - SOLUTION RADICALE */\n            .image-selected {\n              position: relative;\n            }\n            \n            .image-selected::after {\n              content: '';\n              position: absolute;\n              top: -4px;\n              left: -4px;\n              right: -4px;\n              bottom: -4px;\n              border: 4px solid #1d4ed8;\n              box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.3), 0 0 12px rgba(29, 78, 216, 0.4);\n              background: rgba(29, 78, 216, 0.05);\n              outline: 2px solid #ffffff;\n              outline-offset: 2px;\n              pointer-events: none;\n              z-index: 1;\n            }\n            \n            .resizable-image img {\n              width: 100%;\n              height: 100%;\n              display: block;\n              position: relative;\n              z-index: 0;\n            }\n            \n            .resizable-image .resize-handle {\n              position: absolute;\n              width: 10px;\n              height: 10px;\n              background: #3b82f6;\n              border: 2px solid white;\n              border-radius: 50%;\n              opacity: 0;\n              cursor: nw-resize;\n              transition: opacity 0.2s;\n            }\n            \n            .resizable-image:hover .resize-handle,\n            .image-selected .resize-handle {\n              opacity: 1;\n            }\n            \n            .resize-handle.nw { top: -2px; left: -2px; cursor: nw-resize; }\n            .resize-handle.ne { top: -2px; right: -2px; cursor: ne-resize; }\n            .resize-handle.sw { bottom: -2px; left: -2px; cursor: sw-resize; }\n            .resize-handle.se { bottom: -2px; right: -2px; cursor: se-resize; }\n          `}</style>\n          <div\n            ref={(el) => { editorRef.current = el; }}\n            contentEditable=\"true\"\n            suppressContentEditableWarning={true}\n            spellCheck={false}\n            onInput={(e) => {\n              console.log('üéØ WYSIWYG onInput d√©clench√©!');\n              handleWysiwygChange(e);\n            }}\n            onKeyUp={(e) => {\n              console.log('‚å®Ô∏è WYSIWYG onKeyUp d√©clench√©! Touche:', e.key);\n              handleWysiwygChange(e);\n            }}\n            onPaste={(e) => {\n              console.log('üìã WYSIWYG onPaste d√©clench√©!');\n              setTimeout(() => handleWysiwygChange(e), 10); // D√©lai pour laisser le paste s'appliquer\n            }}\n            onMouseUp={(e) => {\n              console.log('üñ±Ô∏è WYSIWYG onMouseUp - S√©lection chang√©e - ignoreFlag:', ignoreSelectionChangeRef?.current);\n              if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n                console.log('‚úÖ EDITOR onMouseUp - VA APPELER onSelectionChange dans 10ms');\n                setTimeout(onSelectionChange, 10);\n              } else {\n                console.log('‚ùå EDITOR onMouseUp - onSelectionChange BLOQU√â');\n              }\n            }}\n            onKeyDown={(e) => {\n              // Protection contre les √©v√©nements undefined\n              if (!e || !e.key) {\n                console.warn('‚ö†Ô∏è √âv√©nement onKeyDown invalide:', e);\n                return;\n              }\n              \n              console.log('üîΩ WYSIWYG onKeyDown d√©clench√©! Touche:', e.key);\n              \n              // Gestion des touches pour les images s√©lectionn√©es\n              if (selectedImage) {\n                if (e.key === 'Delete' || e.key === 'Backspace') {\n                  e.preventDefault();\n                  // Supprimer l'image directement\n                  const wrapper = selectedImage.closest('.resizable-image');\n                  const elementToRemove = wrapper || selectedImage;\n                  elementToRemove.remove();\n                  \n                  // D√©s√©lectionner l'image\n                  if (onImageClick) {\n                    onImageClick(null);\n                  }\n                  \n                  // D√©clencher la sauvegarde\n                  if (onInput) {\n                    const event = new Event('input', { bubbles: true });\n                    editorRef.current.dispatchEvent(event);\n                  }\n                  return;\n                } else if (e.key === 'Enter') {\n                  e.preventDefault();\n                  // Ins√©rer une nouvelle ligne apr√®s l'image s√©lectionn√©e\n                  const wrapper = selectedImage.closest('.resizable-image');\n                  if (wrapper) {\n                    const newParagraph = document.createElement('p');\n                    newParagraph.innerHTML = '<br>';\n                    wrapper.parentNode.insertBefore(newParagraph, wrapper.nextSibling);\n                    \n                    console.log('üìç ENTER Image - Cr√©ation du paragraphe:', newParagraph);\n                    \n                    // Attendre que tous les √©v√©nements (onInput, handleWysiwygChange, etc.) se stabilisent\n                    setTimeout(() => {\n                      console.log('üìç ENTER Image - Positionnement curseur APR√àS stabilisation');\n                      \n                      const selection = window.getSelection();\n                      const range = document.createRange();\n                      \n                      console.log('üìç ENTER Image - Selection avant (delayed):', selection.rangeCount);\n                      \n                      // Positionner au d√©but du paragraphe\n                      range.setStart(newParagraph, 0);\n                      range.collapse(true);\n                      \n                      console.log('üìç ENTER Image - Range (delayed) startContainer:', range.startContainer);\n                      console.log('üìç ENTER Image - Range (delayed) startOffset:', range.startOffset);\n                      \n                      selection.removeAllRanges();\n                      selection.addRange(range);\n                      \n                      console.log('üìç ENTER Image - Selection (delayed) apr√®s:', selection.rangeCount);\n                      \n                      // Focus pour s'assurer que le curseur est visible\n                      editorRef.current?.focus();\n                      \n                      console.log('üìç ENTER Image - Positionnement termin√© avec succ√®s!');\n                    }, 100); // D√©lai pour laisser les √©v√©nements se stabiliser\n                    \n                    // D√©clencher la sauvegarde\n                    if (onInput) {\n                      const event = new Event('input', { bubbles: true });\n                      editorRef.current.dispatchEvent(event);\n                    }\n                    \n                    // D√©s√©lectionner l'image\n                    if (onImageClick) {\n                      onImageClick(null);\n                    }\n                  }\n                  return;\n                }\n              }\n              \n              // Mise √† jour du formatage pour les touches de navigation\n              if (e && e.key && (e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {\n                setTimeout(() => {\n                  console.log('üîº EDITOR onKeyDown Navigation - ignoreFlag:', ignoreSelectionChangeRef?.current);\n                  if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n                    console.log('‚úÖ EDITOR Navigation - VA APPELER onSelectionChange');\n                    onSelectionChange();\n                  } else {\n                    console.log('‚ùå EDITOR Navigation - onSelectionChange BLOQU√â');\n                  }\n                }, 10);\n              }\n            }}\n            onFocus={(e) => {\n              console.log('üîç WYSIWYG onFocus - Mise √† jour formatage - ignoreFlag:', ignoreSelectionChangeRef?.current);\n              if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n                console.log('‚úÖ EDITOR onFocus - VA APPELER onSelectionChange dans 10ms');\n                setTimeout(onSelectionChange, 10);\n              } else {\n                console.log('‚ùå EDITOR onFocus - onSelectionChange BLOQU√â');\n              }\n            }}\n            onChange={(e) => {\n              console.log('üîÑ onChange d√©clench√©!');\n            }}\n            onClick={onEditorClick}\n            style={{\n              minHeight: '384px',\n              outline: 'none',\n              padding: '20px',\n              lineHeight: 'var(--dys-line-height)',\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n            }}\n          />\n        </div>\n      );\n\n    case 'markdown': {\n      console.log('üìù SWITCH - Vue MARKDOWN');\n      const displayContent = content;\n      \n      return (\n        <div key=\"markdown\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              if (editorRef) editorRef.current = el;\n            }}\n            value={displayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalContent = content;\n              \n              if (newValue !== originalContent) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            spellCheck={false}\n            className=\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            style={{\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              lineHeight: 'var(--dys-line-height)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"√âcrivez en Markdown...\n\n# Titre 1\n## Titre 2\n### Titre 3\n\n**Gras** *Italique*\n\n- Liste √† puces\n1. Liste num√©rot√©e\na. Liste alphab√©tique\n\n$E = mc^2$ (formule inline)\n$$\\\\int_{-\\\\infty}^{\\\\infty} e^{-x^2} dx = \\\\sqrt{\\\\pi}$$ (formule block)\"\n          />\n        </div>\n      );\n    }\n\n    case 'html': {\n      console.log('üîß SWITCH - Vue HTML');\n      const htmlDisplayContent = formatHtmlForSource(content);\n    \n      return (\n        <div key=\"html\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              if (editorRef) editorRef.current = el;\n            }}\n            value={htmlDisplayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalWithCollapse = formatHtmlForSource(content);\n              \n              if (newValue !== originalWithCollapse) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            className=\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            style={{ \n              fontFamily: 'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"Code source HTML...\"\n          />\n        </div>\n      );\n    }\n\n    default:\n      console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:', viewMode);\n      return null;\n  }\n});\n\nexport default Editor;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}