{"ast":null,"code":"import _objectSpread from\"C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useCallback,useEffect,useRef,forwardRef}from'react';import{convertAllPromptoDysUrlsToBlobs,getCurrentProject}from'../utils/promptoDysManager';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Editor=/*#__PURE__*/forwardRef((_ref,ref)=>{let{content,setContent,viewMode,onInput,currentFormat,onFormatChange,mathJaxReady,ignoreSelectionChangeRef,selectedImage,onImageClick,onEditorClick,onDeleteSelectedImage,onSelectionChange,storeBlobForUrl,editorRef}=_ref;// Utilise editorRef pass√©e en props (pas de ref locale)\nconst isInitializedRef=useRef(false);const previousContentRef=useRef('');// Fonction pour cr√©er des blobs uniques (mutualisation avec Toolbar)\nconst createUniqueBlob=useCallback((file,storeBlobForUrl)=>{const uniqueId=\"\".concat(Date.now(),\"_\").concat(Math.random().toString(36).substr(2,9));const uniqueName=\"\".concat(uniqueId,\"_\").concat(file.name);const uniqueFile=new File([file],uniqueName,{type:file.type});const blobUrl=URL.createObjectURL(uniqueFile);console.log('üéØ [createUniqueBlob] Cr√©ation blob unique:',uniqueName,'->',blobUrl);storeBlobForUrl(blobUrl,uniqueFile);return{blobUrl,uniqueFile};},[]);// Fonction mutualis√©e pour traiter les images coll√©es et les rendre uniques\nconst processImageBlobs=useCallback(async(container,storeBlobForUrl)=>{console.log('üîÑ [processImageBlobs] Traitement des images...');const images=container.querySelectorAll('img[src^=\"blob:\"]');console.log('üîç [processImageBlobs] Images blob trouv√©es:',images.length);for(const img of images){const originalUrl=img.src;try{console.log('üì• [processImageBlobs] Traitement de:',originalUrl);// R√©cup√©rer le blob original\nconst response=await fetch(originalUrl);const blob=await response.blob();// Cr√©er un nouveau File avec un nom unique\nconst file=new File([blob],'pasted-image.png',{type:blob.type});const{blobUrl}=createUniqueBlob(file,storeBlobForUrl);// Remplacer l'URL dans l'image\nimg.src=blobUrl;console.log('‚úÖ [processImageBlobs] Image mise √† jour:',originalUrl,'->',blobUrl);}catch(error){console.error('‚ùå [processImageBlobs] Erreur pour:',originalUrl,error);}}},[createUniqueBlob]);// Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\nconst handleTextareaResize=useCallback(textarea=>{if(textarea){textarea.style.height='auto';textarea.style.height=Math.max(384,textarea.scrollHeight)+'px';}},[]);// Fonction pour formater le HTML avec des retours √† la ligne et indentation\nconst formatHtmlForSource=useCallback(html=>{let indentLevel=0;const indentSize=2;// 2 espaces par niveau\nreturn html.replace(/<br\\s*\\/?>/gi,'<br>\\n').replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi,match=>{if(match.startsWith('</')){// Balise fermante : diminuer l'indentation puis ajouter la balise\nindentLevel=Math.max(0,indentLevel-1);return match+'\\n';}else{// Balise ouvrante : ajouter la balise puis augmenter l'indentation\nconst result='\\n'+' '.repeat(indentLevel*indentSize)+match;// Augmenter l'indentation pour les balises conteneurs\nif(match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)){indentLevel++;}return result;}}).split('\\n').map((line,index)=>{if(index===0)return line.trim();// Premi√®re ligne sans indentation\nif(line.trim()==='')return'';// Ligne vide\nif(line.trim().startsWith('</')){// Balise fermante : r√©duire l'indentation\nconst currentIndent=Math.max(0,indentLevel-1);return' '.repeat(currentIndent*indentSize)+line.trim();}// Contenu texte : utiliser l'indentation actuelle\nreturn line.startsWith(' ')?line:' '.repeat(indentLevel*indentSize)+line.trim();}).join('\\n').replace(/^\\n+/,'')// Supprimer les retours √† la ligne en d√©but\n.replace(/\\n{2,}/g,'\\n')// Supprimer toutes les lignes vides multiples\n.trim();},[]);// Gestionnaire unifi√© WYSIWYG - connect√© directement √† onInput\nconst handleWysiwygChange=useCallback(e=>{console.log('üìù handleWysiwygChange d√©clench√©');if(!editorRef.current)return;// Nettoyer les spans vides et les &nbsp; en trop\nconst cleanContent=html=>{return html.replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g,'')// Supprimer spans vides SAUF les spans color√©s\n.replace(/(&nbsp;\\s*){2,}/g,'&nbsp;')// R√©duire les &nbsp; multiples\n.replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g,'<span style=\"color: $1;\">$2</span>')// Convertir font en span\n.replace(/<b\\b[^>]*>(.*?)<\\/b>/g,'<strong>$1</strong>')// Convertir b en strong\n.replace(/<i\\b[^>]*>(.*?)<\\/i>/g,'<em>$1</em>');// Convertir i en em\n};const newContent=cleanContent(editorRef.current.innerHTML);console.log('üîç Contenu actuel vs nouveau:',content.length,'vs',newContent.length);// Appel direct vers onInput du hook useEditor\nif(newContent!==content){console.log('‚úÖ WYSIWYG Changement - Appel onInput direct');onInput({target:{innerHTML:newContent}});}// D√©clencher mise √† jour du formatage apr√®s un d√©lai\nif(onSelectionChange&&!(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current)){console.log('üîÑ EDITOR handleWysiwygChange - Va appeler onSelectionChange dans 50ms');setTimeout(onSelectionChange,50);}else{console.log('‚ùå EDITOR handleWysiwygChange - onSelectionChange BLOQU√â - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);}},[content,onInput,onSelectionChange]);// Gestionnaire pour les √©v√©nements de s√©lection/curseur\nconst handleSelectionChange=useCallback(()=>{console.log('üìç EDITOR handleSelectionChange - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);if(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current){console.log('‚ùå EDITOR handleSelectionChange - BLOQU√â par ignoreFlag');return;}if(viewMode==='wysiwyg'&&document.activeElement===editorRef.current){console.log('‚úÖ EDITOR handleSelectionChange - VA APPELER onSelectionChange');onSelectionChange();}else{console.log('‚ö†Ô∏è EDITOR handleSelectionChange - SKIP conditions');}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,onSelectionChange,ignoreSelectionChangeRef]);// Initialiser le contenu uniquement si n√©cessaire\nuseEffect(()=>{const initializeContent=async()=>{if(viewMode==='wysiwyg'&&editorRef.current&&editorRef.current.innerHTML!==content){// Ne pas modifier le contenu si l'utilisateur interagit activement\nconst hasFocus=document.activeElement===editorRef.current;const hasSelection=window.getSelection().rangeCount>0;// √âviter les mises √† jour pendant l'interaction utilisateur\nif(hasFocus&&hasSelection){return;// Ne pas perturber l'utilisateur\n}// Convertir les URLs relatives PromptoDYS en Blob URLs pour affichage\nconst currentProject=getCurrentProject();let displayContent=content;if(currentProject.directory){displayContent=await convertAllPromptoDysUrlsToBlobs(content,currentProject.directory);}// Mise √† jour avec le contenu converti\neditorRef.current.innerHTML=displayContent;// Re-rendre MathJax apr√®s mise √† jour du contenu\nif(window.MathJax&&window.MathJax.typesetPromise){window.MathJax.typesetPromise([editorRef.current]).catch(err=>{console.warn('Erreur MathJax:',err);});}// SOLUTION F5: Forcer le retraitement des poign√©es apr√®s initialisation\nsetTimeout(()=>{var _editorRef$current,_editorRef$current2;console.log('üîÑ [F5 Fix] Retraitement forc√© des poign√©es d\\'images apr√®s initialisation');const images=(_editorRef$current=editorRef.current)===null||_editorRef$current===void 0?void 0:_editorRef$current.querySelectorAll('img');if(images&&(_editorRef$current2=editorRef.current)!==null&&_editorRef$current2!==void 0&&_editorRef$current2.addResizeHandlesToImage){images.forEach(img=>{// Retirer le marqueur data-resizable pour forcer le retraitement\nimg.removeAttribute('data-resizable');// Retirer le wrapper s'il existe d√©j√†\nconst existingWrapper=img.closest('.resizable-image');if(existingWrapper){const parent=existingWrapper.parentNode;parent.insertBefore(img,existingWrapper);existingWrapper.remove();}// Retraiter l'image\neditorRef.current.addResizeHandlesToImage(img);});console.log('‚úÖ [F5 Fix] Poign√©es retrait√©es pour',images.length,'image(s)');}},300);// D√©lai pour s'assurer que tout est bien initialis√©\n}};initializeContent();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,content]);// Gestionnaire pour la copie - convertir HTML en texte propre et g√©rer les images s√©lectionn√©es\nconst handleCopy=useCallback(e=>{if(viewMode==='wysiwyg'&&editorRef.current){// Priorit√© 1: Si une image est s√©lectionn√©e, copier l'image\nif(selectedImage){try{// Cr√©er un √©l√©ment temporaire avec l'image\nconst tempDiv=document.createElement('div');const clonedImg=selectedImage.cloneNode(true);tempDiv.appendChild(clonedImg);// Copier au format HTML pour pr√©server la structure\ne.clipboardData.setData('text/html',tempDiv.innerHTML);// Copier aussi le src comme texte de fallback\ne.clipboardData.setData('text/plain',selectedImage.src);e.preventDefault();return;}catch(error){console.warn('Erreur copie image:',error);}}// Priorit√© 2: S√©lection de texte classique\nconst selection=window.getSelection();if(selection.rangeCount>0){const range=selection.getRangeAt(0);const selectedContent=range.cloneContents();const tempDiv=document.createElement('div');tempDiv.appendChild(selectedContent);// Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\nconst htmlContent=tempDiv.innerHTML;const textContent=htmlContent.replace(/<div[^>]*>/gi,'').replace(/<\\/div>/gi,'\\n').replace(/<br\\s*\\/?>/gi,'\\n').replace(/<p[^>]*>/gi,'').replace(/<\\/p>/gi,'\\n').replace(/<[^>]+>/g,'')// Supprimer toutes les autres balises\n.replace(/&nbsp;/g,' ').replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'\"').replace(/&#39;/g,\"'\").replace(/\\n+$/,'');// Supprimer les retours √† la ligne en fin\n// Mettre le texte propre dans le presse-papier\ne.clipboardData.setData('text/plain',textContent);e.preventDefault();}}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,selectedImage]);// Gestionnaire pour forcer le refresh apr√®s coller\nconst handlePaste=useCallback(e=>{if(viewMode==='wysiwyg'&&editorRef.current){// Attendre que le contenu soit coll√©\nsetTimeout(async()=>{console.log('üîÑ Refresh forc√© apr√®s coller');// Traiter les images coll√©es pour leur donner des URLs blob uniques\nif(storeBlobForUrl){await processImageBlobs(editorRef.current,storeBlobForUrl);}// Ajouter les poign√©es aux nouvelles images coll√©es\nconst newImages=editorRef.current.querySelectorAll('img:not([data-resizable])');newImages.forEach(img=>{if(editorRef.current.addResizeHandlesToImage){editorRef.current.addResizeHandlesToImage(img);}});// D√©clencher sauvegarde\nif(onInput){const event=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(event);}},100);}},[viewMode,onInput]);// √âcouter les changements de s√©lection, la copie et le coller\nuseEffect(()=>{if(viewMode==='wysiwyg'){var _editorRef$current3,_editorRef$current4;document.addEventListener('selectionchange',handleSelectionChange);(_editorRef$current3=editorRef.current)===null||_editorRef$current3===void 0?void 0:_editorRef$current3.addEventListener('copy',handleCopy);(_editorRef$current4=editorRef.current)===null||_editorRef$current4===void 0?void 0:_editorRef$current4.addEventListener('paste',handlePaste);return()=>{var _editorRef$current5,_editorRef$current6;document.removeEventListener('selectionchange',handleSelectionChange);(_editorRef$current5=editorRef.current)===null||_editorRef$current5===void 0?void 0:_editorRef$current5.removeEventListener('copy',handleCopy);(_editorRef$current6=editorRef.current)===null||_editorRef$current6===void 0?void 0:_editorRef$current6.removeEventListener('paste',handlePaste);};}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,handleSelectionChange,handleCopy,handlePaste]);// Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\nuseEffect(()=>{if(viewMode!=='wysiwyg'&&editorRef.current){handleTextareaResize(editorRef.current);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[content,viewMode,handleTextareaResize]);// Supprim√© : useEffect d'initialisation qui causait l'√©crasement des execCommand\n// Effect pour appliquer le style de s√©lection d'image\nuseEffect(()=>{if(viewMode==='wysiwyg'&&editorRef.current){// Supprimer la classe de toutes les images\nconst allImages=editorRef.current.querySelectorAll('img');allImages.forEach(img=>{const wrapper=img.closest('.resizable-image');if(wrapper){wrapper.classList.remove('image-selected');}});// Ajouter la classe √† l'image s√©lectionn√©e\nif(selectedImage){const wrapper=selectedImage.closest('.resizable-image');if(wrapper){wrapper.classList.add('image-selected');}}}},[selectedImage,viewMode,content]);// Gestion des poign√©es de redimensionnement pour les images\nuseEffect(()=>{if(viewMode==='wysiwyg'&&editorRef.current){const addResizeHandlesToImage=img=>{var _img$parentElement;// Exposer la fonction pour r√©utilisation\neditorRef.current.addResizeHandlesToImage=addResizeHandlesToImage;// Toutes les images sont trait√©es normalement\n// V√©rifier si d√©j√† trait√©\nif(img.getAttribute('data-resizable')||(_img$parentElement=img.parentElement)!==null&&_img$parentElement!==void 0&&_img$parentElement.classList.contains('resizable-image')){return;}// Attendre que l'image soit charg√©e\nif(!img.complete||img.naturalWidth===0){img.addEventListener('load',()=>addResizeHandlesToImage(img),{once:true});return;}img.setAttribute('data-resizable','true');// Wrapper l'image dans un conteneur redimensionnable\nconst wrapper=document.createElement('div');wrapper.className='resizable-image';// Ajouter gestionnaire de clic pour s√©lection d'image\nimg.addEventListener('click',e=>{e.stopPropagation();if(onImageClick){onImageClick(img);}});// Extraire les dimensions depuis le style inline ou les attributs\nlet currentWidth,currentHeight;// Priorit√© 1: attributs HTML (ex: width=\"300px\")\nconst attrWidth=img.getAttribute('width');const attrHeight=img.getAttribute('height');// Priorit√© 2: style inline (ex: style=\"width: 300px\")\nconst styleWidth=img.style.width;const styleHeight=img.style.height;if(attrWidth&&attrHeight){currentWidth=parseInt(attrWidth);currentHeight=parseInt(attrHeight);console.log('üìè Dimensions depuis attributs:',currentWidth,'x',currentHeight);}else if(styleWidth&&styleHeight){currentWidth=parseInt(styleWidth);currentHeight=parseInt(styleHeight);console.log('üìè Dimensions depuis style:',currentWidth,'x',currentHeight);}else{// Fallback: dimensions naturelles\ncurrentWidth=img.naturalWidth||300;currentHeight=img.naturalHeight||200;console.log('üìè Dimensions naturelles:',currentWidth,'x',currentHeight);}// Limiter la hauteur maximale √† 300px en pr√©servant le ratio d'aspect\nconst MAX_HEIGHT=300;if(currentHeight>MAX_HEIGHT){const aspectRatio=currentWidth/currentHeight;currentHeight=MAX_HEIGHT;currentWidth=Math.round(currentHeight*aspectRatio);console.log('üîÑ Image redimensionn√©e pour hauteur max 300px:',currentWidth,'x',currentHeight);// Appliquer les nouvelles dimensions √† l'image\nimg.setAttribute('width',currentWidth+'px');img.setAttribute('height',currentHeight+'px');img.style.width=currentWidth+'px';img.style.height=currentHeight+'px';}wrapper.style.width=currentWidth+'px';wrapper.style.height=currentHeight+'px';// Ins√©rer le wrapper\nimg.parentNode.insertBefore(wrapper,img);wrapper.appendChild(img);// Cr√©er les 4 poign√©es\n['nw','ne','sw','se'].forEach(corner=>{const handle=document.createElement('div');handle.className=\"resize-handle \".concat(corner);handle.dataset.corner=corner;handle.addEventListener('mousedown',e=>{e.preventDefault();e.stopPropagation();const startX=e.clientX;const startY=e.clientY;const startWidth=wrapper.offsetWidth;const startHeight=wrapper.offsetHeight;const aspectRatio=startWidth/startHeight;const handleMouseMove=e=>{const deltaX=e.clientX-startX;const deltaY=e.clientY-startY;let newWidth=startWidth;let newHeight=startHeight;// Calculer les nouvelles dimensions selon le coin\nswitch(corner){case'se':// Sud-Est\nnewWidth=Math.max(50,startWidth+deltaX);newHeight=newWidth/aspectRatio;break;case'sw':// Sud-Ouest\nnewWidth=Math.max(50,startWidth-deltaX);newHeight=newWidth/aspectRatio;break;case'ne':// Nord-Est\nnewWidth=Math.max(50,startWidth+deltaX);newHeight=newWidth/aspectRatio;break;case'nw':// Nord-Ouest\nnewWidth=Math.max(50,startWidth-deltaX);newHeight=newWidth/aspectRatio;break;}// Appliquer les nouvelles dimensions\nwrapper.style.width=newWidth+'px';wrapper.style.height=newHeight+'px';img.style.width='100%';img.style.height='100%';// Ajouter les attributs HTML width/height pour persistance lors des conversions\nimg.setAttribute('width',Math.round(newWidth)+'px');img.setAttribute('height',Math.round(newHeight)+'px');};const handleMouseUp=()=>{document.removeEventListener('mousemove',handleMouseMove);document.removeEventListener('mouseup',handleMouseUp);// D√©clencher l'√©v√©nement de changement pour sauvegarder\nif(onInput){const event=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(event);}};document.addEventListener('mousemove',handleMouseMove);document.addEventListener('mouseup',handleMouseUp);});wrapper.appendChild(handle);});};// Observer pour d√©tecter les nouvelles images\nconst handleMutation=mutations=>{mutations.forEach(mutation=>{mutation.addedNodes.forEach(node=>{if(node.nodeName==='IMG'){addResizeHandlesToImage(node);}else if(node.querySelectorAll){node.querySelectorAll('img').forEach(addResizeHandlesToImage);}});});};const observer=new MutationObserver(handleMutation);observer.observe(editorRef.current,{childList:true,subtree:true});// Traiter les images existantes\neditorRef.current.querySelectorAll('img').forEach(addResizeHandlesToImage);return()=>observer.disconnect();}},[viewMode,onInput,content]);// Effect supprim√© - La gestion des poign√©es est maintenant dans l'effect pr√©c√©dent\n// Rendu conditionnel avec switch/case pour garantir une seule vue\nconsole.log('üîÑ Editor.js - Rendu switch/case, viewMode:',viewMode);switch(viewMode){case'wysiwyg':console.log('üéØ SWITCH - Vue WYSIWYG');return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"style\",{children:\"\\n            .editor-content h1 { \\n              font-size: 2em; \\n              font-weight: bold; \\n              margin: 0.67em 0; \\n              line-height: 1.2;\\n            }\\n            .editor-content h2 { \\n              font-size: 1.5em; \\n              font-weight: bold; \\n              margin: 0.75em 0; \\n              line-height: 1.3;\\n            }\\n            .editor-content h3 { \\n              font-size: 1.17em; \\n              font-weight: bold; \\n              margin: 0.83em 0; \\n              line-height: 1.4;\\n            }\\n            .editor-content p {\\n              margin: 0.5em 0;\\n            }\\n            .editor-content ul {\\n              margin: 0.5em 0;\\n              padding-left: 2em;\\n              list-style-type: disc;\\n            }\\n            .editor-content ol {\\n              margin: 0.5em 0;\\n              padding-left: 2em;\\n              list-style-type: decimal;\\n            }\\n            .editor-content ol[style*=\\\"lower-alpha\\\"] {\\n              list-style-type: lower-alpha;\\n            }\\n            .editor-content li {\\n              margin: 0.25em 0;\\n            }\\n            \\n            /* Styles pour images redimensionnables */\\n            .editor-content img {\\n              max-width: 100%;\\n              height: auto;\\n              position: relative;\\n              cursor: pointer;\\n            }\\n            \\n            .resizable-image {\\n              position: relative;\\n              display: inline-block;\\n              border: 2px solid transparent;\\n            }\\n            \\n            .resizable-image:hover {\\n              border: 2px solid #3b82f6;\\n            }\\n            \\n            /* Style pour image s\\xE9lectionn\\xE9e - SOLUTION RADICALE */\\n            .image-selected {\\n              position: relative;\\n            }\\n            \\n            .image-selected::after {\\n              content: '';\\n              position: absolute;\\n              top: -4px;\\n              left: -4px;\\n              right: -4px;\\n              bottom: -4px;\\n              border: 4px solid #1d4ed8;\\n              box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.3), 0 0 12px rgba(29, 78, 216, 0.4);\\n              background: rgba(29, 78, 216, 0.05);\\n              outline: 2px solid #ffffff;\\n              outline-offset: 2px;\\n              pointer-events: none;\\n              z-index: 1;\\n            }\\n            \\n            .resizable-image img {\\n              width: 100%;\\n              height: 100%;\\n              display: block;\\n              position: relative;\\n              z-index: 0;\\n            }\\n            \\n            .resizable-image .resize-handle {\\n              position: absolute;\\n              width: 10px;\\n              height: 10px;\\n              background: #3b82f6;\\n              border: 2px solid white;\\n              border-radius: 50%;\\n              opacity: 0;\\n              cursor: nw-resize;\\n              transition: opacity 0.2s;\\n            }\\n            \\n            .resizable-image:hover .resize-handle,\\n            .image-selected .resize-handle {\\n              opacity: 1;\\n            }\\n            \\n            .resize-handle.nw { top: -2px; left: -2px; cursor: nw-resize; }\\n            .resize-handle.ne { top: -2px; right: -2px; cursor: ne-resize; }\\n            .resize-handle.sw { bottom: -2px; left: -2px; cursor: sw-resize; }\\n            .resize-handle.se { bottom: -2px; right: -2px; cursor: se-resize; }\\n          \"}),/*#__PURE__*/_jsx(\"div\",{ref:el=>{editorRef.current=el;},contentEditable:\"true\",suppressContentEditableWarning:true,spellCheck:false,onInput:e=>{console.log('üéØ WYSIWYG onInput d√©clench√©!');handleWysiwygChange(e);},onKeyUp:e=>{console.log('‚å®Ô∏è WYSIWYG onKeyUp d√©clench√©! Touche:',e.key);handleWysiwygChange(e);},onPaste:e=>{console.log('üìã WYSIWYG onPaste d√©clench√©!');setTimeout(()=>handleWysiwygChange(e),10);// D√©lai pour laisser le paste s'appliquer\n},onMouseUp:e=>{console.log('üñ±Ô∏è WYSIWYG onMouseUp - S√©lection chang√©e - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);if(onSelectionChange&&!(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current)){console.log('‚úÖ EDITOR onMouseUp - VA APPELER onSelectionChange dans 10ms');setTimeout(onSelectionChange,10);}else{console.log('‚ùå EDITOR onMouseUp - onSelectionChange BLOQU√â');}},onKeyDown:e=>{// Protection contre les √©v√©nements undefined\nif(!e||!e.key){console.warn('‚ö†Ô∏è √âv√©nement onKeyDown invalide:',e);return;}console.log('üîΩ WYSIWYG onKeyDown d√©clench√©! Touche:',e.key);// Gestion des touches pour les images s√©lectionn√©es\nif(selectedImage){if(e.key==='Delete'||e.key==='Backspace'){e.preventDefault();// Supprimer l'image directement\nconst wrapper=selectedImage.closest('.resizable-image');const elementToRemove=wrapper||selectedImage;elementToRemove.remove();// D√©s√©lectionner l'image\nif(onImageClick){onImageClick(null);}// D√©clencher la sauvegarde\nif(onInput){const event=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(event);}return;}else if(e.key==='Enter'){e.preventDefault();// Ins√©rer une nouvelle ligne apr√®s l'image s√©lectionn√©e\nconst wrapper=selectedImage.closest('.resizable-image');if(wrapper){const newParagraph=document.createElement('p');newParagraph.innerHTML='<br>';wrapper.parentNode.insertBefore(newParagraph,wrapper.nextSibling);console.log('üìç ENTER Image - Cr√©ation du paragraphe:',newParagraph);// Attendre que tous les √©v√©nements (onInput, handleWysiwygChange, etc.) se stabilisent\nsetTimeout(()=>{var _editorRef$current7;console.log('üìç ENTER Image - Positionnement curseur APR√àS stabilisation');const selection=window.getSelection();const range=document.createRange();console.log('üìç ENTER Image - Selection avant (delayed):',selection.rangeCount);// Positionner au d√©but du paragraphe\nrange.setStart(newParagraph,0);range.collapse(true);console.log('üìç ENTER Image - Range (delayed) startContainer:',range.startContainer);console.log('üìç ENTER Image - Range (delayed) startOffset:',range.startOffset);selection.removeAllRanges();selection.addRange(range);console.log('üìç ENTER Image - Selection (delayed) apr√®s:',selection.rangeCount);// Focus pour s'assurer que le curseur est visible\n(_editorRef$current7=editorRef.current)===null||_editorRef$current7===void 0?void 0:_editorRef$current7.focus();console.log('üìç ENTER Image - Positionnement termin√© avec succ√®s!');},100);// D√©lai pour laisser les √©v√©nements se stabiliser\n// D√©clencher la sauvegarde\nif(onInput){const event=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(event);}// D√©s√©lectionner l'image\nif(onImageClick){onImageClick(null);}}return;}}// Mise √† jour du formatage pour les touches de navigation\nif(e&&e.key&&(e.key==='ArrowUp'||e.key==='ArrowDown'||e.key==='ArrowLeft'||e.key==='ArrowRight')){setTimeout(()=>{console.log('üîº EDITOR onKeyDown Navigation - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);if(onSelectionChange&&!(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current)){console.log('‚úÖ EDITOR Navigation - VA APPELER onSelectionChange');onSelectionChange();}else{console.log('‚ùå EDITOR Navigation - onSelectionChange BLOQU√â');}},10);}},onFocus:e=>{console.log('üîç WYSIWYG onFocus - Mise √† jour formatage - ignoreFlag:',ignoreSelectionChangeRef===null||ignoreSelectionChangeRef===void 0?void 0:ignoreSelectionChangeRef.current);if(onSelectionChange&&!(ignoreSelectionChangeRef!==null&&ignoreSelectionChangeRef!==void 0&&ignoreSelectionChangeRef.current)){console.log('‚úÖ EDITOR onFocus - VA APPELER onSelectionChange dans 10ms');setTimeout(onSelectionChange,10);}else{console.log('‚ùå EDITOR onFocus - onSelectionChange BLOQU√â');}},onChange:e=>{console.log('üîÑ onChange d√©clench√©!');},onClick:onEditorClick,style:{minHeight:'384px',outline:'none',padding:'20px',lineHeight:'var(--dys-line-height)',fontFamily:'var(--dys-font-family)',fontSize:'var(--dys-font-size)',color:'var(--dys-text-color)',backgroundColor:'var(--dys-bg-color)',overflow:'auto',wordWrap:'break-word',whiteSpace:'pre-wrap',border:'1px solid #e5e7eb'}})]},\"wysiwyg\");case'markdown':{console.log('üìù SWITCH - Vue MARKDOWN');const displayContent=content;return/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"textarea\",{ref:el=>{if(editorRef)editorRef.current=el;},value:displayContent,onChange:e=>{const newValue=e.target.value;const originalContent=content;if(newValue!==originalContent){onInput(_objectSpread(_objectSpread({},e),{},{target:_objectSpread(_objectSpread({},e.target),{},{value:newValue})}));}},spellCheck:false,className:\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",style:{fontFamily:'var(--dys-font-family)',fontSize:'var(--dys-font-size)',lineHeight:'var(--dys-line-height)',color:'var(--dys-text-color)',backgroundColor:'var(--dys-bg-color)',overflow:'auto',wordWrap:'break-word',whiteSpace:'pre-wrap',paddingBottom:'2rem'},placeholder:\"\\xC9crivez en Markdown... # Titre 1\\n## Titre 2\\n### Titre 3 **Gras** *Italique* - Liste \\xE0 puces\\n1. Liste num\\xE9rot\\xE9e\\na. Liste alphab\\xE9tique $E = mc^2$ (formule inline)\\n$$\\\\\\\\int_{-\\\\\\\\infty}^{\\\\\\\\infty} e^{-x^2} dx = \\\\\\\\sqrt{\\\\\\\\pi}$$ (formule block)\"})},\"markdown\");}case'html':{console.log('üîß SWITCH - Vue HTML');const htmlDisplayContent=formatHtmlForSource(content);return/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"textarea\",{ref:el=>{if(editorRef)editorRef.current=el;},value:htmlDisplayContent,onChange:e=>{const newValue=e.target.value;const originalWithCollapse=formatHtmlForSource(content);if(newValue!==originalWithCollapse){onInput(_objectSpread(_objectSpread({},e),{},{target:_objectSpread(_objectSpread({},e.target),{},{value:newValue})}));}},className:\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",style:{fontFamily:'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',overflow:'auto',wordWrap:'break-word',whiteSpace:'pre-wrap',border:'1px solid #e5e7eb',paddingBottom:'2rem'},placeholder:\"Code source HTML...\"})},\"html\");}default:console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:',viewMode);return null;}});export default Editor;","map":{"version":3,"names":["React","useCallback","useEffect","useRef","forwardRef","convertAllPromptoDysUrlsToBlobs","getCurrentProject","jsx","_jsx","jsxs","_jsxs","Editor","_ref","ref","content","setContent","viewMode","onInput","currentFormat","onFormatChange","mathJaxReady","ignoreSelectionChangeRef","selectedImage","onImageClick","onEditorClick","onDeleteSelectedImage","onSelectionChange","storeBlobForUrl","editorRef","isInitializedRef","previousContentRef","createUniqueBlob","file","uniqueId","concat","Date","now","Math","random","toString","substr","uniqueName","name","uniqueFile","File","type","blobUrl","URL","createObjectURL","console","log","processImageBlobs","container","images","querySelectorAll","length","img","originalUrl","src","response","fetch","blob","error","handleTextareaResize","textarea","style","height","max","scrollHeight","formatHtmlForSource","html","indentLevel","indentSize","replace","match","startsWith","result","repeat","split","map","line","index","trim","currentIndent","join","handleWysiwygChange","e","current","cleanContent","newContent","innerHTML","target","setTimeout","handleSelectionChange","document","activeElement","initializeContent","hasFocus","hasSelection","window","getSelection","rangeCount","currentProject","displayContent","directory","MathJax","typesetPromise","catch","err","warn","_editorRef$current","_editorRef$current2","addResizeHandlesToImage","forEach","removeAttribute","existingWrapper","closest","parent","parentNode","insertBefore","remove","handleCopy","tempDiv","createElement","clonedImg","cloneNode","appendChild","clipboardData","setData","preventDefault","selection","range","getRangeAt","selectedContent","cloneContents","htmlContent","textContent","handlePaste","newImages","event","Event","bubbles","dispatchEvent","_editorRef$current3","_editorRef$current4","addEventListener","_editorRef$current5","_editorRef$current6","removeEventListener","allImages","wrapper","classList","add","_img$parentElement","getAttribute","parentElement","contains","complete","naturalWidth","once","setAttribute","className","stopPropagation","currentWidth","currentHeight","attrWidth","attrHeight","styleWidth","width","styleHeight","parseInt","naturalHeight","MAX_HEIGHT","aspectRatio","round","corner","handle","dataset","startX","clientX","startY","clientY","startWidth","offsetWidth","startHeight","offsetHeight","handleMouseMove","deltaX","deltaY","newWidth","newHeight","handleMouseUp","handleMutation","mutations","mutation","addedNodes","node","nodeName","observer","MutationObserver","observe","childList","subtree","disconnect","children","el","contentEditable","suppressContentEditableWarning","spellCheck","onKeyUp","key","onPaste","onMouseUp","onKeyDown","elementToRemove","newParagraph","nextSibling","_editorRef$current7","createRange","setStart","collapse","startContainer","startOffset","removeAllRanges","addRange","focus","onFocus","onChange","onClick","minHeight","outline","padding","lineHeight","fontFamily","fontSize","color","backgroundColor","overflow","wordWrap","whiteSpace","border","value","newValue","originalContent","_objectSpread","paddingBottom","placeholder","htmlDisplayContent","originalWithCollapse"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/components/Editor.js"],"sourcesContent":["import React, { useCallback, useEffect, useRef, forwardRef } from 'react';\nimport { convertAllPromptoDysUrlsToBlobs, getCurrentProject } from '../utils/promptoDysManager';\n\nconst Editor = forwardRef(({ \n  content, \n  setContent, \n  viewMode, \n  onInput, \n  currentFormat, \n  onFormatChange, \n  mathJaxReady, \n  ignoreSelectionChangeRef,\n  selectedImage,\n  onImageClick,\n  onEditorClick,\n  onDeleteSelectedImage,\n  onSelectionChange,\n  storeBlobForUrl,\n  editorRef\n}, ref) => {\n  \n  \n  // Utilise editorRef pass√©e en props (pas de ref locale)\n  const isInitializedRef = useRef(false);\n  const previousContentRef = useRef('');\n  \n  // Fonction pour cr√©er des blobs uniques (mutualisation avec Toolbar)\n  const createUniqueBlob = useCallback((file, storeBlobForUrl) => {\n    const uniqueId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    const uniqueName = `${uniqueId}_${file.name}`;\n    const uniqueFile = new File([file], uniqueName, { type: file.type });\n    const blobUrl = URL.createObjectURL(uniqueFile);\n    \n    console.log('üéØ [createUniqueBlob] Cr√©ation blob unique:', uniqueName, '->', blobUrl);\n    storeBlobForUrl(blobUrl, uniqueFile);\n    \n    return { blobUrl, uniqueFile };\n  }, []);\n\n  // Fonction mutualis√©e pour traiter les images coll√©es et les rendre uniques\n  const processImageBlobs = useCallback(async (container, storeBlobForUrl) => {\n    console.log('üîÑ [processImageBlobs] Traitement des images...');\n    \n    const images = container.querySelectorAll('img[src^=\"blob:\"]');\n    console.log('üîç [processImageBlobs] Images blob trouv√©es:', images.length);\n    \n    for (const img of images) {\n      const originalUrl = img.src;\n      \n      try {\n        console.log('üì• [processImageBlobs] Traitement de:', originalUrl);\n        \n        // R√©cup√©rer le blob original\n        const response = await fetch(originalUrl);\n        const blob = await response.blob();\n        \n        // Cr√©er un nouveau File avec un nom unique\n        const file = new File([blob], 'pasted-image.png', { type: blob.type });\n        const { blobUrl } = createUniqueBlob(file, storeBlobForUrl);\n        \n        // Remplacer l'URL dans l'image\n        img.src = blobUrl;\n        console.log('‚úÖ [processImageBlobs] Image mise √† jour:', originalUrl, '->', blobUrl);\n        \n      } catch (error) {\n        console.error('‚ùå [processImageBlobs] Erreur pour:', originalUrl, error);\n      }\n    }\n  }, [createUniqueBlob]);\n  \n  // Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\n  const handleTextareaResize = useCallback((textarea) => {\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.max(384, textarea.scrollHeight) + 'px';\n    }\n  }, []);\n\n\n\n  // Fonction pour formater le HTML avec des retours √† la ligne et indentation\n  const formatHtmlForSource = useCallback((html) => {\n    let indentLevel = 0;\n    const indentSize = 2; // 2 espaces par niveau\n    \n    return html\n      .replace(/<br\\s*\\/?>/gi, '<br>\\n')\n      .replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi, (match) => {\n        if (match.startsWith('</')) {\n          // Balise fermante : diminuer l'indentation puis ajouter la balise\n          indentLevel = Math.max(0, indentLevel - 1);\n          return match + '\\n';\n        } else {\n          // Balise ouvrante : ajouter la balise puis augmenter l'indentation\n          const result = '\\n' + ' '.repeat(indentLevel * indentSize) + match;\n          // Augmenter l'indentation pour les balises conteneurs\n          if (match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)) {\n            indentLevel++;\n          }\n          return result;\n        }\n      })\n      .split('\\n')\n      .map((line, index) => {\n        if (index === 0) return line.trim(); // Premi√®re ligne sans indentation\n        if (line.trim() === '') return ''; // Ligne vide\n        if (line.trim().startsWith('</')) {\n          // Balise fermante : r√©duire l'indentation\n          const currentIndent = Math.max(0, indentLevel - 1);\n          return ' '.repeat(currentIndent * indentSize) + line.trim();\n        }\n        // Contenu texte : utiliser l'indentation actuelle\n        return line.startsWith(' ') ? line : ' '.repeat(indentLevel * indentSize) + line.trim();\n      })\n      .join('\\n')\n      .replace(/^\\n+/, '') // Supprimer les retours √† la ligne en d√©but\n      .replace(/\\n{2,}/g, '\\n') // Supprimer toutes les lignes vides multiples\n      .trim();\n  }, []);\n\n  // Gestionnaire unifi√© WYSIWYG - connect√© directement √† onInput\n  const handleWysiwygChange = useCallback((e) => {\n    console.log('üìù handleWysiwygChange d√©clench√©');\n    \n    if (!editorRef.current) return;\n    \n    // Nettoyer les spans vides et les &nbsp; en trop\n    const cleanContent = (html) => {\n      return html\n        .replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g, '') // Supprimer spans vides SAUF les spans color√©s\n        .replace(/(&nbsp;\\s*){2,}/g, '&nbsp;') // R√©duire les &nbsp; multiples\n        .replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g, '<span style=\"color: $1;\">$2</span>') // Convertir font en span\n        .replace(/<b\\b[^>]*>(.*?)<\\/b>/g, '<strong>$1</strong>') // Convertir b en strong\n        .replace(/<i\\b[^>]*>(.*?)<\\/i>/g, '<em>$1</em>'); // Convertir i en em\n    };\n    \n    const newContent = cleanContent(editorRef.current.innerHTML);\n    console.log('üîç Contenu actuel vs nouveau:', content.length, 'vs', newContent.length);\n    \n    // Appel direct vers onInput du hook useEditor\n    if (newContent !== content) {\n      console.log('‚úÖ WYSIWYG Changement - Appel onInput direct');\n      onInput({ target: { innerHTML: newContent } });\n    }\n    \n    // D√©clencher mise √† jour du formatage apr√®s un d√©lai\n    if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n      console.log('üîÑ EDITOR handleWysiwygChange - Va appeler onSelectionChange dans 50ms');\n      setTimeout(onSelectionChange, 50);\n    } else {\n      console.log('‚ùå EDITOR handleWysiwygChange - onSelectionChange BLOQU√â - ignoreFlag:', ignoreSelectionChangeRef?.current);\n    }\n  }, [content, onInput, onSelectionChange]);\n\n  // Gestionnaire pour les √©v√©nements de s√©lection/curseur\n  const handleSelectionChange = useCallback(() => {\n    console.log('üìç EDITOR handleSelectionChange - ignoreFlag:', ignoreSelectionChangeRef?.current);\n    if (ignoreSelectionChangeRef?.current) {\n      console.log('‚ùå EDITOR handleSelectionChange - BLOQU√â par ignoreFlag');\n      return;\n    }\n    if (viewMode === 'wysiwyg' && document.activeElement === editorRef.current) {\n      console.log('‚úÖ EDITOR handleSelectionChange - VA APPELER onSelectionChange');\n      onSelectionChange();\n    } else {\n      console.log('‚ö†Ô∏è EDITOR handleSelectionChange - SKIP conditions');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, onSelectionChange, ignoreSelectionChangeRef]);\n\n\n  // Initialiser le contenu uniquement si n√©cessaire\n  useEffect(() => {\n    const initializeContent = async () => {\n      if (viewMode === 'wysiwyg' && editorRef.current && editorRef.current.innerHTML !== content) {\n        // Ne pas modifier le contenu si l'utilisateur interagit activement\n        const hasFocus = document.activeElement === editorRef.current;\n        const hasSelection = window.getSelection().rangeCount > 0;\n        \n        // √âviter les mises √† jour pendant l'interaction utilisateur\n        if (hasFocus && hasSelection) {\n          return; // Ne pas perturber l'utilisateur\n        }\n        \n        // Convertir les URLs relatives PromptoDYS en Blob URLs pour affichage\n        const currentProject = getCurrentProject();\n        let displayContent = content;\n        \n        if (currentProject.directory) {\n          displayContent = await convertAllPromptoDysUrlsToBlobs(content, currentProject.directory);\n        }\n        \n        // Mise √† jour avec le contenu converti\n        editorRef.current.innerHTML = displayContent;\n        \n        // Re-rendre MathJax apr√®s mise √† jour du contenu\n        if (window.MathJax && window.MathJax.typesetPromise) {\n          window.MathJax.typesetPromise([editorRef.current]).catch((err) => {\n            console.warn('Erreur MathJax:', err);\n          });\n        }\n        \n        // SOLUTION F5: Forcer le retraitement des poign√©es apr√®s initialisation\n        setTimeout(() => {\n          console.log('üîÑ [F5 Fix] Retraitement forc√© des poign√©es d\\'images apr√®s initialisation');\n          const images = editorRef.current?.querySelectorAll('img');\n          if (images && editorRef.current?.addResizeHandlesToImage) {\n            images.forEach(img => {\n              // Retirer le marqueur data-resizable pour forcer le retraitement\n              img.removeAttribute('data-resizable');\n              // Retirer le wrapper s'il existe d√©j√†\n              const existingWrapper = img.closest('.resizable-image');\n              if (existingWrapper) {\n                const parent = existingWrapper.parentNode;\n                parent.insertBefore(img, existingWrapper);\n                existingWrapper.remove();\n              }\n              // Retraiter l'image\n              editorRef.current.addResizeHandlesToImage(img);\n            });\n            console.log('‚úÖ [F5 Fix] Poign√©es retrait√©es pour', images.length, 'image(s)');\n          }\n        }, 300); // D√©lai pour s'assurer que tout est bien initialis√©\n      }\n    };\n    \n    initializeContent();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, content]);\n\n  // Gestionnaire pour la copie - convertir HTML en texte propre et g√©rer les images s√©lectionn√©es\n  const handleCopy = useCallback((e) => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Priorit√© 1: Si une image est s√©lectionn√©e, copier l'image\n      if (selectedImage) {\n        try {\n          // Cr√©er un √©l√©ment temporaire avec l'image\n          const tempDiv = document.createElement('div');\n          const clonedImg = selectedImage.cloneNode(true);\n          tempDiv.appendChild(clonedImg);\n          \n          // Copier au format HTML pour pr√©server la structure\n          e.clipboardData.setData('text/html', tempDiv.innerHTML);\n          // Copier aussi le src comme texte de fallback\n          e.clipboardData.setData('text/plain', selectedImage.src);\n          e.preventDefault();\n          return;\n        } catch (error) {\n          console.warn('Erreur copie image:', error);\n        }\n      }\n      \n      // Priorit√© 2: S√©lection de texte classique\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const selectedContent = range.cloneContents();\n        const tempDiv = document.createElement('div');\n        tempDiv.appendChild(selectedContent);\n        \n        // Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\n        const htmlContent = tempDiv.innerHTML;\n        const textContent = htmlContent\n          .replace(/<div[^>]*>/gi, '')\n          .replace(/<\\/div>/gi, '\\n')\n          .replace(/<br\\s*\\/?>/gi, '\\n')\n          .replace(/<p[^>]*>/gi, '')\n          .replace(/<\\/p>/gi, '\\n')\n          .replace(/<[^>]+>/g, '') // Supprimer toutes les autres balises\n          .replace(/&nbsp;/g, ' ')\n          .replace(/&amp;/g, '&')\n          .replace(/&lt;/g, '<')\n          .replace(/&gt;/g, '>')\n          .replace(/&quot;/g, '\"')\n          .replace(/&#39;/g, \"'\")\n          .replace(/\\n+$/, ''); // Supprimer les retours √† la ligne en fin\n        \n        // Mettre le texte propre dans le presse-papier\n        e.clipboardData.setData('text/plain', textContent);\n        e.preventDefault();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, selectedImage]);\n\n  // Gestionnaire pour forcer le refresh apr√®s coller\n  const handlePaste = useCallback((e) => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Attendre que le contenu soit coll√©\n      setTimeout(async () => {\n        console.log('üîÑ Refresh forc√© apr√®s coller');\n        \n        // Traiter les images coll√©es pour leur donner des URLs blob uniques\n        if (storeBlobForUrl) {\n          await processImageBlobs(editorRef.current, storeBlobForUrl);\n        }\n        \n        // Ajouter les poign√©es aux nouvelles images coll√©es\n        const newImages = editorRef.current.querySelectorAll('img:not([data-resizable])');\n        newImages.forEach(img => {\n          if (editorRef.current.addResizeHandlesToImage) {\n            editorRef.current.addResizeHandlesToImage(img);\n          }\n        });\n        \n        // D√©clencher sauvegarde\n        if (onInput) {\n          const event = new Event('input', { bubbles: true });\n          editorRef.current.dispatchEvent(event);\n        }\n      }, 100);\n    }\n  }, [viewMode, onInput]);\n\n  // √âcouter les changements de s√©lection, la copie et le coller\n  useEffect(() => {\n    if (viewMode === 'wysiwyg') {\n      document.addEventListener('selectionchange', handleSelectionChange);\n      editorRef.current?.addEventListener('copy', handleCopy);\n      editorRef.current?.addEventListener('paste', handlePaste);\n      \n      return () => {\n        document.removeEventListener('selectionchange', handleSelectionChange);\n        editorRef.current?.removeEventListener('copy', handleCopy);\n        editorRef.current?.removeEventListener('paste', handlePaste);\n      };\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, handleSelectionChange, handleCopy, handlePaste]);\n\n  // Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\n  useEffect(() => {\n    if (viewMode !== 'wysiwyg' && editorRef.current) {\n      handleTextareaResize(editorRef.current);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [content, viewMode, handleTextareaResize]);\n\n\n\n// Supprim√© : useEffect d'initialisation qui causait l'√©crasement des execCommand\n\n// Effect pour appliquer le style de s√©lection d'image\nuseEffect(() => {\n  if (viewMode === 'wysiwyg' && editorRef.current) {\n    // Supprimer la classe de toutes les images\n    const allImages = editorRef.current.querySelectorAll('img');\n    allImages.forEach(img => {\n      const wrapper = img.closest('.resizable-image');\n      if (wrapper) {\n        wrapper.classList.remove('image-selected');\n      }\n    });\n\n    // Ajouter la classe √† l'image s√©lectionn√©e\n    if (selectedImage) {\n      const wrapper = selectedImage.closest('.resizable-image');\n      if (wrapper) {\n        wrapper.classList.add('image-selected');\n      }\n    }\n  }\n}, [selectedImage, viewMode, content]);\n\n  // Gestion des poign√©es de redimensionnement pour les images\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      const addResizeHandlesToImage = (img) => {\n        // Exposer la fonction pour r√©utilisation\n        editorRef.current.addResizeHandlesToImage = addResizeHandlesToImage;\n        // Toutes les images sont trait√©es normalement\n        \n        // V√©rifier si d√©j√† trait√©\n        if (img.getAttribute('data-resizable') || img.parentElement?.classList.contains('resizable-image')) {\n          return;\n        }\n        \n        // Attendre que l'image soit charg√©e\n        if (!img.complete || img.naturalWidth === 0) {\n          img.addEventListener('load', () => addResizeHandlesToImage(img), { once: true });\n          return;\n        }\n        \n        img.setAttribute('data-resizable', 'true');\n        \n        // Wrapper l'image dans un conteneur redimensionnable\n        const wrapper = document.createElement('div');\n        wrapper.className = 'resizable-image';\n        \n        // Ajouter gestionnaire de clic pour s√©lection d'image\n        img.addEventListener('click', (e) => {\n          e.stopPropagation();\n          if (onImageClick) {\n            onImageClick(img);\n          }\n        });\n        \n        // Extraire les dimensions depuis le style inline ou les attributs\n        let currentWidth, currentHeight;\n        \n        // Priorit√© 1: attributs HTML (ex: width=\"300px\")\n        const attrWidth = img.getAttribute('width');\n        const attrHeight = img.getAttribute('height');\n        \n        // Priorit√© 2: style inline (ex: style=\"width: 300px\")\n        const styleWidth = img.style.width;\n        const styleHeight = img.style.height;\n        \n        if (attrWidth && attrHeight) {\n          currentWidth = parseInt(attrWidth);\n          currentHeight = parseInt(attrHeight);\n          console.log('üìè Dimensions depuis attributs:', currentWidth, 'x', currentHeight);\n        } else if (styleWidth && styleHeight) {\n          currentWidth = parseInt(styleWidth);\n          currentHeight = parseInt(styleHeight);\n          console.log('üìè Dimensions depuis style:', currentWidth, 'x', currentHeight);\n        } else {\n          // Fallback: dimensions naturelles\n          currentWidth = img.naturalWidth || 300;\n          currentHeight = img.naturalHeight || 200;\n          console.log('üìè Dimensions naturelles:', currentWidth, 'x', currentHeight);\n        }\n        \n        // Limiter la hauteur maximale √† 300px en pr√©servant le ratio d'aspect\n        const MAX_HEIGHT = 300;\n        if (currentHeight > MAX_HEIGHT) {\n          const aspectRatio = currentWidth / currentHeight;\n          currentHeight = MAX_HEIGHT;\n          currentWidth = Math.round(currentHeight * aspectRatio);\n          console.log('üîÑ Image redimensionn√©e pour hauteur max 300px:', currentWidth, 'x', currentHeight);\n          \n          // Appliquer les nouvelles dimensions √† l'image\n          img.setAttribute('width', currentWidth + 'px');\n          img.setAttribute('height', currentHeight + 'px');\n          img.style.width = currentWidth + 'px';\n          img.style.height = currentHeight + 'px';\n        }\n        \n        wrapper.style.width = currentWidth + 'px';\n        wrapper.style.height = currentHeight + 'px';\n          \n          // Ins√©rer le wrapper\n          img.parentNode.insertBefore(wrapper, img);\n          wrapper.appendChild(img);\n          \n          // Cr√©er les 4 poign√©es\n          ['nw', 'ne', 'sw', 'se'].forEach((corner) => {\n            const handle = document.createElement('div');\n            handle.className = `resize-handle ${corner}`;\n            handle.dataset.corner = corner;\n            \n            handle.addEventListener('mousedown', (e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              \n              const startX = e.clientX;\n              const startY = e.clientY;\n              const startWidth = wrapper.offsetWidth;\n              const startHeight = wrapper.offsetHeight;\n              const aspectRatio = startWidth / startHeight;\n              \n              const handleMouseMove = (e) => {\n                const deltaX = e.clientX - startX;\n                const deltaY = e.clientY - startY;\n                \n                let newWidth = startWidth;\n                let newHeight = startHeight;\n                \n                // Calculer les nouvelles dimensions selon le coin\n                switch(corner) {\n                  case 'se': // Sud-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'sw': // Sud-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'ne': // Nord-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'nw': // Nord-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                }\n                \n                // Appliquer les nouvelles dimensions\n                wrapper.style.width = newWidth + 'px';\n                wrapper.style.height = newHeight + 'px';\n                img.style.width = '100%';\n                img.style.height = '100%';\n                \n                // Ajouter les attributs HTML width/height pour persistance lors des conversions\n                img.setAttribute('width', Math.round(newWidth) + 'px');\n                img.setAttribute('height', Math.round(newHeight) + 'px');\n              };\n              \n              const handleMouseUp = () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n                \n                // D√©clencher l'√©v√©nement de changement pour sauvegarder\n                if (onInput) {\n                  const event = new Event('input', { bubbles: true });\n                  editorRef.current.dispatchEvent(event);\n                }\n              };\n              \n              document.addEventListener('mousemove', handleMouseMove);\n              document.addEventListener('mouseup', handleMouseUp);\n            });\n            \n            wrapper.appendChild(handle);\n          });\n      };\n      \n      // Observer pour d√©tecter les nouvelles images\n      const handleMutation = (mutations) => {\n        mutations.forEach(mutation => {\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeName === 'IMG') {\n              addResizeHandlesToImage(node);\n            } else if (node.querySelectorAll) {\n              node.querySelectorAll('img').forEach(addResizeHandlesToImage);\n            }\n          });\n        });\n      };\n      \n      const observer = new MutationObserver(handleMutation);\n      observer.observe(editorRef.current, {\n        childList: true,\n        subtree: true\n      });\n      \n      // Traiter les images existantes\n      editorRef.current.querySelectorAll('img').forEach(addResizeHandlesToImage);\n      \n      return () => observer.disconnect();\n    }\n  }, [viewMode, onInput, content]);\n  \n  // Effect supprim√© - La gestion des poign√©es est maintenant dans l'effect pr√©c√©dent\n\n  // Rendu conditionnel avec switch/case pour garantir une seule vue\n  console.log('üîÑ Editor.js - Rendu switch/case, viewMode:', viewMode);\n  \n  switch (viewMode) {\n    case 'wysiwyg':\n      console.log('üéØ SWITCH - Vue WYSIWYG');\n      return (\n        <div key=\"wysiwyg\">\n          <style>{`\n            .editor-content h1 { \n              font-size: 2em; \n              font-weight: bold; \n              margin: 0.67em 0; \n              line-height: 1.2;\n            }\n            .editor-content h2 { \n              font-size: 1.5em; \n              font-weight: bold; \n              margin: 0.75em 0; \n              line-height: 1.3;\n            }\n            .editor-content h3 { \n              font-size: 1.17em; \n              font-weight: bold; \n              margin: 0.83em 0; \n              line-height: 1.4;\n            }\n            .editor-content p {\n              margin: 0.5em 0;\n            }\n            .editor-content ul {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: disc;\n            }\n            .editor-content ol {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: decimal;\n            }\n            .editor-content ol[style*=\"lower-alpha\"] {\n              list-style-type: lower-alpha;\n            }\n            .editor-content li {\n              margin: 0.25em 0;\n            }\n            \n            /* Styles pour images redimensionnables */\n            .editor-content img {\n              max-width: 100%;\n              height: auto;\n              position: relative;\n              cursor: pointer;\n            }\n            \n            .resizable-image {\n              position: relative;\n              display: inline-block;\n              border: 2px solid transparent;\n            }\n            \n            .resizable-image:hover {\n              border: 2px solid #3b82f6;\n            }\n            \n            /* Style pour image s√©lectionn√©e - SOLUTION RADICALE */\n            .image-selected {\n              position: relative;\n            }\n            \n            .image-selected::after {\n              content: '';\n              position: absolute;\n              top: -4px;\n              left: -4px;\n              right: -4px;\n              bottom: -4px;\n              border: 4px solid #1d4ed8;\n              box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.3), 0 0 12px rgba(29, 78, 216, 0.4);\n              background: rgba(29, 78, 216, 0.05);\n              outline: 2px solid #ffffff;\n              outline-offset: 2px;\n              pointer-events: none;\n              z-index: 1;\n            }\n            \n            .resizable-image img {\n              width: 100%;\n              height: 100%;\n              display: block;\n              position: relative;\n              z-index: 0;\n            }\n            \n            .resizable-image .resize-handle {\n              position: absolute;\n              width: 10px;\n              height: 10px;\n              background: #3b82f6;\n              border: 2px solid white;\n              border-radius: 50%;\n              opacity: 0;\n              cursor: nw-resize;\n              transition: opacity 0.2s;\n            }\n            \n            .resizable-image:hover .resize-handle,\n            .image-selected .resize-handle {\n              opacity: 1;\n            }\n            \n            .resize-handle.nw { top: -2px; left: -2px; cursor: nw-resize; }\n            .resize-handle.ne { top: -2px; right: -2px; cursor: ne-resize; }\n            .resize-handle.sw { bottom: -2px; left: -2px; cursor: sw-resize; }\n            .resize-handle.se { bottom: -2px; right: -2px; cursor: se-resize; }\n          `}</style>\n          <div\n            ref={(el) => { editorRef.current = el; }}\n            contentEditable=\"true\"\n            suppressContentEditableWarning={true}\n            spellCheck={false}\n            onInput={(e) => {\n              console.log('üéØ WYSIWYG onInput d√©clench√©!');\n              handleWysiwygChange(e);\n            }}\n            onKeyUp={(e) => {\n              console.log('‚å®Ô∏è WYSIWYG onKeyUp d√©clench√©! Touche:', e.key);\n              handleWysiwygChange(e);\n            }}\n            onPaste={(e) => {\n              console.log('üìã WYSIWYG onPaste d√©clench√©!');\n              setTimeout(() => handleWysiwygChange(e), 10); // D√©lai pour laisser le paste s'appliquer\n            }}\n            onMouseUp={(e) => {\n              console.log('üñ±Ô∏è WYSIWYG onMouseUp - S√©lection chang√©e - ignoreFlag:', ignoreSelectionChangeRef?.current);\n              if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n                console.log('‚úÖ EDITOR onMouseUp - VA APPELER onSelectionChange dans 10ms');\n                setTimeout(onSelectionChange, 10);\n              } else {\n                console.log('‚ùå EDITOR onMouseUp - onSelectionChange BLOQU√â');\n              }\n            }}\n            onKeyDown={(e) => {\n              // Protection contre les √©v√©nements undefined\n              if (!e || !e.key) {\n                console.warn('‚ö†Ô∏è √âv√©nement onKeyDown invalide:', e);\n                return;\n              }\n              \n              console.log('üîΩ WYSIWYG onKeyDown d√©clench√©! Touche:', e.key);\n              \n              // Gestion des touches pour les images s√©lectionn√©es\n              if (selectedImage) {\n                if (e.key === 'Delete' || e.key === 'Backspace') {\n                  e.preventDefault();\n                  // Supprimer l'image directement\n                  const wrapper = selectedImage.closest('.resizable-image');\n                  const elementToRemove = wrapper || selectedImage;\n                  elementToRemove.remove();\n                  \n                  // D√©s√©lectionner l'image\n                  if (onImageClick) {\n                    onImageClick(null);\n                  }\n                  \n                  // D√©clencher la sauvegarde\n                  if (onInput) {\n                    const event = new Event('input', { bubbles: true });\n                    editorRef.current.dispatchEvent(event);\n                  }\n                  return;\n                } else if (e.key === 'Enter') {\n                  e.preventDefault();\n                  // Ins√©rer une nouvelle ligne apr√®s l'image s√©lectionn√©e\n                  const wrapper = selectedImage.closest('.resizable-image');\n                  if (wrapper) {\n                    const newParagraph = document.createElement('p');\n                    newParagraph.innerHTML = '<br>';\n                    wrapper.parentNode.insertBefore(newParagraph, wrapper.nextSibling);\n                    \n                    console.log('üìç ENTER Image - Cr√©ation du paragraphe:', newParagraph);\n                    \n                    // Attendre que tous les √©v√©nements (onInput, handleWysiwygChange, etc.) se stabilisent\n                    setTimeout(() => {\n                      console.log('üìç ENTER Image - Positionnement curseur APR√àS stabilisation');\n                      \n                      const selection = window.getSelection();\n                      const range = document.createRange();\n                      \n                      console.log('üìç ENTER Image - Selection avant (delayed):', selection.rangeCount);\n                      \n                      // Positionner au d√©but du paragraphe\n                      range.setStart(newParagraph, 0);\n                      range.collapse(true);\n                      \n                      console.log('üìç ENTER Image - Range (delayed) startContainer:', range.startContainer);\n                      console.log('üìç ENTER Image - Range (delayed) startOffset:', range.startOffset);\n                      \n                      selection.removeAllRanges();\n                      selection.addRange(range);\n                      \n                      console.log('üìç ENTER Image - Selection (delayed) apr√®s:', selection.rangeCount);\n                      \n                      // Focus pour s'assurer que le curseur est visible\n                      editorRef.current?.focus();\n                      \n                      console.log('üìç ENTER Image - Positionnement termin√© avec succ√®s!');\n                    }, 100); // D√©lai pour laisser les √©v√©nements se stabiliser\n                    \n                    // D√©clencher la sauvegarde\n                    if (onInput) {\n                      const event = new Event('input', { bubbles: true });\n                      editorRef.current.dispatchEvent(event);\n                    }\n                    \n                    // D√©s√©lectionner l'image\n                    if (onImageClick) {\n                      onImageClick(null);\n                    }\n                  }\n                  return;\n                }\n              }\n              \n              // Mise √† jour du formatage pour les touches de navigation\n              if (e && e.key && (e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {\n                setTimeout(() => {\n                  console.log('üîº EDITOR onKeyDown Navigation - ignoreFlag:', ignoreSelectionChangeRef?.current);\n                  if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n                    console.log('‚úÖ EDITOR Navigation - VA APPELER onSelectionChange');\n                    onSelectionChange();\n                  } else {\n                    console.log('‚ùå EDITOR Navigation - onSelectionChange BLOQU√â');\n                  }\n                }, 10);\n              }\n            }}\n            onFocus={(e) => {\n              console.log('üîç WYSIWYG onFocus - Mise √† jour formatage - ignoreFlag:', ignoreSelectionChangeRef?.current);\n              if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n                console.log('‚úÖ EDITOR onFocus - VA APPELER onSelectionChange dans 10ms');\n                setTimeout(onSelectionChange, 10);\n              } else {\n                console.log('‚ùå EDITOR onFocus - onSelectionChange BLOQU√â');\n              }\n            }}\n            onChange={(e) => {\n              console.log('üîÑ onChange d√©clench√©!');\n            }}\n            onClick={onEditorClick}\n            style={{\n              minHeight: '384px',\n              outline: 'none',\n              padding: '20px',\n              lineHeight: 'var(--dys-line-height)',\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n            }}\n          />\n        </div>\n      );\n\n    case 'markdown': {\n      console.log('üìù SWITCH - Vue MARKDOWN');\n      const displayContent = content;\n      \n      return (\n        <div key=\"markdown\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              if (editorRef) editorRef.current = el;\n            }}\n            value={displayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalContent = content;\n              \n              if (newValue !== originalContent) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            spellCheck={false}\n            className=\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            style={{\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              lineHeight: 'var(--dys-line-height)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"√âcrivez en Markdown...\n\n# Titre 1\n## Titre 2\n### Titre 3\n\n**Gras** *Italique*\n\n- Liste √† puces\n1. Liste num√©rot√©e\na. Liste alphab√©tique\n\n$E = mc^2$ (formule inline)\n$$\\\\int_{-\\\\infty}^{\\\\infty} e^{-x^2} dx = \\\\sqrt{\\\\pi}$$ (formule block)\"\n          />\n        </div>\n      );\n    }\n\n    case 'html': {\n      console.log('üîß SWITCH - Vue HTML');\n      const htmlDisplayContent = formatHtmlForSource(content);\n    \n      return (\n        <div key=\"html\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              if (editorRef) editorRef.current = el;\n            }}\n            value={htmlDisplayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalWithCollapse = formatHtmlForSource(content);\n              \n              if (newValue !== originalWithCollapse) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            className=\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            style={{ \n              fontFamily: 'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"Code source HTML...\"\n          />\n        </div>\n      );\n    }\n\n    default:\n      console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:', viewMode);\n      return null;\n  }\n});\n\nexport default Editor;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}