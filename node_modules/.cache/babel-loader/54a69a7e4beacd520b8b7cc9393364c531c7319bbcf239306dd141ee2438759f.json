{"ast":null,"code":"import _objectSpread from\"C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useCallback,useEffect,useState}from'react';import{detectBase64,applyBase64Collapse}from'../utils/base64Collapse';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Editor=_ref=>{let{viewMode,content,editorRef,onInput,onSelectionChange,currentFormat}=_ref;// √âtat pour g√©rer l'expansion des donn√©es Base64\nconst[expandedBase64,setExpandedBase64]=useState({});// Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\nconst handleTextareaResize=useCallback(textarea=>{if(textarea){textarea.style.height='auto';textarea.style.height=Math.max(384,textarea.scrollHeight)+'px';}},[]);// Gestionnaire pour toggle Base64\nconst handleBase64Toggle=useCallback(e=>{const clickedText=e.target.value;const cursorPos=e.target.selectionStart;// Chercher si on a cliqu√© sur un bouton \"üëÅÔ∏è Voir\"\nconst beforeCursor=clickedText.substring(Math.max(0,cursorPos-100),cursorPos+20);const toggleMatch=beforeCursor.match(/üëÅÔ∏è Voir/);if(toggleMatch){// Trouver l'index du Base64 correspondant\nconst base64Matches=detectBase64(content);// Pour simplifier, on toggle le premier Base64 trouv√©\n// Dans une version plus avanc√©e, on pourrait calculer l'index exact\nif(base64Matches.length>0){const toggleIndex=0;// Simplifi√© pour cette version\nsetExpandedBase64(prev=>_objectSpread(_objectSpread({},prev),{},{[toggleIndex]:!prev[toggleIndex]}));}}},[content]);// Fonction pour obtenir le contenu avec Base64 collaps√©s\nconst getCollapsedContent=useCallback(originalContent=>{if(viewMode==='wysiwyg'){return originalContent;// Pas de collapse en WYSIWYG\n}return applyBase64Collapse(originalContent,expandedBase64);},[viewMode,expandedBase64]);// Fonction pour formater le HTML avec des retours √† la ligne et indentation\nconst formatHtmlForSource=useCallback(html=>{let indentLevel=0;const indentSize=2;// 2 espaces par niveau\nreturn html.replace(/<br\\s*\\/?>/gi,'<br>\\n').replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi,match=>{if(match.startsWith('</')){// Balise fermante : diminuer l'indentation puis ajouter la balise\nindentLevel=Math.max(0,indentLevel-1);return match+'\\n';}else{// Balise ouvrante : ajouter la balise puis augmenter l'indentation\nconst result='\\n'+' '.repeat(indentLevel*indentSize)+match;// Augmenter l'indentation pour les balises conteneurs\nif(match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)){indentLevel++;}return result;}}).split('\\n').map((line,index)=>{if(index===0)return line.trim();// Premi√®re ligne sans indentation\nif(line.trim()==='')return'';// Ligne vide\nif(line.trim().startsWith('</')){// Balise fermante : r√©duire l'indentation\nconst currentIndent=Math.max(0,indentLevel-1);return' '.repeat(currentIndent*indentSize)+line.trim();}// Contenu texte : utiliser l'indentation actuelle\nreturn line.startsWith(' ')?line:' '.repeat(indentLevel*indentSize)+line.trim();}).join('\\n').replace(/^\\n+/,'')// Supprimer les retours √† la ligne en d√©but\n.replace(/\\n{2,}/g,'\\n')// Supprimer toutes les lignes vides multiples\n.trim();},[]);// Gestionnaire unifi√© pour tous les changements\nconst handleChange=useCallback(e=>{if(viewMode==='wysiwyg'&&editorRef.current){// Nettoyer les spans vides et les &nbsp; en trop\nconst cleanContent=html=>{return html.replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g,'')// Supprimer spans vides SAUF les spans color√©s\n.replace(/(&nbsp;\\s*){2,}/g,'&nbsp;')// R√©duire les &nbsp; multiples\n.replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g,'<span style=\"color: $1;\">$2</span>')// Convertir font en span\n.replace(/<b\\b[^>]*>(.*?)<\\/b>/g,'<strong>$1</strong>')// Convertir b en strong\n.replace(/<i\\b[^>]*>(.*?)<\\/i>/g,'<em>$1</em>');// Convertir i en em\n};const newContent=cleanContent(editorRef.current.innerHTML);// √âviter les boucles infinies avec une v√©rification plus stricte\nif(newContent!==content&&newContent.trim()!==content.trim()){onInput({target:{innerHTML:newContent,value:newContent}});}// Re-rendre MathJax apr√®s modification du contenu\nif(window.MathJax&&window.MathJax.typesetPromise){window.MathJax.typesetPromise([editorRef.current]).catch(err=>{console.warn('Erreur MathJax:',err);});}// Mettre √† jour l'√©tat de formatage avec un d√©lai pour √©viter les conflits\nrequestAnimationFrame(()=>{if(document.activeElement===editorRef.current){onSelectionChange();}});}},[viewMode,editorRef,onInput,onSelectionChange,content]);// Gestionnaire pour les √©v√©nements de s√©lection/curseur\nconst handleSelectionChange=useCallback(()=>{if(viewMode==='wysiwyg'&&document.activeElement===editorRef.current){onSelectionChange();}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,onSelectionChange]);// Initialiser le contenu uniquement si n√©cessaire\nuseEffect(()=>{if(viewMode==='wysiwyg'&&editorRef.current&&editorRef.current.innerHTML!==content){// Ne pas modifier le contenu si l'utilisateur interagit activement\nconst hasFocus=document.activeElement===editorRef.current;const hasSelection=window.getSelection().rangeCount>0;// √âviter les mises √† jour pendant l'interaction utilisateur\nif(hasFocus&&hasSelection){return;// Ne pas perturber l'utilisateur\n}// Mise √† jour simple sans restauration de curseur\neditorRef.current.innerHTML=content;// Re-rendre MathJax apr√®s mise √† jour du contenu\nif(window.MathJax&&window.MathJax.typesetPromise){window.MathJax.typesetPromise([editorRef.current]).catch(err=>{console.warn('Erreur MathJax:',err);});}}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,content]);// Gestionnaire pour la copie - convertir HTML en texte propre\nconst handleCopy=useCallback(e=>{if(viewMode==='wysiwyg'&&editorRef.current){const selection=window.getSelection();if(selection.rangeCount>0){const range=selection.getRangeAt(0);const selectedContent=range.cloneContents();const tempDiv=document.createElement('div');tempDiv.appendChild(selectedContent);// Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\nconst htmlContent=tempDiv.innerHTML;const textContent=htmlContent.replace(/<div[^>]*>/gi,'').replace(/<\\/div>/gi,'\\n').replace(/<br\\s*\\/?>/gi,'\\n').replace(/<p[^>]*>/gi,'').replace(/<\\/p>/gi,'\\n').replace(/<[^>]+>/g,'')// Supprimer toutes les autres balises\n.replace(/&nbsp;/g,' ').replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'\"').replace(/&#39;/g,\"'\").replace(/\\n+$/,'');// Supprimer les retours √† la ligne en fin\n// Mettre le texte propre dans le presse-papier\ne.clipboardData.setData('text/plain',textContent);e.preventDefault();}}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode]);// √âcouter les changements de s√©lection et la copie\nuseEffect(()=>{if(viewMode==='wysiwyg'){var _editorRef$current;document.addEventListener('selectionchange',handleSelectionChange);(_editorRef$current=editorRef.current)===null||_editorRef$current===void 0?void 0:_editorRef$current.addEventListener('copy',handleCopy);return()=>{var _editorRef$current2;document.removeEventListener('selectionchange',handleSelectionChange);(_editorRef$current2=editorRef.current)===null||_editorRef$current2===void 0?void 0:_editorRef$current2.removeEventListener('copy',handleCopy);};}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMode,handleSelectionChange,handleCopy]);// Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\nuseEffect(()=>{if(viewMode!=='wysiwyg'&&editorRef.current){handleTextareaResize(editorRef.current);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[content,viewMode,handleTextareaResize]);// Effect pour ajouter les poign√©es de redimensionnement aux images\nuseEffect(()=>{if(viewMode==='wysiwyg'&&editorRef.current){const addResizeHandlesToImages=()=>{const images=editorRef.current.querySelectorAll('img:not([data-resizable])');images.forEach(img=>{img.setAttribute('data-resizable','true');// Wrapper l'image dans un conteneur redimensionnable\nconst wrapper=document.createElement('div');wrapper.className='resizable-image';wrapper.style.width=img.offsetWidth+'px';wrapper.style.height=img.offsetHeight+'px';// Ins√©rer le wrapper\nimg.parentNode.insertBefore(wrapper,img);wrapper.appendChild(img);// Cr√©er les 4 poign√©es\n['nw','ne','sw','se'].forEach(corner=>{const handle=document.createElement('div');handle.className=\"resize-handle \".concat(corner);handle.dataset.corner=corner;handle.addEventListener('mousedown',e=>{e.preventDefault();e.stopPropagation();const startX=e.clientX;const startY=e.clientY;const startWidth=wrapper.offsetWidth;const startHeight=wrapper.offsetHeight;const aspectRatio=startWidth/startHeight;const handleMouseMove=e=>{const deltaX=e.clientX-startX;const deltaY=e.clientY-startY;let newWidth=startWidth;let newHeight=startHeight;// Calculer les nouvelles dimensions selon le coin\nswitch(corner){case'se':// Sud-Est\nnewWidth=Math.max(50,startWidth+deltaX);newHeight=newWidth/aspectRatio;break;case'sw':// Sud-Ouest\nnewWidth=Math.max(50,startWidth-deltaX);newHeight=newWidth/aspectRatio;break;case'ne':// Nord-Est\nnewWidth=Math.max(50,startWidth+deltaX);newHeight=newWidth/aspectRatio;break;case'nw':// Nord-Ouest\nnewWidth=Math.max(50,startWidth-deltaX);newHeight=newWidth/aspectRatio;break;}// Appliquer les nouvelles dimensions\nwrapper.style.width=newWidth+'px';wrapper.style.height=newHeight+'px';img.style.width='100%';img.style.height='100%';// Ajouter les attributs HTML width/height pour persistance lors des conversions\nimg.setAttribute('width',Math.round(newWidth)+'px');img.setAttribute('height',Math.round(newHeight)+'px');};const handleMouseUp=()=>{document.removeEventListener('mousemove',handleMouseMove);document.removeEventListener('mouseup',handleMouseUp);// D√©clencher l'√©v√©nement de changement pour sauvegarder\nif(onInput){const event=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(event);}};document.addEventListener('mousemove',handleMouseMove);document.addEventListener('mouseup',handleMouseUp);});wrapper.appendChild(handle);});});};// Observer les mutations DOM pour les nouvelles images\nconst observer=new MutationObserver(()=>{setTimeout(addResizeHandlesToImages,100);});observer.observe(editorRef.current,{childList:true,subtree:true});// Ajouter les poign√©es aux images existantes\nsetTimeout(addResizeHandlesToImages,100);return()=>observer.disconnect();}},[viewMode,content,onInput]);// Rendu conditionnel avec switch/case pour garantir une seule vue\nconsole.log('üîÑ Editor.js - Rendu switch/case, viewMode:',viewMode);switch(viewMode){case'wysiwyg':console.log('üéØ SWITCH - Vue WYSIWYG');return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"style\",{children:\"\\n            .editor-content h1 { \\n              font-size: 2em; \\n              font-weight: bold; \\n              margin: 0.67em 0; \\n              line-height: 1.2;\\n            }\\n            .editor-content h2 { \\n              font-size: 1.5em; \\n              font-weight: bold; \\n              margin: 0.75em 0; \\n              line-height: 1.3;\\n            }\\n            .editor-content h3 { \\n              font-size: 1.17em; \\n              font-weight: bold; \\n              margin: 0.83em 0; \\n              line-height: 1.4;\\n            }\\n            .editor-content p {\\n              margin: 0.5em 0;\\n            }\\n            .editor-content ul {\\n              margin: 0.5em 0;\\n              padding-left: 2em;\\n              list-style-type: disc;\\n            }\\n            .editor-content ol {\\n              margin: 0.5em 0;\\n              padding-left: 2em;\\n              list-style-type: decimal;\\n            }\\n            .editor-content ol[style*=\\\"lower-alpha\\\"] {\\n              list-style-type: lower-alpha;\\n            }\\n            .editor-content li {\\n              margin: 0.25em 0;\\n            }\\n            \\n            /* Styles pour images redimensionnables */\\n            .editor-content img {\\n              max-width: 100%;\\n              height: auto;\\n              position: relative;\\n              cursor: pointer;\\n            }\\n            \\n            .resizable-image {\\n              position: relative;\\n              display: inline-block;\\n              border: 2px solid transparent;\\n            }\\n            \\n            .resizable-image:hover {\\n              border: 2px solid #3b82f6;\\n            }\\n            \\n            .resizable-image .resize-handle {\\n              position: absolute;\\n              width: 10px;\\n              height: 10px;\\n              background: #3b82f6;\\n              border: 2px solid white;\\n              border-radius: 50%;\\n              opacity: 0;\\n              cursor: nw-resize;\\n              transition: opacity 0.2s;\\n            }\\n            \\n            .resizable-image:hover .resize-handle {\\n              opacity: 1;\\n            }\\n            \\n            .resize-handle.nw { top: -6px; left: -6px; cursor: nw-resize; }\\n            .resize-handle.ne { top: -6px; right: -6px; cursor: ne-resize; }\\n            .resize-handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }\\n            .resize-handle.se { bottom: -6px; right: -6px; cursor: se-resize; }\\n          \"}),/*#__PURE__*/_jsx(\"div\",{ref:editorRef,contentEditable:true,spellCheck:false,onInput:handleChange,suppressContentEditableWarning:true,className:\"editor-content p-2 focus:outline-none h-full\",style:{fontFamily:'var(--dys-font-family)',fontSize:'var(--dys-font-size)',lineHeight:'var(--dys-line-height)',color:'var(--dys-text-color)',backgroundColor:'var(--dys-bg-color)',overflow:'auto',wordWrap:'break-word',whiteSpace:'pre-wrap',border:'1px solid #e5e7eb',paddingBottom:'2rem'}})]},\"wysiwyg\");case'markdown':{console.log('üìù SWITCH - Vue MARKDOWN');const displayContent=getCollapsedContent(content);return/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"textarea\",{ref:el=>{editorRef.current=el;},value:displayContent,onChange:e=>{const newValue=e.target.value;const originalWithCollapse=getCollapsedContent(content);if(newValue!==originalWithCollapse){onInput(_objectSpread(_objectSpread({},e),{},{target:_objectSpread(_objectSpread({},e.target),{},{value:newValue})}));}},onClick:handleBase64Toggle,className:\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",style:{fontFamily:'var(--dys-font-family)',fontSize:'var(--dys-font-size)',lineHeight:'var(--dys-line-height)',color:'var(--dys-text-color)',backgroundColor:'var(--dys-bg-color)',overflow:'auto',wordWrap:'break-word',whiteSpace:'pre-wrap',paddingBottom:'2rem'},placeholder:\"\\xC9crivez en Markdown... # Titre 1\\n## Titre 2\\n### Titre 3 **Gras** *Italique* - Liste \\xE0 puces\\n1. Liste num\\xE9rot\\xE9e\\na. Liste alphab\\xE9tique $E = mc^2$ (formule inline)\\n$$\\\\\\\\int_{-\\\\\\\\infty}^{\\\\\\\\infty} e^{-x^2} dx = \\\\\\\\sqrt{\\\\\\\\pi}$$ (formule block)\"}),detectBase64(content).length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute top-2 right-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\",children:[\"\\uD83D\\uDCF7 \",detectBase64(content).length,\" image(s) Base64\"]})]},\"markdown\");}case'html':{console.log('üîß SWITCH - Vue HTML');const htmlDisplayContent=formatHtmlForSource(getCollapsedContent(content));return/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"textarea\",{ref:el=>{editorRef.current=el;},value:htmlDisplayContent,onChange:e=>{const newValue=e.target.value;const originalWithCollapse=formatHtmlForSource(getCollapsedContent(content));if(newValue!==originalWithCollapse){onInput(_objectSpread(_objectSpread({},e),{},{target:_objectSpread(_objectSpread({},e.target),{},{value:newValue})}));}},onClick:handleBase64Toggle,className:\"w-full h-full p-2 focus:outline-none resize-none\",style:{fontFamily:'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',overflow:'auto',wordWrap:'break-word',whiteSpace:'pre-wrap',border:'1px solid #e5e7eb',paddingBottom:'2rem'},placeholder:\"Code source HTML...\"}),detectBase64(content).length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute top-2 right-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\",children:[\"\\uD83D\\uDCF7 \",detectBase64(content).length,\" image(s) Base64\"]})]},\"html\");}default:console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:',viewMode);return null;}};export default Editor;","map":{"version":3,"names":["React","useCallback","useEffect","useState","detectBase64","applyBase64Collapse","jsx","_jsx","jsxs","_jsxs","Editor","_ref","viewMode","content","editorRef","onInput","onSelectionChange","currentFormat","expandedBase64","setExpandedBase64","handleTextareaResize","textarea","style","height","Math","max","scrollHeight","handleBase64Toggle","e","clickedText","target","value","cursorPos","selectionStart","beforeCursor","substring","toggleMatch","match","base64Matches","length","toggleIndex","prev","_objectSpread","getCollapsedContent","originalContent","formatHtmlForSource","html","indentLevel","indentSize","replace","startsWith","result","repeat","split","map","line","index","trim","currentIndent","join","handleChange","current","cleanContent","newContent","innerHTML","window","MathJax","typesetPromise","catch","err","console","warn","requestAnimationFrame","document","activeElement","handleSelectionChange","hasFocus","hasSelection","getSelection","rangeCount","handleCopy","selection","range","getRangeAt","selectedContent","cloneContents","tempDiv","createElement","appendChild","htmlContent","textContent","clipboardData","setData","preventDefault","_editorRef$current","addEventListener","_editorRef$current2","removeEventListener","addResizeHandlesToImages","images","querySelectorAll","forEach","img","setAttribute","wrapper","className","width","offsetWidth","offsetHeight","parentNode","insertBefore","corner","handle","concat","dataset","stopPropagation","startX","clientX","startY","clientY","startWidth","startHeight","aspectRatio","handleMouseMove","deltaX","deltaY","newWidth","newHeight","round","handleMouseUp","event","Event","bubbles","dispatchEvent","observer","MutationObserver","setTimeout","observe","childList","subtree","disconnect","log","children","ref","contentEditable","spellCheck","suppressContentEditableWarning","fontFamily","fontSize","lineHeight","color","backgroundColor","overflow","wordWrap","whiteSpace","border","paddingBottom","displayContent","el","onChange","newValue","originalWithCollapse","onClick","placeholder","htmlDisplayContent"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/components/Editor.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { detectBase64, applyBase64Collapse } from '../utils/base64Collapse';\n\nconst Editor = ({ \n  viewMode,  \n  content, \n  editorRef, \n  onInput, \n  onSelectionChange,\n  currentFormat\n}) => {\n  \n  // √âtat pour g√©rer l'expansion des donn√©es Base64\n  const [expandedBase64, setExpandedBase64] = useState({});\n  \n  // Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\n  const handleTextareaResize = useCallback((textarea) => {\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.max(384, textarea.scrollHeight) + 'px';\n    }\n  }, []);\n\n  // Gestionnaire pour toggle Base64\n  const handleBase64Toggle = useCallback((e) => {\n    const clickedText = e.target.value;\n    const cursorPos = e.target.selectionStart;\n    \n    // Chercher si on a cliqu√© sur un bouton \"üëÅÔ∏è Voir\"\n    const beforeCursor = clickedText.substring(Math.max(0, cursorPos - 100), cursorPos + 20);\n    const toggleMatch = beforeCursor.match(/üëÅÔ∏è Voir/);\n    \n    if (toggleMatch) {\n      // Trouver l'index du Base64 correspondant\n      const base64Matches = detectBase64(content);\n      \n      // Pour simplifier, on toggle le premier Base64 trouv√©\n      // Dans une version plus avanc√©e, on pourrait calculer l'index exact\n      if (base64Matches.length > 0) {\n        const toggleIndex = 0; // Simplifi√© pour cette version\n        setExpandedBase64(prev => ({\n          ...prev,\n          [toggleIndex]: !prev[toggleIndex]\n        }));\n      }\n    }\n  }, [content]);\n\n  // Fonction pour obtenir le contenu avec Base64 collaps√©s\n  const getCollapsedContent = useCallback((originalContent) => {\n    if (viewMode === 'wysiwyg') {\n      return originalContent; // Pas de collapse en WYSIWYG\n    }\n    return applyBase64Collapse(originalContent, expandedBase64);\n  }, [viewMode, expandedBase64]);\n\n  // Fonction pour formater le HTML avec des retours √† la ligne et indentation\n  const formatHtmlForSource = useCallback((html) => {\n    let indentLevel = 0;\n    const indentSize = 2; // 2 espaces par niveau\n    \n    return html\n      .replace(/<br\\s*\\/?>/gi, '<br>\\n')\n      .replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi, (match) => {\n        if (match.startsWith('</')) {\n          // Balise fermante : diminuer l'indentation puis ajouter la balise\n          indentLevel = Math.max(0, indentLevel - 1);\n          return match + '\\n';\n        } else {\n          // Balise ouvrante : ajouter la balise puis augmenter l'indentation\n          const result = '\\n' + ' '.repeat(indentLevel * indentSize) + match;\n          // Augmenter l'indentation pour les balises conteneurs\n          if (match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)) {\n            indentLevel++;\n          }\n          return result;\n        }\n      })\n      .split('\\n')\n      .map((line, index) => {\n        if (index === 0) return line.trim(); // Premi√®re ligne sans indentation\n        if (line.trim() === '') return ''; // Ligne vide\n        if (line.trim().startsWith('</')) {\n          // Balise fermante : r√©duire l'indentation\n          const currentIndent = Math.max(0, indentLevel - 1);\n          return ' '.repeat(currentIndent * indentSize) + line.trim();\n        }\n        // Contenu texte : utiliser l'indentation actuelle\n        return line.startsWith(' ') ? line : ' '.repeat(indentLevel * indentSize) + line.trim();\n      })\n      .join('\\n')\n      .replace(/^\\n+/, '') // Supprimer les retours √† la ligne en d√©but\n      .replace(/\\n{2,}/g, '\\n') // Supprimer toutes les lignes vides multiples\n      .trim();\n  }, []);\n\n  // Gestionnaire unifi√© pour tous les changements\n  const handleChange = useCallback((e) => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Nettoyer les spans vides et les &nbsp; en trop\n      const cleanContent = (html) => {\n        return html\n          .replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g, '') // Supprimer spans vides SAUF les spans color√©s\n          .replace(/(&nbsp;\\s*){2,}/g, '&nbsp;') // R√©duire les &nbsp; multiples\n          .replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g, '<span style=\"color: $1;\">$2</span>') // Convertir font en span\n          .replace(/<b\\b[^>]*>(.*?)<\\/b>/g, '<strong>$1</strong>') // Convertir b en strong\n          .replace(/<i\\b[^>]*>(.*?)<\\/i>/g, '<em>$1</em>'); // Convertir i en em\n      };\n      \n      const newContent = cleanContent(editorRef.current.innerHTML);\n      \n      // √âviter les boucles infinies avec une v√©rification plus stricte\n      if (newContent !== content && newContent.trim() !== content.trim()) {\n        onInput({ target: { innerHTML: newContent, value: newContent } });\n      }\n      \n      // Re-rendre MathJax apr√®s modification du contenu\n      if (window.MathJax && window.MathJax.typesetPromise) {\n        window.MathJax.typesetPromise([editorRef.current]).catch((err) => {\n          console.warn('Erreur MathJax:', err);\n        });\n      }\n      \n      // Mettre √† jour l'√©tat de formatage avec un d√©lai pour √©viter les conflits\n      requestAnimationFrame(() => {\n        if (document.activeElement === editorRef.current) {\n          onSelectionChange();\n        }\n      });\n    }\n  }, [viewMode, editorRef, onInput, onSelectionChange, content]);\n\n  // Gestionnaire pour les √©v√©nements de s√©lection/curseur\n  const handleSelectionChange = useCallback(() => {\n    if (viewMode === 'wysiwyg' && document.activeElement === editorRef.current) {\n      onSelectionChange();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, onSelectionChange]);\n\n  // Initialiser le contenu uniquement si n√©cessaire\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current && editorRef.current.innerHTML !== content) {\n      // Ne pas modifier le contenu si l'utilisateur interagit activement\n      const hasFocus = document.activeElement === editorRef.current;\n      const hasSelection = window.getSelection().rangeCount > 0;\n      \n      // √âviter les mises √† jour pendant l'interaction utilisateur\n      if (hasFocus && hasSelection) {\n        return; // Ne pas perturber l'utilisateur\n      }\n      \n      // Mise √† jour simple sans restauration de curseur\n      editorRef.current.innerHTML = content;\n      \n      // Re-rendre MathJax apr√®s mise √† jour du contenu\n      if (window.MathJax && window.MathJax.typesetPromise) {\n        window.MathJax.typesetPromise([editorRef.current]).catch((err) => {\n          console.warn('Erreur MathJax:', err);\n        });\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, content]);\n\n  // Gestionnaire pour la copie - convertir HTML en texte propre\n  const handleCopy = useCallback((e) => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const selectedContent = range.cloneContents();\n        const tempDiv = document.createElement('div');\n        tempDiv.appendChild(selectedContent);\n        \n        // Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\n        const htmlContent = tempDiv.innerHTML;\n        const textContent = htmlContent\n          .replace(/<div[^>]*>/gi, '')\n          .replace(/<\\/div>/gi, '\\n')\n          .replace(/<br\\s*\\/?>/gi, '\\n')\n          .replace(/<p[^>]*>/gi, '')\n          .replace(/<\\/p>/gi, '\\n')\n          .replace(/<[^>]+>/g, '') // Supprimer toutes les autres balises\n          .replace(/&nbsp;/g, ' ')\n          .replace(/&amp;/g, '&')\n          .replace(/&lt;/g, '<')\n          .replace(/&gt;/g, '>')\n          .replace(/&quot;/g, '\"')\n          .replace(/&#39;/g, \"'\")\n          .replace(/\\n+$/, ''); // Supprimer les retours √† la ligne en fin\n        \n        // Mettre le texte propre dans le presse-papier\n        e.clipboardData.setData('text/plain', textContent);\n        e.preventDefault();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode]);\n\n  // √âcouter les changements de s√©lection et la copie\n  useEffect(() => {\n    if (viewMode === 'wysiwyg') {\n      document.addEventListener('selectionchange', handleSelectionChange);\n      editorRef.current?.addEventListener('copy', handleCopy);\n      \n      return () => {\n        document.removeEventListener('selectionchange', handleSelectionChange);\n        editorRef.current?.removeEventListener('copy', handleCopy);\n      };\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, handleSelectionChange, handleCopy]);\n\n  // Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\n  useEffect(() => {\n    if (viewMode !== 'wysiwyg' && editorRef.current) {\n      handleTextareaResize(editorRef.current);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [content, viewMode, handleTextareaResize]);\n\n  // Effect pour ajouter les poign√©es de redimensionnement aux images\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      const addResizeHandlesToImages = () => {\n        const images = editorRef.current.querySelectorAll('img:not([data-resizable])');\n        \n        images.forEach((img) => {\n          img.setAttribute('data-resizable', 'true');\n          \n          // Wrapper l'image dans un conteneur redimensionnable\n          const wrapper = document.createElement('div');\n          wrapper.className = 'resizable-image';\n          wrapper.style.width = img.offsetWidth + 'px';\n          wrapper.style.height = img.offsetHeight + 'px';\n          \n          // Ins√©rer le wrapper\n          img.parentNode.insertBefore(wrapper, img);\n          wrapper.appendChild(img);\n          \n          // Cr√©er les 4 poign√©es\n          ['nw', 'ne', 'sw', 'se'].forEach((corner) => {\n            const handle = document.createElement('div');\n            handle.className = `resize-handle ${corner}`;\n            handle.dataset.corner = corner;\n            \n            handle.addEventListener('mousedown', (e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              \n              const startX = e.clientX;\n              const startY = e.clientY;\n              const startWidth = wrapper.offsetWidth;\n              const startHeight = wrapper.offsetHeight;\n              const aspectRatio = startWidth / startHeight;\n              \n              const handleMouseMove = (e) => {\n                const deltaX = e.clientX - startX;\n                const deltaY = e.clientY - startY;\n                \n                let newWidth = startWidth;\n                let newHeight = startHeight;\n                \n                // Calculer les nouvelles dimensions selon le coin\n                switch(corner) {\n                  case 'se': // Sud-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'sw': // Sud-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'ne': // Nord-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'nw': // Nord-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                }\n                \n                // Appliquer les nouvelles dimensions\n                wrapper.style.width = newWidth + 'px';\n                wrapper.style.height = newHeight + 'px';\n                img.style.width = '100%';\n                img.style.height = '100%';\n                \n                // Ajouter les attributs HTML width/height pour persistance lors des conversions\n                img.setAttribute('width', Math.round(newWidth) + 'px');\n                img.setAttribute('height', Math.round(newHeight) + 'px');\n              };\n              \n              const handleMouseUp = () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n                \n                // D√©clencher l'√©v√©nement de changement pour sauvegarder\n                if (onInput) {\n                  const event = new Event('input', { bubbles: true });\n                  editorRef.current.dispatchEvent(event);\n                }\n              };\n              \n              document.addEventListener('mousemove', handleMouseMove);\n              document.addEventListener('mouseup', handleMouseUp);\n            });\n            \n            wrapper.appendChild(handle);\n          });\n        });\n      };\n      \n      // Observer les mutations DOM pour les nouvelles images\n      const observer = new MutationObserver(() => {\n        setTimeout(addResizeHandlesToImages, 100);\n      });\n      \n      observer.observe(editorRef.current, {\n        childList: true,\n        subtree: true\n      });\n      \n      // Ajouter les poign√©es aux images existantes\n      setTimeout(addResizeHandlesToImages, 100);\n      \n      return () => observer.disconnect();\n    }\n  }, [viewMode, content, onInput]);\n\n  // Rendu conditionnel avec switch/case pour garantir une seule vue\n  console.log('üîÑ Editor.js - Rendu switch/case, viewMode:', viewMode);\n  \n  switch (viewMode) {\n    case 'wysiwyg':\n      console.log('üéØ SWITCH - Vue WYSIWYG');\n      return (\n        <div key=\"wysiwyg\">\n          <style>{`\n            .editor-content h1 { \n              font-size: 2em; \n              font-weight: bold; \n              margin: 0.67em 0; \n              line-height: 1.2;\n            }\n            .editor-content h2 { \n              font-size: 1.5em; \n              font-weight: bold; \n              margin: 0.75em 0; \n              line-height: 1.3;\n            }\n            .editor-content h3 { \n              font-size: 1.17em; \n              font-weight: bold; \n              margin: 0.83em 0; \n              line-height: 1.4;\n            }\n            .editor-content p {\n              margin: 0.5em 0;\n            }\n            .editor-content ul {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: disc;\n            }\n            .editor-content ol {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: decimal;\n            }\n            .editor-content ol[style*=\"lower-alpha\"] {\n              list-style-type: lower-alpha;\n            }\n            .editor-content li {\n              margin: 0.25em 0;\n            }\n            \n            /* Styles pour images redimensionnables */\n            .editor-content img {\n              max-width: 100%;\n              height: auto;\n              position: relative;\n              cursor: pointer;\n            }\n            \n            .resizable-image {\n              position: relative;\n              display: inline-block;\n              border: 2px solid transparent;\n            }\n            \n            .resizable-image:hover {\n              border: 2px solid #3b82f6;\n            }\n            \n            .resizable-image .resize-handle {\n              position: absolute;\n              width: 10px;\n              height: 10px;\n              background: #3b82f6;\n              border: 2px solid white;\n              border-radius: 50%;\n              opacity: 0;\n              cursor: nw-resize;\n              transition: opacity 0.2s;\n            }\n            \n            .resizable-image:hover .resize-handle {\n              opacity: 1;\n            }\n            \n            .resize-handle.nw { top: -6px; left: -6px; cursor: nw-resize; }\n            .resize-handle.ne { top: -6px; right: -6px; cursor: ne-resize; }\n            .resize-handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }\n            .resize-handle.se { bottom: -6px; right: -6px; cursor: se-resize; }\n          `}</style>\n          <div\n            ref={editorRef}\n            contentEditable\n            spellCheck={false}\n            onInput={handleChange}\n            suppressContentEditableWarning={true}\n            className=\"editor-content p-2 focus:outline-none h-full\"\n            style={{ \n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              lineHeight: 'var(--dys-line-height)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n              paddingBottom: '2rem'\n            }}\n          />\n        </div>\n      );\n\n    case 'markdown': {\n      console.log('üìù SWITCH - Vue MARKDOWN');\n      const displayContent = getCollapsedContent(content);\n      \n      return (\n        <div key=\"markdown\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              editorRef.current = el;\n            }}\n            value={displayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalWithCollapse = getCollapsedContent(content);\n              \n              if (newValue !== originalWithCollapse) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            onClick={handleBase64Toggle}\n            className=\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            style={{\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              lineHeight: 'var(--dys-line-height)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"√âcrivez en Markdown...\n\n# Titre 1\n## Titre 2\n### Titre 3\n\n**Gras** *Italique*\n\n- Liste √† puces\n1. Liste num√©rot√©e\na. Liste alphab√©tique\n\n$E = mc^2$ (formule inline)\n$$\\\\int_{-\\\\infty}^{\\\\infty} e^{-x^2} dx = \\\\sqrt{\\\\pi}$$ (formule block)\"\n          />\n          {detectBase64(content).length > 0 && (\n            <div className=\"absolute top-2 right-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\">\n              üì∑ {detectBase64(content).length} image(s) Base64\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    case 'html': {\n      console.log('üîß SWITCH - Vue HTML');\n      const htmlDisplayContent = formatHtmlForSource(getCollapsedContent(content));\n    \n      return (\n        <div key=\"html\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              editorRef.current = el;\n            }}\n            value={htmlDisplayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalWithCollapse = formatHtmlForSource(getCollapsedContent(content));\n              \n              if (newValue !== originalWithCollapse) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            onClick={handleBase64Toggle}\n            className=\"w-full h-full p-2 focus:outline-none resize-none\"\n            style={{ \n              fontFamily: 'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"Code source HTML...\"\n          />\n          {detectBase64(content).length > 0 && (\n            <div className=\"absolute top-2 right-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\">\n              üì∑ {detectBase64(content).length} image(s) Base64\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    default:\n      console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:', viewMode);\n      return null;\n  }\n};\n\nexport default Editor;\n"],"mappings":"yIAAA,MAAO,CAAAA,KAAK,EAAIC,WAAW,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC/D,OAASC,YAAY,CAAEC,mBAAmB,KAAQ,yBAAyB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE5E,KAAM,CAAAC,MAAM,CAAGC,IAAA,EAOT,IAPU,CACdC,QAAQ,CACRC,OAAO,CACPC,SAAS,CACTC,OAAO,CACPC,iBAAiB,CACjBC,aACF,CAAC,CAAAN,IAAA,CAEC;AACA,KAAM,CAACO,cAAc,CAAEC,iBAAiB,CAAC,CAAGhB,QAAQ,CAAC,CAAC,CAAC,CAAC,CAExD;AACA,KAAM,CAAAiB,oBAAoB,CAAGnB,WAAW,CAAEoB,QAAQ,EAAK,CACrD,GAAIA,QAAQ,CAAE,CACZA,QAAQ,CAACC,KAAK,CAACC,MAAM,CAAG,MAAM,CAC9BF,QAAQ,CAACC,KAAK,CAACC,MAAM,CAAGC,IAAI,CAACC,GAAG,CAAC,GAAG,CAAEJ,QAAQ,CAACK,YAAY,CAAC,CAAG,IAAI,CACrE,CACF,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAC,kBAAkB,CAAG1B,WAAW,CAAE2B,CAAC,EAAK,CAC5C,KAAM,CAAAC,WAAW,CAAGD,CAAC,CAACE,MAAM,CAACC,KAAK,CAClC,KAAM,CAAAC,SAAS,CAAGJ,CAAC,CAACE,MAAM,CAACG,cAAc,CAEzC;AACA,KAAM,CAAAC,YAAY,CAAGL,WAAW,CAACM,SAAS,CAACX,IAAI,CAACC,GAAG,CAAC,CAAC,CAAEO,SAAS,CAAG,GAAG,CAAC,CAAEA,SAAS,CAAG,EAAE,CAAC,CACxF,KAAM,CAAAI,WAAW,CAAGF,YAAY,CAACG,KAAK,CAAC,UAAU,CAAC,CAElD,GAAID,WAAW,CAAE,CACf;AACA,KAAM,CAAAE,aAAa,CAAGlC,YAAY,CAACS,OAAO,CAAC,CAE3C;AACA;AACA,GAAIyB,aAAa,CAACC,MAAM,CAAG,CAAC,CAAE,CAC5B,KAAM,CAAAC,WAAW,CAAG,CAAC,CAAE;AACvBrB,iBAAiB,CAACsB,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACjBD,IAAI,MACP,CAACD,WAAW,EAAG,CAACC,IAAI,CAACD,WAAW,CAAC,EACjC,CAAC,CACL,CACF,CACF,CAAC,CAAE,CAAC3B,OAAO,CAAC,CAAC,CAEb;AACA,KAAM,CAAA8B,mBAAmB,CAAG1C,WAAW,CAAE2C,eAAe,EAAK,CAC3D,GAAIhC,QAAQ,GAAK,SAAS,CAAE,CAC1B,MAAO,CAAAgC,eAAe,CAAE;AAC1B,CACA,MAAO,CAAAvC,mBAAmB,CAACuC,eAAe,CAAE1B,cAAc,CAAC,CAC7D,CAAC,CAAE,CAACN,QAAQ,CAAEM,cAAc,CAAC,CAAC,CAE9B;AACA,KAAM,CAAA2B,mBAAmB,CAAG5C,WAAW,CAAE6C,IAAI,EAAK,CAChD,GAAI,CAAAC,WAAW,CAAG,CAAC,CACnB,KAAM,CAAAC,UAAU,CAAG,CAAC,CAAE;AAEtB,MAAO,CAAAF,IAAI,CACRG,OAAO,CAAC,cAAc,CAAE,QAAQ,CAAC,CACjCA,OAAO,CAAC,oDAAoD,CAAGZ,KAAK,EAAK,CACxE,GAAIA,KAAK,CAACa,UAAU,CAAC,IAAI,CAAC,CAAE,CAC1B;AACAH,WAAW,CAAGvB,IAAI,CAACC,GAAG,CAAC,CAAC,CAAEsB,WAAW,CAAG,CAAC,CAAC,CAC1C,MAAO,CAAAV,KAAK,CAAG,IAAI,CACrB,CAAC,IAAM,CACL;AACA,KAAM,CAAAc,MAAM,CAAG,IAAI,CAAG,GAAG,CAACC,MAAM,CAACL,WAAW,CAAGC,UAAU,CAAC,CAAGX,KAAK,CAClE;AACA,GAAIA,KAAK,CAACA,KAAK,CAAC,iCAAiC,CAAC,CAAE,CAClDU,WAAW,EAAE,CACf,CACA,MAAO,CAAAI,MAAM,CACf,CACF,CAAC,CAAC,CACDE,KAAK,CAAC,IAAI,CAAC,CACXC,GAAG,CAAC,CAACC,IAAI,CAAEC,KAAK,GAAK,CACpB,GAAIA,KAAK,GAAK,CAAC,CAAE,MAAO,CAAAD,IAAI,CAACE,IAAI,CAAC,CAAC,CAAE;AACrC,GAAIF,IAAI,CAACE,IAAI,CAAC,CAAC,GAAK,EAAE,CAAE,MAAO,EAAE,CAAE;AACnC,GAAIF,IAAI,CAACE,IAAI,CAAC,CAAC,CAACP,UAAU,CAAC,IAAI,CAAC,CAAE,CAChC;AACA,KAAM,CAAAQ,aAAa,CAAGlC,IAAI,CAACC,GAAG,CAAC,CAAC,CAAEsB,WAAW,CAAG,CAAC,CAAC,CAClD,MAAO,GAAG,CAACK,MAAM,CAACM,aAAa,CAAGV,UAAU,CAAC,CAAGO,IAAI,CAACE,IAAI,CAAC,CAAC,CAC7D,CACA;AACA,MAAO,CAAAF,IAAI,CAACL,UAAU,CAAC,GAAG,CAAC,CAAGK,IAAI,CAAG,GAAG,CAACH,MAAM,CAACL,WAAW,CAAGC,UAAU,CAAC,CAAGO,IAAI,CAACE,IAAI,CAAC,CAAC,CACzF,CAAC,CAAC,CACDE,IAAI,CAAC,IAAI,CAAC,CACVV,OAAO,CAAC,MAAM,CAAE,EAAE,CAAE;AAAA,CACpBA,OAAO,CAAC,SAAS,CAAE,IAAI,CAAE;AAAA,CACzBQ,IAAI,CAAC,CAAC,CACX,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAG,YAAY,CAAG3D,WAAW,CAAE2B,CAAC,EAAK,CACtC,GAAIhB,QAAQ,GAAK,SAAS,EAAIE,SAAS,CAAC+C,OAAO,CAAE,CAC/C;AACA,KAAM,CAAAC,YAAY,CAAIhB,IAAI,EAAK,CAC7B,MAAO,CAAAA,IAAI,CACRG,OAAO,CAAC,oDAAoD,CAAE,EAAE,CAAE;AAAA,CAClEA,OAAO,CAAC,kBAAkB,CAAE,QAAQ,CAAE;AAAA,CACtCA,OAAO,CAAC,+CAA+C,CAAE,oCAAoC,CAAE;AAAA,CAC/FA,OAAO,CAAC,uBAAuB,CAAE,qBAAqB,CAAE;AAAA,CACxDA,OAAO,CAAC,uBAAuB,CAAE,aAAa,CAAC,CAAE;AACtD,CAAC,CAED,KAAM,CAAAc,UAAU,CAAGD,YAAY,CAAChD,SAAS,CAAC+C,OAAO,CAACG,SAAS,CAAC,CAE5D;AACA,GAAID,UAAU,GAAKlD,OAAO,EAAIkD,UAAU,CAACN,IAAI,CAAC,CAAC,GAAK5C,OAAO,CAAC4C,IAAI,CAAC,CAAC,CAAE,CAClE1C,OAAO,CAAC,CAAEe,MAAM,CAAE,CAAEkC,SAAS,CAAED,UAAU,CAAEhC,KAAK,CAAEgC,UAAW,CAAE,CAAC,CAAC,CACnE,CAEA;AACA,GAAIE,MAAM,CAACC,OAAO,EAAID,MAAM,CAACC,OAAO,CAACC,cAAc,CAAE,CACnDF,MAAM,CAACC,OAAO,CAACC,cAAc,CAAC,CAACrD,SAAS,CAAC+C,OAAO,CAAC,CAAC,CAACO,KAAK,CAAEC,GAAG,EAAK,CAChEC,OAAO,CAACC,IAAI,CAAC,iBAAiB,CAAEF,GAAG,CAAC,CACtC,CAAC,CAAC,CACJ,CAEA;AACAG,qBAAqB,CAAC,IAAM,CAC1B,GAAIC,QAAQ,CAACC,aAAa,GAAK5D,SAAS,CAAC+C,OAAO,CAAE,CAChD7C,iBAAiB,CAAC,CAAC,CACrB,CACF,CAAC,CAAC,CACJ,CACF,CAAC,CAAE,CAACJ,QAAQ,CAAEE,SAAS,CAAEC,OAAO,CAAEC,iBAAiB,CAAEH,OAAO,CAAC,CAAC,CAE9D;AACA,KAAM,CAAA8D,qBAAqB,CAAG1E,WAAW,CAAC,IAAM,CAC9C,GAAIW,QAAQ,GAAK,SAAS,EAAI6D,QAAQ,CAACC,aAAa,GAAK5D,SAAS,CAAC+C,OAAO,CAAE,CAC1E7C,iBAAiB,CAAC,CAAC,CACrB,CACA;AACF,CAAC,CAAE,CAACJ,QAAQ,CAAEI,iBAAiB,CAAC,CAAC,CAEjC;AACAd,SAAS,CAAC,IAAM,CACd,GAAIU,QAAQ,GAAK,SAAS,EAAIE,SAAS,CAAC+C,OAAO,EAAI/C,SAAS,CAAC+C,OAAO,CAACG,SAAS,GAAKnD,OAAO,CAAE,CAC1F;AACA,KAAM,CAAA+D,QAAQ,CAAGH,QAAQ,CAACC,aAAa,GAAK5D,SAAS,CAAC+C,OAAO,CAC7D,KAAM,CAAAgB,YAAY,CAAGZ,MAAM,CAACa,YAAY,CAAC,CAAC,CAACC,UAAU,CAAG,CAAC,CAEzD;AACA,GAAIH,QAAQ,EAAIC,YAAY,CAAE,CAC5B,OAAQ;AACV,CAEA;AACA/D,SAAS,CAAC+C,OAAO,CAACG,SAAS,CAAGnD,OAAO,CAErC;AACA,GAAIoD,MAAM,CAACC,OAAO,EAAID,MAAM,CAACC,OAAO,CAACC,cAAc,CAAE,CACnDF,MAAM,CAACC,OAAO,CAACC,cAAc,CAAC,CAACrD,SAAS,CAAC+C,OAAO,CAAC,CAAC,CAACO,KAAK,CAAEC,GAAG,EAAK,CAChEC,OAAO,CAACC,IAAI,CAAC,iBAAiB,CAAEF,GAAG,CAAC,CACtC,CAAC,CAAC,CACJ,CACF,CACA;AACF,CAAC,CAAE,CAACzD,QAAQ,CAAEC,OAAO,CAAC,CAAC,CAEvB;AACA,KAAM,CAAAmE,UAAU,CAAG/E,WAAW,CAAE2B,CAAC,EAAK,CACpC,GAAIhB,QAAQ,GAAK,SAAS,EAAIE,SAAS,CAAC+C,OAAO,CAAE,CAC/C,KAAM,CAAAoB,SAAS,CAAGhB,MAAM,CAACa,YAAY,CAAC,CAAC,CACvC,GAAIG,SAAS,CAACF,UAAU,CAAG,CAAC,CAAE,CAC5B,KAAM,CAAAG,KAAK,CAAGD,SAAS,CAACE,UAAU,CAAC,CAAC,CAAC,CACrC,KAAM,CAAAC,eAAe,CAAGF,KAAK,CAACG,aAAa,CAAC,CAAC,CAC7C,KAAM,CAAAC,OAAO,CAAGb,QAAQ,CAACc,aAAa,CAAC,KAAK,CAAC,CAC7CD,OAAO,CAACE,WAAW,CAACJ,eAAe,CAAC,CAEpC;AACA,KAAM,CAAAK,WAAW,CAAGH,OAAO,CAACtB,SAAS,CACrC,KAAM,CAAA0B,WAAW,CAAGD,WAAW,CAC5BxC,OAAO,CAAC,cAAc,CAAE,EAAE,CAAC,CAC3BA,OAAO,CAAC,WAAW,CAAE,IAAI,CAAC,CAC1BA,OAAO,CAAC,cAAc,CAAE,IAAI,CAAC,CAC7BA,OAAO,CAAC,YAAY,CAAE,EAAE,CAAC,CACzBA,OAAO,CAAC,SAAS,CAAE,IAAI,CAAC,CACxBA,OAAO,CAAC,UAAU,CAAE,EAAE,CAAE;AAAA,CACxBA,OAAO,CAAC,SAAS,CAAE,GAAG,CAAC,CACvBA,OAAO,CAAC,QAAQ,CAAE,GAAG,CAAC,CACtBA,OAAO,CAAC,OAAO,CAAE,GAAG,CAAC,CACrBA,OAAO,CAAC,OAAO,CAAE,GAAG,CAAC,CACrBA,OAAO,CAAC,SAAS,CAAE,GAAG,CAAC,CACvBA,OAAO,CAAC,QAAQ,CAAE,GAAG,CAAC,CACtBA,OAAO,CAAC,MAAM,CAAE,EAAE,CAAC,CAAE;AAExB;AACArB,CAAC,CAAC+D,aAAa,CAACC,OAAO,CAAC,YAAY,CAAEF,WAAW,CAAC,CAClD9D,CAAC,CAACiE,cAAc,CAAC,CAAC,CACpB,CACF,CACA;AACF,CAAC,CAAE,CAACjF,QAAQ,CAAC,CAAC,CAEd;AACAV,SAAS,CAAC,IAAM,CACd,GAAIU,QAAQ,GAAK,SAAS,CAAE,KAAAkF,kBAAA,CAC1BrB,QAAQ,CAACsB,gBAAgB,CAAC,iBAAiB,CAAEpB,qBAAqB,CAAC,CACnE,CAAAmB,kBAAA,CAAAhF,SAAS,CAAC+C,OAAO,UAAAiC,kBAAA,iBAAjBA,kBAAA,CAAmBC,gBAAgB,CAAC,MAAM,CAAEf,UAAU,CAAC,CAEvD,MAAO,IAAM,KAAAgB,mBAAA,CACXvB,QAAQ,CAACwB,mBAAmB,CAAC,iBAAiB,CAAEtB,qBAAqB,CAAC,CACtE,CAAAqB,mBAAA,CAAAlF,SAAS,CAAC+C,OAAO,UAAAmC,mBAAA,iBAAjBA,mBAAA,CAAmBC,mBAAmB,CAAC,MAAM,CAAEjB,UAAU,CAAC,CAC5D,CAAC,CACH,CACA;AACF,CAAC,CAAE,CAACpE,QAAQ,CAAE+D,qBAAqB,CAAEK,UAAU,CAAC,CAAC,CAEjD;AACA9E,SAAS,CAAC,IAAM,CACd,GAAIU,QAAQ,GAAK,SAAS,EAAIE,SAAS,CAAC+C,OAAO,CAAE,CAC/CzC,oBAAoB,CAACN,SAAS,CAAC+C,OAAO,CAAC,CACzC,CACA;AACF,CAAC,CAAE,CAAChD,OAAO,CAAED,QAAQ,CAAEQ,oBAAoB,CAAC,CAAC,CAE7C;AACAlB,SAAS,CAAC,IAAM,CACd,GAAIU,QAAQ,GAAK,SAAS,EAAIE,SAAS,CAAC+C,OAAO,CAAE,CAC/C,KAAM,CAAAqC,wBAAwB,CAAGA,CAAA,GAAM,CACrC,KAAM,CAAAC,MAAM,CAAGrF,SAAS,CAAC+C,OAAO,CAACuC,gBAAgB,CAAC,2BAA2B,CAAC,CAE9ED,MAAM,CAACE,OAAO,CAAEC,GAAG,EAAK,CACtBA,GAAG,CAACC,YAAY,CAAC,gBAAgB,CAAE,MAAM,CAAC,CAE1C;AACA,KAAM,CAAAC,OAAO,CAAG/B,QAAQ,CAACc,aAAa,CAAC,KAAK,CAAC,CAC7CiB,OAAO,CAACC,SAAS,CAAG,iBAAiB,CACrCD,OAAO,CAAClF,KAAK,CAACoF,KAAK,CAAGJ,GAAG,CAACK,WAAW,CAAG,IAAI,CAC5CH,OAAO,CAAClF,KAAK,CAACC,MAAM,CAAG+E,GAAG,CAACM,YAAY,CAAG,IAAI,CAE9C;AACAN,GAAG,CAACO,UAAU,CAACC,YAAY,CAACN,OAAO,CAAEF,GAAG,CAAC,CACzCE,OAAO,CAAChB,WAAW,CAACc,GAAG,CAAC,CAExB;AACA,CAAC,IAAI,CAAE,IAAI,CAAE,IAAI,CAAE,IAAI,CAAC,CAACD,OAAO,CAAEU,MAAM,EAAK,CAC3C,KAAM,CAAAC,MAAM,CAAGvC,QAAQ,CAACc,aAAa,CAAC,KAAK,CAAC,CAC5CyB,MAAM,CAACP,SAAS,kBAAAQ,MAAA,CAAoBF,MAAM,CAAE,CAC5CC,MAAM,CAACE,OAAO,CAACH,MAAM,CAAGA,MAAM,CAE9BC,MAAM,CAACjB,gBAAgB,CAAC,WAAW,CAAGnE,CAAC,EAAK,CAC1CA,CAAC,CAACiE,cAAc,CAAC,CAAC,CAClBjE,CAAC,CAACuF,eAAe,CAAC,CAAC,CAEnB,KAAM,CAAAC,MAAM,CAAGxF,CAAC,CAACyF,OAAO,CACxB,KAAM,CAAAC,MAAM,CAAG1F,CAAC,CAAC2F,OAAO,CACxB,KAAM,CAAAC,UAAU,CAAGhB,OAAO,CAACG,WAAW,CACtC,KAAM,CAAAc,WAAW,CAAGjB,OAAO,CAACI,YAAY,CACxC,KAAM,CAAAc,WAAW,CAAGF,UAAU,CAAGC,WAAW,CAE5C,KAAM,CAAAE,eAAe,CAAI/F,CAAC,EAAK,CAC7B,KAAM,CAAAgG,MAAM,CAAGhG,CAAC,CAACyF,OAAO,CAAGD,MAAM,CACjC,KAAM,CAAAS,MAAM,CAAGjG,CAAC,CAAC2F,OAAO,CAAGD,MAAM,CAEjC,GAAI,CAAAQ,QAAQ,CAAGN,UAAU,CACzB,GAAI,CAAAO,SAAS,CAAGN,WAAW,CAE3B;AACA,OAAOV,MAAM,EACX,IAAK,IAAI,CAAE;AACTe,QAAQ,CAAGtG,IAAI,CAACC,GAAG,CAAC,EAAE,CAAE+F,UAAU,CAAGI,MAAM,CAAC,CAC5CG,SAAS,CAAGD,QAAQ,CAAGJ,WAAW,CAClC,MACF,IAAK,IAAI,CAAE;AACTI,QAAQ,CAAGtG,IAAI,CAACC,GAAG,CAAC,EAAE,CAAE+F,UAAU,CAAGI,MAAM,CAAC,CAC5CG,SAAS,CAAGD,QAAQ,CAAGJ,WAAW,CAClC,MACF,IAAK,IAAI,CAAE;AACTI,QAAQ,CAAGtG,IAAI,CAACC,GAAG,CAAC,EAAE,CAAE+F,UAAU,CAAGI,MAAM,CAAC,CAC5CG,SAAS,CAAGD,QAAQ,CAAGJ,WAAW,CAClC,MACF,IAAK,IAAI,CAAE;AACTI,QAAQ,CAAGtG,IAAI,CAACC,GAAG,CAAC,EAAE,CAAE+F,UAAU,CAAGI,MAAM,CAAC,CAC5CG,SAAS,CAAGD,QAAQ,CAAGJ,WAAW,CAClC,MACJ,CAEA;AACAlB,OAAO,CAAClF,KAAK,CAACoF,KAAK,CAAGoB,QAAQ,CAAG,IAAI,CACrCtB,OAAO,CAAClF,KAAK,CAACC,MAAM,CAAGwG,SAAS,CAAG,IAAI,CACvCzB,GAAG,CAAChF,KAAK,CAACoF,KAAK,CAAG,MAAM,CACxBJ,GAAG,CAAChF,KAAK,CAACC,MAAM,CAAG,MAAM,CAEzB;AACA+E,GAAG,CAACC,YAAY,CAAC,OAAO,CAAE/E,IAAI,CAACwG,KAAK,CAACF,QAAQ,CAAC,CAAG,IAAI,CAAC,CACtDxB,GAAG,CAACC,YAAY,CAAC,QAAQ,CAAE/E,IAAI,CAACwG,KAAK,CAACD,SAAS,CAAC,CAAG,IAAI,CAAC,CAC1D,CAAC,CAED,KAAM,CAAAE,aAAa,CAAGA,CAAA,GAAM,CAC1BxD,QAAQ,CAACwB,mBAAmB,CAAC,WAAW,CAAE0B,eAAe,CAAC,CAC1DlD,QAAQ,CAACwB,mBAAmB,CAAC,SAAS,CAAEgC,aAAa,CAAC,CAEtD;AACA,GAAIlH,OAAO,CAAE,CACX,KAAM,CAAAmH,KAAK,CAAG,GAAI,CAAAC,KAAK,CAAC,OAAO,CAAE,CAAEC,OAAO,CAAE,IAAK,CAAC,CAAC,CACnDtH,SAAS,CAAC+C,OAAO,CAACwE,aAAa,CAACH,KAAK,CAAC,CACxC,CACF,CAAC,CAEDzD,QAAQ,CAACsB,gBAAgB,CAAC,WAAW,CAAE4B,eAAe,CAAC,CACvDlD,QAAQ,CAACsB,gBAAgB,CAAC,SAAS,CAAEkC,aAAa,CAAC,CACrD,CAAC,CAAC,CAEFzB,OAAO,CAAChB,WAAW,CAACwB,MAAM,CAAC,CAC7B,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,CAAC,CAED;AACA,KAAM,CAAAsB,QAAQ,CAAG,GAAI,CAAAC,gBAAgB,CAAC,IAAM,CAC1CC,UAAU,CAACtC,wBAAwB,CAAE,GAAG,CAAC,CAC3C,CAAC,CAAC,CAEFoC,QAAQ,CAACG,OAAO,CAAC3H,SAAS,CAAC+C,OAAO,CAAE,CAClC6E,SAAS,CAAE,IAAI,CACfC,OAAO,CAAE,IACX,CAAC,CAAC,CAEF;AACAH,UAAU,CAACtC,wBAAwB,CAAE,GAAG,CAAC,CAEzC,MAAO,IAAMoC,QAAQ,CAACM,UAAU,CAAC,CAAC,CACpC,CACF,CAAC,CAAE,CAAChI,QAAQ,CAAEC,OAAO,CAAEE,OAAO,CAAC,CAAC,CAEhC;AACAuD,OAAO,CAACuE,GAAG,CAAC,6CAA6C,CAAEjI,QAAQ,CAAC,CAEpE,OAAQA,QAAQ,EACd,IAAK,SAAS,CACZ0D,OAAO,CAACuE,GAAG,CAAC,yBAAyB,CAAC,CACtC,mBACEpI,KAAA,QAAAqI,QAAA,eACEvI,IAAA,UAAAuI,QAAA,u9EA6ES,CAAC,cACVvI,IAAA,QACEwI,GAAG,CAAEjI,SAAU,CACfkI,eAAe,MACfC,UAAU,CAAE,KAAM,CAClBlI,OAAO,CAAE6C,YAAa,CACtBsF,8BAA8B,CAAE,IAAK,CACrCzC,SAAS,CAAC,8CAA8C,CACxDnF,KAAK,CAAE,CACL6H,UAAU,CAAE,wBAAwB,CACpCC,QAAQ,CAAE,sBAAsB,CAChCC,UAAU,CAAE,wBAAwB,CACpCC,KAAK,CAAE,uBAAuB,CAC9BC,eAAe,CAAE,qBAAqB,CACtCC,QAAQ,CAAE,MAAM,CAChBC,QAAQ,CAAE,YAAY,CACtBC,UAAU,CAAE,UAAU,CACtBC,MAAM,CAAE,mBAAmB,CAC3BC,aAAa,CAAE,MACjB,CAAE,CACH,CAAC,GAlGK,SAmGJ,CAAC,CAGV,IAAK,UAAU,CAAE,CACftF,OAAO,CAACuE,GAAG,CAAC,0BAA0B,CAAC,CACvC,KAAM,CAAAgB,cAAc,CAAGlH,mBAAmB,CAAC9B,OAAO,CAAC,CAEnD,mBACEJ,KAAA,QAAoBgG,SAAS,CAAC,UAAU,CAAAqC,QAAA,eACtCvI,IAAA,aACEwI,GAAG,CAAGe,EAAE,EAAK,CACXhJ,SAAS,CAAC+C,OAAO,CAAGiG,EAAE,CACxB,CAAE,CACF/H,KAAK,CAAE8H,cAAe,CACtBE,QAAQ,CAAGnI,CAAC,EAAK,CACf,KAAM,CAAAoI,QAAQ,CAAGpI,CAAC,CAACE,MAAM,CAACC,KAAK,CAC/B,KAAM,CAAAkI,oBAAoB,CAAGtH,mBAAmB,CAAC9B,OAAO,CAAC,CAEzD,GAAImJ,QAAQ,GAAKC,oBAAoB,CAAE,CACrClJ,OAAO,CAAA2B,aAAA,CAAAA,aAAA,IAAMd,CAAC,MAAEE,MAAM,CAAAY,aAAA,CAAAA,aAAA,IAAOd,CAAC,CAACE,MAAM,MAAEC,KAAK,CAAEiI,QAAQ,EAAE,EAAE,CAAC,CAC7D,CACF,CAAE,CACFE,OAAO,CAAEvI,kBAAmB,CAC5B8E,SAAS,CAAC,0JAA0J,CACpKnF,KAAK,CAAE,CACL6H,UAAU,CAAE,wBAAwB,CACpCC,QAAQ,CAAE,sBAAsB,CAChCC,UAAU,CAAE,wBAAwB,CACpCC,KAAK,CAAE,uBAAuB,CAC9BC,eAAe,CAAE,qBAAqB,CACtCC,QAAQ,CAAE,MAAM,CAChBC,QAAQ,CAAE,YAAY,CACtBC,UAAU,CAAE,UAAU,CACtBE,aAAa,CAAE,MACjB,CAAE,CACFO,WAAW,CAAC,0QAakD,CAC/D,CAAC,CACD/J,YAAY,CAACS,OAAO,CAAC,CAAC0B,MAAM,CAAG,CAAC,eAC/B9B,KAAA,QAAKgG,SAAS,CAAC,4EAA4E,CAAAqC,QAAA,EAAC,eACvF,CAAC1I,YAAY,CAACS,OAAO,CAAC,CAAC0B,MAAM,CAAC,kBACnC,EAAK,CACN,GA9CM,UA+CJ,CAAC,CAEV,CAEA,IAAK,MAAM,CAAE,CACX+B,OAAO,CAACuE,GAAG,CAAC,sBAAsB,CAAC,CACnC,KAAM,CAAAuB,kBAAkB,CAAGvH,mBAAmB,CAACF,mBAAmB,CAAC9B,OAAO,CAAC,CAAC,CAE5E,mBACEJ,KAAA,QAAgBgG,SAAS,CAAC,UAAU,CAAAqC,QAAA,eAClCvI,IAAA,aACEwI,GAAG,CAAGe,EAAE,EAAK,CACXhJ,SAAS,CAAC+C,OAAO,CAAGiG,EAAE,CACxB,CAAE,CACF/H,KAAK,CAAEqI,kBAAmB,CAC1BL,QAAQ,CAAGnI,CAAC,EAAK,CACf,KAAM,CAAAoI,QAAQ,CAAGpI,CAAC,CAACE,MAAM,CAACC,KAAK,CAC/B,KAAM,CAAAkI,oBAAoB,CAAGpH,mBAAmB,CAACF,mBAAmB,CAAC9B,OAAO,CAAC,CAAC,CAE9E,GAAImJ,QAAQ,GAAKC,oBAAoB,CAAE,CACrClJ,OAAO,CAAA2B,aAAA,CAAAA,aAAA,IAAMd,CAAC,MAAEE,MAAM,CAAAY,aAAA,CAAAA,aAAA,IAAOd,CAAC,CAACE,MAAM,MAAEC,KAAK,CAAEiI,QAAQ,EAAE,EAAE,CAAC,CAC7D,CACF,CAAE,CACFE,OAAO,CAAEvI,kBAAmB,CAC5B8E,SAAS,CAAC,kDAAkD,CAC5DnF,KAAK,CAAE,CACL6H,UAAU,CAAE,mDAAmD,CAC/DK,QAAQ,CAAE,MAAM,CAChBC,QAAQ,CAAE,YAAY,CACtBC,UAAU,CAAE,UAAU,CACtBC,MAAM,CAAE,mBAAmB,CAC3BC,aAAa,CAAE,MACjB,CAAE,CACFO,WAAW,CAAC,qBAAqB,CAClC,CAAC,CACD/J,YAAY,CAACS,OAAO,CAAC,CAAC0B,MAAM,CAAG,CAAC,eAC/B9B,KAAA,QAAKgG,SAAS,CAAC,4EAA4E,CAAAqC,QAAA,EAAC,eACvF,CAAC1I,YAAY,CAACS,OAAO,CAAC,CAAC0B,MAAM,CAAC,kBACnC,EAAK,CACN,GA9BM,MA+BJ,CAAC,CAEV,CAEA,QACE+B,OAAO,CAACuE,GAAG,CAAC,iDAAiD,CAAEjI,QAAQ,CAAC,CACxE,MAAO,KAAI,CACf,CACF,CAAC,CAED,cAAe,CAAAF,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}