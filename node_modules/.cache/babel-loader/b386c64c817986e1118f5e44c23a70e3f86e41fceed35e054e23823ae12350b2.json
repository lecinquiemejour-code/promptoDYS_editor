{"ast":null,"code":"import _objectSpread from\"C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{markdownToHtml,htmlToMarkdown}from'../utils/markdownConverter';import{saveImage,loadImage}from'../utils/imageStore';// Removed PromptoDYS imports - using simplified project management\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Toolbar=_ref=>{let{content,setContent,viewMode,onViewModeChange,currentFormat,onFormatChange,editorRef,onThemeSettingsToggle,ignoreSelectionChangeRef,storeBlobForUrl,getBlobFromUrl,getAllBlobs}=_ref;// IndexedDB supprim√© - √©diteur volatil uniquement\n// √âtats pour la modal de sauvegarde\nconst[showSaveModal,setShowSaveModal]=useState(false);const[documentName,setDocumentName]=useState('MonDocument');const[isSaving,setIsSaving]=useState(false);// √âtats pour les couleurs et formats\nconst[showColorPicker,setShowColorPicker]=useState(false);const[showBackgroundPicker,setShowBackgroundPicker]=useState(false);const[showConfirmModal,setShowConfirmModal]=useState(false);// V√©rifier le support File System Access API\nconst isFileSystemAccessSupported=()=>{return'showDirectoryPicker'in window&&'showOpenFilePicker'in window;};// Fonctions pour les fichiers Markdown\nconst handleCopyMarkdown=async()=>{const editor=document.querySelector('.editor-scroll .prose');if(!editor)return;const markdown=htmlToMarkdown(content);try{await navigator.clipboard.writeText(markdown);console.log('Markdown copi√© dans le presse-papier');}catch(err){console.error('Erreur lors de la copie:',err);}};// Cr√©er un blob unique pour √©viter les conflits d'URL\nconst createUniqueBlob=(file,storeBlobForUrl)=>{const uniqueId=\"\".concat(Date.now(),\"_\").concat(Math.random().toString(36).substr(2,9));const uniqueName=\"\".concat(uniqueId,\"_\").concat(file.name);const uniqueFile=new File([file],uniqueName,{type:file.type});const blobUrl=URL.createObjectURL(uniqueFile);console.log('üîó URL blob unique cr√©√©e:',blobUrl);// Stocker le blob pour r√©cup√©ration ult√©rieure\nif(storeBlobForUrl){storeBlobForUrl(blobUrl,uniqueFile);}return{blobUrl,uniqueFile};};// G√©n√©rer un nom de fichier unique avec timestamp\nconst generateImageFileName=(originalName,extension)=>{const now=new Date();const timestamp=now.getFullYear().toString()+String(now.getMonth()+1).padStart(2,'0')+String(now.getDate()).padStart(2,'0')+'_'+String(now.getHours()).padStart(2,'0')+String(now.getMinutes()).padStart(2,'0')+String(now.getSeconds()).padStart(2,'0');const baseName=originalName.replace(/\\.[^/.]+$/,\"\")||'image';return\"\".concat(baseName,\"_\").concat(timestamp,\".\").concat(extension);};// Fonction mutualis√©e pour traiter les images coll√©es et les rendre uniques\nconst processImageBlobs=async(container,storeBlobForUrl)=>{console.log('üîÑ [processImageBlobs] Traitement des images...');const images=container.querySelectorAll('img[src^=\"blob:\"]');console.log('üîç [processImageBlobs] Images blob trouv√©es:',images.length);for(const img of images){const originalUrl=img.src;try{console.log('üì• [processImageBlobs] Traitement de:',originalUrl);// R√©cup√©rer le blob original\nconst response=await fetch(originalUrl);const blob=await response.blob();// Cr√©er un nouveau fichier unique √† partir du blob\nconst filename=\"image_\".concat(Date.now(),\".\").concat(blob.type.split('/')[1]||'png');const uniqueFile=new File([blob],filename,{type:blob.type});// Cr√©er un nouveau blob URL unique\nconst{blobUrl}=createUniqueBlob(uniqueFile,storeBlobForUrl);// Remplacer l'URL dans l'image\nimg.src=blobUrl;console.log('‚úÖ [processImageBlobs] Image mise √† jour:',originalUrl,'->',blobUrl);}catch(error){console.error('‚ùå [processImageBlobs] Erreur pour:',originalUrl,error);}}};// Validation pr√©-sauvegarde des images blob (mise √† jour pour IndexedDB)\nconst validateImagesBeforeSave=htmlContent=>{console.log('üîç [VALIDATION] D√©but validation des images avant sauvegarde...');// Parser le HTML avec DOMParser\nconst parser=new DOMParser();const doc=parser.parseFromString(htmlContent,'text/html');// Trouver toutes les images avec src blob: MAIS sans data-image-id (temporaires)\nconst allBlobImages=doc.querySelectorAll('img[src^=\"blob:\"]');const blobImages=Array.from(allBlobImages).filter(img=>!img.hasAttribute('data-image-id'));// Trouver les images persistantes avec data-image-id\nconst persistentImages=doc.querySelectorAll('img[data-image-id]');console.log('üîç [VALIDATION] Images blob temporaires (sans data-image-id):',blobImages.length);console.log('üîç [VALIDATION] Images persistantes (avec data-image-id):',persistentImages.length);console.log('üîç [VALIDATION] Total images blob:',allBlobImages.length);// Les images persistantes sont toujours valides\nif(blobImages.length===0){console.log('‚úÖ [VALIDATION] Aucune image blob temporaire √† valider');console.log('‚úÖ [VALIDATION] Images persistantes OK, sauvegarde autoris√©e');return{valid:true,missingBlobs:[],totalImages:blobImages.length+persistentImages.length};}// R√©cup√©rer les blobs disponibles en m√©moire (ancien syst√®me)\nconst availableBlobs=getAllBlobs?getAllBlobs():new Map();const storedBlobUrls=Array.from(availableBlobs.keys());console.log('üîç [VALIDATION] Blobs temporaires en m√©moire:',storedBlobUrls.length);console.log('üîç [VALIDATION] URLs temporaires stock√©es:',storedBlobUrls);// V√©rifier seulement les images blob: temporaires\nconst missingBlobs=[];blobImages.forEach((img,index)=>{const imageUrl=img.src;if(availableBlobs.has(imageUrl)){const storedFile=availableBlobs.get(imageUrl);console.log(\"\\u2705 [VALIDATION] Blob temporaire trouv\\xE9 pour image \".concat(index+1,\":\"),storedFile===null||storedFile===void 0?void 0:storedFile.name,\"(\".concat(storedFile===null||storedFile===void 0?void 0:storedFile.size,\" bytes)\"));}else{console.log(\"\\u274C [VALIDATION] Blob temporaire MANQUANT pour image \".concat(index+1,\":\"),imageUrl);missingBlobs.push({index:index+1,url:imageUrl,alt:img.alt||'image sans nom'});}});const isValid=missingBlobs.length===0;if(isValid){console.log('‚úÖ [VALIDATION] Validation r√©ussie - toutes les images sont disponibles');console.log(\"\\u2705 [VALIDATION] Total: \".concat(blobImages.length,\" blob temporaires + \").concat(persistentImages.length,\" persistantes\"));}else{console.log(\"\\u274C [VALIDATION] Validation \\xE9chou\\xE9e - \".concat(missingBlobs.length,\"/\").concat(blobImages.length,\" image(s) blob temporaire(s) manquante(s)\"));console.log('‚ùå [VALIDATION] Images manquantes d√©tail:',missingBlobs);}return{valid:isValid,missingBlobs:missingBlobs,totalImages:blobImages.length+persistentImages.length};};// Extraire et sauvegarder les images blob\nconst extractAndSaveImages=async(htmlContent,documentDir)=>{console.log('üîç extractAndSaveImages appel√©e avec HTML:',htmlContent.substring(0,200)+'...');// Parser le HTML avec DOMParser\nconst parser=new DOMParser();const doc=parser.parseFromString(htmlContent,'text/html');// Trouver toutes les images avec src blob:\nconst images=doc.querySelectorAll('img[src^=\"blob:\"]');console.log('üîç Nombre d\\'images trouv√©es:',images.length);images.forEach((img,i)=>{console.log(\"\\uD83D\\uDD0D Image \".concat(i+1,\":\"),img.src,'|',img.alt);});if(images.length===0){console.log('‚ùå Aucune image trouv√©e - HTML:',htmlContent);return htmlContent;// Pas d'images √† traiter\n}// Cr√©er le dossier images\nconst imagesDir=await documentDir.getDirectoryHandle('images',{create:true});// Traiter chaque image s√©par√©ment (pas de d√©duplication)\nfor(const img of images){const imageUrl=img.src;const altText=img.alt||'image';try{let blob;// V√©rifier d'abord si on a le blob en m√©moire\nif(imageUrl.startsWith('blob:')&&getBlobFromUrl){const storedFile=getBlobFromUrl(imageUrl);if(storedFile){console.log('‚úÖ Blob trouv√© en m√©moire pour:',imageUrl,'Name:',storedFile===null||storedFile===void 0?void 0:storedFile.name,'Size:',storedFile===null||storedFile===void 0?void 0:storedFile.size);blob=storedFile;}else{console.log('‚ö†Ô∏è Blob non trouv√© en m√©moire pour:',imageUrl);console.log('üìä Blobs disponibles en m√©moire:',getAllBlobs?getAllBlobs().size:'getAllBlobs non disponible');if(getAllBlobs){console.log('üîç URLs des blobs stock√©s:',Array.from(getAllBlobs().keys()));}console.log('üîÑ Tentative de fetch:',imageUrl);const response=await fetch(imageUrl);blob=await response.blob();}}else{const response=await fetch(imageUrl);blob=await response.blob();}if(!blob){console.error('‚ùå Impossible de r√©cup√©rer l\\'image:',imageUrl);continue;}// D√©terminer l'extension du fichier\nconst mimeType=blob.type||'image/png';const extension=mimeType.split('/')[1]||'png';// Utiliser le nom de l'image ou d√©faut\nconst originalName=altText||'image';const fileName=generateImageFileName(originalName,extension);// Sauvegarder l'image\nconst imageHandle=await imagesDir.getFileHandle(fileName,{create:true});const writable=await imageHandle.createWritable();await writable.write(blob);await writable.close();// Mettre √† jour le src dans l'HTML pour pointer vers le fichier local\nimg.src=\"./images/\".concat(fileName);console.log('‚úÖ Image sauvegard√©e:',fileName);}catch(imageError){console.error('‚ùå Erreur sauvegarde image:',imageError);}}// Retourner le HTML modifi√© depuis le DOM\nreturn doc.body.innerHTML;};// Trouver un nom de dossier disponible (gestion des collisions)\nconst findAvailableDirectoryName=async(parentDir,baseName)=>{let finalName=baseName;let counter=1;while(true){try{// Tenter d'acc√©der au dossier (si √ßa marche, il existe d√©j√†)\nawait parentDir.getDirectoryHandle(finalName);// Le dossier existe, essayer le suivant\nfinalName=\"\".concat(baseName,\" (\").concat(counter,\")\");counter++;}catch(error){// Le dossier n'existe pas, on peut l'utiliser\nbreak;}}return finalName;};// Fonction pour effectuer la sauvegarde\nconst performSave=async chosenDocumentName=>{try{var _editorRef$current;setIsSaving(true);console.log('üíæ [SAVE] D√©but du processus de sauvegarde...');// R√©cup√©rer le HTML actuel\nconst htmlContent=((_editorRef$current=editorRef.current)===null||_editorRef$current===void 0?void 0:_editorRef$current.innerHTML)||content;console.log('üíæ [SAVE] HTML r√©cup√©r√©, longueur:',htmlContent.length);// √âTAPE 1: Validation pr√©-sauvegarde des images\nconsole.log('üîç [SAVE] √âtape 1 - Validation pr√©-sauvegarde...');const validationResult=validateImagesBeforeSave(htmlContent);if(!validationResult.valid){console.log('‚ùå [SAVE] Sauvegarde bloqu√©e - images manquantes d√©tect√©es');const missingCount=validationResult.missingBlobs.length;const totalCount=validationResult.totalImages;let errorMessage=\"\\u274C Impossible de sauvegarder le document\\n\\n\";errorMessage+=\"\".concat(missingCount,\" image(s) sur \").concat(totalCount,\" ne sont pas disponibles en m\\xE9moire.\\n\\n\");errorMessage+=\"Images concern\\xE9es :\\n\";validationResult.missingBlobs.forEach(missing=>{errorMessage+=\"\\u2022 Image \".concat(missing.index,\": \\\"\").concat(missing.alt,\"\\\"\\n\");});errorMessage+=\"\\nVeuillez :\\n\";errorMessage+=\"1. R\\xE9ins\\xE9rer les images manquantes\\n\";errorMessage+=\"2. Ou supprimer les images corrompues\\n\";errorMessage+=\"3. Puis r\\xE9essayer la sauvegarde\";alert(errorMessage);setIsSaving(false);return;}console.log('‚úÖ [SAVE] Validation r√©ussie - poursuite de la sauvegarde');// √âTAPE 2: S√©lection du dossier de destination\nconsole.log('üíæ [SAVE] √âtape 2 - S√©lection du dossier de destination...');const parentDirectoryHandle=await window.showDirectoryPicker({mode:'readwrite'});// Trouver un nom de dossier disponible (√©viter les collisions)\nconst availableDocumentName=await findAvailableDirectoryName(parentDirectoryHandle,chosenDocumentName.trim());// Cr√©er le dossier du document avec le nom disponible\nconst documentDir=await parentDirectoryHandle.getDirectoryHandle(availableDocumentName,{create:true});// √âTAPE 3: Extraire et sauvegarder les images (validation d√©j√† pass√©e)\nconsole.log('üíæ [SAVE] √âtape 3 - Extraction et sauvegarde des images...');const updatedHtmlContent=await extractAndSaveImages(htmlContent,documentDir);// Convertir en markdown avec les nouveaux chemins d'images\nconst markdownContent=htmlToMarkdown(updatedHtmlContent);// Sauvegarder le fichier markdown (utiliser le nom disponible)\nconst fileName=\"\".concat(availableDocumentName,\".md\");const fileHandle=await documentDir.getFileHandle(fileName,{create:true});const writable=await fileHandle.createWritable();await writable.write(markdownContent);await writable.close();const imageCount=(updatedHtmlContent.match(/src=[\"']\\.\\/images\\/[^\"']+[\"']/g)||[]).length;const message=imageCount>0?\"\\u2705 Document sauvegard\\xE9 avec succ\\xE8s :\\n\".concat(fileName,\" + \").concat(imageCount,\" image(s) dans \").concat(availableDocumentName,\"/\"):\"\\u2705 Document sauvegard\\xE9 avec succ\\xE8s :\\n\".concat(fileName,\" dans \").concat(availableDocumentName,\"/\");alert(message);setShowSaveModal(false);}catch(error){console.error('‚ùå Erreur sauvegarde:',error);if(error.name==='AbortError'){setShowSaveModal(false);return;}alert(\"\\u274C Erreur lors de la sauvegarde :\\n\".concat(error.message));}finally{setIsSaving(false);}};// Fonction pour ouvrir la modal de sauvegarde\nconst handleSaveMarkdown=async()=>{console.log('üî• DEBUG: handleSaveMarkdown appel√©e');if(!isFileSystemAccessSupported()){console.log('‚ùå DEBUG: File System Access API non support√©e');alert('‚ùå Votre navigateur ne supporte pas l\\'acc√®s aux fichiers.');return;}console.log('‚úÖ DEBUG: File System Access API support√©e');// Ouvrir la modal pour demander le nom du document\nsetShowSaveModal(true);};// Fonction pour confirmer la sauvegarde avec le nom choisi\nconst handleConfirmSave=()=>{if(documentName.trim()==='')return;performSave(documentName);};const handleOpenDocument=async()=>{if(!isFileSystemAccessSupported()){alert('‚ùå Votre navigateur ne supporte pas l\\'acc√®s aux fichiers.');return;}// √âditeur volatil - pas de persistance\ntry{// S√©lectionner le r√©pertoire du document\nconst directoryHandle=await window.showDirectoryPicker({mode:'read'});// Chercher le fichier .md correspondant au nom du r√©pertoire\nconst documentName=directoryHandle.name;const fileName=\"\".concat(documentName,\".md\");try{const fileHandle=await directoryHandle.getFileHandle(fileName);const file=await fileHandle.getFile();const content=await file.text();let htmlContent=markdownToHtml(content);// Charger les images locales et les convertir en blob URLs\nhtmlContent=await loadLocalImages(htmlContent,directoryHandle);if(editorRef.current){editorRef.current.innerHTML=htmlContent;// D√©clencher l'√©v√©nement de changement pour mettre √† jour l'√©tat\nconst inputEvent=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(inputEvent);}// Basculer en mode WYSIWYG apr√®s le chargement\nonViewModeChange('wysiwyg');const imageCount=(htmlContent.match(/src=[\"']blob:[^\"']+[\"']/g)||[]).length;const message=imageCount>0?\"\\u2705 Document ouvert avec succ\\xE8s :\\n\".concat(fileName,\" + \").concat(imageCount,\" image(s) charg\\xE9e(s)\"):\"\\u2705 Document ouvert avec succ\\xE8s :\\n\".concat(fileName);alert(message);}catch(fileError){// Si le fichier n'existe pas, proposer de le cr√©er\nconst createFile=window.confirm(\"Le fichier \".concat(fileName,\" n'existe pas dans ce r\\xE9pertoire.\\n\\nVoulez-vous cr\\xE9er un nouveau document ?\"));if(createFile){const newContent='';const htmlContent=markdownToHtml(newContent);if(editorRef.current){editorRef.current.innerHTML=htmlContent;const inputEvent=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(inputEvent);}// Basculer en mode WYSIWYG apr√®s le chargement\nonViewModeChange('wysiwyg');alert(\"\\uD83D\\uDCDD Nouveau document cr\\xE9\\xE9 : \".concat(documentName,\"\\n\\nUtilisez \\\"Sauvegarder\\\" pour l'enregistrer.\"));}}}catch(error){console.error('‚ùå Erreur ouverture document:',error);if(error.name==='AbortError'){// L'utilisateur a annul√©\nreturn;}alert(\"\\u274C Erreur lors de l'ouverture du document :\\n\".concat(error.message));}};const loadLocalImages=async(htmlContent,documentDir)=>{// Trouver toutes les images avec src=\"./images/*\"\nconst localImageRegex=/<img[^>]+src=[\"']\\.\\/(images\\/[^\"']+)[\"'][^>]*>/g;const matches=[...htmlContent.matchAll(localImageRegex)];if(matches.length===0){return htmlContent;// Pas d'images locales\n}let updatedHtml=htmlContent;try{// V√©rifier si le dossier images existe\nconst imagesDir=await documentDir.getDirectoryHandle('images');for(const match of matches){const[fullMatch,imagePath]=match;const fileName=imagePath.split('/')[1];// R√©cup√©rer juste le nom du fichier\ntry{// Charger l'image depuis le dossier\nconst imageHandle=await imagesDir.getFileHandle(fileName);const imageFile=await imageHandle.getFile();// Cr√©er une blob URL pour l'affichage\nconst blobUrl=URL.createObjectURL(imageFile);// Remplacer dans le HTML\nupdatedHtml=updatedHtml.replace(\"\\\"./\".concat(imagePath,\"\\\"\"),\"\\\"\".concat(blobUrl,\"\\\"\"));console.log('‚úÖ Image locale charg√©e:',fileName);}catch(imageError){console.error('‚ùå Image introuvable:',fileName,imageError);}}}catch(dirError){console.log('‚ÑπÔ∏è Dossier images non trouv√©');}return updatedHtml;};const handleLoadMarkdown=event=>{const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=e=>{try{const markdownContent=e.target.result;const htmlContent=markdownToHtml(markdownContent);if(editorRef.current){editorRef.current.innerHTML=htmlContent;// D√©clencher l'√©v√©nement de changement pour mettre √† jour l'√©tat\nconst inputEvent=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(inputEvent);}// Basculer en mode WYSIWYG apr√®s le chargement\nonViewModeChange('wysiwyg');alert('Fichier Markdown charg√© avec succ√®s !');}catch(error){console.error('Erreur lors du chargement:',error);alert('Erreur lors du chargement du fichier');}};reader.readAsText(file);// Reset l'input pour permettre de recharger le m√™me fichier\nevent.target.value='';};// D√©tecter si le th√®me actuel est sombre (Dark mode)\nconst isDarkMode=()=>{const savedSettings=localStorage.getItem('dysThemeSettings');if(!savedSettings)return false;const settings=JSON.parse(savedSettings);const bg=settings.backgroundColor;// Convertir hex en RGB pour calculer la luminosit√©\nconst hex=bg.replace('#','');const r=parseInt(hex.substr(0,2),16);const g=parseInt(hex.substr(2,2),16);const b=parseInt(hex.substr(4,2),16);// Calculer la luminosit√© relative (0-255)\nconst luminance=0.299*r+0.587*g+0.114*b;// Si luminosit√© < 128, c'est un th√®me sombre\nreturn luminance<128;};// Tableau de couleurs adaptatif selon le mode\nconst colors=[{name:isDarkMode()?'Blanc':'Noir',value:isDarkMode()?'#ffffff':'#000000'},{name:'Bleu',value:'#3399ff'},{name:'Vert',value:'#00cc00'},{name:'Rouge',value:'#ff0000'},{name:'Orange',value:'#ff9900'},{name:'Violet',value:'#ff00ff'}];const execCommand=function(command){let value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;console.log('üöÄ EXECCOMMAND START:',command,'currentFormat AVANT:',currentFormat);console.log('üîí ignoreSelectionChangeRef AVANT activation:',ignoreSelectionChangeRef.current);if(viewMode!=='wysiwyg'||!editorRef.current)return;// üî• PROTECTION ACTIV√âE AVANT TOUT (m√™me focus)\nignoreSelectionChangeRef.current=true;console.log('üîí PROTECTION ACTIV√âE - ignoreSelectionChangeRef:',ignoreSelectionChangeRef.current);editorRef.current.focus();// Traitement uniforme - √âtat d'abord, DOM apr√®s\nconst newFormat=_objectSpread({},currentFormat);if(command==='bold'){newFormat.bold=!currentFormat.bold;document.execCommand('bold',false,null);}else if(command==='italic'){newFormat.italic=!currentFormat.italic;document.execCommand('italic',false,null);}else if(command==='normal'){// √âtat Normal imm√©diat - FORCE tout √† false\nnewFormat.bold=false;newFormat.italic=false;newFormat.color='#000000';newFormat.fontSize='16px';newFormat.fontFamily='system-ui';newFormat.heading=null;newFormat.list=null;// Force d√©sactivation DOM - toujours ex√©cuter m√™me si d√©j√† off\nif(document.queryCommandState('bold')){document.execCommand('bold',false,null);}if(document.queryCommandState('italic')){document.execCommand('italic',false,null);}document.execCommand('removeFormat',false,null);document.execCommand('formatBlock',false,'p');}else if(command==='foreColor'){newFormat.color=value;document.execCommand('foreColor',false,value);}else{document.execCommand(command,false,value);}// Mise √† jour imm√©diate de l'√©tat\nconsole.log('üìù APPEL onFormatChange avec newFormat:',newFormat);onFormatChange(newFormat);console.log('‚úÖ onFormatChange appel√©');// Pour le bouton Normal, forcer une deuxi√®me mise √† jour apr√®s DOM\nif(command==='normal'){setTimeout(()=>{onFormatChange({bold:false,italic:false,color:'#000000',fontSize:'16px',fontFamily:'system-ui',heading:null,list:null});},10);}// D√©sactiver la protection apr√®s d√©lai\nsetTimeout(()=>{console.log('üîì D√âSACTIVATION PROTECTION apr√®s 100ms');ignoreSelectionChangeRef.current=false;console.log('üîì ignoreSelectionChangeRef maintenant:',ignoreSelectionChangeRef.current);},100);console.log('üöÄ EXECCOMMAND END:',command);};const handleHeading=level=>{if(viewMode!=='wysiwyg'||!editorRef.current)return;editorRef.current.focus();// Nettoyer le formatage existant avant d'appliquer le titre\ndocument.execCommand('removeFormat',false,null);// Appliquer le titre\ndocument.execCommand('formatBlock',false,level);onFormatChange({bold:false,italic:false,color:'#000000',fontSize:'16px',fontFamily:'system-ui',heading:level,list:null});};const handleRemoveList=()=>{if(viewMode!=='wysiwyg'||!editorRef.current)return;editorRef.current.focus();// Utiliser la logique toggle native : appeler la m√™me commande que le type de liste actuel\nif(currentFormat.list==='bullet'){document.execCommand('insertUnorderedList',false,null);}else if(currentFormat.list==='number'||currentFormat.list==='letter'){document.execCommand('insertOrderedList',false,null);}// Mettre √† jour le format pour refl√©ter la suppression\nonFormatChange(_objectSpread(_objectSpread({},currentFormat),{},{list:null}));};const handleList=type=>{if(viewMode!=='wysiwyg'||!editorRef.current)return;editorRef.current.focus();if(type==='bullet'){document.execCommand('insertUnorderedList',false,null);}else if(type==='number'){document.execCommand('insertOrderedList',false,null);}else if(type==='letter'){document.execCommand('insertOrderedList',false,null);// Appliquer le style alphab√©tique √† la liste cr√©√©e\nconst selection=window.getSelection();if(selection.rangeCount>0){let element=selection.getRangeAt(0).commonAncestorContainer;while(element&&element.nodeType!==1){element=element.parentNode;}while(element&&element.tagName!=='OL'){element=element.parentNode;}if(element&&element.tagName==='OL'){element.style.listStyleType='lower-alpha';}}}onFormatChange({bold:false,italic:false,color:'#000000',fontSize:'16px',fontFamily:'system-ui',heading:null,list:type});};const handleImageUpload=async event=>{const file=event.target.files[0];if(!file||!file.type.startsWith('image/')){alert('Veuillez s√©lectionner un fichier image valide.');return;}console.log('üîÑ [handleImageUpload] D√©but upload image:',file.name,file.type,\"\".concat(Math.round(file.size/1024),\"KB\"));// Ins√©rer l'image directement dans l'√©diteur\nif(viewMode==='wysiwyg'&&editorRef.current){try{console.log('üíæ [handleImageUpload] Sauvegarde en IndexedDB...');// G√©n√©rer UUID et sauvegarder en IndexedDB\nconst imageId=crypto.randomUUID();await saveImage(imageId,file);// Cr√©er Object URL temporaire pour affichage imm√©diat\nconst tempObjectUrl=URL.createObjectURL(file);console.log('üîó [handleImageUpload] Object URL temporaire cr√©√©e:',tempObjectUrl);// Ins√©rer avec data-image-id ET Object URL temporaire\neditorRef.current.focus();const imgHtml=\"<img src=\\\"\".concat(tempObjectUrl,\"\\\" data-image-id=\\\"\").concat(imageId,\"\\\" width=\\\"300px\\\" style=\\\"height: auto; margin: 0.5em 0;\\\" alt=\\\"\").concat(file.name,\"\\\" />\");console.log('üìù [handleImageUpload] Insertion HTML avec imageId:',{imageId,fileName:file.name,tempUrl:tempObjectUrl,html:imgHtml});document.execCommand('insertHTML',false,imgHtml);// Forcer re-rendu imm√©diat pour styles/poign√©es images ET r√©hydratation\nsetTimeout(async()=>{if(setContent){console.log('üîÑ [handleImageUpload] Force re-rendu pour styles image');setContent(editorRef.current.innerHTML);}// D√©clencher r√©hydratation imm√©diate pour remplacer l'URL temporaire\nif(editorRef.current){console.log('üîÑ [handleImageUpload] D√©clenchement r√©hydratation post-upload...');const images=editorRef.current.querySelectorAll('img[data-image-id]');console.log(\"\\uD83D\\uDD0D [handleImageUpload] \".concat(images.length,\" images \\xE0 r\\xE9hydrater trouv\\xE9es\"));for(const img of images){const imageId=img.getAttribute('data-image-id');if(img.src.startsWith('blob:')){console.log('üîÑ [handleImageUpload] R√©hydratation image:',imageId);try{const objectUrl=await loadImage(imageId);if(objectUrl){console.log('‚úÖ [handleImageUpload] R√©hydratation r√©ussie:',img.src,'->',objectUrl);img.src=objectUrl;}}catch(error){console.error('‚ùå [handleImageUpload] Erreur r√©hydratation:',error);}}}}},200);// R√©initialiser le formatage apr√®s insertion\nonFormatChange({bold:false,italic:false,color:'#000000',fontSize:'16px',fontFamily:'system-ui',heading:null,list:null});console.log('‚úÖ [handleImageUpload] Image persistante ins√©r√©e:',{fileName:file.name,imageId,persistedInIndexedDB:true});// R√©initialiser l'input file\nevent.target.value='';}catch(error){console.error('‚ùå [handleImageUpload] ERREUR D√âTAILL√âE insertion image:',{message:error.message,stack:error.stack,fileName:file.name,fileSize:file.size,fileType:file.type});alert(\"Erreur: \".concat(error.message||'Insertion image √©chou√©e'));}}else{console.warn('‚ö†Ô∏è Upload ignor√© - Mode non-WYSIWYG ou √©diteur non disponible');}};const createNewDocument=()=>{if(editorRef.current){const newContent='';editorRef.current.innerHTML=newContent;setContent(newContent);const inputEvent=new Event('input',{bubbles:true});editorRef.current.dispatchEvent(inputEvent);}onViewModeChange('wysiwyg');};const handleNewDocument=()=>{// V√©rifier s'il y a du contenu √† perdre (logique simplifi√©e)\nconst defaultContent='';const isEmpty=!content||content.trim().length===0||content.trim()===defaultContent.trim()||content.trim()==='<p><br></p>'||content.trim()==='<p></p>'||content.trim()==='<div><br></div>';if(!isEmpty){// Il y a du contenu, ouvrir la modal de confirmation\nsetShowConfirmModal(true);}else{// Pas de contenu significatif, cr√©er directement\ncreateNewDocument();}};return/*#__PURE__*/_jsxs(\"div\",{className:\"border-4 border-blue-600 rounded-lg bg-blue-100 py-3 shadow-lg w-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-start space-x-6 mb-2 w-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"Format:\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>execCommand('normal'),className:\"px-2 py-0.5 text-xs rounded \".concat(!currentFormat.bold&&!currentFormat.italic&&!currentFormat.heading&&!currentFormat.list?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),disabled:viewMode!=='wysiwyg',children:\"Normal\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>execCommand('bold'),className:\"px-2 py-0.5 text-xs rounded font-bold \".concat(currentFormat.bold?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),disabled:viewMode!=='wysiwyg',children:\"Gras\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>execCommand('italic'),className:\"px-2 py-0.5 text-xs rounded italic \".concat(currentFormat.italic?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),disabled:viewMode!=='wysiwyg',children:\"Italique\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex space-x-1\",children:colors.map((color,index)=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>execCommand('foreColor',color.value),className:\"w-4 h-4 rounded-full border-2 \".concat(currentFormat.color===color.value?'border-blue-500 ring-2 ring-blue-300':'border-gray-300 hover:border-gray-500'),style:{backgroundColor:color.value},disabled:viewMode!=='wysiwyg',title:color.name},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"Mode:\"}),/*#__PURE__*/_jsxs(\"select\",{value:viewMode,onChange:e=>onViewModeChange(e.target.value),className:\"px-3 py-1 text-sm rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"wysiwyg\",children:\"\\uD83D\\uDCDD \\xC9diteur visuel\"}),/*#__PURE__*/_jsx(\"option\",{value:\"markdown\",children:\"#\\uFE0F\\u20E3 Code Markdown\"}),/*#__PURE__*/_jsx(\"option\",{value:\"html\",children:\"\\uD83C\\uDF10 Code HTML\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"Document:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative group\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{console.log('üî¥ DEBUG: Bouton Sauvegarder cliqu√©!');handleSaveMarkdown();},className:\"border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 px-2 py-1 text-xs rounded\",children:\"\\uD83D\\uDCBE Sauvegarder\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\",children:[\"Sauvegarder le document sur l'ordinateur\",/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative group\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleOpenDocument,className:\"border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 px-2 py-1 text-xs rounded\",children:\"\\uD83D\\uDCC1 Ouvrir\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\",children:[\"Ouvrir un Document existant\",/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative group\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowConfirmModal(true),className:\"border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 px-2 py-1 text-xs rounded\",children:\"\\uD83C\\uDD95 Nouveau\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\",children:[\"Cr\\xE9er un Nouveau Document Vierge\",/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-start space-x-6 w-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"Titres:\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>execCommand('normal'),className:\"px-2 py-0.5 text-xs rounded \".concat(!currentFormat.heading&&!currentFormat.list?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),disabled:viewMode!=='wysiwyg',children:\"Texte\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleHeading('h3'),className:\"px-2 py-0.5 text-xs rounded \".concat(currentFormat.heading==='h3'?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),style:{fontSize:'0.8em'},disabled:viewMode!=='wysiwyg',children:\"Titre 1\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleHeading('h2'),className:\"px-2 py-0.5 text-xs rounded \".concat(currentFormat.heading==='h2'?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),disabled:viewMode!=='wysiwyg',children:\"Titre 2\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleHeading('h1'),className:\"px-2 py-0.5 text-xs rounded \".concat(currentFormat.heading==='h1'?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),style:{fontSize:'1.2em'},disabled:viewMode!=='wysiwyg',children:\"Titre 3\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"Listes:\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRemoveList,className:\"px-2 py-0.5 text-xs rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500\",disabled:viewMode!=='wysiwyg',title:\"Supprimer la liste\",children:\"\\u2717\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleList('bullet'),className:\"px-2 py-0.5 text-xs rounded \".concat(currentFormat.list==='bullet'?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),disabled:viewMode!=='wysiwyg',children:\"\\u2022 Puces\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleList('number'),className:\"px-2 py-0.5 text-xs rounded \".concat(currentFormat.list==='number'?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),disabled:viewMode!=='wysiwyg',children:\"1. Num\\xE9ros\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleList('letter'),className:\"px-2 py-0.5 text-xs rounded \".concat(currentFormat.list==='letter'?'border-2 border-blue-500 bg-blue-50 text-blue-700':'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'),disabled:viewMode!=='wysiwyg',children:\"a. Lettres\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"\\xC9dition:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative group\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>document.execCommand('undo',false,null),className:\"px-2 py-0.5 text-xs rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500\",disabled:viewMode!=='wysiwyg',children:\"\\u21B6\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\",children:[\"Annuler (Ctrl+Z)\",/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative group\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>document.execCommand('redo',false,null),className:\"px-2 py-0.5 text-xs rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500\",disabled:viewMode!=='wysiwyg',children:\"\\u21B7\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\",children:[\"R\\xE9tablir (Ctrl+Y)\",/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative group\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>document.getElementById('image-input').click(),className:\"px-3 py-1 text-sm rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 font-medium\",disabled:viewMode!=='wysiwyg',children:\"\\uD83D\\uDDBC\\uFE0F Image\"}),/*#__PURE__*/_jsx(\"input\",{id:\"image-input\",type:\"file\",accept:\"image/*\",onChange:handleImageUpload,className:\"hidden\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\",children:[\"Ins\\xE9rer une image\",/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative group\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onThemeSettingsToggle,className:\"px-3 py-1 text-sm rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 font-medium\",children:\"\\uD83C\\uDFA8 Th\\xE8me\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\",children:[\"Param\\xE8tres du th\\xE8me\",/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"})]})]})]})]}),showSaveModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"system-ui bg-white rounded-lg p-4 w-64 shadow-xl border-4 border-orange-400\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-6\",children:\"\\uD83D\\uDCBE Sauvegarder le document\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"document-name\",className:\"block text-sm font-semibold text-gray-800 mb-3\",children:\"Nom du document :\"}),/*#__PURE__*/_jsx(\"input\",{id:\"document-name\",type:\"text\",value:documentName,onChange:e=>setDocumentName(e.target.value),onKeyPress:e=>{if(e.key==='Enter'&&!isSaving){handleConfirmSave();}if(e.key==='Escape'){setShowSaveModal(false);}},className:\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800 font-medium\",placeholder:\"MonDocument\",autoFocus:true,disabled:isSaving,spellCheck:\"false\",autoComplete:\"off\",autoCorrect:\"off\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mt-2 flex items-center\",children:\"\\u2728 Un nom unique sera g\\xE9n\\xE9r\\xE9 automatiquement si n\\xE9cessaire\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowSaveModal(false),disabled:isSaving,className:\"px-5 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 transition-colors duration-200\",children:\"\\u274C Annuler\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleConfirmSave,disabled:isSaving||documentName.trim()==='',className:\"px-5 py-2.5 text-sm font-semibold text-gray-800 bg-blue-50 border border-blue-300 rounded-lg hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200\",children:isSaving?'‚è≥ Sauvegarde...':'üíæ Sauvegarder'})]})]})}),showConfirmModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"system-ui bg-white rounded-lg p-4 w-64 shadow-xl border-4 border-orange-400\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-6\",children:\"\\u26A0\\uFE0F Document non sauvegard\\xE9\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-700\",children:\"Que souhaitez-vous faire ?\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowConfirmModal(false);handleSaveMarkdown();},className:\"px-3 py-2 text-xs font-medium text-gray-800 bg-green-50 border border-green-300 rounded-lg hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200\",children:\"\\uD83D\\uDCBE Sauvegarder puis nouveau\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowConfirmModal(false);createNewDocument();},className:\"px-3 py-2 text-xs font-medium text-gray-800 bg-red-50 border border-red-300 rounded-lg hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200\",children:\"\\uD83D\\uDDD1\\uFE0F Nouveau sans sauvegarder\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowConfirmModal(false),className:\"px-3 py-2 text-xs font-medium text-gray-800 bg-gray-50 border border-gray-300 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors duration-200\",children:\"\\u21A9\\uFE0F Annuler\"})]})]})})]});};export default Toolbar;","map":{"version":3,"names":["React","useState","markdownToHtml","htmlToMarkdown","saveImage","loadImage","jsx","_jsx","jsxs","_jsxs","Toolbar","_ref","content","setContent","viewMode","onViewModeChange","currentFormat","onFormatChange","editorRef","onThemeSettingsToggle","ignoreSelectionChangeRef","storeBlobForUrl","getBlobFromUrl","getAllBlobs","showSaveModal","setShowSaveModal","documentName","setDocumentName","isSaving","setIsSaving","showColorPicker","setShowColorPicker","showBackgroundPicker","setShowBackgroundPicker","showConfirmModal","setShowConfirmModal","isFileSystemAccessSupported","window","handleCopyMarkdown","editor","document","querySelector","markdown","navigator","clipboard","writeText","console","log","err","error","createUniqueBlob","file","uniqueId","concat","Date","now","Math","random","toString","substr","uniqueName","name","uniqueFile","File","type","blobUrl","URL","createObjectURL","generateImageFileName","originalName","extension","timestamp","getFullYear","String","getMonth","padStart","getDate","getHours","getMinutes","getSeconds","baseName","replace","processImageBlobs","container","images","querySelectorAll","length","img","originalUrl","src","response","fetch","blob","filename","split","validateImagesBeforeSave","htmlContent","parser","DOMParser","doc","parseFromString","allBlobImages","blobImages","Array","from","filter","hasAttribute","persistentImages","valid","missingBlobs","totalImages","availableBlobs","Map","storedBlobUrls","keys","forEach","index","imageUrl","has","storedFile","get","size","push","url","alt","isValid","extractAndSaveImages","documentDir","substring","i","imagesDir","getDirectoryHandle","create","altText","startsWith","mimeType","fileName","imageHandle","getFileHandle","writable","createWritable","write","close","imageError","body","innerHTML","findAvailableDirectoryName","parentDir","finalName","counter","performSave","chosenDocumentName","_editorRef$current","current","validationResult","missingCount","totalCount","errorMessage","missing","alert","parentDirectoryHandle","showDirectoryPicker","mode","availableDocumentName","trim","updatedHtmlContent","markdownContent","fileHandle","imageCount","match","message","handleSaveMarkdown","handleConfirmSave","handleOpenDocument","directoryHandle","getFile","text","loadLocalImages","inputEvent","Event","bubbles","dispatchEvent","fileError","createFile","confirm","newContent","localImageRegex","matches","matchAll","updatedHtml","fullMatch","imagePath","imageFile","dirError","handleLoadMarkdown","event","target","files","reader","FileReader","onload","e","result","readAsText","value","isDarkMode","savedSettings","localStorage","getItem","settings","JSON","parse","bg","backgroundColor","hex","r","parseInt","g","b","luminance","colors","execCommand","command","arguments","undefined","focus","newFormat","_objectSpread","bold","italic","color","fontSize","fontFamily","heading","list","queryCommandState","setTimeout","handleHeading","level","handleRemoveList","handleList","selection","getSelection","rangeCount","element","getRangeAt","commonAncestorContainer","nodeType","parentNode","tagName","style","listStyleType","handleImageUpload","round","imageId","crypto","randomUUID","tempObjectUrl","imgHtml","tempUrl","html","getAttribute","objectUrl","persistedInIndexedDB","stack","fileSize","fileType","warn","createNewDocument","handleNewDocument","defaultContent","isEmpty","className","children","onClick","disabled","map","title","onChange","getElementById","click","id","accept","htmlFor","onKeyPress","key","placeholder","autoFocus","spellCheck","autoComplete","autoCorrect"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/components/Toolbar.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { markdownToHtml, htmlToMarkdown } from '../utils/markdownConverter';\nimport { saveImage, loadImage } from '../utils/imageStore';\n// Removed PromptoDYS imports - using simplified project management\n\nconst Toolbar = ({ \n  content, \n  setContent, \n  viewMode, \n  onViewModeChange, \n  currentFormat, \n  onFormatChange, \n  editorRef,\n  onThemeSettingsToggle,\n  ignoreSelectionChangeRef,\n  storeBlobForUrl,\n  getBlobFromUrl,\n  getAllBlobs\n}) => {\n  // IndexedDB supprim√© - √©diteur volatil uniquement\n\n  // √âtats pour la modal de sauvegarde\n  const [showSaveModal, setShowSaveModal] = useState(false);\n  const [documentName, setDocumentName] = useState('MonDocument');\n  const [isSaving, setIsSaving] = useState(false);\n\n  // √âtats pour les couleurs et formats\n  const [showColorPicker, setShowColorPicker] = useState(false);\n  const [showBackgroundPicker, setShowBackgroundPicker] = useState(false);\n  const [showConfirmModal, setShowConfirmModal] = useState(false);\n\n  // V√©rifier le support File System Access API\n  const isFileSystemAccessSupported = () => {\n    return 'showDirectoryPicker' in window && 'showOpenFilePicker' in window;\n  };\n\n  // Fonctions pour les fichiers Markdown\n  const handleCopyMarkdown = async () => {\n    const editor = document.querySelector('.editor-scroll .prose');\n    if (!editor) return;\n    \n    const markdown = htmlToMarkdown(content);\n    \n    try {\n      await navigator.clipboard.writeText(markdown);\n      console.log('Markdown copi√© dans le presse-papier');\n    } catch (err) {\n      console.error('Erreur lors de la copie:', err);\n    }\n  };\n\n  // Cr√©er un blob unique pour √©viter les conflits d'URL\n  const createUniqueBlob = (file, storeBlobForUrl) => {\n    const uniqueId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    const uniqueName = `${uniqueId}_${file.name}`;\n    const uniqueFile = new File([file], uniqueName, { type: file.type });\n    const blobUrl = URL.createObjectURL(uniqueFile);\n    \n    console.log('üîó URL blob unique cr√©√©e:', blobUrl);\n    \n    // Stocker le blob pour r√©cup√©ration ult√©rieure\n    if (storeBlobForUrl) {\n      storeBlobForUrl(blobUrl, uniqueFile);\n    }\n    \n    return { blobUrl, uniqueFile };\n  };\n\n  // G√©n√©rer un nom de fichier unique avec timestamp\n  const generateImageFileName = (originalName, extension) => {\n    const now = new Date();\n    const timestamp = now.getFullYear().toString() + \n                     String(now.getMonth() + 1).padStart(2, '0') +\n                     String(now.getDate()).padStart(2, '0') + '_' +\n                     String(now.getHours()).padStart(2, '0') +\n                     String(now.getMinutes()).padStart(2, '0') +\n                     String(now.getSeconds()).padStart(2, '0');\n    \n    const baseName = originalName.replace(/\\.[^/.]+$/, \"\") || 'image';\n    return `${baseName}_${timestamp}.${extension}`;\n  };\n\n  // Fonction mutualis√©e pour traiter les images coll√©es et les rendre uniques\n  const processImageBlobs = async (container, storeBlobForUrl) => {\n    console.log('üîÑ [processImageBlobs] Traitement des images...');\n    \n    const images = container.querySelectorAll('img[src^=\"blob:\"]');\n    console.log('üîç [processImageBlobs] Images blob trouv√©es:', images.length);\n    \n    for (const img of images) {\n      const originalUrl = img.src;\n      \n      try {\n        console.log('üì• [processImageBlobs] Traitement de:', originalUrl);\n        \n        // R√©cup√©rer le blob original\n        const response = await fetch(originalUrl);\n        const blob = await response.blob();\n        \n        // Cr√©er un nouveau fichier unique √† partir du blob\n        const filename = `image_${Date.now()}.${blob.type.split('/')[1] || 'png'}`;\n        const uniqueFile = new File([blob], filename, { type: blob.type });\n        \n        // Cr√©er un nouveau blob URL unique\n        const { blobUrl } = createUniqueBlob(uniqueFile, storeBlobForUrl);\n        \n        // Remplacer l'URL dans l'image\n        img.src = blobUrl;\n        console.log('‚úÖ [processImageBlobs] Image mise √† jour:', originalUrl, '->', blobUrl);\n        \n      } catch (error) {\n        console.error('‚ùå [processImageBlobs] Erreur pour:', originalUrl, error);\n      }\n    }\n  };\n\n  // Validation pr√©-sauvegarde des images blob (mise √† jour pour IndexedDB)\n  const validateImagesBeforeSave = (htmlContent) => {\n    console.log('üîç [VALIDATION] D√©but validation des images avant sauvegarde...');\n    \n    // Parser le HTML avec DOMParser\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(htmlContent, 'text/html');\n    \n    // Trouver toutes les images avec src blob: MAIS sans data-image-id (temporaires)\n    const allBlobImages = doc.querySelectorAll('img[src^=\"blob:\"]');\n    const blobImages = Array.from(allBlobImages).filter(img => !img.hasAttribute('data-image-id'));\n    \n    // Trouver les images persistantes avec data-image-id\n    const persistentImages = doc.querySelectorAll('img[data-image-id]');\n    \n    console.log('üîç [VALIDATION] Images blob temporaires (sans data-image-id):', blobImages.length);\n    console.log('üîç [VALIDATION] Images persistantes (avec data-image-id):', persistentImages.length);\n    console.log('üîç [VALIDATION] Total images blob:', allBlobImages.length);\n    \n    // Les images persistantes sont toujours valides\n    if (blobImages.length === 0) {\n      console.log('‚úÖ [VALIDATION] Aucune image blob temporaire √† valider');\n      console.log('‚úÖ [VALIDATION] Images persistantes OK, sauvegarde autoris√©e');\n      return { valid: true, missingBlobs: [], totalImages: blobImages.length + persistentImages.length };\n    }\n    \n    // R√©cup√©rer les blobs disponibles en m√©moire (ancien syst√®me)\n    const availableBlobs = getAllBlobs ? getAllBlobs() : new Map();\n    const storedBlobUrls = Array.from(availableBlobs.keys());\n    console.log('üîç [VALIDATION] Blobs temporaires en m√©moire:', storedBlobUrls.length);\n    console.log('üîç [VALIDATION] URLs temporaires stock√©es:', storedBlobUrls);\n    \n    // V√©rifier seulement les images blob: temporaires\n    const missingBlobs = [];\n    blobImages.forEach((img, index) => {\n      const imageUrl = img.src;\n      \n      if (availableBlobs.has(imageUrl)) {\n        const storedFile = availableBlobs.get(imageUrl);\n        console.log(`‚úÖ [VALIDATION] Blob temporaire trouv√© pour image ${index + 1}:`, storedFile?.name, `(${storedFile?.size} bytes)`);\n      } else {\n        console.log(`‚ùå [VALIDATION] Blob temporaire MANQUANT pour image ${index + 1}:`, imageUrl);\n        missingBlobs.push({\n          index: index + 1,\n          url: imageUrl,\n          alt: img.alt || 'image sans nom'\n        });\n      }\n    });\n    \n    const isValid = missingBlobs.length === 0;\n    \n    if (isValid) {\n      console.log('‚úÖ [VALIDATION] Validation r√©ussie - toutes les images sont disponibles');\n      console.log(`‚úÖ [VALIDATION] Total: ${blobImages.length} blob temporaires + ${persistentImages.length} persistantes`);\n    } else {\n      console.log(`‚ùå [VALIDATION] Validation √©chou√©e - ${missingBlobs.length}/${blobImages.length} image(s) blob temporaire(s) manquante(s)`);\n      console.log('‚ùå [VALIDATION] Images manquantes d√©tail:', missingBlobs);\n    }\n    \n    return {\n      valid: isValid,\n      missingBlobs: missingBlobs,\n      totalImages: blobImages.length + persistentImages.length\n    };\n  };\n\n  // Extraire et sauvegarder les images blob\n  const extractAndSaveImages = async (htmlContent, documentDir) => {\n    console.log('üîç extractAndSaveImages appel√©e avec HTML:', htmlContent.substring(0, 200) + '...');\n    \n    // Parser le HTML avec DOMParser\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(htmlContent, 'text/html');\n    \n    // Trouver toutes les images avec src blob:\n    const images = doc.querySelectorAll('img[src^=\"blob:\"]');\n    \n    console.log('üîç Nombre d\\'images trouv√©es:', images.length);\n    images.forEach((img, i) => {\n      console.log(`üîç Image ${i + 1}:`, img.src, '|', img.alt);\n    });\n    \n    if (images.length === 0) {\n      console.log('‚ùå Aucune image trouv√©e - HTML:', htmlContent);\n      return htmlContent; // Pas d'images √† traiter\n    }\n\n    // Cr√©er le dossier images\n    const imagesDir = await documentDir.getDirectoryHandle('images', { create: true });\n    \n    // Traiter chaque image s√©par√©ment (pas de d√©duplication)\n    for (const img of images) {\n      const imageUrl = img.src;\n      const altText = img.alt || 'image';\n      \n      try {\n        let blob;\n        \n        // V√©rifier d'abord si on a le blob en m√©moire\n        if (imageUrl.startsWith('blob:') && getBlobFromUrl) {\n          const storedFile = getBlobFromUrl(imageUrl);\n          if (storedFile) {\n            console.log('‚úÖ Blob trouv√© en m√©moire pour:', imageUrl, 'Name:', storedFile?.name, 'Size:', storedFile?.size);\n            blob = storedFile;\n          } else {\n            console.log('‚ö†Ô∏è Blob non trouv√© en m√©moire pour:', imageUrl);\n            console.log('üìä Blobs disponibles en m√©moire:', getAllBlobs ? getAllBlobs().size : 'getAllBlobs non disponible');\n            if (getAllBlobs) {\n              console.log('üîç URLs des blobs stock√©s:', Array.from(getAllBlobs().keys()));\n            }\n            console.log('üîÑ Tentative de fetch:', imageUrl);\n            const response = await fetch(imageUrl);\n            blob = await response.blob();\n          }\n        } else {\n          const response = await fetch(imageUrl);\n          blob = await response.blob();\n        }\n        \n        if (!blob) {\n          console.error('‚ùå Impossible de r√©cup√©rer l\\'image:', imageUrl);\n          continue;\n        }\n        \n        // D√©terminer l'extension du fichier\n        const mimeType = blob.type || 'image/png';\n        const extension = mimeType.split('/')[1] || 'png';\n        \n        // Utiliser le nom de l'image ou d√©faut\n        const originalName = altText || 'image';\n        const fileName = generateImageFileName(originalName, extension);\n        \n        // Sauvegarder l'image\n        const imageHandle = await imagesDir.getFileHandle(fileName, { create: true });\n        const writable = await imageHandle.createWritable();\n        await writable.write(blob);\n        await writable.close();\n        \n        // Mettre √† jour le src dans l'HTML pour pointer vers le fichier local\n        img.src = `./images/${fileName}`;\n        console.log('‚úÖ Image sauvegard√©e:', fileName);\n      } catch (imageError) {\n        console.error('‚ùå Erreur sauvegarde image:', imageError);\n      }\n    }\n    \n    // Retourner le HTML modifi√© depuis le DOM\n    return doc.body.innerHTML;\n  };\n\n  // Trouver un nom de dossier disponible (gestion des collisions)\n  const findAvailableDirectoryName = async (parentDir, baseName) => {\n    let finalName = baseName;\n    let counter = 1;\n    \n    while (true) {\n      try {\n        // Tenter d'acc√©der au dossier (si √ßa marche, il existe d√©j√†)\n        await parentDir.getDirectoryHandle(finalName);\n        // Le dossier existe, essayer le suivant\n        finalName = `${baseName} (${counter})`;\n        counter++;\n      } catch (error) {\n        // Le dossier n'existe pas, on peut l'utiliser\n        break;\n      }\n    }\n    \n    return finalName;\n  };\n\n  // Fonction pour effectuer la sauvegarde\n  const performSave = async (chosenDocumentName) => {\n    try {\n      setIsSaving(true);\n      console.log('üíæ [SAVE] D√©but du processus de sauvegarde...');\n      \n      // R√©cup√©rer le HTML actuel\n      const htmlContent = editorRef.current?.innerHTML || content;\n      console.log('üíæ [SAVE] HTML r√©cup√©r√©, longueur:', htmlContent.length);\n      \n      // √âTAPE 1: Validation pr√©-sauvegarde des images\n      console.log('üîç [SAVE] √âtape 1 - Validation pr√©-sauvegarde...');\n      const validationResult = validateImagesBeforeSave(htmlContent);\n      \n      if (!validationResult.valid) {\n        console.log('‚ùå [SAVE] Sauvegarde bloqu√©e - images manquantes d√©tect√©es');\n        const missingCount = validationResult.missingBlobs.length;\n        const totalCount = validationResult.totalImages;\n        \n        let errorMessage = `‚ùå Impossible de sauvegarder le document\\n\\n`;\n        errorMessage += `${missingCount} image(s) sur ${totalCount} ne sont pas disponibles en m√©moire.\\n\\n`;\n        errorMessage += `Images concern√©es :\\n`;\n        \n        validationResult.missingBlobs.forEach(missing => {\n          errorMessage += `‚Ä¢ Image ${missing.index}: \"${missing.alt}\"\\n`;\n        });\n        \n        errorMessage += `\\nVeuillez :\\n`;\n        errorMessage += `1. R√©ins√©rer les images manquantes\\n`;\n        errorMessage += `2. Ou supprimer les images corrompues\\n`;\n        errorMessage += `3. Puis r√©essayer la sauvegarde`;\n        \n        alert(errorMessage);\n        setIsSaving(false);\n        return;\n      }\n      \n      console.log('‚úÖ [SAVE] Validation r√©ussie - poursuite de la sauvegarde');\n      \n      // √âTAPE 2: S√©lection du dossier de destination\n      console.log('üíæ [SAVE] √âtape 2 - S√©lection du dossier de destination...');\n      const parentDirectoryHandle = await window.showDirectoryPicker({\n        mode: 'readwrite'\n      });\n\n      // Trouver un nom de dossier disponible (√©viter les collisions)\n      const availableDocumentName = await findAvailableDirectoryName(\n        parentDirectoryHandle, \n        chosenDocumentName.trim()\n      );\n\n      // Cr√©er le dossier du document avec le nom disponible\n      const documentDir = await parentDirectoryHandle.getDirectoryHandle(\n        availableDocumentName, \n        { create: true }\n      );\n\n      // √âTAPE 3: Extraire et sauvegarder les images (validation d√©j√† pass√©e)\n      console.log('üíæ [SAVE] √âtape 3 - Extraction et sauvegarde des images...');\n      const updatedHtmlContent = await extractAndSaveImages(htmlContent, documentDir);\n      \n      // Convertir en markdown avec les nouveaux chemins d'images\n      const markdownContent = htmlToMarkdown(updatedHtmlContent);\n\n      // Sauvegarder le fichier markdown (utiliser le nom disponible)\n      const fileName = `${availableDocumentName}.md`;\n      const fileHandle = await documentDir.getFileHandle(fileName, { create: true });\n      const writable = await fileHandle.createWritable();\n      await writable.write(markdownContent);\n      await writable.close();\n      \n      const imageCount = (updatedHtmlContent.match(/src=[\"']\\.\\/images\\/[^\"']+[\"']/g) || []).length;\n      const message = imageCount > 0 \n        ? `‚úÖ Document sauvegard√© avec succ√®s :\\n${fileName} + ${imageCount} image(s) dans ${availableDocumentName}/`\n        : `‚úÖ Document sauvegard√© avec succ√®s :\\n${fileName} dans ${availableDocumentName}/`;\n\n      alert(message);\n      setShowSaveModal(false);\n    } catch (error) {\n      console.error('‚ùå Erreur sauvegarde:', error);\n      if (error.name === 'AbortError') {\n        setShowSaveModal(false);\n        return;\n      }\n      alert(`‚ùå Erreur lors de la sauvegarde :\\n${error.message}`);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Fonction pour ouvrir la modal de sauvegarde\n  const handleSaveMarkdown = async () => {\n    console.log('üî• DEBUG: handleSaveMarkdown appel√©e');\n    \n    if (!isFileSystemAccessSupported()) {\n      console.log('‚ùå DEBUG: File System Access API non support√©e');\n      alert('‚ùå Votre navigateur ne supporte pas l\\'acc√®s aux fichiers.');\n      return;\n    }\n    console.log('‚úÖ DEBUG: File System Access API support√©e');\n\n    // Ouvrir la modal pour demander le nom du document\n    setShowSaveModal(true);\n  };\n\n  // Fonction pour confirmer la sauvegarde avec le nom choisi\n  const handleConfirmSave = () => {\n    if (documentName.trim() === '') return;\n    performSave(documentName);\n  };\n\n  const handleOpenDocument = async () => {\n    if (!isFileSystemAccessSupported()) {\n      alert('‚ùå Votre navigateur ne supporte pas l\\'acc√®s aux fichiers.');\n      return;\n    }\n\n    // √âditeur volatil - pas de persistance\n\n    try {\n      // S√©lectionner le r√©pertoire du document\n      const directoryHandle = await window.showDirectoryPicker({\n        mode: 'read'\n      });\n\n      // Chercher le fichier .md correspondant au nom du r√©pertoire\n      const documentName = directoryHandle.name;\n      const fileName = `${documentName}.md`;\n      \n      try {\n        const fileHandle = await directoryHandle.getFileHandle(fileName);\n        const file = await fileHandle.getFile();\n        const content = await file.text();\n        let htmlContent = markdownToHtml(content);\n        \n        // Charger les images locales et les convertir en blob URLs\n        htmlContent = await loadLocalImages(htmlContent, directoryHandle);\n        \n        if (editorRef.current) {\n          editorRef.current.innerHTML = htmlContent;\n          // D√©clencher l'√©v√©nement de changement pour mettre √† jour l'√©tat\n          const inputEvent = new Event('input', { bubbles: true });\n          editorRef.current.dispatchEvent(inputEvent);\n        }\n        \n        // Basculer en mode WYSIWYG apr√®s le chargement\n        onViewModeChange('wysiwyg');\n        \n        const imageCount = (htmlContent.match(/src=[\"']blob:[^\"']+[\"']/g) || []).length;\n        const message = imageCount > 0 \n          ? `‚úÖ Document ouvert avec succ√®s :\\n${fileName} + ${imageCount} image(s) charg√©e(s)`\n          : `‚úÖ Document ouvert avec succ√®s :\\n${fileName}`;\n          \n        alert(message);\n      } catch (fileError) {\n        // Si le fichier n'existe pas, proposer de le cr√©er\n        const createFile = window.confirm(`Le fichier ${fileName} n'existe pas dans ce r√©pertoire.\\n\\nVoulez-vous cr√©er un nouveau document ?`);\n        if (createFile) {\n          const newContent = '';\n          const htmlContent = markdownToHtml(newContent);\n          \n          if (editorRef.current) {\n            editorRef.current.innerHTML = htmlContent;\n            const inputEvent = new Event('input', { bubbles: true });\n            editorRef.current.dispatchEvent(inputEvent);\n          }\n          \n          // Basculer en mode WYSIWYG apr√®s le chargement\n          onViewModeChange('wysiwyg');\n          alert(`üìù Nouveau document cr√©√© : ${documentName}\\n\\nUtilisez \"Sauvegarder\" pour l'enregistrer.`);\n        }\n      }\n    } catch (error) {\n      console.error('‚ùå Erreur ouverture document:', error);\n      if (error.name === 'AbortError') {\n        // L'utilisateur a annul√©\n        return;\n      }\n      alert(`‚ùå Erreur lors de l'ouverture du document :\\n${error.message}`);\n    }\n  };\n\n  const loadLocalImages = async (htmlContent, documentDir) => {\n    // Trouver toutes les images avec src=\"./images/*\"\n    const localImageRegex = /<img[^>]+src=[\"']\\.\\/(images\\/[^\"']+)[\"'][^>]*>/g;\n    const matches = [...htmlContent.matchAll(localImageRegex)];\n    \n    if (matches.length === 0) {\n      return htmlContent; // Pas d'images locales\n    }\n\n    let updatedHtml = htmlContent;\n    \n    try {\n      // V√©rifier si le dossier images existe\n      const imagesDir = await documentDir.getDirectoryHandle('images');\n      \n      for (const match of matches) {\n        const [fullMatch, imagePath] = match;\n        const fileName = imagePath.split('/')[1]; // R√©cup√©rer juste le nom du fichier\n        \n        try {\n          // Charger l'image depuis le dossier\n          const imageHandle = await imagesDir.getFileHandle(fileName);\n          const imageFile = await imageHandle.getFile();\n          \n          // Cr√©er une blob URL pour l'affichage\n          const blobUrl = URL.createObjectURL(imageFile);\n          \n          // Remplacer dans le HTML\n          updatedHtml = updatedHtml.replace(`\"./${imagePath}\"`, `\"${blobUrl}\"`);\n          \n          console.log('‚úÖ Image locale charg√©e:', fileName);\n        } catch (imageError) {\n          console.error('‚ùå Image introuvable:', fileName, imageError);\n        }\n      }\n    } catch (dirError) {\n      console.log('‚ÑπÔ∏è Dossier images non trouv√©');\n    }\n    \n    return updatedHtml;\n  };\n\n  const handleLoadMarkdown = (event) => {\n    const file = event.target.files[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const markdownContent = e.target.result;\n        const htmlContent = markdownToHtml(markdownContent);\n        \n        if (editorRef.current) {\n          editorRef.current.innerHTML = htmlContent;\n          // D√©clencher l'√©v√©nement de changement pour mettre √† jour l'√©tat\n          const inputEvent = new Event('input', { bubbles: true });\n          editorRef.current.dispatchEvent(inputEvent);\n        }\n        \n        // Basculer en mode WYSIWYG apr√®s le chargement\n        onViewModeChange('wysiwyg');\n        alert('Fichier Markdown charg√© avec succ√®s !');\n      } catch (error) {\n        console.error('Erreur lors du chargement:', error);\n        alert('Erreur lors du chargement du fichier');\n      }\n    };\n    \n    reader.readAsText(file);\n    // Reset l'input pour permettre de recharger le m√™me fichier\n    event.target.value = '';\n  };\n  \n  // D√©tecter si le th√®me actuel est sombre (Dark mode)\n  const isDarkMode = () => {\n    const savedSettings = localStorage.getItem('dysThemeSettings');\n    if (!savedSettings) return false;\n    \n    const settings = JSON.parse(savedSettings);\n    const bg = settings.backgroundColor;\n    \n    // Convertir hex en RGB pour calculer la luminosit√©\n    const hex = bg.replace('#', '');\n    const r = parseInt(hex.substr(0, 2), 16);\n    const g = parseInt(hex.substr(2, 2), 16);\n    const b = parseInt(hex.substr(4, 2), 16);\n    \n    // Calculer la luminosit√© relative (0-255)\n    const luminance = (0.299 * r + 0.587 * g + 0.114 * b);\n    \n    // Si luminosit√© < 128, c'est un th√®me sombre\n    return luminance < 128;\n  };\n  \n  // Tableau de couleurs adaptatif selon le mode\n  const colors = [\n    { name: isDarkMode() ? 'Blanc' : 'Noir', value: isDarkMode() ? '#ffffff' : '#000000' },\n    { name: 'Bleu', value: '#3399ff' },\n    { name: 'Vert', value: '#00cc00' },\n    { name: 'Rouge', value: '#ff0000' },\n    { name: 'Orange', value: '#ff9900' },\n    { name: 'Violet', value: '#ff00ff' }\n  ];\n\n\n  const execCommand = (command, value = null) => {\n    console.log('üöÄ EXECCOMMAND START:', command, 'currentFormat AVANT:', currentFormat);\n    console.log('üîí ignoreSelectionChangeRef AVANT activation:', ignoreSelectionChangeRef.current);\n    \n    if (viewMode !== 'wysiwyg' || !editorRef.current) return;\n    \n    // üî• PROTECTION ACTIV√âE AVANT TOUT (m√™me focus)\n    ignoreSelectionChangeRef.current = true;\n    console.log('üîí PROTECTION ACTIV√âE - ignoreSelectionChangeRef:', ignoreSelectionChangeRef.current);\n    \n    editorRef.current.focus();\n    \n    // Traitement uniforme - √âtat d'abord, DOM apr√®s\n    const newFormat = { ...currentFormat };\n    \n    if (command === 'bold') {\n      newFormat.bold = !currentFormat.bold;\n      document.execCommand('bold', false, null);\n    } else if (command === 'italic') {\n      newFormat.italic = !currentFormat.italic;\n      document.execCommand('italic', false, null);\n    } else if (command === 'normal') {\n      // √âtat Normal imm√©diat - FORCE tout √† false\n      newFormat.bold = false;\n      newFormat.italic = false;\n      newFormat.color = '#000000';\n      newFormat.fontSize = '16px';\n      newFormat.fontFamily = 'system-ui';\n      newFormat.heading = null;\n      newFormat.list = null;\n      \n      // Force d√©sactivation DOM - toujours ex√©cuter m√™me si d√©j√† off\n      if (document.queryCommandState('bold')) {\n        document.execCommand('bold', false, null);\n      }\n      if (document.queryCommandState('italic')) {\n        document.execCommand('italic', false, null);\n      }\n      document.execCommand('removeFormat', false, null);\n      document.execCommand('formatBlock', false, 'p');\n    } else if (command === 'foreColor') {\n      newFormat.color = value;\n      document.execCommand('foreColor', false, value);\n    } else {\n      document.execCommand(command, false, value);\n    }\n    \n    // Mise √† jour imm√©diate de l'√©tat\n    console.log('üìù APPEL onFormatChange avec newFormat:', newFormat);\n    onFormatChange(newFormat);\n    console.log('‚úÖ onFormatChange appel√©');\n    \n    // Pour le bouton Normal, forcer une deuxi√®me mise √† jour apr√®s DOM\n    if (command === 'normal') {\n      setTimeout(() => {\n        onFormatChange({\n          bold: false,\n          italic: false,\n          color: '#000000',\n          fontSize: '16px',\n          fontFamily: 'system-ui',\n          heading: null,\n          list: null\n        });\n      }, 10);\n    }\n    \n    // D√©sactiver la protection apr√®s d√©lai\n    setTimeout(() => {\n      console.log('üîì D√âSACTIVATION PROTECTION apr√®s 100ms');\n      ignoreSelectionChangeRef.current = false;\n      console.log('üîì ignoreSelectionChangeRef maintenant:', ignoreSelectionChangeRef.current);\n    }, 100);\n    \n    console.log('üöÄ EXECCOMMAND END:', command);\n  };\n\n  const handleHeading = (level) => {\n    if (viewMode !== 'wysiwyg' || !editorRef.current) return;\n    \n    editorRef.current.focus();\n    \n    // Nettoyer le formatage existant avant d'appliquer le titre\n    document.execCommand('removeFormat', false, null);\n    \n    // Appliquer le titre\n    document.execCommand('formatBlock', false, level);\n    \n    onFormatChange({ bold: false, italic: false, color: '#000000', fontSize: '16px', fontFamily: 'system-ui', heading: level, list: null });\n  };\n\n\n  const handleRemoveList = () => {\n    if (viewMode !== 'wysiwyg' || !editorRef.current) return;\n    \n    editorRef.current.focus();\n    \n    // Utiliser la logique toggle native : appeler la m√™me commande que le type de liste actuel\n    if (currentFormat.list === 'bullet') {\n      document.execCommand('insertUnorderedList', false, null);\n    } else if (currentFormat.list === 'number' || currentFormat.list === 'letter') {\n      document.execCommand('insertOrderedList', false, null);\n    }\n    \n    // Mettre √† jour le format pour refl√©ter la suppression\n    onFormatChange({ ...currentFormat, list: null });\n  };\n\n  const handleList = (type) => {\n    if (viewMode !== 'wysiwyg' || !editorRef.current) return;\n    \n    editorRef.current.focus();\n    \n    if (type === 'bullet') {\n      document.execCommand('insertUnorderedList', false, null);\n    } else if (type === 'number') {\n      document.execCommand('insertOrderedList', false, null);\n    } else if (type === 'letter') {\n      document.execCommand('insertOrderedList', false, null);\n      // Appliquer le style alphab√©tique √† la liste cr√©√©e\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        let element = selection.getRangeAt(0).commonAncestorContainer;\n        while (element && element.nodeType !== 1) {\n          element = element.parentNode;\n        }\n        while (element && element.tagName !== 'OL') {\n          element = element.parentNode;\n        }\n        if (element && element.tagName === 'OL') {\n          element.style.listStyleType = 'lower-alpha';\n        }\n      }\n    }\n    \n    onFormatChange({ bold: false, italic: false, color: '#000000', fontSize: '16px', fontFamily: 'system-ui', heading: null, list: type });\n  };\n\n  const handleImageUpload = async (event) => {\n    const file = event.target.files[0];\n    if (!file || !file.type.startsWith('image/')) {\n      alert('Veuillez s√©lectionner un fichier image valide.');\n      return;\n    }\n    \n    console.log('üîÑ [handleImageUpload] D√©but upload image:', file.name, file.type, `${Math.round(file.size/1024)}KB`);\n    \n    // Ins√©rer l'image directement dans l'√©diteur\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      try {\n        console.log('üíæ [handleImageUpload] Sauvegarde en IndexedDB...');\n        \n        // G√©n√©rer UUID et sauvegarder en IndexedDB\n        const imageId = crypto.randomUUID();\n        await saveImage(imageId, file);\n        \n        // Cr√©er Object URL temporaire pour affichage imm√©diat\n        const tempObjectUrl = URL.createObjectURL(file);\n        console.log('üîó [handleImageUpload] Object URL temporaire cr√©√©e:', tempObjectUrl);\n        \n        // Ins√©rer avec data-image-id ET Object URL temporaire\n        editorRef.current.focus();\n        const imgHtml = `<img src=\"${tempObjectUrl}\" data-image-id=\"${imageId}\" width=\"300px\" style=\"height: auto; margin: 0.5em 0;\" alt=\"${file.name}\" />`;\n        \n        console.log('üìù [handleImageUpload] Insertion HTML avec imageId:', {\n          imageId,\n          fileName: file.name,\n          tempUrl: tempObjectUrl,\n          html: imgHtml\n        });\n        \n        document.execCommand('insertHTML', false, imgHtml);\n        \n        // Forcer re-rendu imm√©diat pour styles/poign√©es images ET r√©hydratation\n        setTimeout(async () => {\n          if (setContent) {\n            console.log('üîÑ [handleImageUpload] Force re-rendu pour styles image');\n            setContent(editorRef.current.innerHTML);\n          }\n          \n          // D√©clencher r√©hydratation imm√©diate pour remplacer l'URL temporaire\n          if (editorRef.current) {\n            console.log('üîÑ [handleImageUpload] D√©clenchement r√©hydratation post-upload...');\n            const images = editorRef.current.querySelectorAll('img[data-image-id]');\n            console.log(`üîç [handleImageUpload] ${images.length} images √† r√©hydrater trouv√©es`);\n            \n            for (const img of images) {\n              const imageId = img.getAttribute('data-image-id');\n              if (img.src.startsWith('blob:')) {\n                console.log('üîÑ [handleImageUpload] R√©hydratation image:', imageId);\n                try {\n                  const objectUrl = await loadImage(imageId);\n                  if (objectUrl) {\n                    console.log('‚úÖ [handleImageUpload] R√©hydratation r√©ussie:', img.src, '->', objectUrl);\n                    img.src = objectUrl;\n                  }\n                } catch (error) {\n                  console.error('‚ùå [handleImageUpload] Erreur r√©hydratation:', error);\n                }\n              }\n            }\n          }\n        }, 200);\n        \n        // R√©initialiser le formatage apr√®s insertion\n        onFormatChange({ bold: false, italic: false, color: '#000000', fontSize: '16px', fontFamily: 'system-ui', heading: null, list: null });\n        \n        console.log('‚úÖ [handleImageUpload] Image persistante ins√©r√©e:', {\n          fileName: file.name,\n          imageId,\n          persistedInIndexedDB: true\n        });\n        \n        // R√©initialiser l'input file\n        event.target.value = '';\n        \n      } catch (error) {\n        console.error('‚ùå [handleImageUpload] ERREUR D√âTAILL√âE insertion image:', {\n          message: error.message,\n          stack: error.stack,\n          fileName: file.name,\n          fileSize: file.size,\n          fileType: file.type\n        });\n        alert(`Erreur: ${error.message || 'Insertion image √©chou√©e'}`);\n      }\n    } else {\n      console.warn('‚ö†Ô∏è Upload ignor√© - Mode non-WYSIWYG ou √©diteur non disponible');\n    }\n  };\n\n\n  const createNewDocument = () => {\n    if (editorRef.current) {\n      const newContent = '';\n      editorRef.current.innerHTML = newContent;\n      setContent(newContent);\n      const inputEvent = new Event('input', { bubbles: true });\n      editorRef.current.dispatchEvent(inputEvent);\n    }\n    onViewModeChange('wysiwyg');\n  };\n\n  const handleNewDocument = () => {\n    // V√©rifier s'il y a du contenu √† perdre (logique simplifi√©e)\n    const defaultContent = '';\n    const isEmpty = !content || \n      content.trim().length === 0 || \n      content.trim() === defaultContent.trim() ||\n      content.trim() === '<p><br></p>' ||\n      content.trim() === '<p></p>' ||\n      content.trim() === '<div><br></div>';\n    \n    if (!isEmpty) {\n      // Il y a du contenu, ouvrir la modal de confirmation\n      setShowConfirmModal(true);\n    } else {\n      // Pas de contenu significatif, cr√©er directement\n      createNewDocument();\n    }\n  };\n\n  return (\n    <div className=\"border-4 border-blue-600 rounded-lg bg-blue-100 py-3 shadow-lg w-full\">\n      {/* Ligne 1 - Format + Couleurs + Mode */}\n      <div className=\"flex items-center justify-start space-x-6 mb-2 w-full\">\n        {/* Format buttons */}\n        <div className=\"flex items-center space-x-2\">\n          <span className=\"text-sm font-medium text-gray-700\">Format:</span>\n          <button\n            onClick={() => execCommand('normal')}\n            className={`px-2 py-0.5 text-xs rounded ${\n              !currentFormat.bold && !currentFormat.italic && !currentFormat.heading && !currentFormat.list\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            Normal\n          </button>\n          <button\n            onClick={() => execCommand('bold')}\n            className={`px-2 py-0.5 text-xs rounded font-bold ${\n              currentFormat.bold\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            Gras\n          </button>\n          <button\n            onClick={() => execCommand('italic')}\n            className={`px-2 py-0.5 text-xs rounded italic ${\n              currentFormat.italic\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            Italique\n          </button>\n        </div>\n\n        {/* Colors (sans libell√©) */}\n        <div className=\"flex space-x-1\">\n          {colors.map((color, index) => (\n            <button\n              key={index}\n              onClick={() => execCommand('foreColor', color.value)}\n              className={`w-4 h-4 rounded-full border-2 ${\n                currentFormat.color === color.value\n                  ? 'border-blue-500 ring-2 ring-blue-300'\n                  : 'border-gray-300 hover:border-gray-500'\n              }`}\n              style={{ backgroundColor: color.value }}\n              disabled={viewMode !== 'wysiwyg'}\n              title={color.name}\n            />\n          ))}\n        </div>\n\n\n        {/* Mode selection menu */}\n        <div className=\"flex items-center space-x-2 mb-4\">\n          <span className=\"text-sm font-medium text-gray-700\">Mode:</span>\n          <select\n            value={viewMode}\n            onChange={(e) => onViewModeChange(e.target.value)}\n            className=\"px-3 py-1 text-sm rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          >\n            <option value=\"wysiwyg\">üìù √âditeur visuel</option>\n            <option value=\"markdown\">#Ô∏è‚É£ Code Markdown</option>\n            <option value=\"html\">üåê Code HTML</option>\n          </select>\n        </div>\n\n        {/* Fichiers Markdown */}\n        <div className=\"flex items-center space-x-2 mb-4\">\n          <span className=\"text-sm font-medium text-gray-700\">Document:</span>\n          <div className=\"relative group\">\n            <button\n              onClick={() => {\n                console.log('üî¥ DEBUG: Bouton Sauvegarder cliqu√©!');\n                handleSaveMarkdown();\n              }}\n              className=\"border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 px-2 py-1 text-xs rounded\"\n            >\n              üíæ Sauvegarder\n            </button>\n            <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\">\n              Sauvegarder le document sur l'ordinateur\n              <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"></div>\n            </div>\n          </div>\n          <div className=\"relative group\">\n            <button\n              onClick={handleOpenDocument}\n              className=\"border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 px-2 py-1 text-xs rounded\"\n            >\n              üìÅ Ouvrir\n            </button>\n            <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\">\n              Ouvrir un Document existant\n              <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"></div>\n            </div>\n          </div>\n          <div className=\"relative group\">\n            <button\n              onClick={() => setShowConfirmModal(true)}\n              className=\"border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 px-2 py-1 text-xs rounded\"\n            >\n              üÜï Nouveau\n            </button>\n            <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\">\n              Cr√©er un Nouveau Document Vierge\n              <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"></div>\n            </div>\n          </div>\n        </div>\n\n\n      </div>\n\n      {/* Ligne 2 - Titres + Listes + √âdition */}\n      <div className=\"flex items-center justify-start space-x-6 w-full\">\n        {/* Headings */}\n        <div className=\"flex items-center space-x-2\">\n          <span className=\"text-sm font-medium text-gray-700\">Titres:</span>\n          <button\n            onClick={() => execCommand('normal')}\n            className={`px-2 py-0.5 text-xs rounded ${\n              !currentFormat.heading && !currentFormat.list\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            Texte\n          </button>\n          <button\n            onClick={() => handleHeading('h3')}\n            className={`px-2 py-0.5 text-xs rounded ${\n              currentFormat.heading === 'h3'\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            style={{ fontSize: '0.8em' }}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            Titre 1\n          </button>\n          <button\n            onClick={() => handleHeading('h2')}\n            className={`px-2 py-0.5 text-xs rounded ${\n              currentFormat.heading === 'h2'\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            Titre 2\n          </button>\n          <button\n            onClick={() => handleHeading('h1')}\n            className={`px-2 py-0.5 text-xs rounded ${\n              currentFormat.heading === 'h1'\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            style={{ fontSize: '1.2em' }}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            Titre 3\n          </button>\n        </div>\n\n        {/* Lists */}\n        <div className=\"flex items-center space-x-2\">\n          <span className=\"text-sm font-medium text-gray-700\">Listes:</span>\n          <button\n            onClick={handleRemoveList}\n            className=\"px-2 py-0.5 text-xs rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500\"\n            disabled={viewMode !== 'wysiwyg'}\n            title=\"Supprimer la liste\"\n          >\n            ‚úó\n          </button>\n          <button\n            onClick={() => handleList('bullet')}\n            className={`px-2 py-0.5 text-xs rounded ${\n              currentFormat.list === 'bullet'\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            ‚Ä¢ Puces\n          </button>\n          <button\n            onClick={() => handleList('number')}\n            className={`px-2 py-0.5 text-xs rounded ${\n              currentFormat.list === 'number'\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            1. Num√©ros\n          </button>\n          <button\n            onClick={() => handleList('letter')}\n            className={`px-2 py-0.5 text-xs rounded ${\n              currentFormat.list === 'letter'\n                ? 'border-2 border-blue-500 bg-blue-50 text-blue-700'\n                : 'border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500'\n            }`}\n            disabled={viewMode !== 'wysiwyg'}\n          >\n            a. Lettres\n          </button>\n        </div>\n\n        {/* Boutons Undo/Redo */}\n        <div className=\"flex items-center space-x-2\">\n          <span className=\"text-sm font-medium text-gray-700\">√âdition:</span>\n          <div className=\"relative group\">\n            <button\n              onClick={() => document.execCommand('undo', false, null)}\n              className=\"px-2 py-0.5 text-xs rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500\"\n              disabled={viewMode !== 'wysiwyg'}\n            >\n              ‚Ü∂\n            </button>\n            <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\">\n              Annuler (Ctrl+Z)\n              <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"></div>\n            </div>\n          </div>\n          <div className=\"relative group\">\n            <button\n              onClick={() => document.execCommand('redo', false, null)}\n              className=\"px-2 py-0.5 text-xs rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500\"\n              disabled={viewMode !== 'wysiwyg'}\n            >\n              ‚Ü∑\n            </button>\n            <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\">\n              R√©tablir (Ctrl+Y)\n              <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"></div>\n            </div>\n          </div>\n          <div className=\"relative group\">\n            <button\n              onClick={() => document.getElementById('image-input').click()}\n              className=\"px-3 py-1 text-sm rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 font-medium\"\n              disabled={viewMode !== 'wysiwyg'}\n            >\n              üñºÔ∏è Image\n            </button>\n            <input\n              id=\"image-input\"\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleImageUpload}\n              className=\"hidden\"\n            />\n            <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\">\n              Ins√©rer une image\n              <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"></div>\n            </div>\n          </div>\n          <div className=\"relative group\">\n            <button\n              onClick={onThemeSettingsToggle}\n              className=\"px-3 py-1 text-sm rounded border border-gray-400 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-500 font-medium\"\n            >\n              üé® Th√®me\n            </button>\n            <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50\">\n              Param√®tres du th√®me\n              <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Modal de sauvegarde */}\n      {showSaveModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]\">\n          <div className=\"system-ui bg-white rounded-lg p-4 w-64 shadow-xl border-4 border-orange-400\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">\n              üíæ Sauvegarder le document\n            </h3>\n            \n            <div className=\"mb-6\">\n              <label htmlFor=\"document-name\" className=\"block text-sm font-semibold text-gray-800 mb-3\">\n                Nom du document :\n              </label>\n              <input\n                id=\"document-name\"\n                type=\"text\"\n                value={documentName}\n                onChange={(e) => setDocumentName(e.target.value)}\n                onKeyPress={(e) => {\n                  if (e.key === 'Enter' && !isSaving) {\n                    handleConfirmSave();\n                  }\n                  if (e.key === 'Escape') {\n                    setShowSaveModal(false);\n                  }\n                }}\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800 font-medium\"\n                placeholder=\"MonDocument\"\n                autoFocus\n                disabled={isSaving}\n                spellCheck=\"false\"\n                autoComplete=\"off\"\n                autoCorrect=\"off\"\n              />\n              <p className=\"text-sm text-gray-600 mt-2 flex items-center\">\n                ‚ú® Un nom unique sera g√©n√©r√© automatiquement si n√©cessaire\n              </p>\n            </div>\n            \n            <div className=\"flex justify-end space-x-3\">\n              <button\n                onClick={() => setShowSaveModal(false)}\n                disabled={isSaving}\n                className=\"px-5 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 transition-colors duration-200\"\n              >\n                ‚ùå Annuler\n              </button>\n              <button\n                onClick={handleConfirmSave}\n                disabled={isSaving || documentName.trim() === ''}\n                className=\"px-5 py-2.5 text-sm font-semibold text-gray-800 bg-blue-50 border border-blue-300 rounded-lg hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200\"\n              >\n                {isSaving ? '‚è≥ Sauvegarde...' : 'üíæ Sauvegarder'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Modal de confirmation */}\n      {showConfirmModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]\">\n          <div className=\"system-ui bg-white rounded-lg p-4 w-64 shadow-xl border-4 border-orange-400\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">\n              ‚ö†Ô∏è Document non sauvegard√©\n            </h3>\n            \n            <div className=\"mb-6\">\n              <p className=\"text-sm text-gray-700\">\n                Que souhaitez-vous faire ?\n              </p>\n            </div>\n            \n            <div className=\"flex justify-between space-x-2\">\n              <button\n                onClick={() => {\n                  setShowConfirmModal(false);\n                  handleSaveMarkdown();\n                }}\n                className=\"px-3 py-2 text-xs font-medium text-gray-800 bg-green-50 border border-green-300 rounded-lg hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200\"\n              >\n                üíæ Sauvegarder puis nouveau\n              </button>\n              <button\n                onClick={() => {\n                  setShowConfirmModal(false);\n                  createNewDocument();\n                }}\n                className=\"px-3 py-2 text-xs font-medium text-gray-800 bg-red-50 border border-red-300 rounded-lg hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200\"\n              >\n                üóëÔ∏è Nouveau sans sauvegarder\n              </button>\n              <button\n                onClick={() => setShowConfirmModal(false)}\n                className=\"px-3 py-2 text-xs font-medium text-gray-800 bg-gray-50 border border-gray-300 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors duration-200\"\n              >\n                ‚Ü©Ô∏è Annuler\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Toolbar;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}