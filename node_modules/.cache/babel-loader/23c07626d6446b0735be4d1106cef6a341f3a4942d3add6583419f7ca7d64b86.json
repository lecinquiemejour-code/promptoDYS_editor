{"ast":null,"code":"import React,{useRef,useEffect,useState,useCallback}from'react';import{useEditor}from'./hooks/useEditor';import{useEelBridge}from'./hooks/useEelBridge';import{useThemeSettings}from'./hooks/useThemeSettings';import{useMathJax}from'./hooks/useMathJax';import{htmlToMarkdown,markdownToHtml}from'./utils/markdownConverter';// Removed PromptoDYS imports - using simple project management\nimport Toolbar from'./components/Toolbar';import Editor from'./components/Editor';import StatusBar from'./components/StatusBar';import ThemeSettings from'./components/ThemeSettings';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const App=()=>{const{content,setContent,viewMode,setViewMode,changeViewMode,isWysiwyg,currentFormat,setCurrentFormat,editorRef,handleInput,updateCurrentFormat,ignoreSelectionChangeRef,selectedImage,setSelectedImage,handleImageClick,handleEditorClick}=useEditor();// Gestionnaire de blobs pour les images\nconst blobStorageRef=useRef(new Map());const storeBlobForUrl=useCallback((blobUrl,file)=>{console.log('üíæ [App] Stockage blob pour URL:',blobUrl,'File:',file===null||file===void 0?void 0:file.name,'Size:',file===null||file===void 0?void 0:file.size);blobStorageRef.current.set(blobUrl,file);console.log('üìä [App] Total blobs stock√©s:',blobStorageRef.current.size);},[]);const getBlobFromUrl=useCallback(blobUrl=>{return blobStorageRef.current.get(blobUrl);},[]);const getAllBlobs=useCallback(()=>{return blobStorageRef.current;},[]);// Sauvegarde automatique pour refresh F5\nuseEffect(()=>{const saveForRefresh=()=>{const refreshData={content:content,viewMode:viewMode,timestamp:Date.now()};console.log('üíæ [App.js] Sauvegarde pour refresh:',{contentLength:content===null||content===void 0?void 0:content.length,viewMode:viewMode,timestamp:new Date().toISOString()});localStorage.setItem('editor-refresh-backup',JSON.stringify(refreshData));};// Sauvegarder √† chaque changement de contenu\nif(content){console.log('üìù [App.js] Contenu modifi√©, sauvegarde...');saveForRefresh();}// Nettoyer avant de quitter\nconst handleBeforeUnload=()=>{console.log('üö™ [App.js] beforeunload - Sauvegarde finale avant refresh');saveForRefresh();};window.addEventListener('beforeunload',handleBeforeUnload);return()=>{window.removeEventListener('beforeunload',handleBeforeUnload);};},[content,viewMode]);// Hook pour param√®tres de th√®me\nconst{settings,backgroundOptions,textOptions,fontOptions,presetThemes,isSettingsOpen,updateSetting,resetToDefaults,applyPresetTheme,toggleSettings}=useThemeSettings();// ‚ö° Int√©gration MathJax en local\nconst{renderMath}=useMathJax();// √âtat de restauration supprim√© - √©diteur volatil uniquement\n// ‚ö° Int√©gration Eel pour support desktop\nuseEelBridge(content,setContent,viewMode);return/*#__PURE__*/_jsxs(\"div\",{className:\"h-screen bg-white w-full relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"editor-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"editor-scroll\",children:/*#__PURE__*/_jsx(Editor,{viewMode:viewMode,content:content,editorRef:editorRef,onInput:handleInput,onSelectionChange:updateCurrentFormat,currentFormat:currentFormat,selectedImage:selectedImage,onImageClick:handleImageClick,onEditorClick:handleEditorClick,onDeleteSelectedImage:null,ignoreSelectionChangeRef:ignoreSelectionChangeRef,storeBlobForUrl:storeBlobForUrl})})}),/*#__PURE__*/_jsx(\"div\",{className:\"fixed bottom-8 left-0 right-0 bg-gray-50 border-t border-gray-200 px-5 py-2 z-10\",children:/*#__PURE__*/_jsx(Toolbar,{content:content,setContent:setContent,viewMode:viewMode,onViewModeChange:changeViewMode,currentFormat:currentFormat,onFormatChange:setCurrentFormat,editorRef:editorRef,onThemeSettingsToggle:toggleSettings,ignoreSelectionChangeRef:ignoreSelectionChangeRef,storeBlobForUrl:storeBlobForUrl,getBlobFromUrl:getBlobFromUrl,getAllBlobs:getAllBlobs})}),/*#__PURE__*/_jsx(\"div\",{className:\"fixed bottom-0 left-0 right-0 bg-gray-100 border-t border-gray-300 px-5 py-1 z-10\",children:/*#__PURE__*/_jsx(StatusBar,{currentFormat:currentFormat,content:content,dysSettings:settings})}),/*#__PURE__*/_jsx(ThemeSettings,{settings:settings,isSettingsOpen:isSettingsOpen,toggleSettings:toggleSettings,backgroundOptions:backgroundOptions,textOptions:textOptions,fontOptions:fontOptions,presetThemes:presetThemes,updateSetting:updateSetting,resetToDefaults:resetToDefaults,applyPresetTheme:applyPresetTheme})]});};export default App;","map":{"version":3,"names":["React","useRef","useEffect","useState","useCallback","useEditor","useEelBridge","useThemeSettings","useMathJax","htmlToMarkdown","markdownToHtml","Toolbar","Editor","StatusBar","ThemeSettings","jsx","_jsx","jsxs","_jsxs","App","content","setContent","viewMode","setViewMode","changeViewMode","isWysiwyg","currentFormat","setCurrentFormat","editorRef","handleInput","updateCurrentFormat","ignoreSelectionChangeRef","selectedImage","setSelectedImage","handleImageClick","handleEditorClick","blobStorageRef","Map","storeBlobForUrl","blobUrl","file","console","log","name","size","current","set","getBlobFromUrl","get","getAllBlobs","saveForRefresh","refreshData","timestamp","Date","now","contentLength","length","toISOString","localStorage","setItem","JSON","stringify","handleBeforeUnload","window","addEventListener","removeEventListener","settings","backgroundOptions","textOptions","fontOptions","presetThemes","isSettingsOpen","updateSetting","resetToDefaults","applyPresetTheme","toggleSettings","renderMath","className","children","onInput","onSelectionChange","onImageClick","onEditorClick","onDeleteSelectedImage","onViewModeChange","onFormatChange","onThemeSettingsToggle","dysSettings"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/App.js"],"sourcesContent":["import React, { useRef, useEffect, useState, useCallback } from 'react';\nimport { useEditor } from './hooks/useEditor';\nimport { useEelBridge } from './hooks/useEelBridge';\nimport { useThemeSettings } from './hooks/useThemeSettings';\nimport { useMathJax } from './hooks/useMathJax';\nimport { htmlToMarkdown, markdownToHtml } from './utils/markdownConverter';\n// Removed PromptoDYS imports - using simple project management\nimport Toolbar from './components/Toolbar';\nimport Editor from './components/Editor';\nimport StatusBar from './components/StatusBar';\nimport ThemeSettings from './components/ThemeSettings';\n\nconst App = () => {\n  \n  const {\n    content,\n    setContent,\n    viewMode,\n    setViewMode,\n    changeViewMode,\n    isWysiwyg,\n    currentFormat,\n    setCurrentFormat,\n    editorRef,\n    handleInput,\n    updateCurrentFormat,\n    ignoreSelectionChangeRef,\n    selectedImage,\n    setSelectedImage,\n    handleImageClick,\n    handleEditorClick\n  } = useEditor();\n\n  // Gestionnaire de blobs pour les images\n  const blobStorageRef = useRef(new Map());\n  \n  const storeBlobForUrl = useCallback((blobUrl, file) => {\n    console.log('üíæ [App] Stockage blob pour URL:', blobUrl, 'File:', file?.name, 'Size:', file?.size);\n    blobStorageRef.current.set(blobUrl, file);\n    console.log('üìä [App] Total blobs stock√©s:', blobStorageRef.current.size);\n  }, []);\n  \n  const getBlobFromUrl = useCallback((blobUrl) => {\n    return blobStorageRef.current.get(blobUrl);\n  }, []);\n  \n  const getAllBlobs = useCallback(() => {\n    return blobStorageRef.current;\n  }, []);\n\n  // Sauvegarde automatique pour refresh F5\n  useEffect(() => {\n    const saveForRefresh = () => {\n      const refreshData = {\n        content: content,\n        viewMode: viewMode,\n        timestamp: Date.now()\n      };\n      console.log('üíæ [App.js] Sauvegarde pour refresh:', {\n        contentLength: content?.length,\n        viewMode: viewMode,\n        timestamp: new Date().toISOString()\n      });\n      localStorage.setItem('editor-refresh-backup', JSON.stringify(refreshData));\n    };\n\n    // Sauvegarder √† chaque changement de contenu\n    if (content) {\n      console.log('üìù [App.js] Contenu modifi√©, sauvegarde...');\n      saveForRefresh();\n    }\n\n    // Nettoyer avant de quitter\n    const handleBeforeUnload = () => {\n      console.log('üö™ [App.js] beforeunload - Sauvegarde finale avant refresh');\n      saveForRefresh();\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [content, viewMode]);\n\n\n  // Hook pour param√®tres de th√®me\n  const {\n    settings,\n    backgroundOptions,\n    textOptions,\n    fontOptions,\n    presetThemes,\n    isSettingsOpen,\n    updateSetting,\n    resetToDefaults,\n    applyPresetTheme,\n    toggleSettings\n  } = useThemeSettings();\n\n  // ‚ö° Int√©gration MathJax en local\n  const { renderMath } = useMathJax();\n\n  // √âtat de restauration supprim√© - √©diteur volatil uniquement\n\n  // ‚ö° Int√©gration Eel pour support desktop\n  useEelBridge(content, setContent, viewMode);\n\n  return (\n      <div className=\"h-screen bg-white w-full relative\">\n        {/* Removed PromptoDYS error messages */}\n        \n        \n        {/* Zone d'√©dition principale avec scroll ind√©pendant */}\n        <div className=\"editor-container\">\n          <div className=\"editor-scroll\">\n            <Editor \n              viewMode={viewMode}\n              content={content}\n              editorRef={editorRef}\n              onInput={handleInput}\n              onSelectionChange={updateCurrentFormat}\n              currentFormat={currentFormat}\n              selectedImage={selectedImage}\n              onImageClick={handleImageClick}\n              onEditorClick={handleEditorClick}\n              onDeleteSelectedImage={null}\n              ignoreSelectionChangeRef={ignoreSelectionChangeRef}\n              storeBlobForUrl={storeBlobForUrl}\n            />\n          </div>\n        </div>\n\n        {/* Toolbar fix√©e en bas */}\n        <div className=\"fixed bottom-8 left-0 right-0 bg-gray-50 border-t border-gray-200 px-5 py-2 z-10\">\n          <Toolbar \n            content={content}\n            setContent={setContent}\n            viewMode={viewMode}\n            onViewModeChange={changeViewMode}\n            currentFormat={currentFormat}\n            onFormatChange={setCurrentFormat}\n            editorRef={editorRef}\n            onThemeSettingsToggle={toggleSettings}\n            ignoreSelectionChangeRef={ignoreSelectionChangeRef}\n            storeBlobForUrl={storeBlobForUrl}\n            getBlobFromUrl={getBlobFromUrl}\n            getAllBlobs={getAllBlobs}\n          />\n        </div>\n\n        {/* StatusBar tout en bas */}\n        <div className=\"fixed bottom-0 left-0 right-0 bg-gray-100 border-t border-gray-300 px-5 py-1 z-10\">\n          <StatusBar \n            currentFormat={currentFormat}\n            content={content}\n            dysSettings={settings}\n          />\n        </div>\n\n        {/* Modal ThemeSettings */}\n        <ThemeSettings \n          settings={settings}\n          isSettingsOpen={isSettingsOpen}\n          toggleSettings={toggleSettings}\n          backgroundOptions={backgroundOptions}\n          textOptions={textOptions}\n          fontOptions={fontOptions}\n          presetThemes={presetThemes}\n          updateSetting={updateSetting}\n          resetToDefaults={resetToDefaults}\n          applyPresetTheme={applyPresetTheme}\n        />\n      </div>\n    );\n};\n\nexport default App;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,MAAM,CAAEC,SAAS,CAAEC,QAAQ,CAAEC,WAAW,KAAQ,OAAO,CACvE,OAASC,SAAS,KAAQ,mBAAmB,CAC7C,OAASC,YAAY,KAAQ,sBAAsB,CACnD,OAASC,gBAAgB,KAAQ,0BAA0B,CAC3D,OAASC,UAAU,KAAQ,oBAAoB,CAC/C,OAASC,cAAc,CAAEC,cAAc,KAAQ,2BAA2B,CAC1E;AACA,MAAO,CAAAC,OAAO,KAAM,sBAAsB,CAC1C,MAAO,CAAAC,MAAM,KAAM,qBAAqB,CACxC,MAAO,CAAAC,SAAS,KAAM,wBAAwB,CAC9C,MAAO,CAAAC,aAAa,KAAM,4BAA4B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEvD,KAAM,CAAAC,GAAG,CAAGA,CAAA,GAAM,CAEhB,KAAM,CACJC,OAAO,CACPC,UAAU,CACVC,QAAQ,CACRC,WAAW,CACXC,cAAc,CACdC,SAAS,CACTC,aAAa,CACbC,gBAAgB,CAChBC,SAAS,CACTC,WAAW,CACXC,mBAAmB,CACnBC,wBAAwB,CACxBC,aAAa,CACbC,gBAAgB,CAChBC,gBAAgB,CAChBC,iBACF,CAAC,CAAG9B,SAAS,CAAC,CAAC,CAEf;AACA,KAAM,CAAA+B,cAAc,CAAGnC,MAAM,CAAC,GAAI,CAAAoC,GAAG,CAAC,CAAC,CAAC,CAExC,KAAM,CAAAC,eAAe,CAAGlC,WAAW,CAAC,CAACmC,OAAO,CAAEC,IAAI,GAAK,CACrDC,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAEH,OAAO,CAAE,OAAO,CAAEC,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEG,IAAI,CAAE,OAAO,CAAEH,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEI,IAAI,CAAC,CAClGR,cAAc,CAACS,OAAO,CAACC,GAAG,CAACP,OAAO,CAAEC,IAAI,CAAC,CACzCC,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAEN,cAAc,CAACS,OAAO,CAACD,IAAI,CAAC,CAC3E,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAG,cAAc,CAAG3C,WAAW,CAAEmC,OAAO,EAAK,CAC9C,MAAO,CAAAH,cAAc,CAACS,OAAO,CAACG,GAAG,CAACT,OAAO,CAAC,CAC5C,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAU,WAAW,CAAG7C,WAAW,CAAC,IAAM,CACpC,MAAO,CAAAgC,cAAc,CAACS,OAAO,CAC/B,CAAC,CAAE,EAAE,CAAC,CAEN;AACA3C,SAAS,CAAC,IAAM,CACd,KAAM,CAAAgD,cAAc,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAAAC,WAAW,CAAG,CAClB/B,OAAO,CAAEA,OAAO,CAChBE,QAAQ,CAAEA,QAAQ,CAClB8B,SAAS,CAAEC,IAAI,CAACC,GAAG,CAAC,CACtB,CAAC,CACDb,OAAO,CAACC,GAAG,CAAC,sCAAsC,CAAE,CAClDa,aAAa,CAAEnC,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAEoC,MAAM,CAC9BlC,QAAQ,CAAEA,QAAQ,CAClB8B,SAAS,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACI,WAAW,CAAC,CACpC,CAAC,CAAC,CACFC,YAAY,CAACC,OAAO,CAAC,uBAAuB,CAAEC,IAAI,CAACC,SAAS,CAACV,WAAW,CAAC,CAAC,CAC5E,CAAC,CAED;AACA,GAAI/B,OAAO,CAAE,CACXqB,OAAO,CAACC,GAAG,CAAC,4CAA4C,CAAC,CACzDQ,cAAc,CAAC,CAAC,CAClB,CAEA;AACA,KAAM,CAAAY,kBAAkB,CAAGA,CAAA,GAAM,CAC/BrB,OAAO,CAACC,GAAG,CAAC,4DAA4D,CAAC,CACzEQ,cAAc,CAAC,CAAC,CAClB,CAAC,CAEDa,MAAM,CAACC,gBAAgB,CAAC,cAAc,CAAEF,kBAAkB,CAAC,CAC3D,MAAO,IAAM,CACXC,MAAM,CAACE,mBAAmB,CAAC,cAAc,CAAEH,kBAAkB,CAAC,CAChE,CAAC,CACH,CAAC,CAAE,CAAC1C,OAAO,CAAEE,QAAQ,CAAC,CAAC,CAGvB;AACA,KAAM,CACJ4C,QAAQ,CACRC,iBAAiB,CACjBC,WAAW,CACXC,WAAW,CACXC,YAAY,CACZC,cAAc,CACdC,aAAa,CACbC,eAAe,CACfC,gBAAgB,CAChBC,cACF,CAAC,CAAGpE,gBAAgB,CAAC,CAAC,CAEtB;AACA,KAAM,CAAEqE,UAAW,CAAC,CAAGpE,UAAU,CAAC,CAAC,CAEnC;AAEA;AACAF,YAAY,CAACc,OAAO,CAAEC,UAAU,CAAEC,QAAQ,CAAC,CAE3C,mBACIJ,KAAA,QAAK2D,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAKhD9D,IAAA,QAAK6D,SAAS,CAAC,kBAAkB,CAAAC,QAAA,cAC/B9D,IAAA,QAAK6D,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC5B9D,IAAA,CAACJ,MAAM,EACLU,QAAQ,CAAEA,QAAS,CACnBF,OAAO,CAAEA,OAAQ,CACjBQ,SAAS,CAAEA,SAAU,CACrBmD,OAAO,CAAElD,WAAY,CACrBmD,iBAAiB,CAAElD,mBAAoB,CACvCJ,aAAa,CAAEA,aAAc,CAC7BM,aAAa,CAAEA,aAAc,CAC7BiD,YAAY,CAAE/C,gBAAiB,CAC/BgD,aAAa,CAAE/C,iBAAkB,CACjCgD,qBAAqB,CAAE,IAAK,CAC5BpD,wBAAwB,CAAEA,wBAAyB,CACnDO,eAAe,CAAEA,eAAgB,CAClC,CAAC,CACC,CAAC,CACH,CAAC,cAGNtB,IAAA,QAAK6D,SAAS,CAAC,kFAAkF,CAAAC,QAAA,cAC/F9D,IAAA,CAACL,OAAO,EACNS,OAAO,CAAEA,OAAQ,CACjBC,UAAU,CAAEA,UAAW,CACvBC,QAAQ,CAAEA,QAAS,CACnB8D,gBAAgB,CAAE5D,cAAe,CACjCE,aAAa,CAAEA,aAAc,CAC7B2D,cAAc,CAAE1D,gBAAiB,CACjCC,SAAS,CAAEA,SAAU,CACrB0D,qBAAqB,CAAEX,cAAe,CACtC5C,wBAAwB,CAAEA,wBAAyB,CACnDO,eAAe,CAAEA,eAAgB,CACjCS,cAAc,CAAEA,cAAe,CAC/BE,WAAW,CAAEA,WAAY,CAC1B,CAAC,CACC,CAAC,cAGNjC,IAAA,QAAK6D,SAAS,CAAC,mFAAmF,CAAAC,QAAA,cAChG9D,IAAA,CAACH,SAAS,EACRa,aAAa,CAAEA,aAAc,CAC7BN,OAAO,CAAEA,OAAQ,CACjBmE,WAAW,CAAErB,QAAS,CACvB,CAAC,CACC,CAAC,cAGNlD,IAAA,CAACF,aAAa,EACZoD,QAAQ,CAAEA,QAAS,CACnBK,cAAc,CAAEA,cAAe,CAC/BI,cAAc,CAAEA,cAAe,CAC/BR,iBAAiB,CAAEA,iBAAkB,CACrCC,WAAW,CAAEA,WAAY,CACzBC,WAAW,CAAEA,WAAY,CACzBC,YAAY,CAAEA,YAAa,CAC3BE,aAAa,CAAEA,aAAc,CAC7BC,eAAe,CAAEA,eAAgB,CACjCC,gBAAgB,CAAEA,gBAAiB,CACpC,CAAC,EACC,CAAC,CAEZ,CAAC,CAED,cAAe,CAAAvD,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}