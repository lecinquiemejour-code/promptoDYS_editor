{"ast":null,"code":"import{useState,useCallback,useEffect}from'react';const DB_NAME='EditorImageDB';const DB_VERSION=1;const STORE_NAME='images';// Maps globales partagÃ©es entre toutes les instances du hook\nconst globalBlobToImageIdMap=new Map();const globalImageIdToBlobMap=new Map();// Cache pour Ã©viter rechargements\nconst globalImageMetadataCache=new Map();// Cache des mÃ©tadonnÃ©es complÃ¨tes\nconst pendingImageLoads=new Map();// Promesses en cours pour Ã©viter les appels parallÃ¨les\nexport const useImageStorage=()=>{const[db,setDb]=useState(null);// ðŸ”„ Vider les caches au dÃ©marrage pour Ã©viter les blob URLs obsolÃ¨tes aprÃ¨s restart\nuseEffect(()=>{console.log('ðŸ§¹ Nettoyage des caches blob au dÃ©marrage de useImageStorage');globalImageIdToBlobMap.clear();globalImageMetadataCache.clear();globalBlobToImageIdMap.clear();console.log('âœ… Caches vidÃ©s - nouvelles blob URLs seront crÃ©Ã©es Ã  la demande');// DÃ©clencher un Ã©vÃ©nement pour signaler que les caches sont vidÃ©s\nsetTimeout(()=>{window.dispatchEvent(new CustomEvent('cacheCleared'));console.log('ðŸ“¡ DEBUG: Ã‰vÃ©nement cacheCleared envoyÃ©');},100);},[]);// Ouvrir/crÃ©er la base IndexedDB\nconst initDB=useCallback(async()=>{return new Promise((resolve,reject)=>{const request=indexedDB.open(DB_NAME,DB_VERSION);request.onerror=()=>reject(request.error);request.onsuccess=()=>resolve(request.result);request.onupgradeneeded=event=>{const database=event.target.result;// CrÃ©er le store si nÃ©cessaire\nif(!database.objectStoreNames.contains(STORE_NAME)){const imageStore=database.createObjectStore(STORE_NAME,{keyPath:'id'});imageStore.createIndex('fileName','fileName',{unique:false});imageStore.createIndex('timestamp','timestamp',{unique:false});}};});},[]);// Stocker une image blob dans IndexedDB\nconst storeImage=useCallback(async function(blobUrl){let fileName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'image';try{// Initialiser la DB si nÃ©cessaire\nconst database=db||(await initDB());if(!db)setDb(database);// RÃ©cupÃ©rer le blob depuis l'URL\nconst response=await fetch(blobUrl);const blob=await response.blob();// GÃ©nÃ©rer un ID unique\nconst imageId=\"img_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).substr(2,9));// PrÃ©parer les donnÃ©es Ã  stocker\nconst imageData={id:imageId,fileName:fileName,blob:blob,mimeType:blob.type,size:blob.size,timestamp:new Date().toISOString()};// Ã‰crire dans IndexedDB\nconst transaction=database.transaction([STORE_NAME],'readwrite');const store=transaction.objectStore(STORE_NAME);return new Promise((resolve,reject)=>{const request=store.add(imageData);request.onsuccess=()=>{// CrÃ©er le mapping blobUrlâ†’imageId pour la sÃ©rialisation\nglobalBlobToImageIdMap.set(blobUrl,imageId);console.log('âœ… Image stockÃ©e dans IndexedDB:',fileName,imageId);console.log('ðŸ”— Mapping crÃ©Ã©:',blobUrl,'â†’',imageId);console.log('ðŸ”— DIAGNOSTIC storeImage: Nouvelle taille Map:',globalBlobToImageIdMap.size);resolve(imageId);};request.onerror=()=>reject(request.error);});}catch(error){console.error('âŒ Erreur stockage image IndexedDB:',error);throw error;}},[db,initDB]);// Charger une image depuis IndexedDB par son ID\nconst loadImage=useCallback(async imageId=>{console.log('ðŸ” DEBUG loadImage: Demande de chargement pour:',imageId);console.log('ðŸ“Š DEBUG: Ã‰tat des caches:',{globalImageIdToBlobMap:globalImageIdToBlobMap.size,globalImageMetadataCache:globalImageMetadataCache.size,hasImageInCache:globalImageIdToBlobMap.has(imageId)});// VÃ©rifier le cache d'abord pour Ã©viter rechargements\nif(globalImageIdToBlobMap.has(imageId)&&globalImageMetadataCache.has(imageId)){const cachedBlobUrl=globalImageIdToBlobMap.get(imageId);const cachedMetadata=globalImageMetadataCache.get(imageId);console.log('ðŸš€ CACHE HIT: Image dÃ©jÃ  en mÃ©moire:',imageId,'â†’',cachedBlobUrl);return{blobUrl:cachedBlobUrl,fileName:cachedMetadata.fileName,mimeType:cachedMetadata.mimeType,size:cachedMetadata.size};}// VÃ©rifier si un chargement est dÃ©jÃ  en cours pour cette image\nif(pendingImageLoads.has(imageId)){console.log('â³ CACHE: Chargement dÃ©jÃ  en cours pour:',imageId);return pendingImageLoads.get(imageId);}// CrÃ©er une promesse pour ce chargement\nconst loadPromise=(async()=>{if(!db){await initDB();}try{const database=db||(await initDB());if(!db)setDb(database);console.log(' DEBUG: Chargement depuis IndexedDB pour:',imageId);console.log(' DEBUG: Base de donnÃ©es:',database?'OK':'Non initialisÃ©e');return new Promise((resolve,reject)=>{const transaction=database.transaction([STORE_NAME],'readonly');const store=transaction.objectStore(STORE_NAME);const request=store.get(imageId);request.onsuccess=()=>{const result=request.result;console.log(' DEBUG: RÃ©sultat IndexedDB:',{found:!!result,hasBlob:!!(result!==null&&result!==void 0&&result.blob),fileName:result===null||result===void 0?void 0:result.fileName,mimeType:result===null||result===void 0?void 0:result.mimeType,size:result===null||result===void 0?void 0:result.size});if(result){// VÃ©rifier que le blob est valide\nif(!result.blob||!(result.blob instanceof Blob)){console.error(' DEBUG: Blob invalide dans IndexedDB');resolve(null);return;}console.log(' DEBUG: Blob valide, type:',result.blob.type,'taille:',result.blob.size);// CrÃ©er une blob URL pour l'affichage\nlet blobUrl;try{blobUrl=URL.createObjectURL(result.blob);console.log(' DEBUG: Blob URL crÃ©Ã©e:',blobUrl);}catch(error){console.error(' DEBUG: Erreur createObjectURL:',error);resolve(null);return;}// Enregistrer les mappings et mÃ©tadonnÃ©es dans le cache GLOBAL\nglobalBlobToImageIdMap.set(blobUrl,imageId);globalImageIdToBlobMap.set(imageId,blobUrl);globalImageMetadataCache.set(imageId,{fileName:result.fileName,mimeType:result.mimeType,size:result.size});console.log(' DEBUG: Image chargÃ©e depuis IndexedDB:',{imageId,blobUrl:blobUrl.substring(0,50)+'...',fileName:result.fileName,mimeType:result.mimeType,mapSize:globalBlobToImageIdMap.size});console.log(' DIAGNOSTIC loadImage: Mapping crÃ©Ã©:',blobUrl,'â†’',imageId);console.log(' CACHE: Image et mÃ©tadonnÃ©es mises en cache:',imageId,'â†’',blobUrl);console.log(' Image chargÃ©e depuis IndexedDB:',result.fileName,imageId);resolve({blobUrl,fileName:result.fileName,mimeType:result.mimeType,size:result.size});}else{console.warn(' DEBUG: Image non trouvÃ©e dans IndexedDB:',imageId);resolve(null);}};request.onerror=()=>{console.error(' DEBUG: Erreur accÃ¨s IndexedDB pour',imageId,':',request.error);reject(request.error);};});}catch(error){console.error('Erreur lors du chargement de l\\'image:',error);return null;}})();// Stocker la promesse en cours\npendingImageLoads.set(imageId,loadPromise);try{const result=await loadPromise;return result;}finally{// Nettoyer la promesse une fois terminÃ©e\npendingImageLoads.delete(imageId);}},[db,initDB]);// Lister toutes les images stockÃ©es\nconst listImages=useCallback(async()=>{try{const database=db||(await initDB());if(!db)setDb(database);const transaction=database.transaction([STORE_NAME],'readonly');const store=transaction.objectStore(STORE_NAME);return new Promise((resolve,reject)=>{const request=store.getAll();request.onsuccess=()=>{const images=request.result.map(img=>({id:img.id,fileName:img.fileName,mimeType:img.mimeType,size:img.size,timestamp:img.timestamp}));resolve(images);};request.onerror=()=>reject(request.error);});}catch(error){console.error('âŒ Erreur listage images IndexedDB:',error);return[];}},[db,initDB]);// Supprimer une image\nconst deleteImage=useCallback(async imageId=>{try{const database=db||(await initDB());if(!db)setDb(database);const transaction=database.transaction([STORE_NAME],'readwrite');const store=transaction.objectStore(STORE_NAME);return new Promise((resolve,reject)=>{const request=store.delete(imageId);request.onsuccess=()=>{console.log('âœ… Image supprimÃ©e de IndexedDB:',imageId);resolve(true);};request.onerror=()=>reject(request.error);});}catch(error){console.error('âŒ Erreur suppression image IndexedDB:',error);return false;}},[db,initDB]);// Convertir les blob URLs vers indexed:// URLs pour sauvegarde\nconst convertBlobUrlsToIndexed=useCallback(htmlContent=>{let convertedHtml=htmlContent;let conversionCount=0;// Parcourir toutes les blob URLs dans le mapping\nglobalBlobToImageIdMap.forEach((imageId,blobUrl)=>{// Chercher et remplacer cette blob URL par indexed://imageId\nconst blobRegex=new RegExp(blobUrl.replace(/[.*+?^${}()|[\\]\\\\]/g,'\\\\$&'),'g');const matches=convertedHtml.match(blobRegex);if(matches){convertedHtml=convertedHtml.replace(blobRegex,\"indexed://\".concat(imageId));conversionCount+=matches.length;}});if(conversionCount>0){console.log(\"\\uD83D\\uDD04 \".concat(conversionCount,\" blob URL(s) converties vers indexed:// pour sauvegarde\"));}return convertedHtml;},[]);// Nettoyer les images orphelines (non rÃ©fÃ©rencÃ©es dans le contenu)\nconst cleanupOrphanImages=useCallback(async htmlContent=>{try{const allImages=await listImages();const usedImageIds=[];// Extraire tous les IDs d'images rÃ©fÃ©rencÃ©es dans le HTML\nconst indexedImageRegex=/indexed:\\/\\/(img_[^\"'\\s]+)/g;let match;while((match=indexedImageRegex.exec(htmlContent))!==null){usedImageIds.push(match[1]);}// Supprimer les images non rÃ©fÃ©rencÃ©es\nlet deletedCount=0;for(const image of allImages){if(!usedImageIds.includes(image.id)){await deleteImage(image.id);deletedCount++;}}if(deletedCount>0){console.log(\"\\uD83E\\uDDF9 \".concat(deletedCount,\" image(s) orpheline(s) supprim\\xE9e(s)\"));}return deletedCount;}catch(error){console.error('âŒ Erreur nettoyage images IndexedDB:',error);return 0;}},[listImages,deleteImage]);// Fonction pour rÃ©cupÃ©rer toutes les correspondances blobâ†’imageId\nconst getAllBlobMappings=useCallback(()=>{console.log('ðŸ”Ž DIAGNOSTIC getAllBlobMappings: Map actuelle:',globalBlobToImageIdMap);console.log('ðŸ”Ž DIAGNOSTIC getAllBlobMappings: Taille de la Map:',globalBlobToImageIdMap.size);for(const[blobUrl,imageId]of globalBlobToImageIdMap.entries()){console.log('ðŸ”— DIAGNOSTIC Mapping:',blobUrl,'â†’',imageId);}return globalBlobToImageIdMap;},[]);return{storeImage,loadImage,listImages,deleteImage,cleanupOrphanImages,getAllBlobMappings,convertBlobUrlsToIndexed};};","map":{"version":3,"names":["useState","useCallback","useEffect","DB_NAME","DB_VERSION","STORE_NAME","globalBlobToImageIdMap","Map","globalImageIdToBlobMap","globalImageMetadataCache","pendingImageLoads","useImageStorage","db","setDb","console","log","clear","setTimeout","window","dispatchEvent","CustomEvent","initDB","Promise","resolve","reject","request","indexedDB","open","onerror","error","onsuccess","result","onupgradeneeded","event","database","target","objectStoreNames","contains","imageStore","createObjectStore","keyPath","createIndex","unique","storeImage","blobUrl","fileName","arguments","length","undefined","response","fetch","blob","imageId","concat","Date","now","Math","random","toString","substr","imageData","id","mimeType","type","size","timestamp","toISOString","transaction","store","objectStore","add","set","loadImage","hasImageInCache","has","cachedBlobUrl","get","cachedMetadata","loadPromise","found","hasBlob","Blob","URL","createObjectURL","substring","mapSize","warn","delete","listImages","getAll","images","map","img","deleteImage","convertBlobUrlsToIndexed","htmlContent","convertedHtml","conversionCount","forEach","blobRegex","RegExp","replace","matches","match","cleanupOrphanImages","allImages","usedImageIds","indexedImageRegex","exec","push","deletedCount","image","includes","getAllBlobMappings","entries"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/hooks/useImageStorage.js"],"sourcesContent":["import { useState, useCallback, useEffect } from 'react';\n\nconst DB_NAME = 'EditorImageDB';\nconst DB_VERSION = 1;\nconst STORE_NAME = 'images';\n\n// Maps globales partagÃ©es entre toutes les instances du hook\nconst globalBlobToImageIdMap = new Map();\nconst globalImageIdToBlobMap = new Map(); // Cache pour Ã©viter rechargements\nconst globalImageMetadataCache = new Map(); // Cache des mÃ©tadonnÃ©es complÃ¨tes\nconst pendingImageLoads = new Map(); // Promesses en cours pour Ã©viter les appels parallÃ¨les\n\nexport const useImageStorage = () => {\n  const [db, setDb] = useState(null);\n\n  // ðŸ”„ Vider les caches au dÃ©marrage pour Ã©viter les blob URLs obsolÃ¨tes aprÃ¨s restart\n  useEffect(() => {\n    console.log('ðŸ§¹ Nettoyage des caches blob au dÃ©marrage de useImageStorage');\n    globalImageIdToBlobMap.clear();\n    globalImageMetadataCache.clear();\n    globalBlobToImageIdMap.clear();\n    console.log('âœ… Caches vidÃ©s - nouvelles blob URLs seront crÃ©Ã©es Ã  la demande');\n    \n    // DÃ©clencher un Ã©vÃ©nement pour signaler que les caches sont vidÃ©s\n    setTimeout(() => {\n      window.dispatchEvent(new CustomEvent('cacheCleared'));\n      console.log('ðŸ“¡ DEBUG: Ã‰vÃ©nement cacheCleared envoyÃ©');\n    }, 100);\n  }, []);\n\n  // Ouvrir/crÃ©er la base IndexedDB\n  const initDB = useCallback(async () => {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\n      \n      request.onerror = () => reject(request.error);\n      request.onsuccess = () => resolve(request.result);\n      \n      request.onupgradeneeded = (event) => {\n        const database = event.target.result;\n        \n        // CrÃ©er le store si nÃ©cessaire\n        if (!database.objectStoreNames.contains(STORE_NAME)) {\n          const imageStore = database.createObjectStore(STORE_NAME, { keyPath: 'id' });\n          imageStore.createIndex('fileName', 'fileName', { unique: false });\n          imageStore.createIndex('timestamp', 'timestamp', { unique: false });\n        }\n      };\n    });\n  }, []);\n\n  // Stocker une image blob dans IndexedDB\n  const storeImage = useCallback(async (blobUrl, fileName = 'image') => {\n    try {\n      // Initialiser la DB si nÃ©cessaire\n      const database = db || await initDB();\n      if (!db) setDb(database);\n\n      // RÃ©cupÃ©rer le blob depuis l'URL\n      const response = await fetch(blobUrl);\n      const blob = await response.blob();\n\n      // GÃ©nÃ©rer un ID unique\n      const imageId = `img_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      \n      // PrÃ©parer les donnÃ©es Ã  stocker\n      const imageData = {\n        id: imageId,\n        fileName: fileName,\n        blob: blob,\n        mimeType: blob.type,\n        size: blob.size,\n        timestamp: new Date().toISOString()\n      };\n\n      // Ã‰crire dans IndexedDB\n      const transaction = database.transaction([STORE_NAME], 'readwrite');\n      const store = transaction.objectStore(STORE_NAME);\n      \n      return new Promise((resolve, reject) => {\n        const request = store.add(imageData);\n        request.onsuccess = () => {\n          // CrÃ©er le mapping blobUrlâ†’imageId pour la sÃ©rialisation\n          globalBlobToImageIdMap.set(blobUrl, imageId);\n          console.log('âœ… Image stockÃ©e dans IndexedDB:', fileName, imageId);\n          console.log('ðŸ”— Mapping crÃ©Ã©:', blobUrl, 'â†’', imageId);\n          console.log('ðŸ”— DIAGNOSTIC storeImage: Nouvelle taille Map:', globalBlobToImageIdMap.size);\n          resolve(imageId);\n        };\n        request.onerror = () => reject(request.error);\n      });\n\n    } catch (error) {\n      console.error('âŒ Erreur stockage image IndexedDB:', error);\n      throw error;\n    }\n  }, [db, initDB]);\n\n  // Charger une image depuis IndexedDB par son ID\n  const loadImage = useCallback(async (imageId) => {\n    console.log('ðŸ” DEBUG loadImage: Demande de chargement pour:', imageId);\n    console.log('ðŸ“Š DEBUG: Ã‰tat des caches:', {\n      globalImageIdToBlobMap: globalImageIdToBlobMap.size,\n      globalImageMetadataCache: globalImageMetadataCache.size,\n      hasImageInCache: globalImageIdToBlobMap.has(imageId)\n    });\n    \n    // VÃ©rifier le cache d'abord pour Ã©viter rechargements\n    if (globalImageIdToBlobMap.has(imageId) && globalImageMetadataCache.has(imageId)) {\n      const cachedBlobUrl = globalImageIdToBlobMap.get(imageId);\n      const cachedMetadata = globalImageMetadataCache.get(imageId);\n      console.log('ðŸš€ CACHE HIT: Image dÃ©jÃ  en mÃ©moire:', imageId, 'â†’', cachedBlobUrl);\n      return {\n        blobUrl: cachedBlobUrl,\n        fileName: cachedMetadata.fileName,\n        mimeType: cachedMetadata.mimeType,\n        size: cachedMetadata.size\n      };\n    }\n    \n    // VÃ©rifier si un chargement est dÃ©jÃ  en cours pour cette image\n    if (pendingImageLoads.has(imageId)) {\n      console.log('â³ CACHE: Chargement dÃ©jÃ  en cours pour:', imageId);\n      return pendingImageLoads.get(imageId);\n    }\n    \n    // CrÃ©er une promesse pour ce chargement\n    const loadPromise = (async () => {\n      if (!db) {\n        await initDB();\n      }\n      \n      try {\n      const database = db || await initDB();\n      if (!db) setDb(database);\n\n      \n      console.log(' DEBUG: Chargement depuis IndexedDB pour:', imageId);\n      console.log(' DEBUG: Base de donnÃ©es:', database ? 'OK' : 'Non initialisÃ©e');\n      \n      return new Promise((resolve, reject) => {\n        const transaction = database.transaction([STORE_NAME], 'readonly');\n        const store = transaction.objectStore(STORE_NAME);\n        const request = store.get(imageId);\n        \n        request.onsuccess = () => {\n          const result = request.result;\n          console.log(' DEBUG: RÃ©sultat IndexedDB:', {\n            found: !!result,\n            hasBlob: !!result?.blob,\n            fileName: result?.fileName,\n            mimeType: result?.mimeType,\n            size: result?.size\n          });\n          \n          if (result) {\n            // VÃ©rifier que le blob est valide\n            if (!result.blob || !(result.blob instanceof Blob)) {\n              console.error(' DEBUG: Blob invalide dans IndexedDB');\n              resolve(null);\n              return;\n            }\n            \n            console.log(' DEBUG: Blob valide, type:', result.blob.type, 'taille:', result.blob.size);\n            \n            // CrÃ©er une blob URL pour l'affichage\n            let blobUrl;\n            try {\n              blobUrl = URL.createObjectURL(result.blob);\n              console.log(' DEBUG: Blob URL crÃ©Ã©e:', blobUrl);\n            } catch (error) {\n              console.error(' DEBUG: Erreur createObjectURL:', error);\n              resolve(null);\n              return;\n            }\n            \n            // Enregistrer les mappings et mÃ©tadonnÃ©es dans le cache GLOBAL\n            globalBlobToImageIdMap.set(blobUrl, imageId);\n            globalImageIdToBlobMap.set(imageId, blobUrl);\n            globalImageMetadataCache.set(imageId, {\n              fileName: result.fileName,\n              mimeType: result.mimeType,\n              size: result.size\n            });\n            \n            console.log(' DEBUG: Image chargÃ©e depuis IndexedDB:', {\n              imageId,\n              blobUrl: blobUrl.substring(0, 50) + '...',\n              fileName: result.fileName,\n              mimeType: result.mimeType,\n              mapSize: globalBlobToImageIdMap.size\n            });\n            console.log(' DIAGNOSTIC loadImage: Mapping crÃ©Ã©:', blobUrl, 'â†’', imageId);\n            console.log(' CACHE: Image et mÃ©tadonnÃ©es mises en cache:', imageId, 'â†’', blobUrl);\n            \n            console.log(' Image chargÃ©e depuis IndexedDB:', result.fileName, imageId);\n            resolve({\n              blobUrl,\n              fileName: result.fileName,\n              mimeType: result.mimeType,\n              size: result.size\n            });\n          } else {\n            console.warn(' DEBUG: Image non trouvÃ©e dans IndexedDB:', imageId);\n            resolve(null);\n          }\n        };\n        \n        request.onerror = () => {\n          console.error(' DEBUG: Erreur accÃ¨s IndexedDB pour', imageId, ':', request.error);\n          reject(request.error);\n        };\n      });\n\n      } catch (error) {\n        console.error('Erreur lors du chargement de l\\'image:', error);\n        return null;\n      }\n    })();\n    \n    // Stocker la promesse en cours\n    pendingImageLoads.set(imageId, loadPromise);\n    \n    try {\n      const result = await loadPromise;\n      return result;\n    } finally {\n      // Nettoyer la promesse une fois terminÃ©e\n      pendingImageLoads.delete(imageId);\n    }\n  }, [db, initDB]);\n\n  // Lister toutes les images stockÃ©es\n  const listImages = useCallback(async () => {\n    try {\n      const database = db || await initDB();\n      if (!db) setDb(database);\n\n      const transaction = database.transaction([STORE_NAME], 'readonly');\n      const store = transaction.objectStore(STORE_NAME);\n      \n      return new Promise((resolve, reject) => {\n        const request = store.getAll();\n        request.onsuccess = () => {\n          const images = request.result.map(img => ({\n            id: img.id,\n            fileName: img.fileName,\n            mimeType: img.mimeType,\n            size: img.size,\n            timestamp: img.timestamp\n          }));\n          resolve(images);\n        };\n        request.onerror = () => reject(request.error);\n      });\n\n    } catch (error) {\n      console.error('âŒ Erreur listage images IndexedDB:', error);\n      return [];\n    }\n  }, [db, initDB]);\n\n  // Supprimer une image\n  const deleteImage = useCallback(async (imageId) => {\n    try {\n      const database = db || await initDB();\n      if (!db) setDb(database);\n\n      const transaction = database.transaction([STORE_NAME], 'readwrite');\n      const store = transaction.objectStore(STORE_NAME);\n      \n      return new Promise((resolve, reject) => {\n        const request = store.delete(imageId);\n        request.onsuccess = () => {\n          console.log('âœ… Image supprimÃ©e de IndexedDB:', imageId);\n          resolve(true);\n        };\n        request.onerror = () => reject(request.error);\n      });\n\n    } catch (error) {\n      console.error('âŒ Erreur suppression image IndexedDB:', error);\n      return false;\n    }\n  }, [db, initDB]);\n\n  // Convertir les blob URLs vers indexed:// URLs pour sauvegarde\n  const convertBlobUrlsToIndexed = useCallback((htmlContent) => {\n    let convertedHtml = htmlContent;\n    let conversionCount = 0;\n    \n    // Parcourir toutes les blob URLs dans le mapping\n    globalBlobToImageIdMap.forEach((imageId, blobUrl) => {\n      // Chercher et remplacer cette blob URL par indexed://imageId\n      const blobRegex = new RegExp(blobUrl.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'g');\n      const matches = convertedHtml.match(blobRegex);\n      \n      if (matches) {\n        convertedHtml = convertedHtml.replace(blobRegex, `indexed://${imageId}`);\n        conversionCount += matches.length;\n      }\n    });\n    \n    if (conversionCount > 0) {\n      console.log(`ðŸ”„ ${conversionCount} blob URL(s) converties vers indexed:// pour sauvegarde`);\n    }\n    \n    return convertedHtml;\n  }, []);\n\n  // Nettoyer les images orphelines (non rÃ©fÃ©rencÃ©es dans le contenu)\n  const cleanupOrphanImages = useCallback(async (htmlContent) => {\n    try {\n      const allImages = await listImages();\n      const usedImageIds = [];\n      \n      // Extraire tous les IDs d'images rÃ©fÃ©rencÃ©es dans le HTML\n      const indexedImageRegex = /indexed:\\/\\/(img_[^\"'\\s]+)/g;\n      let match;\n      while ((match = indexedImageRegex.exec(htmlContent)) !== null) {\n        usedImageIds.push(match[1]);\n      }\n\n      // Supprimer les images non rÃ©fÃ©rencÃ©es\n      let deletedCount = 0;\n      for (const image of allImages) {\n        if (!usedImageIds.includes(image.id)) {\n          await deleteImage(image.id);\n          deletedCount++;\n        }\n      }\n\n      if (deletedCount > 0) {\n        console.log(`ðŸ§¹ ${deletedCount} image(s) orpheline(s) supprimÃ©e(s)`);\n      }\n\n      return deletedCount;\n\n    } catch (error) {\n      console.error('âŒ Erreur nettoyage images IndexedDB:', error);\n      return 0;\n    }\n  }, [listImages, deleteImage]);\n\n  // Fonction pour rÃ©cupÃ©rer toutes les correspondances blobâ†’imageId\n  const getAllBlobMappings = useCallback(() => {\n    console.log('ðŸ”Ž DIAGNOSTIC getAllBlobMappings: Map actuelle:', globalBlobToImageIdMap);\n    console.log('ðŸ”Ž DIAGNOSTIC getAllBlobMappings: Taille de la Map:', globalBlobToImageIdMap.size);\n    for (const [blobUrl, imageId] of globalBlobToImageIdMap.entries()) {\n      console.log('ðŸ”— DIAGNOSTIC Mapping:', blobUrl, 'â†’', imageId);\n    }\n    return globalBlobToImageIdMap;\n  }, []);\n\n  return {\n    storeImage,\n    loadImage,\n    listImages,\n    deleteImage,\n    cleanupOrphanImages,\n    getAllBlobMappings,\n    convertBlobUrlsToIndexed\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}