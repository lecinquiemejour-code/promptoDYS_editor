{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\JEAN-NOELLEFEBVRE-SA\\\\CascadeProjects\\\\editor\\\\src\\\\components\\\\Editor.js\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect, useRef } from 'react';\nimport { convertAllPromptoDysUrlsToBlobs, getCurrentProject } from '../utils/promptoDysManager';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Editor = ({\n  content,\n  onInput,\n  viewMode,\n  selectedImage,\n  onImageClick,\n  onSelectionChange,\n  onEditorClick,\n  onDeleteSelectedImage,\n  isRestoring\n}) => {\n  _s();\n  // R√©f√©rence pour l'√©diteur\n  const editorRef = useRef(null);\n  const isInitializedRef = useRef(false);\n  const previousContentRef = useRef('');\n\n  // Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\n  const handleTextareaResize = useCallback(textarea => {\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.max(384, textarea.scrollHeight) + 'px';\n    }\n  }, []);\n\n  // Fonction pour formater le HTML avec des retours √† la ligne et indentation\n  const formatHtmlForSource = useCallback(html => {\n    let indentLevel = 0;\n    const indentSize = 2; // 2 espaces par niveau\n\n    return html.replace(/<br\\s*\\/?>/gi, '<br>\\n').replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi, match => {\n      if (match.startsWith('</')) {\n        // Balise fermante : diminuer l'indentation puis ajouter la balise\n        indentLevel = Math.max(0, indentLevel - 1);\n        return match + '\\n';\n      } else {\n        // Balise ouvrante : ajouter la balise puis augmenter l'indentation\n        const result = '\\n' + ' '.repeat(indentLevel * indentSize) + match;\n        // Augmenter l'indentation pour les balises conteneurs\n        if (match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)) {\n          indentLevel++;\n        }\n        return result;\n      }\n    }).split('\\n').map((line, index) => {\n      if (index === 0) return line.trim(); // Premi√®re ligne sans indentation\n      if (line.trim() === '') return ''; // Ligne vide\n      if (line.trim().startsWith('</')) {\n        // Balise fermante : r√©duire l'indentation\n        const currentIndent = Math.max(0, indentLevel - 1);\n        return ' '.repeat(currentIndent * indentSize) + line.trim();\n      }\n      // Contenu texte : utiliser l'indentation actuelle\n      return line.startsWith(' ') ? line : ' '.repeat(indentLevel * indentSize) + line.trim();\n    }).join('\\n').replace(/^\\n+/, '') // Supprimer les retours √† la ligne en d√©but\n    .replace(/\\n{2,}/g, '\\n') // Supprimer toutes les lignes vides multiples\n    .trim();\n  }, []);\n\n  // Gestionnaire unifi√© pour tous les changements\n  const handleChange = useCallback(e => {\n    console.log('üìù handleChange d√©clench√© en mode:', viewMode, '| isRestoring:', isRestoring);\n\n    // üö´ BLOQUER pendant la restauration IndexedDB\n    if (isRestoring) {\n      console.log('üö´ handleChange BLOQU√â - Restauration IndexedDB en cours');\n      return;\n    }\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Nettoyer les spans vides et les &nbsp; en trop\n      const cleanContent = html => {\n        return html.replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g, '') // Supprimer spans vides SAUF les spans color√©s\n        .replace(/(&nbsp;\\s*){2,}/g, '&nbsp;') // R√©duire les &nbsp; multiples\n        .replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g, '<span style=\"color: $1;\">$2</span>') // Convertir font en span\n        .replace(/<b\\b[^>]*>(.*?)<\\/b>/g, '<strong>$1</strong>') // Convertir b en strong\n        .replace(/<i\\b[^>]*>(.*?)<\\/i>/g, '<em>$1</em>'); // Convertir i en em\n      };\n      const newContent = cleanContent(editorRef.current.innerHTML);\n      console.log('üîç Contenu actuel state:', content.substring(0, 50) + '...');\n      console.log('üÜï Nouveau contenu √©diteur:', newContent.substring(0, 50) + '...');\n\n      // √âviter les boucles infinies avec une v√©rification plus stricte\n      if (newContent !== content && newContent.trim() !== content.trim()) {\n        console.log('‚úÖ Changement d√©tect√© - Appel onInput');\n        onInput({\n          target: {\n            innerHTML: newContent,\n            value: newContent\n          }\n        });\n      } else {\n        console.log('üö´ Aucun changement d√©tect√© ou contenu identique');\n      }\n\n      // Re-rendre MathJax apr√®s modification du contenu\n      if (window.MathJax && window.MathJax.typesetPromise) {\n        window.MathJax.typesetPromise([editorRef.current]).catch(err => {\n          console.warn('Erreur MathJax:', err);\n        });\n      }\n\n      // Mettre √† jour l'√©tat de formatage avec un d√©lai pour √©viter les conflits\n      requestAnimationFrame(() => {\n        if (document.activeElement === editorRef.current) {\n          onSelectionChange();\n        }\n      });\n    }\n  }, [viewMode, editorRef, onInput, onSelectionChange, content, isRestoring]);\n\n  // Gestionnaire pour les √©v√©nements de s√©lection/curseur\n  const handleSelectionChange = useCallback(() => {\n    if (viewMode === 'wysiwyg' && document.activeElement === editorRef.current) {\n      onSelectionChange();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, onSelectionChange]);\n\n  // Initialiser le contenu uniquement si n√©cessaire\n  useEffect(() => {\n    const initializeContent = async () => {\n      if (viewMode === 'wysiwyg' && editorRef.current && editorRef.current.innerHTML !== content) {\n        // Ne pas modifier le contenu si l'utilisateur interagit activement\n        const hasFocus = document.activeElement === editorRef.current;\n        const hasSelection = window.getSelection().rangeCount > 0;\n\n        // √âviter les mises √† jour pendant l'interaction utilisateur\n        if (hasFocus && hasSelection) {\n          return; // Ne pas perturber l'utilisateur\n        }\n\n        // Convertir les URLs relatives PromptoDYS en Blob URLs pour affichage\n        const currentProject = getCurrentProject();\n        let displayContent = content;\n        if (currentProject.directory) {\n          displayContent = await convertAllPromptoDysUrlsToBlobs(content, currentProject.directory);\n        }\n\n        // Mise √† jour avec le contenu converti\n        editorRef.current.innerHTML = displayContent;\n\n        // Re-rendre MathJax apr√®s mise √† jour du contenu\n        if (window.MathJax && window.MathJax.typesetPromise) {\n          window.MathJax.typesetPromise([editorRef.current]).catch(err => {\n            console.warn('Erreur MathJax:', err);\n          });\n        }\n      }\n    };\n    initializeContent();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, content]);\n\n  // Gestionnaire pour la copie - convertir HTML en texte propre et g√©rer les images s√©lectionn√©es\n  const handleCopy = useCallback(e => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Priorit√© 1: Si une image est s√©lectionn√©e, copier l'image\n      if (selectedImage) {\n        try {\n          // Cr√©er un √©l√©ment temporaire avec l'image\n          const tempDiv = document.createElement('div');\n          const clonedImg = selectedImage.cloneNode(true);\n          tempDiv.appendChild(clonedImg);\n\n          // Copier au format HTML pour pr√©server la structure\n          e.clipboardData.setData('text/html', tempDiv.innerHTML);\n          // Copier aussi le src comme texte de fallback\n          e.clipboardData.setData('text/plain', selectedImage.src);\n          e.preventDefault();\n          return;\n        } catch (error) {\n          console.warn('Erreur copie image:', error);\n        }\n      }\n\n      // Priorit√© 2: S√©lection de texte classique\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const selectedContent = range.cloneContents();\n        const tempDiv = document.createElement('div');\n        tempDiv.appendChild(selectedContent);\n\n        // Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\n        const htmlContent = tempDiv.innerHTML;\n        const textContent = htmlContent.replace(/<div[^>]*>/gi, '').replace(/<\\/div>/gi, '\\n').replace(/<br\\s*\\/?>/gi, '\\n').replace(/<p[^>]*>/gi, '').replace(/<\\/p>/gi, '\\n').replace(/<[^>]+>/g, '') // Supprimer toutes les autres balises\n        .replace(/&nbsp;/g, ' ').replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&#39;/g, \"'\").replace(/\\n+$/, ''); // Supprimer les retours √† la ligne en fin\n\n        // Mettre le texte propre dans le presse-papier\n        e.clipboardData.setData('text/plain', textContent);\n        e.preventDefault();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, selectedImage]);\n\n  // Gestionnaire pour forcer le refresh apr√®s coller\n  const handlePaste = useCallback(e => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Attendre que le contenu soit coll√©\n      setTimeout(async () => {\n        console.log('üîÑ Refresh forc√© apr√®s coller');\n\n        // Images coll√©es restent avec leurs URLs originales (blob: ou http:)\n\n        // Ajouter les poign√©es aux nouvelles images coll√©es\n        const newImages = editorRef.current.querySelectorAll('img:not([data-resizable])');\n        newImages.forEach(img => {\n          if (editorRef.current.addResizeHandlesToImage) {\n            editorRef.current.addResizeHandlesToImage(img);\n          }\n        });\n\n        // D√©clencher sauvegarde\n        if (onInput) {\n          const event = new Event('input', {\n            bubbles: true\n          });\n          editorRef.current.dispatchEvent(event);\n        }\n      }, 100);\n    }\n  }, [viewMode, onInput]);\n\n  // √âcouter les changements de s√©lection, la copie et le coller\n  useEffect(() => {\n    if (viewMode === 'wysiwyg') {\n      var _editorRef$current, _editorRef$current2;\n      document.addEventListener('selectionchange', handleSelectionChange);\n      (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : _editorRef$current.addEventListener('copy', handleCopy);\n      (_editorRef$current2 = editorRef.current) === null || _editorRef$current2 === void 0 ? void 0 : _editorRef$current2.addEventListener('paste', handlePaste);\n      return () => {\n        var _editorRef$current3, _editorRef$current4;\n        document.removeEventListener('selectionchange', handleSelectionChange);\n        (_editorRef$current3 = editorRef.current) === null || _editorRef$current3 === void 0 ? void 0 : _editorRef$current3.removeEventListener('copy', handleCopy);\n        (_editorRef$current4 = editorRef.current) === null || _editorRef$current4 === void 0 ? void 0 : _editorRef$current4.removeEventListener('paste', handlePaste);\n      };\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, handleSelectionChange, handleCopy, handlePaste]);\n\n  // Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\n  useEffect(() => {\n    if (viewMode !== 'wysiwyg' && editorRef.current) {\n      handleTextareaResize(editorRef.current);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [content, viewMode, handleTextareaResize]);\n\n  // Effect pour reset le flag lors du changement de contenu (nouveau projet)\n  useEffect(() => {\n    if (content !== previousContentRef.current) {\n      console.log('üîÑ NOUVEAU CONTENU D√âTECT√â - Reset du flag d\\'initialisation');\n      console.log('üìã Ancien:', previousContentRef.current.substring(0, 50) + '...');\n      console.log('üÜï Nouveau:', content.substring(0, 50) + '...');\n      isInitializedRef.current = false;\n      previousContentRef.current = content;\n    }\n  }, [content]);\n\n  // Effect pour initialiser le contenu une seule fois (mode non-contr√¥l√©)\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current && !isInitializedRef.current && content) {\n      console.log('üöÄ INITIALISATION - Contenu d√©fini:', content.substring(0, 100) + '...');\n      editorRef.current.innerHTML = content;\n      isInitializedRef.current = true;\n    }\n  }, [content, viewMode]);\n\n  // Effect pour appliquer le style de s√©lection d'image\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Supprimer la classe de toutes les images\n      const allImages = editorRef.current.querySelectorAll('img');\n      allImages.forEach(img => {\n        const wrapper = img.closest('.resizable-image');\n        if (wrapper) {\n          wrapper.classList.remove('image-selected');\n        }\n      });\n\n      // Ajouter la classe √† l'image s√©lectionn√©e\n      if (selectedImage) {\n        const wrapper = selectedImage.closest('.resizable-image');\n        if (wrapper) {\n          wrapper.classList.add('image-selected');\n        }\n      }\n    }\n  }, [selectedImage, viewMode, content]);\n\n  // Gestion des poign√©es de redimensionnement pour les images\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      const addResizeHandlesToImage = img => {\n        var _img$parentElement;\n        // Exposer la fonction pour r√©utilisation\n        editorRef.current.addResizeHandlesToImage = addResizeHandlesToImage;\n        // Toutes les images sont trait√©es normalement\n\n        // V√©rifier si d√©j√† trait√©\n        if (img.getAttribute('data-resizable') || (_img$parentElement = img.parentElement) !== null && _img$parentElement !== void 0 && _img$parentElement.classList.contains('resizable-image')) {\n          return;\n        }\n\n        // Attendre que l'image soit charg√©e\n        if (!img.complete || img.naturalWidth === 0) {\n          img.addEventListener('load', () => addResizeHandlesToImage(img), {\n            once: true\n          });\n          return;\n        }\n        img.setAttribute('data-resizable', 'true');\n\n        // Wrapper l'image dans un conteneur redimensionnable\n        const wrapper = document.createElement('div');\n        wrapper.className = 'resizable-image';\n\n        // Ajouter gestionnaire de clic pour s√©lection d'image\n        img.addEventListener('click', e => {\n          e.stopPropagation();\n          if (onImageClick) {\n            onImageClick(img);\n          }\n        });\n\n        // Extraire les dimensions depuis le style inline ou les attributs\n        let currentWidth, currentHeight;\n\n        // Priorit√© 1: attributs HTML (ex: width=\"300px\")\n        const attrWidth = img.getAttribute('width');\n        const attrHeight = img.getAttribute('height');\n\n        // Priorit√© 2: style inline (ex: style=\"width: 300px\")\n        const styleWidth = img.style.width;\n        const styleHeight = img.style.height;\n        if (attrWidth && attrHeight) {\n          currentWidth = parseInt(attrWidth);\n          currentHeight = parseInt(attrHeight);\n          console.log('üìè Dimensions depuis attributs:', currentWidth, 'x', currentHeight);\n        } else if (styleWidth && styleHeight) {\n          currentWidth = parseInt(styleWidth);\n          currentHeight = parseInt(styleHeight);\n          console.log('üìè Dimensions depuis style:', currentWidth, 'x', currentHeight);\n        } else {\n          // Fallback: dimensions naturelles\n          currentWidth = img.naturalWidth || 300;\n          currentHeight = img.naturalHeight || 200;\n          console.log('üìè Dimensions naturelles:', currentWidth, 'x', currentHeight);\n        }\n\n        // Limiter la hauteur maximale √† 300px en pr√©servant le ratio d'aspect\n        const MAX_HEIGHT = 300;\n        if (currentHeight > MAX_HEIGHT) {\n          const aspectRatio = currentWidth / currentHeight;\n          currentHeight = MAX_HEIGHT;\n          currentWidth = Math.round(currentHeight * aspectRatio);\n          console.log('üîÑ Image redimensionn√©e pour hauteur max 300px:', currentWidth, 'x', currentHeight);\n\n          // Appliquer les nouvelles dimensions √† l'image\n          img.setAttribute('width', currentWidth + 'px');\n          img.setAttribute('height', currentHeight + 'px');\n          img.style.width = currentWidth + 'px';\n          img.style.height = currentHeight + 'px';\n        }\n        wrapper.style.width = currentWidth + 'px';\n        wrapper.style.height = currentHeight + 'px';\n\n        // Ins√©rer le wrapper\n        img.parentNode.insertBefore(wrapper, img);\n        wrapper.appendChild(img);\n\n        // Cr√©er les 4 poign√©es\n        ['nw', 'ne', 'sw', 'se'].forEach(corner => {\n          const handle = document.createElement('div');\n          handle.className = `resize-handle ${corner}`;\n          handle.dataset.corner = corner;\n          handle.addEventListener('mousedown', e => {\n            e.preventDefault();\n            e.stopPropagation();\n            const startX = e.clientX;\n            const startY = e.clientY;\n            const startWidth = wrapper.offsetWidth;\n            const startHeight = wrapper.offsetHeight;\n            const aspectRatio = startWidth / startHeight;\n            const handleMouseMove = e => {\n              const deltaX = e.clientX - startX;\n              const deltaY = e.clientY - startY;\n              let newWidth = startWidth;\n              let newHeight = startHeight;\n\n              // Calculer les nouvelles dimensions selon le coin\n              switch (corner) {\n                case 'se':\n                  // Sud-Est\n                  newWidth = Math.max(50, startWidth + deltaX);\n                  newHeight = newWidth / aspectRatio;\n                  break;\n                case 'sw':\n                  // Sud-Ouest\n                  newWidth = Math.max(50, startWidth - deltaX);\n                  newHeight = newWidth / aspectRatio;\n                  break;\n                case 'ne':\n                  // Nord-Est\n                  newWidth = Math.max(50, startWidth + deltaX);\n                  newHeight = newWidth / aspectRatio;\n                  break;\n                case 'nw':\n                  // Nord-Ouest\n                  newWidth = Math.max(50, startWidth - deltaX);\n                  newHeight = newWidth / aspectRatio;\n                  break;\n              }\n\n              // Appliquer les nouvelles dimensions\n              wrapper.style.width = newWidth + 'px';\n              wrapper.style.height = newHeight + 'px';\n              img.style.width = '100%';\n              img.style.height = '100%';\n\n              // Ajouter les attributs HTML width/height pour persistance lors des conversions\n              img.setAttribute('width', Math.round(newWidth) + 'px');\n              img.setAttribute('height', Math.round(newHeight) + 'px');\n            };\n            const handleMouseUp = () => {\n              document.removeEventListener('mousemove', handleMouseMove);\n              document.removeEventListener('mouseup', handleMouseUp);\n\n              // D√©clencher l'√©v√©nement de changement pour sauvegarder\n              if (onInput) {\n                const event = new Event('input', {\n                  bubbles: true\n                });\n                editorRef.current.dispatchEvent(event);\n              }\n            };\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n          });\n          wrapper.appendChild(handle);\n        });\n      };\n\n      // Observer pour d√©tecter les nouvelles images\n      const handleMutation = mutations => {\n        mutations.forEach(mutation => {\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeName === 'IMG') {\n              addResizeHandlesToImage(node);\n            } else if (node.querySelectorAll) {\n              node.querySelectorAll('img').forEach(addResizeHandlesToImage);\n            }\n          });\n        });\n      };\n      const observer = new MutationObserver(handleMutation);\n      observer.observe(editorRef.current, {\n        childList: true,\n        subtree: true\n      });\n\n      // Traiter les images existantes\n      editorRef.current.querySelectorAll('img').forEach(addResizeHandlesToImage);\n      return () => observer.disconnect();\n    }\n  }, [viewMode, onInput, content]);\n\n  // Effect supprim√© - La gestion des poign√©es est maintenant dans l'effect pr√©c√©dent\n\n  // Rendu conditionnel avec switch/case pour garantir une seule vue\n  console.log('üîÑ Editor.js - Rendu switch/case, viewMode:', viewMode);\n  switch (viewMode) {\n    case 'wysiwyg':\n      console.log('üéØ SWITCH - Vue WYSIWYG');\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"style\", {\n          children: `\n            .editor-content h1 { \n              font-size: 2em; \n              font-weight: bold; \n              margin: 0.67em 0; \n              line-height: 1.2;\n            }\n            .editor-content h2 { \n              font-size: 1.5em; \n              font-weight: bold; \n              margin: 0.75em 0; \n              line-height: 1.3;\n            }\n            .editor-content h3 { \n              font-size: 1.17em; \n              font-weight: bold; \n              margin: 0.83em 0; \n              line-height: 1.4;\n            }\n            .editor-content p {\n              margin: 0.5em 0;\n            }\n            .editor-content ul {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: disc;\n            }\n            .editor-content ol {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: decimal;\n            }\n            .editor-content ol[style*=\"lower-alpha\"] {\n              list-style-type: lower-alpha;\n            }\n            .editor-content li {\n              margin: 0.25em 0;\n            }\n            \n            /* Styles pour images redimensionnables */\n            .editor-content img {\n              max-width: 100%;\n              height: auto;\n              position: relative;\n              cursor: pointer;\n            }\n            \n            .resizable-image {\n              position: relative;\n              display: inline-block;\n              border: 2px solid transparent;\n            }\n            \n            .resizable-image:hover {\n              border: 2px solid #3b82f6;\n            }\n            \n            /* Style pour image s√©lectionn√©e */\n            .image-selected {\n              border: 4px solid #1d4ed8 !important;\n              box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.3), 0 0 12px rgba(29, 78, 216, 0.4);\n              background: rgba(29, 78, 216, 0.05);\n              outline: 2px solid #ffffff;\n              outline-offset: 2px;\n            }\n            \n            .resizable-image img {\n              width: 100%;\n              height: 100%;\n              display: block;\n            }\n            \n            .resizable-image .resize-handle {\n              position: absolute;\n              width: 10px;\n              height: 10px;\n              background: #3b82f6;\n              border: 2px solid white;\n              border-radius: 50%;\n              opacity: 0;\n              cursor: nw-resize;\n              transition: opacity 0.2s;\n            }\n            \n            .resizable-image:hover .resize-handle {\n              opacity: 1;\n            }\n            \n            .resize-handle.nw { top: -6px; left: -6px; cursor: nw-resize; }\n            .resize-handle.ne { top: -6px; right: -6px; cursor: ne-resize; }\n            .resize-handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }\n            .resize-handle.se { bottom: -6px; right: -6px; cursor: se-resize; }\n          `\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 507,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: editorRef,\n          contentEditable: \"true\",\n          suppressContentEditableWarning: true,\n          onInput: e => {\n            console.log('üéØ onInput d√©clench√©! Contenu:', e.target.innerHTML.substring(0, 100) + '...');\n            handleChange(e);\n          },\n          onKeyUp: e => {\n            console.log('‚å®Ô∏è onKeyUp d√©clench√©! Touche:', e.key, 'Contenu:', e.target.innerHTML.substring(0, 100) + '...');\n            handleChange(e);\n          },\n          onPaste: e => {\n            console.log('üìã onPaste d√©clench√©! Contenu:', e.target.innerHTML.substring(0, 100) + '...');\n            handleChange(e);\n          },\n          onChange: e => {\n            console.log('üîÑ onChange d√©clench√©! Contenu:', e.target.innerHTML ? e.target.innerHTML.substring(0, 100) + '...' : 'N/A');\n          },\n          onKeyDown: e => {\n            console.log('üîΩ onKeyDown d√©clench√©! Touche:', e.key, 'Contenu:', e.target.innerHTML.substring(0, 100) + '...');\n            // Gestion des touches pour les images s√©lectionn√©es\n            if (selectedImage && (e.key === 'Delete' || e.key === 'Backspace')) {\n              e.preventDefault();\n              onDeleteSelectedImage();\n            }\n          },\n          onSelectionChange: handleSelectionChange,\n          onClick: onEditorClick,\n          style: {\n            minHeight: '384px',\n            outline: 'none',\n            padding: '20px',\n            lineHeight: '1.6',\n            fontFamily: 'system-ui, -apple-system, sans-serif',\n            color: 'var(--dys-text-color)',\n            backgroundColor: 'var(--dys-bg-color)',\n            overflow: 'auto',\n            wordWrap: 'break-word',\n            whiteSpace: 'pre-wrap',\n            border: '1px solid #e5e7eb'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 600,\n          columnNumber: 11\n        }, this)]\n      }, \"wysiwyg\", true, {\n        fileName: _jsxFileName,\n        lineNumber: 506,\n        columnNumber: 9\n      }, this);\n    case 'markdown':\n      {\n        console.log('üìù SWITCH - Vue MARKDOWN');\n        const displayContent = content;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n            ref: el => {\n              editorRef.current = el;\n            },\n            value: displayContent,\n            onChange: e => {\n              const newValue = e.target.value;\n              const originalContent = content;\n              if (newValue !== originalContent) {\n                onInput({\n                  ...e,\n                  target: {\n                    ...e.target,\n                    value: newValue\n                  }\n                });\n              }\n            },\n            className: \"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",\n            style: {\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              lineHeight: 'var(--dys-line-height)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              paddingBottom: '2rem'\n            },\n            placeholder: \"\\xC9crivez en Markdown... # Titre 1\\n## Titre 2\\n### Titre 3 **Gras** *Italique* - Liste \\xE0 puces\\n1. Liste num\\xE9rot\\xE9e\\na. Liste alphab\\xE9tique $E = mc^2$ (formule inline)\\n$$\\\\\\\\int_{-\\\\\\\\infty}^{\\\\\\\\infty} e^{-x^2} dx = \\\\\\\\sqrt{\\\\\\\\pi}$$ (formule block)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 652,\n            columnNumber: 11\n          }, this), detectBase64(content).length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute top-2 right-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\",\n            children: [\"\\uD83D\\uDCF7 \", detectBase64(content).length, \" image(s) Base64\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 693,\n            columnNumber: 13\n          }, this)]\n        }, \"markdown\", true, {\n          fileName: _jsxFileName,\n          lineNumber: 651,\n          columnNumber: 9\n        }, this);\n      }\n    case 'html':\n      {\n        console.log('üîß SWITCH - Vue HTML');\n        const htmlDisplayContent = formatHtmlForSource(content);\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n            ref: el => {\n              editorRef.current = el;\n            },\n            value: htmlDisplayContent,\n            onChange: e => {\n              const newValue = e.target.value;\n              const originalWithCollapse = formatHtmlForSource(content);\n              if (newValue !== originalWithCollapse) {\n                onInput({\n                  ...e,\n                  target: {\n                    ...e.target,\n                    value: newValue\n                  }\n                });\n              }\n            },\n            className: \"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",\n            style: {\n              fontFamily: 'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n              paddingBottom: '2rem'\n            },\n            placeholder: \"Code source HTML...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 707,\n            columnNumber: 11\n          }, this), detectBase64(content).length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute top-2 right-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\",\n            children: [\"\\uD83D\\uDCF7 \", detectBase64(content).length, \" image(s) Base64\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 732,\n            columnNumber: 13\n          }, this)]\n        }, \"html\", true, {\n          fileName: _jsxFileName,\n          lineNumber: 706,\n          columnNumber: 9\n        }, this);\n      }\n    default:\n      console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:', viewMode);\n      return null;\n  }\n};\n_s(Editor, \"eShqu5eEuvNpACYd8HlJWcZFX5Y=\");\n_c = Editor;\nexport default Editor;\nvar _c;\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"names":["React","useCallback","useEffect","useRef","convertAllPromptoDysUrlsToBlobs","getCurrentProject","jsxDEV","_jsxDEV","Editor","content","onInput","viewMode","selectedImage","onImageClick","onSelectionChange","onEditorClick","onDeleteSelectedImage","isRestoring","_s","editorRef","isInitializedRef","previousContentRef","handleTextareaResize","textarea","style","height","Math","max","scrollHeight","formatHtmlForSource","html","indentLevel","indentSize","replace","match","startsWith","result","repeat","split","map","line","index","trim","currentIndent","join","handleChange","e","console","log","current","cleanContent","newContent","innerHTML","substring","target","value","window","MathJax","typesetPromise","catch","err","warn","requestAnimationFrame","document","activeElement","handleSelectionChange","initializeContent","hasFocus","hasSelection","getSelection","rangeCount","currentProject","displayContent","directory","handleCopy","tempDiv","createElement","clonedImg","cloneNode","appendChild","clipboardData","setData","src","preventDefault","error","selection","range","getRangeAt","selectedContent","cloneContents","htmlContent","textContent","handlePaste","setTimeout","newImages","querySelectorAll","forEach","img","addResizeHandlesToImage","event","Event","bubbles","dispatchEvent","_editorRef$current","_editorRef$current2","addEventListener","_editorRef$current3","_editorRef$current4","removeEventListener","allImages","wrapper","closest","classList","remove","add","_img$parentElement","getAttribute","parentElement","contains","complete","naturalWidth","once","setAttribute","className","stopPropagation","currentWidth","currentHeight","attrWidth","attrHeight","styleWidth","width","styleHeight","parseInt","naturalHeight","MAX_HEIGHT","aspectRatio","round","parentNode","insertBefore","corner","handle","dataset","startX","clientX","startY","clientY","startWidth","offsetWidth","startHeight","offsetHeight","handleMouseMove","deltaX","deltaY","newWidth","newHeight","handleMouseUp","handleMutation","mutations","mutation","addedNodes","node","nodeName","observer","MutationObserver","observe","childList","subtree","disconnect","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","contentEditable","suppressContentEditableWarning","onKeyUp","key","onPaste","onChange","onKeyDown","onClick","minHeight","outline","padding","lineHeight","fontFamily","color","backgroundColor","overflow","wordWrap","whiteSpace","border","el","newValue","originalContent","fontSize","paddingBottom","placeholder","detectBase64","length","htmlDisplayContent","originalWithCollapse","_c","$RefreshReg$"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/components/Editor.js"],"sourcesContent":["import React, { useCallback, useEffect, useRef } from 'react';\nimport { convertAllPromptoDysUrlsToBlobs, getCurrentProject } from '../utils/promptoDysManager';\n\nconst Editor = ({\n  content,\n  onInput,\n  viewMode,\n  selectedImage,\n  onImageClick,\n  onSelectionChange,\n  onEditorClick,\n  onDeleteSelectedImage,\n  isRestoring\n}) => {\n  \n  \n  // R√©f√©rence pour l'√©diteur\n  const editorRef = useRef(null);\n  const isInitializedRef = useRef(false);\n  const previousContentRef = useRef('');\n  \n  \n  // Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\n  const handleTextareaResize = useCallback((textarea) => {\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.max(384, textarea.scrollHeight) + 'px';\n    }\n  }, []);\n\n\n\n  // Fonction pour formater le HTML avec des retours √† la ligne et indentation\n  const formatHtmlForSource = useCallback((html) => {\n    let indentLevel = 0;\n    const indentSize = 2; // 2 espaces par niveau\n    \n    return html\n      .replace(/<br\\s*\\/?>/gi, '<br>\\n')\n      .replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi, (match) => {\n        if (match.startsWith('</')) {\n          // Balise fermante : diminuer l'indentation puis ajouter la balise\n          indentLevel = Math.max(0, indentLevel - 1);\n          return match + '\\n';\n        } else {\n          // Balise ouvrante : ajouter la balise puis augmenter l'indentation\n          const result = '\\n' + ' '.repeat(indentLevel * indentSize) + match;\n          // Augmenter l'indentation pour les balises conteneurs\n          if (match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)) {\n            indentLevel++;\n          }\n          return result;\n        }\n      })\n      .split('\\n')\n      .map((line, index) => {\n        if (index === 0) return line.trim(); // Premi√®re ligne sans indentation\n        if (line.trim() === '') return ''; // Ligne vide\n        if (line.trim().startsWith('</')) {\n          // Balise fermante : r√©duire l'indentation\n          const currentIndent = Math.max(0, indentLevel - 1);\n          return ' '.repeat(currentIndent * indentSize) + line.trim();\n        }\n        // Contenu texte : utiliser l'indentation actuelle\n        return line.startsWith(' ') ? line : ' '.repeat(indentLevel * indentSize) + line.trim();\n      })\n      .join('\\n')\n      .replace(/^\\n+/, '') // Supprimer les retours √† la ligne en d√©but\n      .replace(/\\n{2,}/g, '\\n') // Supprimer toutes les lignes vides multiples\n      .trim();\n  }, []);\n\n  // Gestionnaire unifi√© pour tous les changements\n  const handleChange = useCallback((e) => {\n    console.log('üìù handleChange d√©clench√© en mode:', viewMode, '| isRestoring:', isRestoring);\n    \n    // üö´ BLOQUER pendant la restauration IndexedDB\n    if (isRestoring) {\n      console.log('üö´ handleChange BLOQU√â - Restauration IndexedDB en cours');\n      return;\n    }\n    \n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Nettoyer les spans vides et les &nbsp; en trop\n      const cleanContent = (html) => {\n        return html\n          .replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g, '') // Supprimer spans vides SAUF les spans color√©s\n          .replace(/(&nbsp;\\s*){2,}/g, '&nbsp;') // R√©duire les &nbsp; multiples\n          .replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g, '<span style=\"color: $1;\">$2</span>') // Convertir font en span\n          .replace(/<b\\b[^>]*>(.*?)<\\/b>/g, '<strong>$1</strong>') // Convertir b en strong\n          .replace(/<i\\b[^>]*>(.*?)<\\/i>/g, '<em>$1</em>'); // Convertir i en em\n      };\n      \n      const newContent = cleanContent(editorRef.current.innerHTML);\n      console.log('üîç Contenu actuel state:', content.substring(0, 50) + '...');\n      console.log('üÜï Nouveau contenu √©diteur:', newContent.substring(0, 50) + '...');\n      \n      // √âviter les boucles infinies avec une v√©rification plus stricte\n      if (newContent !== content && newContent.trim() !== content.trim()) {\n        console.log('‚úÖ Changement d√©tect√© - Appel onInput');\n        onInput({ target: { innerHTML: newContent, value: newContent } });\n      } else {\n        console.log('üö´ Aucun changement d√©tect√© ou contenu identique');\n      }\n      \n      // Re-rendre MathJax apr√®s modification du contenu\n      if (window.MathJax && window.MathJax.typesetPromise) {\n        window.MathJax.typesetPromise([editorRef.current]).catch((err) => {\n          console.warn('Erreur MathJax:', err);\n        });\n      }\n      \n      // Mettre √† jour l'√©tat de formatage avec un d√©lai pour √©viter les conflits\n      requestAnimationFrame(() => {\n        if (document.activeElement === editorRef.current) {\n          onSelectionChange();\n        }\n      });\n    }\n  }, [viewMode, editorRef, onInput, onSelectionChange, content, isRestoring]);\n\n  // Gestionnaire pour les √©v√©nements de s√©lection/curseur\n  const handleSelectionChange = useCallback(() => {\n    if (viewMode === 'wysiwyg' && document.activeElement === editorRef.current) {\n      onSelectionChange();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, onSelectionChange]);\n\n\n  // Initialiser le contenu uniquement si n√©cessaire\n  useEffect(() => {\n    const initializeContent = async () => {\n      if (viewMode === 'wysiwyg' && editorRef.current && editorRef.current.innerHTML !== content) {\n        // Ne pas modifier le contenu si l'utilisateur interagit activement\n        const hasFocus = document.activeElement === editorRef.current;\n        const hasSelection = window.getSelection().rangeCount > 0;\n        \n        // √âviter les mises √† jour pendant l'interaction utilisateur\n        if (hasFocus && hasSelection) {\n          return; // Ne pas perturber l'utilisateur\n        }\n        \n        // Convertir les URLs relatives PromptoDYS en Blob URLs pour affichage\n        const currentProject = getCurrentProject();\n        let displayContent = content;\n        \n        if (currentProject.directory) {\n          displayContent = await convertAllPromptoDysUrlsToBlobs(content, currentProject.directory);\n        }\n        \n        // Mise √† jour avec le contenu converti\n        editorRef.current.innerHTML = displayContent;\n        \n        // Re-rendre MathJax apr√®s mise √† jour du contenu\n        if (window.MathJax && window.MathJax.typesetPromise) {\n          window.MathJax.typesetPromise([editorRef.current]).catch((err) => {\n            console.warn('Erreur MathJax:', err);\n          });\n        }\n      }\n    };\n    \n    initializeContent();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, content]);\n\n  // Gestionnaire pour la copie - convertir HTML en texte propre et g√©rer les images s√©lectionn√©es\n  const handleCopy = useCallback((e) => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Priorit√© 1: Si une image est s√©lectionn√©e, copier l'image\n      if (selectedImage) {\n        try {\n          // Cr√©er un √©l√©ment temporaire avec l'image\n          const tempDiv = document.createElement('div');\n          const clonedImg = selectedImage.cloneNode(true);\n          tempDiv.appendChild(clonedImg);\n          \n          // Copier au format HTML pour pr√©server la structure\n          e.clipboardData.setData('text/html', tempDiv.innerHTML);\n          // Copier aussi le src comme texte de fallback\n          e.clipboardData.setData('text/plain', selectedImage.src);\n          e.preventDefault();\n          return;\n        } catch (error) {\n          console.warn('Erreur copie image:', error);\n        }\n      }\n      \n      // Priorit√© 2: S√©lection de texte classique\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const selectedContent = range.cloneContents();\n        const tempDiv = document.createElement('div');\n        tempDiv.appendChild(selectedContent);\n        \n        // Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\n        const htmlContent = tempDiv.innerHTML;\n        const textContent = htmlContent\n          .replace(/<div[^>]*>/gi, '')\n          .replace(/<\\/div>/gi, '\\n')\n          .replace(/<br\\s*\\/?>/gi, '\\n')\n          .replace(/<p[^>]*>/gi, '')\n          .replace(/<\\/p>/gi, '\\n')\n          .replace(/<[^>]+>/g, '') // Supprimer toutes les autres balises\n          .replace(/&nbsp;/g, ' ')\n          .replace(/&amp;/g, '&')\n          .replace(/&lt;/g, '<')\n          .replace(/&gt;/g, '>')\n          .replace(/&quot;/g, '\"')\n          .replace(/&#39;/g, \"'\")\n          .replace(/\\n+$/, ''); // Supprimer les retours √† la ligne en fin\n        \n        // Mettre le texte propre dans le presse-papier\n        e.clipboardData.setData('text/plain', textContent);\n        e.preventDefault();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, selectedImage]);\n\n  // Gestionnaire pour forcer le refresh apr√®s coller\n  const handlePaste = useCallback((e) => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Attendre que le contenu soit coll√©\n      setTimeout(async () => {\n        console.log('üîÑ Refresh forc√© apr√®s coller');\n        \n        // Images coll√©es restent avec leurs URLs originales (blob: ou http:)\n        \n        // Ajouter les poign√©es aux nouvelles images coll√©es\n        const newImages = editorRef.current.querySelectorAll('img:not([data-resizable])');\n        newImages.forEach(img => {\n          if (editorRef.current.addResizeHandlesToImage) {\n            editorRef.current.addResizeHandlesToImage(img);\n          }\n        });\n        \n        // D√©clencher sauvegarde\n        if (onInput) {\n          const event = new Event('input', { bubbles: true });\n          editorRef.current.dispatchEvent(event);\n        }\n      }, 100);\n    }\n  }, [viewMode, onInput]);\n\n  // √âcouter les changements de s√©lection, la copie et le coller\n  useEffect(() => {\n    if (viewMode === 'wysiwyg') {\n      document.addEventListener('selectionchange', handleSelectionChange);\n      editorRef.current?.addEventListener('copy', handleCopy);\n      editorRef.current?.addEventListener('paste', handlePaste);\n      \n      return () => {\n        document.removeEventListener('selectionchange', handleSelectionChange);\n        editorRef.current?.removeEventListener('copy', handleCopy);\n        editorRef.current?.removeEventListener('paste', handlePaste);\n      };\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, handleSelectionChange, handleCopy, handlePaste]);\n\n  // Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\n  useEffect(() => {\n    if (viewMode !== 'wysiwyg' && editorRef.current) {\n      handleTextareaResize(editorRef.current);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [content, viewMode, handleTextareaResize]);\n\n\n\n// Effect pour reset le flag lors du changement de contenu (nouveau projet)\nuseEffect(() => {\n  if (content !== previousContentRef.current) {\n    console.log('üîÑ NOUVEAU CONTENU D√âTECT√â - Reset du flag d\\'initialisation');\n    console.log('üìã Ancien:', previousContentRef.current.substring(0, 50) + '...');\n    console.log('üÜï Nouveau:', content.substring(0, 50) + '...');\n    isInitializedRef.current = false;\n    previousContentRef.current = content;\n  }\n}, [content]);\n\n// Effect pour initialiser le contenu une seule fois (mode non-contr√¥l√©)\nuseEffect(() => {\n  if (viewMode === 'wysiwyg' && editorRef.current && !isInitializedRef.current && content) {\n    console.log('üöÄ INITIALISATION - Contenu d√©fini:', content.substring(0, 100) + '...');\n    editorRef.current.innerHTML = content;\n    isInitializedRef.current = true;\n  }\n}, [content, viewMode]);\n\n// Effect pour appliquer le style de s√©lection d'image\nuseEffect(() => {\n  if (viewMode === 'wysiwyg' && editorRef.current) {\n    // Supprimer la classe de toutes les images\n    const allImages = editorRef.current.querySelectorAll('img');\n    allImages.forEach(img => {\n      const wrapper = img.closest('.resizable-image');\n      if (wrapper) {\n        wrapper.classList.remove('image-selected');\n      }\n    });\n\n    // Ajouter la classe √† l'image s√©lectionn√©e\n    if (selectedImage) {\n      const wrapper = selectedImage.closest('.resizable-image');\n      if (wrapper) {\n        wrapper.classList.add('image-selected');\n      }\n    }\n  }\n}, [selectedImage, viewMode, content]);\n\n  // Gestion des poign√©es de redimensionnement pour les images\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      const addResizeHandlesToImage = (img) => {\n        // Exposer la fonction pour r√©utilisation\n        editorRef.current.addResizeHandlesToImage = addResizeHandlesToImage;\n        // Toutes les images sont trait√©es normalement\n        \n        // V√©rifier si d√©j√† trait√©\n        if (img.getAttribute('data-resizable') || img.parentElement?.classList.contains('resizable-image')) {\n          return;\n        }\n        \n        // Attendre que l'image soit charg√©e\n        if (!img.complete || img.naturalWidth === 0) {\n          img.addEventListener('load', () => addResizeHandlesToImage(img), { once: true });\n          return;\n        }\n        \n        img.setAttribute('data-resizable', 'true');\n        \n        // Wrapper l'image dans un conteneur redimensionnable\n        const wrapper = document.createElement('div');\n        wrapper.className = 'resizable-image';\n        \n        // Ajouter gestionnaire de clic pour s√©lection d'image\n        img.addEventListener('click', (e) => {\n          e.stopPropagation();\n          if (onImageClick) {\n            onImageClick(img);\n          }\n        });\n        \n        // Extraire les dimensions depuis le style inline ou les attributs\n        let currentWidth, currentHeight;\n        \n        // Priorit√© 1: attributs HTML (ex: width=\"300px\")\n        const attrWidth = img.getAttribute('width');\n        const attrHeight = img.getAttribute('height');\n        \n        // Priorit√© 2: style inline (ex: style=\"width: 300px\")\n        const styleWidth = img.style.width;\n        const styleHeight = img.style.height;\n        \n        if (attrWidth && attrHeight) {\n          currentWidth = parseInt(attrWidth);\n          currentHeight = parseInt(attrHeight);\n          console.log('üìè Dimensions depuis attributs:', currentWidth, 'x', currentHeight);\n        } else if (styleWidth && styleHeight) {\n          currentWidth = parseInt(styleWidth);\n          currentHeight = parseInt(styleHeight);\n          console.log('üìè Dimensions depuis style:', currentWidth, 'x', currentHeight);\n        } else {\n          // Fallback: dimensions naturelles\n          currentWidth = img.naturalWidth || 300;\n          currentHeight = img.naturalHeight || 200;\n          console.log('üìè Dimensions naturelles:', currentWidth, 'x', currentHeight);\n        }\n        \n        // Limiter la hauteur maximale √† 300px en pr√©servant le ratio d'aspect\n        const MAX_HEIGHT = 300;\n        if (currentHeight > MAX_HEIGHT) {\n          const aspectRatio = currentWidth / currentHeight;\n          currentHeight = MAX_HEIGHT;\n          currentWidth = Math.round(currentHeight * aspectRatio);\n          console.log('üîÑ Image redimensionn√©e pour hauteur max 300px:', currentWidth, 'x', currentHeight);\n          \n          // Appliquer les nouvelles dimensions √† l'image\n          img.setAttribute('width', currentWidth + 'px');\n          img.setAttribute('height', currentHeight + 'px');\n          img.style.width = currentWidth + 'px';\n          img.style.height = currentHeight + 'px';\n        }\n        \n        wrapper.style.width = currentWidth + 'px';\n        wrapper.style.height = currentHeight + 'px';\n          \n          // Ins√©rer le wrapper\n          img.parentNode.insertBefore(wrapper, img);\n          wrapper.appendChild(img);\n          \n          // Cr√©er les 4 poign√©es\n          ['nw', 'ne', 'sw', 'se'].forEach((corner) => {\n            const handle = document.createElement('div');\n            handle.className = `resize-handle ${corner}`;\n            handle.dataset.corner = corner;\n            \n            handle.addEventListener('mousedown', (e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              \n              const startX = e.clientX;\n              const startY = e.clientY;\n              const startWidth = wrapper.offsetWidth;\n              const startHeight = wrapper.offsetHeight;\n              const aspectRatio = startWidth / startHeight;\n              \n              const handleMouseMove = (e) => {\n                const deltaX = e.clientX - startX;\n                const deltaY = e.clientY - startY;\n                \n                let newWidth = startWidth;\n                let newHeight = startHeight;\n                \n                // Calculer les nouvelles dimensions selon le coin\n                switch(corner) {\n                  case 'se': // Sud-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'sw': // Sud-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'ne': // Nord-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'nw': // Nord-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                }\n                \n                // Appliquer les nouvelles dimensions\n                wrapper.style.width = newWidth + 'px';\n                wrapper.style.height = newHeight + 'px';\n                img.style.width = '100%';\n                img.style.height = '100%';\n                \n                // Ajouter les attributs HTML width/height pour persistance lors des conversions\n                img.setAttribute('width', Math.round(newWidth) + 'px');\n                img.setAttribute('height', Math.round(newHeight) + 'px');\n              };\n              \n              const handleMouseUp = () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n                \n                // D√©clencher l'√©v√©nement de changement pour sauvegarder\n                if (onInput) {\n                  const event = new Event('input', { bubbles: true });\n                  editorRef.current.dispatchEvent(event);\n                }\n              };\n              \n              document.addEventListener('mousemove', handleMouseMove);\n              document.addEventListener('mouseup', handleMouseUp);\n            });\n            \n            wrapper.appendChild(handle);\n          });\n      };\n      \n      // Observer pour d√©tecter les nouvelles images\n      const handleMutation = (mutations) => {\n        mutations.forEach(mutation => {\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeName === 'IMG') {\n              addResizeHandlesToImage(node);\n            } else if (node.querySelectorAll) {\n              node.querySelectorAll('img').forEach(addResizeHandlesToImage);\n            }\n          });\n        });\n      };\n      \n      const observer = new MutationObserver(handleMutation);\n      observer.observe(editorRef.current, {\n        childList: true,\n        subtree: true\n      });\n      \n      // Traiter les images existantes\n      editorRef.current.querySelectorAll('img').forEach(addResizeHandlesToImage);\n      \n      return () => observer.disconnect();\n    }\n  }, [viewMode, onInput, content]);\n  \n  // Effect supprim√© - La gestion des poign√©es est maintenant dans l'effect pr√©c√©dent\n\n  // Rendu conditionnel avec switch/case pour garantir une seule vue\n  console.log('üîÑ Editor.js - Rendu switch/case, viewMode:', viewMode);\n  \n  switch (viewMode) {\n    case 'wysiwyg':\n      console.log('üéØ SWITCH - Vue WYSIWYG');\n      return (\n        <div key=\"wysiwyg\">\n          <style>{`\n            .editor-content h1 { \n              font-size: 2em; \n              font-weight: bold; \n              margin: 0.67em 0; \n              line-height: 1.2;\n            }\n            .editor-content h2 { \n              font-size: 1.5em; \n              font-weight: bold; \n              margin: 0.75em 0; \n              line-height: 1.3;\n            }\n            .editor-content h3 { \n              font-size: 1.17em; \n              font-weight: bold; \n              margin: 0.83em 0; \n              line-height: 1.4;\n            }\n            .editor-content p {\n              margin: 0.5em 0;\n            }\n            .editor-content ul {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: disc;\n            }\n            .editor-content ol {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: decimal;\n            }\n            .editor-content ol[style*=\"lower-alpha\"] {\n              list-style-type: lower-alpha;\n            }\n            .editor-content li {\n              margin: 0.25em 0;\n            }\n            \n            /* Styles pour images redimensionnables */\n            .editor-content img {\n              max-width: 100%;\n              height: auto;\n              position: relative;\n              cursor: pointer;\n            }\n            \n            .resizable-image {\n              position: relative;\n              display: inline-block;\n              border: 2px solid transparent;\n            }\n            \n            .resizable-image:hover {\n              border: 2px solid #3b82f6;\n            }\n            \n            /* Style pour image s√©lectionn√©e */\n            .image-selected {\n              border: 4px solid #1d4ed8 !important;\n              box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.3), 0 0 12px rgba(29, 78, 216, 0.4);\n              background: rgba(29, 78, 216, 0.05);\n              outline: 2px solid #ffffff;\n              outline-offset: 2px;\n            }\n            \n            .resizable-image img {\n              width: 100%;\n              height: 100%;\n              display: block;\n            }\n            \n            .resizable-image .resize-handle {\n              position: absolute;\n              width: 10px;\n              height: 10px;\n              background: #3b82f6;\n              border: 2px solid white;\n              border-radius: 50%;\n              opacity: 0;\n              cursor: nw-resize;\n              transition: opacity 0.2s;\n            }\n            \n            .resizable-image:hover .resize-handle {\n              opacity: 1;\n            }\n            \n            .resize-handle.nw { top: -6px; left: -6px; cursor: nw-resize; }\n            .resize-handle.ne { top: -6px; right: -6px; cursor: ne-resize; }\n            .resize-handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }\n            .resize-handle.se { bottom: -6px; right: -6px; cursor: se-resize; }\n          `}</style>\n          <div\n            ref={editorRef}\n            contentEditable=\"true\"\n            suppressContentEditableWarning={true}\n            onInput={(e) => {\n              console.log('üéØ onInput d√©clench√©! Contenu:', e.target.innerHTML.substring(0, 100) + '...');\n              handleChange(e);\n            }}\n            onKeyUp={(e) => {\n              console.log('‚å®Ô∏è onKeyUp d√©clench√©! Touche:', e.key, 'Contenu:', e.target.innerHTML.substring(0, 100) + '...');\n              handleChange(e);\n            }}\n            onPaste={(e) => {\n              console.log('üìã onPaste d√©clench√©! Contenu:', e.target.innerHTML.substring(0, 100) + '...');\n              handleChange(e);\n            }}\n            onChange={(e) => {\n              console.log('üîÑ onChange d√©clench√©! Contenu:', e.target.innerHTML ? e.target.innerHTML.substring(0, 100) + '...' : 'N/A');\n            }}\n            onKeyDown={(e) => {\n              console.log('üîΩ onKeyDown d√©clench√©! Touche:', e.key, 'Contenu:', e.target.innerHTML.substring(0, 100) + '...');\n              // Gestion des touches pour les images s√©lectionn√©es\n              if (selectedImage && (e.key === 'Delete' || e.key === 'Backspace')) {\n                e.preventDefault();\n                onDeleteSelectedImage();\n              }\n            }}\n            onSelectionChange={handleSelectionChange}\n            onClick={onEditorClick}\n            style={{\n              minHeight: '384px',\n              outline: 'none',\n              padding: '20px',\n              lineHeight: '1.6',\n              fontFamily: 'system-ui, -apple-system, sans-serif',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n            }}\n          />\n        </div>\n      );\n\n    case 'markdown': {\n      console.log('üìù SWITCH - Vue MARKDOWN');\n      const displayContent = content;\n      \n      return (\n        <div key=\"markdown\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              editorRef.current = el;\n            }}\n            value={displayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalContent = content;\n              \n              if (newValue !== originalContent) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            className=\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            style={{\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              lineHeight: 'var(--dys-line-height)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"√âcrivez en Markdown...\n\n# Titre 1\n## Titre 2\n### Titre 3\n\n**Gras** *Italique*\n\n- Liste √† puces\n1. Liste num√©rot√©e\na. Liste alphab√©tique\n\n$E = mc^2$ (formule inline)\n$$\\\\int_{-\\\\infty}^{\\\\infty} e^{-x^2} dx = \\\\sqrt{\\\\pi}$$ (formule block)\"\n          />\n          {detectBase64(content).length > 0 && (\n            <div className=\"absolute top-2 right-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\">\n              üì∑ {detectBase64(content).length} image(s) Base64\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    case 'html': {\n      console.log('üîß SWITCH - Vue HTML');\n      const htmlDisplayContent = formatHtmlForSource(content);\n    \n      return (\n        <div key=\"html\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              editorRef.current = el;\n            }}\n            value={htmlDisplayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalWithCollapse = formatHtmlForSource(content);\n              \n              if (newValue !== originalWithCollapse) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            className=\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            style={{ \n              fontFamily: 'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"Code source HTML...\"\n          />\n          {detectBase64(content).length > 0 && (\n            <div className=\"absolute top-2 right-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\">\n              üì∑ {detectBase64(content).length} image(s) Base64\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    default:\n      console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:', viewMode);\n      return null;\n  }\n};\n\nexport default Editor;\n"],"mappings":"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AAI,CAAC;YAC/B,CAAC,MAAM,IAAIA,IAAI,CAACjE,gBAAgB,EAAE;cAChCiE,IAAI,CAACjE,gBAAgB,CAAC,KAAK,CAAC,CAACC,OAAO,CAACE,uBAAuB,CAAC;YAC/D;UACF,CAAC,CAAC;QACJ,CAAC,CAAC;MACJ,CAAC;MAED,MAAMgE,QAAQ,GAAG,IAAIC,gBAAgB,CAACP,cAAc,CAAC;MACrDM,QAAQ,CAACE,OAAO,CAACjJ,SAAS,CAAC8B,OAAO,EAAE;QAClCoH,SAAS,EAAE,IAAI;QACfC,OAAO,EAAE;MACX,CAAC,CAAC;;MAEF;MACAnJ,SAAS,CAAC8B,OAAO,CAAC8C,gBAAgB,CAAC,KAAK,CAAC,CAACC,OAAO,CAACE,uBAAuB,CAAC;MAE1E,OAAO,MAAMgE,QAAQ,CAACK,UAAU,CAAC,CAAC;IACpC;EACF,CAAC,EAAE,CAAC5J,QAAQ,EAAED,OAAO,EAAED,OAAO,CAAC,CAAC;;EAEhC;;EAEA;EACAsC,OAAO,CAACC,GAAG,CAAC,6CAA6C,EAAErC,QAAQ,CAAC;EAEpE,QAAQA,QAAQ;IACd,KAAK,SAAS;MACZoC,OAAO,CAACC,GAAG,CAAC,yBAAyB,CAAC;MACtC,oBACEzC,OAAA;QAAAiK,QAAA,gBACEjK,OAAA;UAAAiK,QAAA,EAAQ;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QAAW;UAAAC,QAAA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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}