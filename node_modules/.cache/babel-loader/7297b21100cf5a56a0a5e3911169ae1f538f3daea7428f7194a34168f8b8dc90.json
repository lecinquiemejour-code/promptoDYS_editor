{"ast":null,"code":"// Utilitaires pour le collapse des donnÃ©es Base64\n\n/**\n * DÃ©tecte et extrait les donnÃ©es Base64 dans le contenu\n * @param {string} content - Contenu Ã  analyser\n * @returns {Array} - Tableau d'objets {index, match, start, end, type, size}\n */\nexport const detectBase64 = content => {\n  const base64Regex = /data:image\\/([^;]+);base64,([A-Za-z0-9+/=]{100,})/g;\n  const matches = [];\n  let match;\n  let index = 0;\n  while ((match = base64Regex.exec(content)) !== null) {\n    const [fullMatch, imageType, base64Data] = match;\n    matches.push({\n      index: index++,\n      match: fullMatch,\n      start: match.index,\n      end: match.index + fullMatch.length,\n      type: imageType,\n      size: base64Data.length,\n      base64Data\n    });\n  }\n  return matches;\n};\n\n/**\n * GÃ©nÃ¨re la version collapsÃ©e d'une donnÃ©e Base64\n * @param {Object} base64Info - Information sur la donnÃ©e Base64\n * @param {boolean} isExpanded - Ã‰tat d'expansion\n * @returns {string} - Version collapsÃ©e ou complÃ¨te\n */\nexport const generateCollapsedBase64 = (base64Info, isExpanded = false) => {\n  if (isExpanded) {\n    return base64Info.match;\n  }\n  const preview = base64Info.base64Data.substring(0, 50);\n  return `data:image/${base64Info.type};base64,${preview}[...${base64Info.size} caractÃ¨res...] ðŸ‘ï¸ Voir`;\n};\n\n/**\n * Applique le collapse Ã  tout le contenu\n * @param {string} content - Contenu original\n * @param {Object} expandedStates - Ã‰tats d'expansion {index: boolean}\n * @returns {string} - Contenu avec base64 collapsÃ©s\n */\nexport const applyBase64Collapse = (content, expandedStates = {}) => {\n  const base64Matches = detectBase64(content);\n  if (base64Matches.length === 0) {\n    return content;\n  }\n\n  // Traiter les matches de la fin vers le dÃ©but pour prÃ©server les indices\n  let result = content;\n  for (let i = base64Matches.length - 1; i >= 0; i--) {\n    const base64Info = base64Matches[i];\n    const isExpanded = expandedStates[base64Info.index] || false;\n    const replacement = generateCollapsedBase64(base64Info, isExpanded);\n    result = result.substring(0, base64Info.start) + replacement + result.substring(base64Info.end);\n  }\n  return result;\n};\n\n/**\n * Extrait l'index du Base64 Ã  partir du texte cliquÃ©\n * @param {string} text - Texte contenant potentiellement un marqueur de Base64\n * @returns {number|null} - Index du Base64 ou null\n */\nexport const extractBase64Index = text => {\n  // Recherche dans le contexte proche du clic\n  const base64Pattern = /data:image\\/[^;]+;base64,[A-Za-z0-9+/]{0,50}\\[\\.\\.\\.(\\d+) caractÃ¨res\\.\\.\\.\\] ðŸ‘ï¸ Voir/;\n  const matches = detectBase64(text);\n\n  // Pour l'instant, on retourne l'index basÃ© sur l'ordre d'apparition\n  // Cette logique peut Ãªtre amÃ©liorÃ©e selon les besoins\n  return matches.length > 0 ? 0 : null;\n};","map":{"version":3,"names":["detectBase64","content","base64Regex","matches","match","index","exec","fullMatch","imageType","base64Data","push","start","end","length","type","size","generateCollapsedBase64","base64Info","isExpanded","preview","substring","applyBase64Collapse","expandedStates","base64Matches","result","i","replacement","extractBase64Index","text","base64Pattern"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/utils/base64Collapse.js"],"sourcesContent":["// Utilitaires pour le collapse des donnÃ©es Base64\n\n/**\n * DÃ©tecte et extrait les donnÃ©es Base64 dans le contenu\n * @param {string} content - Contenu Ã  analyser\n * @returns {Array} - Tableau d'objets {index, match, start, end, type, size}\n */\nexport const detectBase64 = (content) => {\n  const base64Regex = /data:image\\/([^;]+);base64,([A-Za-z0-9+/=]{100,})/g;\n  const matches = [];\n  let match;\n  let index = 0;\n\n  while ((match = base64Regex.exec(content)) !== null) {\n    const [fullMatch, imageType, base64Data] = match;\n    matches.push({\n      index: index++,\n      match: fullMatch,\n      start: match.index,\n      end: match.index + fullMatch.length,\n      type: imageType,\n      size: base64Data.length,\n      base64Data\n    });\n  }\n\n  return matches;\n};\n\n/**\n * GÃ©nÃ¨re la version collapsÃ©e d'une donnÃ©e Base64\n * @param {Object} base64Info - Information sur la donnÃ©e Base64\n * @param {boolean} isExpanded - Ã‰tat d'expansion\n * @returns {string} - Version collapsÃ©e ou complÃ¨te\n */\nexport const generateCollapsedBase64 = (base64Info, isExpanded = false) => {\n  if (isExpanded) {\n    return base64Info.match;\n  }\n\n  const preview = base64Info.base64Data.substring(0, 50);\n  return `data:image/${base64Info.type};base64,${preview}[...${base64Info.size} caractÃ¨res...] ðŸ‘ï¸ Voir`;\n};\n\n/**\n * Applique le collapse Ã  tout le contenu\n * @param {string} content - Contenu original\n * @param {Object} expandedStates - Ã‰tats d'expansion {index: boolean}\n * @returns {string} - Contenu avec base64 collapsÃ©s\n */\nexport const applyBase64Collapse = (content, expandedStates = {}) => {\n  const base64Matches = detectBase64(content);\n  \n  if (base64Matches.length === 0) {\n    return content;\n  }\n\n  // Traiter les matches de la fin vers le dÃ©but pour prÃ©server les indices\n  let result = content;\n  for (let i = base64Matches.length - 1; i >= 0; i--) {\n    const base64Info = base64Matches[i];\n    const isExpanded = expandedStates[base64Info.index] || false;\n    const replacement = generateCollapsedBase64(base64Info, isExpanded);\n    \n    result = result.substring(0, base64Info.start) + \n             replacement + \n             result.substring(base64Info.end);\n  }\n\n  return result;\n};\n\n/**\n * Extrait l'index du Base64 Ã  partir du texte cliquÃ©\n * @param {string} text - Texte contenant potentiellement un marqueur de Base64\n * @returns {number|null} - Index du Base64 ou null\n */\nexport const extractBase64Index = (text) => {\n  // Recherche dans le contexte proche du clic\n  const base64Pattern = /data:image\\/[^;]+;base64,[A-Za-z0-9+/]{0,50}\\[\\.\\.\\.(\\d+) caractÃ¨res\\.\\.\\.\\] ðŸ‘ï¸ Voir/;\n  const matches = detectBase64(text);\n  \n  // Pour l'instant, on retourne l'index basÃ© sur l'ordre d'apparition\n  // Cette logique peut Ãªtre amÃ©liorÃ©e selon les besoins\n  return matches.length > 0 ? 0 : null;\n};\n"],"mappings":"AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMA,YAAY,GAAIC,OAAO,IAAK;EACvC,MAAMC,WAAW,GAAG,oDAAoD;EACxE,MAAMC,OAAO,GAAG,EAAE;EAClB,IAAIC,KAAK;EACT,IAAIC,KAAK,GAAG,CAAC;EAEb,OAAO,CAACD,KAAK,GAAGF,WAAW,CAACI,IAAI,CAACL,OAAO,CAAC,MAAM,IAAI,EAAE;IACnD,MAAM,CAACM,SAAS,EAAEC,SAAS,EAAEC,UAAU,CAAC,GAAGL,KAAK;IAChDD,OAAO,CAACO,IAAI,CAAC;MACXL,KAAK,EAAEA,KAAK,EAAE;MACdD,KAAK,EAAEG,SAAS;MAChBI,KAAK,EAAEP,KAAK,CAACC,KAAK;MAClBO,GAAG,EAAER,KAAK,CAACC,KAAK,GAAGE,SAAS,CAACM,MAAM;MACnCC,IAAI,EAAEN,SAAS;MACfO,IAAI,EAAEN,UAAU,CAACI,MAAM;MACvBJ;IACF,CAAC,CAAC;EACJ;EAEA,OAAON,OAAO;AAChB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMa,uBAAuB,GAAGA,CAACC,UAAU,EAAEC,UAAU,GAAG,KAAK,KAAK;EACzE,IAAIA,UAAU,EAAE;IACd,OAAOD,UAAU,CAACb,KAAK;EACzB;EAEA,MAAMe,OAAO,GAAGF,UAAU,CAACR,UAAU,CAACW,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC;EACtD,OAAO,cAAcH,UAAU,CAACH,IAAI,WAAWK,OAAO,OAAOF,UAAU,CAACF,IAAI,0BAA0B;AACxG,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMM,mBAAmB,GAAGA,CAACpB,OAAO,EAAEqB,cAAc,GAAG,CAAC,CAAC,KAAK;EACnE,MAAMC,aAAa,GAAGvB,YAAY,CAACC,OAAO,CAAC;EAE3C,IAAIsB,aAAa,CAACV,MAAM,KAAK,CAAC,EAAE;IAC9B,OAAOZ,OAAO;EAChB;;EAEA;EACA,IAAIuB,MAAM,GAAGvB,OAAO;EACpB,KAAK,IAAIwB,CAAC,GAAGF,aAAa,CAACV,MAAM,GAAG,CAAC,EAAEY,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;IAClD,MAAMR,UAAU,GAAGM,aAAa,CAACE,CAAC,CAAC;IACnC,MAAMP,UAAU,GAAGI,cAAc,CAACL,UAAU,CAACZ,KAAK,CAAC,IAAI,KAAK;IAC5D,MAAMqB,WAAW,GAAGV,uBAAuB,CAACC,UAAU,EAAEC,UAAU,CAAC;IAEnEM,MAAM,GAAGA,MAAM,CAACJ,SAAS,CAAC,CAAC,EAAEH,UAAU,CAACN,KAAK,CAAC,GACrCe,WAAW,GACXF,MAAM,CAACJ,SAAS,CAACH,UAAU,CAACL,GAAG,CAAC;EAC3C;EAEA,OAAOY,MAAM;AACf,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMG,kBAAkB,GAAIC,IAAI,IAAK;EAC1C;EACA,MAAMC,aAAa,GAAG,uFAAuF;EAC7G,MAAM1B,OAAO,GAAGH,YAAY,CAAC4B,IAAI,CAAC;;EAElC;EACA;EACA,OAAOzB,OAAO,CAACU,MAAM,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI;AACtC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}