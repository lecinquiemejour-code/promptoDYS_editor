{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect } from 'react';\nimport { htmlToMarkdown, markdownToHtml, isMarkdownContent } from '../utils/markdownConverter';\n\n/**\n * Nettoie le contenu Markdown injectÃ© pour Ã©viter les dÃ©fauts d'affichage\n * - Supprime les astÃ©risques isolÃ©s (prÃ©serve **gras** et *italique*)\n * - Supprime les lignes vides excessives\n * @param {string} content - Le contenu Markdown Ã  nettoyer\n * @returns {string} - Le contenu nettoyÃ©\n */\nconst cleanIsolatedAsterisks = content => {\n  if (!content) return '';\n\n  // PrÃ©server temporairement les syntaxes Markdown valides\n  const preservedPatterns = [];\n  let tempContent = content;\n\n  // 1. PrÃ©server les gras (**texte**)\n  tempContent = tempContent.replace(/\\*\\*([^*]+)\\*\\*/g, match => {\n    const marker = `__BOLD_${preservedPatterns.length}__`;\n    preservedPatterns.push(match);\n    return marker;\n  });\n\n  // 2. PrÃ©server les italiques valides (*texte*)\n  tempContent = tempContent.replace(/\\*([^*\\s][^*]*[^*\\s])\\*/g, match => {\n    const marker = `__ITALIC_${preservedPatterns.length}__`;\n    preservedPatterns.push(match);\n    return marker;\n  });\n\n  // 3. Supprimer tous les astÃ©risques restants (isolÃ©s)\n  tempContent = tempContent.replace(/\\*/g, '');\n\n  // 4. Supprimer les lignes vides excessives (garder max 1 ligne vide entre les blocs)\n  tempContent = tempContent.replace(/\\n{3,}/g, '\\n\\n');\n\n  // 5. Supprimer les lignes vides en dÃ©but et fin\n  tempContent = tempContent.trim();\n\n  // 6. Restaurer les syntaxes Markdown prÃ©servÃ©es\n  tempContent = tempContent.replace(/__(?:BOLD|ITALIC)_(\\d+)__/g, (match, index) => {\n    return preservedPatterns[parseInt(index)] || '';\n  });\n  return tempContent;\n};\n\n/**\n * Hook pour l'intÃ©gration Eel (Python â†” JavaScript)\n * Expose les fonctions de lecture/Ã©criture du contenu Ã  Python\n * IMPORTANT: Python travaille TOUJOURS en format Markdown\n * \n * @param {string} content - Contenu actuel de l'Ã©diteur\n * @param {function} setContent - Fonction pour modifier le contenu\n * @param {string} viewMode - Mode de vue actuel ('wysiwyg', 'html', 'markdown')\n */\nexport const useEelBridge = (content, setContent, viewMode) => {\n  _s();\n  // DÃ©tecter si Eel est disponible (mode desktop)\n  const isEelAvailable = typeof window !== 'undefined' && typeof window.eel !== 'undefined';\n\n  // Exposer l'Ã©tat desktop globalement pour les autres composants\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      window.isDesktopMode = isEelAvailable;\n    }\n  }, [isEelAvailable]);\n  useEffect(() => {\n    if (isEelAvailable) {\n      console.log('ðŸ”— Initialisation du pont Eel...');\n\n      // Fonction pour lire le contenu Markdown actuel\n      // TOUJOURS retourner du Markdown, peu importe la vue active\n      window.readMarkdown = function () {\n        console.log('ðŸ“– Python demande le contenu Markdown');\n        if (!content) return '';\n\n        // Si on est en vue Markdown ou si le contenu est dÃ©jÃ  du Markdown\n        if (viewMode === 'markdown' || isMarkdownContent(content)) {\n          console.log('âœ… Contenu dÃ©jÃ  en Markdown');\n          return content;\n        }\n\n        // Sinon, convertir HTML vers Markdown\n        console.log('ðŸ”„ Conversion HTML â†’ Markdown pour Python');\n        const markdownContent = htmlToMarkdown(content);\n        return markdownContent;\n      };\n\n      // Fonction pour Ã©crire du contenu Markdown\n      // Python envoie TOUJOURS du Markdown, on adapte selon la vue active\n      window.writeMarkdown = function (newContent) {\n        console.log('âœï¸ Python injecte du contenu Markdown:', newContent.substring(0, 50) + '...');\n        if (!setContent || typeof setContent !== 'function') {\n          console.warn('âš ï¸ setContent non disponible');\n          return false;\n        }\n\n        // Nettoyer les astÃ©risques isolÃ©s du contenu injectÃ©\n        const cleanedContent = cleanIsolatedAsterisks(newContent);\n        console.log('ðŸ§¹ Nettoyage des astÃ©risques isolÃ©s effectuÃ©');\n\n        // Forcer la perte de focus pour permettre la mise Ã  jour (Ã©vite les blocages)\n        const activeElement = document.activeElement;\n        if (activeElement && activeElement.blur) {\n          activeElement.blur();\n        }\n\n        // Si on est en vue Markdown, injecter directement\n        if (viewMode === 'markdown') {\n          console.log('âœ… Injection directe en vue Markdown');\n          setContent(cleanedContent);\n          // Restaurer le focus aprÃ¨s injection\n          setTimeout(() => {\n            const editorElement = document.querySelector('.editor-content');\n            if (editorElement) {\n              editorElement.focus();\n            }\n          }, 50);\n          return true;\n        }\n\n        // Sinon, convertir Markdown vers HTML pour les vues WYSIWYG/HTML\n        console.log('ðŸ”„ Conversion Markdown â†’ HTML pour vue', viewMode);\n        const htmlContent = markdownToHtml(cleanedContent);\n        setContent(htmlContent);\n\n        // Forcer la mise Ã  jour du DOM de l'Ã©diteur WYSIWYG\n        setTimeout(() => {\n          const editorElement = document.querySelector('.editor-content');\n          if (editorElement && viewMode === 'wysiwyg') {\n            // Mise Ã  jour explicite du contenu WYSIWYG\n            editorElement.innerHTML = htmlContent;\n            console.log('ðŸ”„ Mise Ã  jour forcÃ©e du DOM WYSIWYG');\n\n            // DÃ©clencher un Ã©vÃ©nement input pour synchroniser l'Ã©tat React\n            const inputEvent = new Event('input', {\n              bubbles: true\n            });\n            editorElement.dispatchEvent(inputEvent);\n\n            // Restaurer le focus\n            editorElement.focus();\n          } else if (editorElement) {\n            editorElement.focus();\n          }\n        }, 100);\n        return true;\n      };\n\n      // Exposer les fonctions Ã  Python\n      try {\n        window.eel.expose(window.readMarkdown, 'readMarkdown');\n        window.eel.expose(window.writeMarkdown, 'writeMarkdown');\n        console.log('âœ… Fonctions exposÃ©es Ã  Python : readMarkdown, writeMarkdown');\n      } catch (error) {\n        console.warn('âš ï¸ Erreur exposition Eel:', error);\n      }\n    } else {\n      // Mode web normal - pas de logs pour Ã©viter la pollution\n    }\n  }, [content, setContent, viewMode]);\n\n  // Cleanup lors du dÃ©montage\n  useEffect(() => {\n    return () => {\n      if (typeof window !== 'undefined') {\n        delete window.readMarkdown;\n        delete window.writeMarkdown;\n      }\n    };\n  }, []);\n};\n_s(useEelBridge, \"ewq31d5h+FnD/qJW52w5UqeNMN4=\");","map":{"version":3,"names":["useEffect","htmlToMarkdown","markdownToHtml","isMarkdownContent","cleanIsolatedAsterisks","content","preservedPatterns","tempContent","replace","match","marker","length","push","trim","index","parseInt","useEelBridge","setContent","viewMode","_s","isEelAvailable","window","eel","isDesktopMode","console","log","readMarkdown","markdownContent","writeMarkdown","newContent","substring","warn","cleanedContent","activeElement","document","blur","setTimeout","editorElement","querySelector","focus","htmlContent","innerHTML","inputEvent","Event","bubbles","dispatchEvent","expose","error"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/hooks/useEelBridge.js"],"sourcesContent":["import { useEffect } from 'react';\nimport { htmlToMarkdown, markdownToHtml, isMarkdownContent } from '../utils/markdownConverter';\n\n/**\n * Nettoie le contenu Markdown injectÃ© pour Ã©viter les dÃ©fauts d'affichage\n * - Supprime les astÃ©risques isolÃ©s (prÃ©serve **gras** et *italique*)\n * - Supprime les lignes vides excessives\n * @param {string} content - Le contenu Markdown Ã  nettoyer\n * @returns {string} - Le contenu nettoyÃ©\n */\nconst cleanIsolatedAsterisks = (content) => {\n  if (!content) return '';\n  \n  // PrÃ©server temporairement les syntaxes Markdown valides\n  const preservedPatterns = [];\n  let tempContent = content;\n  \n  // 1. PrÃ©server les gras (**texte**)\n  tempContent = tempContent.replace(/\\*\\*([^*]+)\\*\\*/g, (match) => {\n    const marker = `__BOLD_${preservedPatterns.length}__`;\n    preservedPatterns.push(match);\n    return marker;\n  });\n  \n  // 2. PrÃ©server les italiques valides (*texte*)\n  tempContent = tempContent.replace(/\\*([^*\\s][^*]*[^*\\s])\\*/g, (match) => {\n    const marker = `__ITALIC_${preservedPatterns.length}__`;\n    preservedPatterns.push(match);\n    return marker;\n  });\n  \n  // 3. Supprimer tous les astÃ©risques restants (isolÃ©s)\n  tempContent = tempContent.replace(/\\*/g, '');\n  \n  // 4. Supprimer les lignes vides excessives (garder max 1 ligne vide entre les blocs)\n  tempContent = tempContent.replace(/\\n{3,}/g, '\\n\\n');\n  \n  // 5. Supprimer les lignes vides en dÃ©but et fin\n  tempContent = tempContent.trim();\n  \n  // 6. Restaurer les syntaxes Markdown prÃ©servÃ©es\n  tempContent = tempContent.replace(/__(?:BOLD|ITALIC)_(\\d+)__/g, (match, index) => {\n    return preservedPatterns[parseInt(index)] || '';\n  });\n  \n  return tempContent;\n};\n\n/**\n * Hook pour l'intÃ©gration Eel (Python â†” JavaScript)\n * Expose les fonctions de lecture/Ã©criture du contenu Ã  Python\n * IMPORTANT: Python travaille TOUJOURS en format Markdown\n * \n * @param {string} content - Contenu actuel de l'Ã©diteur\n * @param {function} setContent - Fonction pour modifier le contenu\n * @param {string} viewMode - Mode de vue actuel ('wysiwyg', 'html', 'markdown')\n */\nexport const useEelBridge = (content, setContent, viewMode) => {\n  // DÃ©tecter si Eel est disponible (mode desktop)\n  const isEelAvailable = typeof window !== 'undefined' && typeof window.eel !== 'undefined';\n\n  // Exposer l'Ã©tat desktop globalement pour les autres composants\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      window.isDesktopMode = isEelAvailable;\n    }\n  }, [isEelAvailable]);\n\n  useEffect(() => {\n    if (isEelAvailable) {\n      console.log('ðŸ”— Initialisation du pont Eel...');\n      \n      // Fonction pour lire le contenu Markdown actuel\n      // TOUJOURS retourner du Markdown, peu importe la vue active\n      window.readMarkdown = function() {\n        console.log('ðŸ“– Python demande le contenu Markdown');\n        \n        if (!content) return '';\n        \n        // Si on est en vue Markdown ou si le contenu est dÃ©jÃ  du Markdown\n        if (viewMode === 'markdown' || isMarkdownContent(content)) {\n          console.log('âœ… Contenu dÃ©jÃ  en Markdown');\n          return content;\n        }\n        \n        // Sinon, convertir HTML vers Markdown\n        console.log('ðŸ”„ Conversion HTML â†’ Markdown pour Python');\n        const markdownContent = htmlToMarkdown(content);\n        return markdownContent;\n      };\n      \n      // Fonction pour Ã©crire du contenu Markdown\n      // Python envoie TOUJOURS du Markdown, on adapte selon la vue active\n      window.writeMarkdown = function(newContent) {\n        console.log('âœï¸ Python injecte du contenu Markdown:', newContent.substring(0, 50) + '...');\n        \n        if (!setContent || typeof setContent !== 'function') {\n          console.warn('âš ï¸ setContent non disponible');\n          return false;\n        }\n        \n        // Nettoyer les astÃ©risques isolÃ©s du contenu injectÃ©\n        const cleanedContent = cleanIsolatedAsterisks(newContent);\n        console.log('ðŸ§¹ Nettoyage des astÃ©risques isolÃ©s effectuÃ©');\n        \n        // Forcer la perte de focus pour permettre la mise Ã  jour (Ã©vite les blocages)\n        const activeElement = document.activeElement;\n        if (activeElement && activeElement.blur) {\n          activeElement.blur();\n        }\n        \n        // Si on est en vue Markdown, injecter directement\n        if (viewMode === 'markdown') {\n          console.log('âœ… Injection directe en vue Markdown');\n          setContent(cleanedContent);\n          // Restaurer le focus aprÃ¨s injection\n          setTimeout(() => {\n            const editorElement = document.querySelector('.editor-content');\n            if (editorElement) {\n              editorElement.focus();\n            }\n          }, 50);\n          return true;\n        }\n        \n        // Sinon, convertir Markdown vers HTML pour les vues WYSIWYG/HTML\n        console.log('ðŸ”„ Conversion Markdown â†’ HTML pour vue', viewMode);\n        const htmlContent = markdownToHtml(cleanedContent);\n        setContent(htmlContent);\n        \n        // Forcer la mise Ã  jour du DOM de l'Ã©diteur WYSIWYG\n        setTimeout(() => {\n          const editorElement = document.querySelector('.editor-content');\n          if (editorElement && viewMode === 'wysiwyg') {\n            // Mise Ã  jour explicite du contenu WYSIWYG\n            editorElement.innerHTML = htmlContent;\n            console.log('ðŸ”„ Mise Ã  jour forcÃ©e du DOM WYSIWYG');\n            \n            // DÃ©clencher un Ã©vÃ©nement input pour synchroniser l'Ã©tat React\n            const inputEvent = new Event('input', { bubbles: true });\n            editorElement.dispatchEvent(inputEvent);\n            \n            // Restaurer le focus\n            editorElement.focus();\n          } else if (editorElement) {\n            editorElement.focus();\n          }\n        }, 100);\n        return true;\n      };\n      \n      // Exposer les fonctions Ã  Python\n      try {\n        window.eel.expose(window.readMarkdown, 'readMarkdown');\n        window.eel.expose(window.writeMarkdown, 'writeMarkdown');\n        console.log('âœ… Fonctions exposÃ©es Ã  Python : readMarkdown, writeMarkdown');\n      } catch (error) {\n        console.warn('âš ï¸ Erreur exposition Eel:', error);\n      }\n    } else {\n      // Mode web normal - pas de logs pour Ã©viter la pollution\n    }\n  }, [content, setContent, viewMode]);\n  \n  // Cleanup lors du dÃ©montage\n  useEffect(() => {\n    return () => {\n      if (typeof window !== 'undefined') {\n        delete window.readMarkdown;\n        delete window.writeMarkdown;\n      }\n    };\n  }, []);\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}