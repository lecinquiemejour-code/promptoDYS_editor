{"ast":null,"code":"import{useEffect}from'react';import{htmlToMarkdown,markdownToHtml,isMarkdownContent}from'../utils/markdownConverter';/**\n * Nettoie le contenu Markdown injectÃ© pour Ã©viter les dÃ©fauts d'affichage\n * - Supprime les astÃ©risques isolÃ©s (prÃ©serve **gras** et *italique*)\n * - Supprime les lignes vides excessives\n * @param {string} content - Le contenu Markdown Ã  nettoyer\n * @returns {string} - Le contenu nettoyÃ©\n */const cleanIsolatedAsterisks=content=>{if(!content)return'';// PrÃ©server temporairement les syntaxes Markdown valides\nconst preservedPatterns=[];let tempContent=content;// 1. PrÃ©server les gras (**texte**)\ntempContent=tempContent.replace(/\\*\\*([^*]+)\\*\\*/g,match=>{const marker=\"__BOLD_\".concat(preservedPatterns.length,\"__\");preservedPatterns.push(match);return marker;});// 2. PrÃ©server les italiques valides (*texte*)\ntempContent=tempContent.replace(/\\*([^*\\s][^*]*[^*\\s])\\*/g,match=>{const marker=\"__ITALIC_\".concat(preservedPatterns.length,\"__\");preservedPatterns.push(match);return marker;});// 3. Supprimer tous les astÃ©risques restants (isolÃ©s)\ntempContent=tempContent.replace(/\\*/g,'');// 4. Supprimer les lignes vides excessives (garder max 1 ligne vide entre les blocs)\ntempContent=tempContent.replace(/\\n{3,}/g,'\\n\\n');// 5. Supprimer les lignes vides en dÃ©but et fin\ntempContent=tempContent.trim();// 6. Restaurer les syntaxes Markdown prÃ©servÃ©es\ntempContent=tempContent.replace(/__(?:BOLD|ITALIC)_(\\d+)__/g,(match,index)=>{return preservedPatterns[parseInt(index)]||'';});return tempContent;};/**\n * Hook pour l'intÃ©gration Eel (Python â†” JavaScript)\n * Expose les fonctions de lecture/Ã©criture du contenu Ã  Python\n * IMPORTANT: Python travaille TOUJOURS en format Markdown\n * \n * @param {string} content - Contenu actuel de l'Ã©diteur\n * @param {function} setContent - Fonction pour modifier le contenu\n * @param {string} viewMode - Mode de vue actuel ('wysiwyg', 'html', 'markdown')\n */export const useEelBridge=(content,setContent,viewMode)=>{// DÃ©tecter si Eel est disponible (mode desktop)\nconst isEelAvailable=typeof window!=='undefined'&&typeof window.eel!=='undefined';// Exposer l'Ã©tat desktop globalement pour les autres composants\nuseEffect(()=>{if(typeof window!=='undefined'){window.isDesktopMode=isEelAvailable;}},[isEelAvailable]);useEffect(()=>{if(isEelAvailable){console.log('ðŸ”— Initialisation du pont Eel...');// Fonction pour lire le contenu Markdown actuel\n// TOUJOURS retourner du Markdown, peu importe la vue active\nwindow.readMarkdown=function(){console.log('ðŸ“– Python demande le contenu Markdown');if(!content)return'';// Si on est en vue Markdown ou si le contenu est dÃ©jÃ  du Markdown\nif(viewMode==='markdown'||isMarkdownContent(content)){console.log('âœ… Contenu dÃ©jÃ  en Markdown');return content;}// Sinon, convertir HTML vers Markdown\nconsole.log('ðŸ”„ Conversion HTML â†’ Markdown pour Python');const markdownContent=htmlToMarkdown(content);return markdownContent;};// Fonction pour Ã©crire du contenu Markdown\n// Python envoie TOUJOURS du Markdown, on adapte selon la vue active\nwindow.writeMarkdown=function(newContent){console.log('âœï¸ Python injecte du contenu Markdown:',newContent.substring(0,50)+'...');if(!setContent||typeof setContent!=='function'){console.warn('âš ï¸ setContent non disponible');return false;}// Nettoyer les astÃ©risques isolÃ©s du contenu injectÃ©\nconst cleanedContent=cleanIsolatedAsterisks(newContent);console.log('ðŸ§¹ Nettoyage des astÃ©risques isolÃ©s effectuÃ©');// Forcer la perte de focus pour permettre la mise Ã  jour (Ã©vite les blocages)\nconst activeElement=document.activeElement;if(activeElement&&activeElement.blur){activeElement.blur();}// Si on est en vue Markdown, injecter directement\nif(viewMode==='markdown'){console.log('âœ… Injection directe en vue Markdown');setContent(cleanedContent);// Restaurer le focus aprÃ¨s injection\nsetTimeout(()=>{const editorElement=document.querySelector('.editor-content');if(editorElement){editorElement.focus();}},50);return true;}// Sinon, convertir Markdown vers HTML pour les vues WYSIWYG/HTML\nconsole.log('ðŸ”„ Conversion Markdown â†’ HTML pour vue',viewMode);const htmlContent=markdownToHtml(cleanedContent);setContent(htmlContent);// Forcer la mise Ã  jour du DOM de l'Ã©diteur WYSIWYG\nsetTimeout(()=>{const editorElement=document.querySelector('.editor-content');if(editorElement&&viewMode==='wysiwyg'){// Mise Ã  jour explicite du contenu WYSIWYG\neditorElement.innerHTML=htmlContent;console.log('ðŸ”„ Mise Ã  jour forcÃ©e du DOM WYSIWYG');// DÃ©clencher un Ã©vÃ©nement input pour synchroniser l'Ã©tat React\nconst inputEvent=new Event('input',{bubbles:true});editorElement.dispatchEvent(inputEvent);// Restaurer le focus\neditorElement.focus();}else if(editorElement){editorElement.focus();}},100);return true;};// Exposer les fonctions Ã  Python\ntry{window.eel.expose(window.readMarkdown,'readMarkdown');window.eel.expose(window.writeMarkdown,'writeMarkdown');console.log('âœ… Fonctions exposÃ©es Ã  Python : readMarkdown, writeMarkdown');}catch(error){console.warn('âš ï¸ Erreur exposition Eel:',error);}}else{// Mode web normal - pas de logs pour Ã©viter la pollution\n}},[content,setContent,viewMode]);// Cleanup lors du dÃ©montage\nuseEffect(()=>{return()=>{if(typeof window!=='undefined'){delete window.readMarkdown;delete window.writeMarkdown;}};},[]);};","map":{"version":3,"names":["useEffect","htmlToMarkdown","markdownToHtml","isMarkdownContent","cleanIsolatedAsterisks","content","preservedPatterns","tempContent","replace","match","marker","concat","length","push","trim","index","parseInt","useEelBridge","setContent","viewMode","isEelAvailable","window","eel","isDesktopMode","console","log","readMarkdown","markdownContent","writeMarkdown","newContent","substring","warn","cleanedContent","activeElement","document","blur","setTimeout","editorElement","querySelector","focus","htmlContent","innerHTML","inputEvent","Event","bubbles","dispatchEvent","expose","error"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/hooks/useEelBridge.js"],"sourcesContent":["import { useEffect } from 'react';\nimport { htmlToMarkdown, markdownToHtml, isMarkdownContent } from '../utils/markdownConverter';\n\n/**\n * Nettoie le contenu Markdown injectÃ© pour Ã©viter les dÃ©fauts d'affichage\n * - Supprime les astÃ©risques isolÃ©s (prÃ©serve **gras** et *italique*)\n * - Supprime les lignes vides excessives\n * @param {string} content - Le contenu Markdown Ã  nettoyer\n * @returns {string} - Le contenu nettoyÃ©\n */\nconst cleanIsolatedAsterisks = (content) => {\n  if (!content) return '';\n  \n  // PrÃ©server temporairement les syntaxes Markdown valides\n  const preservedPatterns = [];\n  let tempContent = content;\n  \n  // 1. PrÃ©server les gras (**texte**)\n  tempContent = tempContent.replace(/\\*\\*([^*]+)\\*\\*/g, (match) => {\n    const marker = `__BOLD_${preservedPatterns.length}__`;\n    preservedPatterns.push(match);\n    return marker;\n  });\n  \n  // 2. PrÃ©server les italiques valides (*texte*)\n  tempContent = tempContent.replace(/\\*([^*\\s][^*]*[^*\\s])\\*/g, (match) => {\n    const marker = `__ITALIC_${preservedPatterns.length}__`;\n    preservedPatterns.push(match);\n    return marker;\n  });\n  \n  // 3. Supprimer tous les astÃ©risques restants (isolÃ©s)\n  tempContent = tempContent.replace(/\\*/g, '');\n  \n  // 4. Supprimer les lignes vides excessives (garder max 1 ligne vide entre les blocs)\n  tempContent = tempContent.replace(/\\n{3,}/g, '\\n\\n');\n  \n  // 5. Supprimer les lignes vides en dÃ©but et fin\n  tempContent = tempContent.trim();\n  \n  // 6. Restaurer les syntaxes Markdown prÃ©servÃ©es\n  tempContent = tempContent.replace(/__(?:BOLD|ITALIC)_(\\d+)__/g, (match, index) => {\n    return preservedPatterns[parseInt(index)] || '';\n  });\n  \n  return tempContent;\n};\n\n/**\n * Hook pour l'intÃ©gration Eel (Python â†” JavaScript)\n * Expose les fonctions de lecture/Ã©criture du contenu Ã  Python\n * IMPORTANT: Python travaille TOUJOURS en format Markdown\n * \n * @param {string} content - Contenu actuel de l'Ã©diteur\n * @param {function} setContent - Fonction pour modifier le contenu\n * @param {string} viewMode - Mode de vue actuel ('wysiwyg', 'html', 'markdown')\n */\nexport const useEelBridge = (content, setContent, viewMode) => {\n  // DÃ©tecter si Eel est disponible (mode desktop)\n  const isEelAvailable = typeof window !== 'undefined' && typeof window.eel !== 'undefined';\n\n  // Exposer l'Ã©tat desktop globalement pour les autres composants\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      window.isDesktopMode = isEelAvailable;\n    }\n  }, [isEelAvailable]);\n\n  useEffect(() => {\n    if (isEelAvailable) {\n      console.log('ðŸ”— Initialisation du pont Eel...');\n      \n      // Fonction pour lire le contenu Markdown actuel\n      // TOUJOURS retourner du Markdown, peu importe la vue active\n      window.readMarkdown = function() {\n        console.log('ðŸ“– Python demande le contenu Markdown');\n        \n        if (!content) return '';\n        \n        // Si on est en vue Markdown ou si le contenu est dÃ©jÃ  du Markdown\n        if (viewMode === 'markdown' || isMarkdownContent(content)) {\n          console.log('âœ… Contenu dÃ©jÃ  en Markdown');\n          return content;\n        }\n        \n        // Sinon, convertir HTML vers Markdown\n        console.log('ðŸ”„ Conversion HTML â†’ Markdown pour Python');\n        const markdownContent = htmlToMarkdown(content);\n        return markdownContent;\n      };\n      \n      // Fonction pour Ã©crire du contenu Markdown\n      // Python envoie TOUJOURS du Markdown, on adapte selon la vue active\n      window.writeMarkdown = function(newContent) {\n        console.log('âœï¸ Python injecte du contenu Markdown:', newContent.substring(0, 50) + '...');\n        \n        if (!setContent || typeof setContent !== 'function') {\n          console.warn('âš ï¸ setContent non disponible');\n          return false;\n        }\n        \n        // Nettoyer les astÃ©risques isolÃ©s du contenu injectÃ©\n        const cleanedContent = cleanIsolatedAsterisks(newContent);\n        console.log('ðŸ§¹ Nettoyage des astÃ©risques isolÃ©s effectuÃ©');\n        \n        // Forcer la perte de focus pour permettre la mise Ã  jour (Ã©vite les blocages)\n        const activeElement = document.activeElement;\n        if (activeElement && activeElement.blur) {\n          activeElement.blur();\n        }\n        \n        // Si on est en vue Markdown, injecter directement\n        if (viewMode === 'markdown') {\n          console.log('âœ… Injection directe en vue Markdown');\n          setContent(cleanedContent);\n          // Restaurer le focus aprÃ¨s injection\n          setTimeout(() => {\n            const editorElement = document.querySelector('.editor-content');\n            if (editorElement) {\n              editorElement.focus();\n            }\n          }, 50);\n          return true;\n        }\n        \n        // Sinon, convertir Markdown vers HTML pour les vues WYSIWYG/HTML\n        console.log('ðŸ”„ Conversion Markdown â†’ HTML pour vue', viewMode);\n        const htmlContent = markdownToHtml(cleanedContent);\n        setContent(htmlContent);\n        \n        // Forcer la mise Ã  jour du DOM de l'Ã©diteur WYSIWYG\n        setTimeout(() => {\n          const editorElement = document.querySelector('.editor-content');\n          if (editorElement && viewMode === 'wysiwyg') {\n            // Mise Ã  jour explicite du contenu WYSIWYG\n            editorElement.innerHTML = htmlContent;\n            console.log('ðŸ”„ Mise Ã  jour forcÃ©e du DOM WYSIWYG');\n            \n            // DÃ©clencher un Ã©vÃ©nement input pour synchroniser l'Ã©tat React\n            const inputEvent = new Event('input', { bubbles: true });\n            editorElement.dispatchEvent(inputEvent);\n            \n            // Restaurer le focus\n            editorElement.focus();\n          } else if (editorElement) {\n            editorElement.focus();\n          }\n        }, 100);\n        return true;\n      };\n      \n      // Exposer les fonctions Ã  Python\n      try {\n        window.eel.expose(window.readMarkdown, 'readMarkdown');\n        window.eel.expose(window.writeMarkdown, 'writeMarkdown');\n        console.log('âœ… Fonctions exposÃ©es Ã  Python : readMarkdown, writeMarkdown');\n      } catch (error) {\n        console.warn('âš ï¸ Erreur exposition Eel:', error);\n      }\n    } else {\n      // Mode web normal - pas de logs pour Ã©viter la pollution\n    }\n  }, [content, setContent, viewMode]);\n  \n  // Cleanup lors du dÃ©montage\n  useEffect(() => {\n    return () => {\n      if (typeof window !== 'undefined') {\n        delete window.readMarkdown;\n        delete window.writeMarkdown;\n      }\n    };\n  }, []);\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}