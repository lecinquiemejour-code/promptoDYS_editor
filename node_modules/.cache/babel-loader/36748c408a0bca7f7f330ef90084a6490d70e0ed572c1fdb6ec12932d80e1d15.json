{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\JEAN-NOELLEFEBVRE-SA\\\\CascadeProjects\\\\editor\\\\src\\\\components\\\\Editor.js\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect, useRef, forwardRef } from 'react';\nimport { convertAllPromptoDysUrlsToBlobs, getCurrentProject } from '../utils/promptoDysManager';\nimport { loadImage, saveImage, requestPersistentStorage } from '../utils/imageStore';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Editor = /*#__PURE__*/_s(/*#__PURE__*/forwardRef(_c = _s(({\n  content,\n  setContent,\n  viewMode,\n  onInput,\n  currentFormat,\n  onFormatChange,\n  mathJaxReady,\n  ignoreSelectionChangeRef,\n  selectedImage,\n  onImageClick,\n  onEditorClick,\n  onDeleteSelectedImage,\n  onSelectionChange,\n  storeBlobForUrl,\n  editorRef\n}, ref) => {\n  _s();\n  // Utilise editorRef pass√©e en props (pas de ref locale)\n  const isInitializedRef = useRef(false);\n  const previousContentRef = useRef('');\n\n  // Fonction pour cr√©er des blobs uniques (mutualisation avec Toolbar)\n  const createUniqueBlob = useCallback((file, storeBlobForUrl) => {\n    const uniqueId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    const uniqueName = `${uniqueId}_${file.name}`;\n    const uniqueFile = new File([file], uniqueName, {\n      type: file.type\n    });\n    const blobUrl = URL.createObjectURL(uniqueFile);\n    console.log('üéØ [createUniqueBlob] Cr√©ation blob unique:', uniqueName, '->', blobUrl);\n    storeBlobForUrl(blobUrl, uniqueFile);\n    return {\n      blobUrl,\n      uniqueFile\n    };\n  }, []);\n\n  // Fonction de v√©rification force de la persistance des images\n  const forceVerifyImagePersistence = useCallback(async container => {\n    console.log('üîç [forceVerify] V√©rification persistance images...');\n    const imagesWithId = container.querySelectorAll('img[data-image-id]');\n    console.log(`üîç [forceVerify] ${imagesWithId.length} images avec data-image-id trouv√©es`);\n    for (const img of imagesWithId) {\n      const imageId = img.getAttribute('data-image-id');\n      try {\n        const blob = await loadImage(imageId);\n        if (blob) {\n          console.log(`‚úÖ [forceVerify] Image ${imageId} OK en IndexedDB (${Math.round(blob.size / 1024)}KB)`);\n        } else {\n          console.error(`‚ùå [forceVerify] Image ${imageId} MANQUANTE en IndexedDB`);\n          // Re-sauvegarder depuis l'URL actuelle si possible\n          if (img.src.startsWith('blob:')) {\n            try {\n              const response = await fetch(img.src);\n              const newBlob = await response.blob();\n              await saveImage(imageId, newBlob);\n              console.log(`üîÑ [forceVerify] Re-sauvegarde OK pour ${imageId}`);\n            } catch (error) {\n              console.error(`‚ùå [forceVerify] √âchec re-sauvegarde ${imageId}:`, error);\n            }\n          }\n        }\n      } catch (error) {\n        console.error(` [forceVerify] Erreur v√©rification ${imageId}:`, error);\n      }\n    }\n  }, []);\n\n  // Fonction de r√©hydratation des images depuis IndexedDB\n  const rehydrateImages = useCallback(async container => {\n    console.log(' [rehydrateImages] D√©but r√©hydratation des images...');\n    if (!container) {\n      console.warn(' [rehydrateImages] Pas de conteneur fourni');\n      return;\n    }\n\n    // Trouver toutes les images avec data-image-id\n    const images = container.querySelectorAll('img[data-image-id]');\n    console.log(` [rehydrateImages] ${images.length} images avec data-image-id trouv√©es`);\n\n    // Traiter chaque image\n    for (const img of images) {\n      const imageId = img.getAttribute('data-image-id');\n      console.log(' [rehydrateImages] Traitement image:', imageId);\n      try {\n        // Charger l'image depuis IndexedDB\n        const objectUrl = await loadImage(imageId);\n        if (objectUrl) {\n          // Conserver les attributs existants\n          const width = img.getAttribute('width');\n          const height = img.getAttribute('height');\n          const alt = img.getAttribute('alt') || '';\n          console.log(' [rehydrateImages] Image charg√©e:', {\n            imageId,\n            oldSrc: img.src,\n            newSrc: objectUrl,\n            width,\n            height,\n            alt\n          });\n\n          // Mettre √† jour la source\n          img.src = objectUrl;\n          console.log(' [rehydrateImages] Image r√©hydrat√©e avec succ√®s:', imageId);\n        } else {\n          console.warn(' [rehydrateImages] Image non trouv√©e en IndexedDB:', imageId);\n          // On garde l'image avec son data-image-id pour un essai ult√©rieur\n        }\n      } catch (error) {\n        console.error(' [rehydrateImages] Erreur r√©hydratation:', imageId, error);\n      }\n    }\n    console.log(' [rehydrateImages] R√©hydratation termin√©e');\n  }, []);\n\n  // Fonction mutualis√©e pour traiter les images coll√©es et les rendre uniques\n  const processImageBlobs = useCallback(async (container, storeBlobForUrl) => {\n    console.log(' [processImageBlobs] Traitement des images...');\n\n    // Traiter les images blob: temporaires\n    const blobImages = container.querySelectorAll('img[src^=\"blob:\"]');\n    console.log('üîç [processImageBlobs] Images blob trouv√©es:', blobImages.length);\n    for (const img of blobImages) {\n      const originalUrl = img.src;\n      try {\n        console.log('üì• [processImageBlobs] Traitement blob:', originalUrl);\n\n        // R√©cup√©rer le blob original\n        const response = await fetch(originalUrl);\n        const blob = await response.blob();\n\n        // Cr√©er un nouveau File avec un nom unique\n        const file = new File([blob], 'pasted-image.png', {\n          type: blob.type\n        });\n        const {\n          blobUrl\n        } = createUniqueBlob(file, storeBlobForUrl);\n\n        // Remplacer l'URL dans l'image\n        img.src = blobUrl;\n        console.log('‚úÖ [processImageBlobs] Image blob mise √† jour:', originalUrl, '->', blobUrl);\n      } catch (error) {\n        console.error('‚ùå [processImageBlobs] Erreur blob pour:', originalUrl, error);\n      }\n    }\n\n    // Traiter les images base64 coll√©es (copie d'√©cran Windows)\n    const base64Images = container.querySelectorAll('img[src^=\"data:image/\"]');\n    console.log('üîç [processImageBlobs] Images base64 trouv√©es:', base64Images.length);\n    for (const img of base64Images) {\n      const dataUrl = img.src;\n      try {\n        console.log('üì• [processImageBlobs] Traitement base64 (longueur:', dataUrl.length, 'chars)');\n\n        // Convertir data URL en blob\n        const response = await fetch(dataUrl);\n        const blob = await response.blob();\n\n        // G√©n√©rer nom de fichier unique\n        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n        const filename = `pasted-screenshot-${timestamp}.png`;\n\n        // G√©n√©rer ID unique et stocker dans IndexedDB\n        const imageId = crypto.randomUUID();\n        await saveImage(imageId, blob);\n\n        // Cr√©er blob URL temporaire pour affichage\n        const blobUrl = URL.createObjectURL(blob);\n\n        // Stocker le mapping URL->File pour compatibilit√©\n        const file = new File([blob], filename, {\n          type: blob.type\n        });\n        if (storeBlobForUrl) {\n          storeBlobForUrl(blobUrl, file);\n        }\n\n        // Remplacer l'image base64 par blob + data-image-id\n        img.src = blobUrl;\n        img.setAttribute('data-image-id', imageId);\n        img.setAttribute('alt', filename);\n        console.log(' [processImageBlobs] Image base64 convertie:', dataUrl.substring(0, 50) + '...', '->', blobUrl, 'ID:', imageId);\n      } catch (error) {\n        console.error(' [processImageBlobs] Erreur base64 pour:', dataUrl.substring(0, 50), error);\n      }\n    }\n\n    // OPTION B: Force v√©rification + double check apr√®s processus\n    console.log(' [processImageBlobs] OPTION B - Force v√©rification persistance...');\n    await forceVerifyImagePersistence(container);\n\n    // Double r√©hydratation apr√®s 500ms\n    setTimeout(async () => {\n      console.log(' [processImageBlobs] OPTION B - Double r√©hydratation...');\n      await rehydrateImages(container);\n    }, 500);\n    console.log(' [processImageBlobs] Traitement termin√©');\n  }, [forceVerifyImagePersistence, rehydrateImages, createUniqueBlob]);\n\n  // Fonction de migration des anciennes images blob: vers IndexedDB\n  const migrateOldBlobImages = useCallback(async container => {\n    console.log(' [migrateOldBlobImages] D√©but migration des anciennes images...');\n    if (!container) {\n      console.warn('‚ö†Ô∏è [migrateOldBlobImages] Pas de conteneur fourni');\n      return;\n    }\n\n    // Trouver toutes les images avec src blob: SANS data-image-id (anciennes)\n    const oldImages = container.querySelectorAll('img[src^=\"blob:\"]:not([data-image-id])');\n    console.log(`üîç [migrateOldBlobImages] ${oldImages.length} anciennes images blob trouv√©es`);\n    if (oldImages.length === 0) {\n      console.log('‚úÖ [migrateOldBlobImages] Aucune migration n√©cessaire');\n      return;\n    }\n\n    // Traiter chaque ancienne image\n    for (const img of oldImages) {\n      const oldBlobUrl = img.src;\n      console.log('üîÑ [migrateOldBlobImages] Migration image:', oldBlobUrl);\n      try {\n        // R√©cup√©rer le blob depuis l'URL\n        const response = await fetch(oldBlobUrl);\n        if (!response.ok) {\n          console.warn('‚ö†Ô∏è [migrateOldBlobImages] Impossible de r√©cup√©rer le blob:', response.status);\n          continue;\n        }\n        const blob = await response.blob();\n        console.log('üì¶ [migrateOldBlobImages] Blob r√©cup√©r√©:', {\n          size: `${Math.round(blob.size / 1024)}KB`,\n          type: blob.type\n        });\n\n        // Cr√©er un File pour saveImage()\n        const fileName = img.alt || `migrated_image_${Date.now()}.png`;\n        const file = new File([blob], fileName, {\n          type: blob.type\n        });\n\n        // G√©n√©rer UUID et sauvegarder en IndexedDB\n        const imageId = crypto.randomUUID();\n        await saveImage(imageId, file);\n        console.log('üíæ [migrateOldBlobImages] Image migr√©e vers IndexedDB:', imageId);\n\n        // Mettre √† jour l'√©l√©ment img avec data-image-id\n        img.setAttribute('data-image-id', imageId);\n\n        // Cr√©er nouvelle Object URL\n        const newObjectUrl = URL.createObjectURL(blob);\n        img.src = newObjectUrl;\n\n        // R√©voquer l'ancienne URL si possible\n        try {\n          URL.revokeObjectURL(oldBlobUrl);\n          console.log('üßπ [migrateOldBlobImages] Ancienne URL r√©voqu√©e:', oldBlobUrl);\n        } catch (revokeError) {\n          console.warn('‚ö†Ô∏è [migrateOldBlobImages] Impossible de r√©voquer ancienne URL:', revokeError);\n        }\n        console.log('‚úÖ [migrateOldBlobImages] Image migr√©e avec succ√®s:', {\n          oldUrl: oldBlobUrl,\n          newImageId: imageId,\n          fileName\n        });\n      } catch (error) {\n        console.error('‚ùå [migrateOldBlobImages] Erreur migration:', oldBlobUrl, error);\n        // On garde l'ancienne image m√™me en cas d'erreur\n      }\n    }\n    console.log('‚úÖ [migrateOldBlobImages] Migration termin√©e');\n\n    // D√©clencher une sauvegarde du contenu apr√®s migration\n    if (onInput && container.innerHTML) {\n      console.log('üíæ [migrateOldBlobImages] D√©clenchement sauvegarde apr√®s migration...');\n      const event = new Event('input', {\n        bubbles: true\n      });\n      container.dispatchEvent(event);\n    }\n  }, [onInput]);\n\n  // Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\n  const handleTextareaResize = useCallback(textarea => {\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.max(384, textarea.scrollHeight) + 'px';\n    }\n  }, []);\n\n  // Effect pour la r√©hydratation des images au chargement\n  useEffect(() => {\n    console.log(' [Editor] Effect r√©hydratation - Chargement initial');\n    const initImageSystem = async () => {\n      console.log(' [Editor] Demande stockage persistant...');\n      // Demander le stockage persistant\n      await requestPersistentStorage();\n\n      // R√©hydrater les images si l'√©diteur est pr√™t\n      if (editorRef.current) {\n        console.log(' [Editor] D√©clenchement r√©hydratation...');\n        await rehydrateImages(editorRef.current);\n        console.log(' [Editor] D√©clenchement migration anciennes images...');\n        await migrateOldBlobImages(editorRef.current);\n      } else {\n        console.warn(' [Editor] editorRef pas encore pr√™t pour r√©hydratation');\n      }\n    };\n    initImageSystem();\n  }, [rehydrateImages, migrateOldBlobImages]);\n\n  // Effect pour r√©hydrater quand le contenu change (nouveau document charg√©)\n  useEffect(() => {\n    if (content && content !== previousContentRef.current && editorRef.current) {\n      console.log(' [Editor] Contenu chang√© - V√©rification r√©hydratation...');\n      previousContentRef.current = content;\n\n      // D√©lai pour laisser le DOM se mettre √† jour (plus long en production)\n      const rehydrationDelay = process.env.NODE_ENV === 'production' ? 1000 : 100;\n      console.log(` [Editor] D√©lai r√©hydratation: ${rehydrationDelay}ms (env: ${process.env.NODE_ENV})`);\n      setTimeout(async () => {\n        await rehydrateImages(editorRef.current);\n        await migrateOldBlobImages(editorRef.current);\n      }, rehydrationDelay);\n    }\n  }, [content, rehydrateImages, migrateOldBlobImages]);\n\n  // Fonction pour formater le HTML avec des retours √† la ligne et indentation\n  const formatHtmlForSource = useCallback(html => {\n    let indentLevel = 0;\n    const indentSize = 2; // 2 espaces par niveau\n\n    return html.replace(/<br\\s*\\/?>/gi, '<br>\\n').replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi, match => {\n      if (match.startsWith('</')) {\n        // Balise fermante : diminuer l'indentation puis ajouter la balise\n        indentLevel = Math.max(0, indentLevel - 1);\n        return match + '\\n';\n      } else {\n        // Balise ouvrante : ajouter la balise puis augmenter l'indentation\n        const result = '\\n' + ' '.repeat(indentLevel * indentSize) + match;\n        // Augmenter l'indentation pour les balises conteneurs\n        if (match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)) {\n          indentLevel++;\n        }\n        return result;\n      }\n    }).split('\\n').map((line, index) => {\n      if (index === 0) return line.trim(); // Premi√®re ligne sans indentation\n      if (line.trim() === '') return ''; // Ligne vide\n      if (line.trim().startsWith('</')) {\n        // Balise fermante : r√©duire l'indentation\n        const currentIndent = Math.max(0, indentLevel - 1);\n        return ' '.repeat(currentIndent * indentSize) + line.trim();\n      }\n      // Contenu texte : utiliser l'indentation actuelle\n      return line.startsWith(' ') ? line : ' '.repeat(indentLevel * indentSize) + line.trim();\n    }).join('\\n').replace(/^\\n+/, '') // Supprimer les retours √† la ligne en d√©but\n    .replace(/\\n{2,}/g, '\\n') // Supprimer toutes les lignes vides multiples\n    .trim();\n  }, []);\n\n  // Gestionnaire unifi√© WYSIWYG - connect√© directement √† onInput\n  const handleWysiwygChange = useCallback(e => {\n    console.log('üìù handleWysiwygChange d√©clench√©');\n    if (!editorRef.current) return;\n\n    // Nettoyer les spans vides et les &nbsp; en trop\n    const cleanContent = html => {\n      return html.replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g, '') // Supprimer spans vides SAUF les spans color√©s\n      .replace(/(&nbsp;\\s*){2,}/g, '&nbsp;') // R√©duire les &nbsp; multiples\n      .replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g, '<span style=\"color: $1;\">$2</span>') // Convertir font en span\n      .replace(/<b\\b[^>]*>(.*?)<\\/b>/g, '<strong>$1</strong>') // Convertir b en strong\n      .replace(/<i\\b[^>]*>(.*?)<\\/i>/g, '<em>$1</em>'); // Convertir i en em\n    };\n    const newContent = cleanContent(editorRef.current.innerHTML);\n    console.log('üîç Contenu actuel vs nouveau:', content.length, 'vs', newContent.length);\n\n    // Appel direct vers onInput du hook useEditor\n    if (newContent !== content) {\n      console.log('‚úÖ WYSIWYG Changement - Appel onInput direct');\n      onInput({\n        target: {\n          innerHTML: newContent\n        }\n      });\n    }\n\n    // D√©clencher mise √† jour du formatage apr√®s un d√©lai\n    if (onSelectionChange && !(ignoreSelectionChangeRef !== null && ignoreSelectionChangeRef !== void 0 && ignoreSelectionChangeRef.current)) {\n      console.log('üîÑ EDITOR handleWysiwygChange - Va appeler onSelectionChange dans 50ms');\n      setTimeout(onSelectionChange, 50);\n    } else {\n      console.log('‚ùå EDITOR handleWysiwygChange - onSelectionChange BLOQU√â - ignoreFlag:', ignoreSelectionChangeRef === null || ignoreSelectionChangeRef === void 0 ? void 0 : ignoreSelectionChangeRef.current);\n    }\n  }, [content, onInput, onSelectionChange]);\n\n  // Gestionnaire pour les √©v√©nements de s√©lection/curseur\n  const handleSelectionChange = useCallback(() => {\n    console.log('üìç EDITOR handleSelectionChange - ignoreFlag:', ignoreSelectionChangeRef === null || ignoreSelectionChangeRef === void 0 ? void 0 : ignoreSelectionChangeRef.current);\n    if (ignoreSelectionChangeRef !== null && ignoreSelectionChangeRef !== void 0 && ignoreSelectionChangeRef.current) {\n      console.log('‚ùå EDITOR handleSelectionChange - BLOQU√â par ignoreFlag');\n      return;\n    }\n    if (viewMode === 'wysiwyg' && document.activeElement === editorRef.current) {\n      console.log('‚úÖ EDITOR handleSelectionChange - VA APPELER onSelectionChange');\n      onSelectionChange();\n    } else {\n      console.log('‚ö†Ô∏è EDITOR handleSelectionChange - SKIP conditions');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, onSelectionChange, ignoreSelectionChangeRef]);\n\n  // Initialiser le contenu uniquement si n√©cessaire\n  useEffect(() => {\n    const initializeContent = async () => {\n      if (viewMode === 'wysiwyg' && editorRef.current && editorRef.current.innerHTML !== content) {\n        // Ne pas modifier le contenu si l'utilisateur interagit activement\n        const hasFocus = document.activeElement === editorRef.current;\n        const hasSelection = window.getSelection().rangeCount > 0;\n\n        // √âviter les mises √† jour pendant l'interaction utilisateur\n        if (hasFocus && hasSelection) {\n          return; // Ne pas perturber l'utilisateur\n        }\n\n        // Convertir les URLs relatives PromptoDYS en Blob URLs pour affichage\n        const currentProject = getCurrentProject();\n        let displayContent = content;\n        if (currentProject.directory) {\n          displayContent = await convertAllPromptoDysUrlsToBlobs(content, currentProject.directory);\n        }\n\n        // Mise √† jour avec le contenu converti\n        editorRef.current.innerHTML = displayContent;\n\n        // Re-rendre MathJax apr√®s mise √† jour du contenu\n        if (window.MathJax && window.MathJax.typesetPromise) {\n          window.MathJax.typesetPromise([editorRef.current]).catch(err => {\n            console.warn('Erreur MathJax:', err);\n          });\n        }\n\n        // SOLUTION F5: Forcer le retraitement des poign√©es apr√®s initialisation\n        setTimeout(() => {\n          var _editorRef$current, _editorRef$current2;\n          console.log('üîÑ [F5 Fix] Retraitement forc√© des poign√©es d\\'images apr√®s initialisation');\n          const images = (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : _editorRef$current.querySelectorAll('img');\n          if (images && (_editorRef$current2 = editorRef.current) !== null && _editorRef$current2 !== void 0 && _editorRef$current2.addResizeHandlesToImage) {\n            images.forEach(img => {\n              // Retirer le marqueur data-resizable pour forcer le retraitement\n              img.removeAttribute('data-resizable');\n              // Retirer le wrapper s'il existe d√©j√†\n              const existingWrapper = img.closest('.resizable-image');\n              if (existingWrapper) {\n                const parent = existingWrapper.parentNode;\n                parent.insertBefore(img, existingWrapper);\n                existingWrapper.remove();\n              }\n              // Retraiter l'image\n              editorRef.current.addResizeHandlesToImage(img);\n            });\n            console.log('‚úÖ [F5 Fix] Poign√©es retrait√©es pour', images.length, 'image(s)');\n          }\n        }, 300); // D√©lai pour s'assurer que tout est bien initialis√©\n      }\n    };\n    initializeContent();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, content]);\n\n  // Gestionnaire pour la copie - convertir HTML en texte propre et g√©rer les images s√©lectionn√©es\n  const handleCopy = useCallback(e => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Priorit√© 1: Si une image est s√©lectionn√©e, copier l'image\n      if (selectedImage) {\n        try {\n          // Cr√©er un √©l√©ment temporaire avec l'image\n          const tempDiv = document.createElement('div');\n          const clonedImg = selectedImage.cloneNode(true);\n          tempDiv.appendChild(clonedImg);\n\n          // Copier au format HTML pour pr√©server la structure\n          e.clipboardData.setData('text/html', tempDiv.innerHTML);\n          // Copier aussi le src comme texte de fallback\n          e.clipboardData.setData('text/plain', selectedImage.src);\n          e.preventDefault();\n          return;\n        } catch (error) {\n          console.warn('Erreur copie image:', error);\n        }\n      }\n\n      // Priorit√© 2: S√©lection de texte classique\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const selectedContent = range.cloneContents();\n        const tempDiv = document.createElement('div');\n        tempDiv.appendChild(selectedContent);\n\n        // Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\n        const htmlContent = tempDiv.innerHTML;\n        const textContent = htmlContent.replace(/<div[^>]*>/gi, '').replace(/<\\/div>/gi, '\\n').replace(/<br\\s*\\/?>/gi, '\\n').replace(/<p[^>]*>/gi, '').replace(/<\\/p>/gi, '\\n').replace(/<[^>]+>/g, '') // Supprimer toutes les autres balises\n        .replace(/&nbsp;/g, ' ').replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&#39;/g, \"'\").replace(/\\n+$/, ''); // Supprimer les retours √† la ligne en fin\n\n        // Mettre le texte propre dans le presse-papier\n        e.clipboardData.setData('text/plain', textContent);\n        e.preventDefault();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, selectedImage]);\n\n  // Gestionnaire pour forcer le refresh apr√®s coller\n  const handlePaste = useCallback(e => {\n    console.log('üìã [DEBUG] handlePaste D√âCLENCH√â!', {\n      viewMode,\n      hasEditor: !!editorRef.current\n    });\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Attendre que le contenu soit coll√©\n      setTimeout(async () => {\n        console.log('üîÑ Refresh forc√© apr√®s coller');\n\n        // Traiter les images coll√©es pour leur donner des URLs blob uniques\n        if (storeBlobForUrl) {\n          await processImageBlobs(editorRef.current, storeBlobForUrl);\n        }\n        console.log('‚úÖ [handlePaste] Images trait√©es par processImageBlobs (Option B incluse)');\n\n        // Ajouter les poign√©es aux nouvelles images coll√©es\n        const newImages = editorRef.current.querySelectorAll('img:not([data-resizable])');\n        newImages.forEach(img => {\n          if (editorRef.current.addResizeHandlesToImage) {\n            editorRef.current.addResizeHandlesToImage(img);\n          }\n        });\n\n        // D√©clencher sauvegarde\n        if (onInput) {\n          const event = new Event('input', {\n            bubbles: true\n          });\n          editorRef.current.dispatchEvent(event);\n        }\n      }, 100); // setTimeout\n    }\n    console.log('üìã [DEBUG] handlePaste termin√©');\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, handleSelectionChange, handleCopy]);\n\n  // Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\n  useEffect(() => {\n    if (viewMode !== 'wysiwyg' && editorRef.current) {\n      handleTextareaResize(editorRef.current);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [content, viewMode, handleTextareaResize]);\n\n  // Effect pour attacher les gestionnaires d'√©v√©nements\n  useEffect(() => {\n    console.log('üîó [DEBUG] Attachement events, viewMode:', viewMode, 'editorRef:', !!editorRef.current);\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Debug g√©n√©rique pour TOUS les events paste\n      const debugPaste = e => {\n        console.log('üî• [DEBUG] PASTE EVENT D√âTECT√â!', {\n          target: e.target.tagName,\n          currentTarget: e.currentTarget.tagName,\n          hasClipboardData: !!e.clipboardData\n        });\n      };\n      document.addEventListener('selectionchange', handleSelectionChange);\n      editorRef.current.addEventListener('copy', handleCopy);\n      editorRef.current.addEventListener('paste', handlePaste);\n      editorRef.current.addEventListener('paste', debugPaste); // DEBUG GLOBAL\n\n      console.log('‚úÖ [DEBUG] Event paste attach√© √† editorRef.current + debug global');\n      return () => {\n        var _editorRef$current3, _editorRef$current4, _editorRef$current5;\n        console.log('üóëÔ∏è [DEBUG] Nettoyage events');\n        document.removeEventListener('selectionchange', handleSelectionChange);\n        (_editorRef$current3 = editorRef.current) === null || _editorRef$current3 === void 0 ? void 0 : _editorRef$current3.removeEventListener('copy', handleCopy);\n        (_editorRef$current4 = editorRef.current) === null || _editorRef$current4 === void 0 ? void 0 : _editorRef$current4.removeEventListener('paste', handlePaste);\n        (_editorRef$current5 = editorRef.current) === null || _editorRef$current5 === void 0 ? void 0 : _editorRef$current5.removeEventListener('paste', debugPaste);\n      };\n    }\n  }, [viewMode, handleSelectionChange, handleCopy]);\n\n  // Effect pour appliquer le style de s√©lection d'image\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Supprimer la classe de toutes les images\n      const allImages = editorRef.current.querySelectorAll('img');\n      allImages.forEach(img => {\n        const wrapper = img.closest('.resizable-image');\n        if (wrapper) {\n          wrapper.classList.remove('image-selected');\n        }\n      });\n\n      // Ajouter la classe √† l'image s√©lectionn√©e\n      if (selectedImage) {\n        const wrapper = selectedImage.closest('.resizable-image');\n        if (wrapper) {\n          wrapper.classList.add('image-selected');\n        }\n      }\n    }\n  }, [selectedImage, viewMode, content]);\n\n  // Gestion des poign√©es de redimensionnement pour les images\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      const addResizeHandlesToImage = img => {\n        var _img$parentElement;\n        // Exposer la fonction pour r√©utilisation\n        editorRef.current.addResizeHandlesToImage = addResizeHandlesToImage;\n        // Toutes les images sont trait√©es normalement\n\n        // V√©rifier si d√©j√† trait√©\n        if (img.getAttribute('data-resizable') || (_img$parentElement = img.parentElement) !== null && _img$parentElement !== void 0 && _img$parentElement.classList.contains('resizable-image')) {\n          return;\n        }\n\n        // Attendre que l'image soit charg√©e\n        if (!img.complete || img.naturalWidth === 0) {\n          img.addEventListener('load', () => addResizeHandlesToImage(img), {\n            once: true\n          });\n          return;\n        }\n        img.setAttribute('data-resizable', 'true');\n\n        // Wrapper l'image dans un conteneur redimensionnable\n        const wrapper = document.createElement('div');\n        wrapper.className = 'resizable-image';\n\n        // Ajouter gestionnaire de clic pour s√©lection d'image\n        img.addEventListener('click', e => {\n          e.stopPropagation();\n          if (onImageClick) {\n            onImageClick(img);\n          }\n        });\n\n        // Extraire les dimensions depuis le style inline ou les attributs\n        let currentWidth, currentHeight;\n\n        // Priorit√© 1: attributs HTML (ex: width=\"300px\")\n        const attrWidth = img.getAttribute('width');\n        const attrHeight = img.getAttribute('height');\n\n        // Priorit√© 2: style inline (ex: style=\"width: 300px\")\n        const styleWidth = img.style.width;\n        const styleHeight = img.style.height;\n        if (attrWidth && attrHeight) {\n          currentWidth = parseInt(attrWidth);\n          currentHeight = parseInt(attrHeight);\n          console.log('üìè Dimensions depuis attributs:', currentWidth, 'x', currentHeight);\n        } else if (styleWidth && styleHeight) {\n          currentWidth = parseInt(styleWidth);\n          currentHeight = parseInt(styleHeight);\n          console.log('üìè Dimensions depuis style:', currentWidth, 'x', currentHeight);\n        } else {\n          // Fallback: dimensions naturelles\n          currentWidth = img.naturalWidth || 300;\n          currentHeight = img.naturalHeight || 200;\n          console.log('üìè Dimensions naturelles:', currentWidth, 'x', currentHeight);\n        }\n\n        // Limiter la hauteur maximale √† 300px en pr√©servant le ratio d'aspect\n        const MAX_HEIGHT = 300;\n        if (currentHeight > MAX_HEIGHT) {\n          const aspectRatio = currentWidth / currentHeight;\n          currentHeight = MAX_HEIGHT;\n          currentWidth = Math.round(currentHeight * aspectRatio);\n          console.log('üîÑ Image redimensionn√©e pour hauteur max 300px:', currentWidth, 'x', currentHeight);\n\n          // Appliquer les nouvelles dimensions √† l'image\n          img.setAttribute('width', currentWidth + 'px');\n          img.setAttribute('height', currentHeight + 'px');\n          img.style.width = currentWidth + 'px';\n          img.style.height = currentHeight + 'px';\n        }\n        wrapper.style.width = currentWidth + 'px';\n        wrapper.style.height = currentHeight + 'px';\n\n        // Ins√©rer le wrapper\n        img.parentNode.insertBefore(wrapper, img);\n        wrapper.appendChild(img);\n\n        // Cr√©er les 4 poign√©es\n        ['nw', 'ne', 'sw', 'se'].forEach(corner => {\n          const handle = document.createElement('div');\n          handle.className = `resize-handle ${corner}`;\n          handle.dataset.corner = corner;\n          handle.addEventListener('mousedown', e => {\n            e.preventDefault();\n            e.stopPropagation();\n            const startX = e.clientX;\n            const startY = e.clientY;\n            const startWidth = wrapper.offsetWidth;\n            const startHeight = wrapper.offsetHeight;\n            const aspectRatio = startWidth / startHeight;\n            const handleMouseMove = e => {\n              const deltaX = e.clientX - startX;\n              const deltaY = e.clientY - startY;\n              let newWidth = startWidth;\n              let newHeight = startHeight;\n\n              // Calculer les nouvelles dimensions selon le coin\n              switch (corner) {\n                case 'se':\n                  // Sud-Est\n                  newWidth = Math.max(50, startWidth + deltaX);\n                  newHeight = newWidth / aspectRatio;\n                  break;\n                case 'sw':\n                  // Sud-Ouest\n                  newWidth = Math.max(50, startWidth - deltaX);\n                  newHeight = newWidth / aspectRatio;\n                  break;\n                case 'ne':\n                  // Nord-Est\n                  newWidth = Math.max(50, startWidth + deltaX);\n                  newHeight = newWidth / aspectRatio;\n                  break;\n                case 'nw':\n                  // Nord-Ouest\n                  newWidth = Math.max(50, startWidth - deltaX);\n                  newHeight = newWidth / aspectRatio;\n                  break;\n              }\n\n              // Appliquer les nouvelles dimensions\n              wrapper.style.width = newWidth + 'px';\n              wrapper.style.height = newHeight + 'px';\n              img.style.width = '100%';\n              img.style.height = '100%';\n\n              // Ajouter les attributs HTML width/height pour persistance lors des conversions\n              img.setAttribute('width', Math.round(newWidth) + 'px');\n              img.setAttribute('height', Math.round(newHeight) + 'px');\n            };\n            const handleMouseUp = () => {\n              document.removeEventListener('mousemove', handleMouseMove);\n              document.removeEventListener('mouseup', handleMouseUp);\n\n              // D√©clencher l'√©v√©nement de changement pour sauvegarder\n              if (onInput) {\n                const event = new Event('input', {\n                  bubbles: true\n                });\n                editorRef.current.dispatchEvent(event);\n              }\n            };\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n          });\n          wrapper.appendChild(handle);\n        });\n      };\n\n      // Observer pour d√©tecter les nouvelles images\n      const handleMutation = mutations => {\n        mutations.forEach(mutation => {\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeName === 'IMG') {\n              addResizeHandlesToImage(node);\n            } else if (node.querySelectorAll) {\n              node.querySelectorAll('img').forEach(addResizeHandlesToImage);\n            }\n          });\n        });\n      };\n      const observer = new MutationObserver(handleMutation);\n      observer.observe(editorRef.current, {\n        childList: true,\n        subtree: true\n      });\n\n      // Traiter les images existantes\n      editorRef.current.querySelectorAll('img').forEach(addResizeHandlesToImage);\n      return () => observer.disconnect();\n    }\n  }, [viewMode, onInput, content]);\n\n  // Effect supprim√© - La gestion des poign√©es est maintenant dans l'effect pr√©c√©dent\n\n  // Rendu conditionnel avec switch/case pour garantir une seule vue\n  console.log('üîÑ Editor.js - Rendu switch/case, viewMode:', viewMode);\n  switch (viewMode) {\n    case 'wysiwyg':\n      console.log('üéØ SWITCH - Vue WYSIWYG');\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"style\", {\n          children: `\n            .editor-content h1 { \n              font-size: 2em; \n              font-weight: bold; \n              margin: 0.67em 0; \n              line-height: 1.2;\n            }\n            .editor-content h2 { \n              font-size: 1.5em; \n              font-weight: bold; \n              margin: 0.75em 0; \n              line-height: 1.3;\n            }\n            .editor-content h3 { \n              font-size: 1.17em; \n              font-weight: bold; \n              margin: 0.83em 0; \n              line-height: 1.4;\n            }\n            .editor-content p {\n              margin: 0.5em 0;\n            }\n            .editor-content ul {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: disc;\n            }\n            .editor-content ol {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: decimal;\n            }\n            .editor-content ol[style*=\"lower-alpha\"] {\n              list-style-type: lower-alpha;\n            }\n            .editor-content li {\n              margin: 0.25em 0;\n            }\n            \n            /* Styles pour images redimensionnables */\n            .editor-content img {\n              max-width: 100%;\n              height: auto;\n              position: relative;\n              cursor: pointer;\n            }\n            \n            .resizable-image {\n              position: relative;\n              display: inline-block;\n              border: 2px solid transparent;\n            }\n            \n            .resizable-image:hover {\n              border: 2px solid #3b82f6;\n            }\n            \n            /* Style pour image s√©lectionn√©e - SOLUTION RADICALE */\n            .image-selected {\n              position: relative;\n            }\n            \n            .image-selected::after {\n              content: '';\n              position: absolute;\n              top: -4px;\n              left: -4px;\n              right: -4px;\n              bottom: -4px;\n              border: 4px solid #1d4ed8;\n              box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.3), 0 0 12px rgba(29, 78, 216, 0.4);\n              background: rgba(29, 78, 216, 0.05);\n              outline: 2px solid #ffffff;\n              outline-offset: 2px;\n              pointer-events: none;\n              z-index: 1;\n            }\n            \n            .resizable-image img {\n              width: 100%;\n              height: 100%;\n              display: block;\n              position: relative;\n              z-index: 0;\n            }\n            \n            .resizable-image .resize-handle {\n              position: absolute;\n              width: 10px;\n              height: 10px;\n              background: #3b82f6;\n              border: 2px solid white;\n              border-radius: 50%;\n              opacity: 0;\n              cursor: nw-resize;\n              transition: opacity 0.2s;\n            }\n            \n            .resizable-image:hover .resize-handle,\n            .image-selected .resize-handle {\n              opacity: 1;\n            }\n            \n            .resize-handle.nw { top: -2px; left: -2px; cursor: nw-resize; }\n            .resize-handle.ne { top: -2px; right: -2px; cursor: ne-resize; }\n            .resize-handle.sw { bottom: -2px; left: -2px; cursor: sw-resize; }\n            .resize-handle.se { bottom: -2px; right: -2px; cursor: se-resize; }\n          `\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 841,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: el => {\n            editorRef.current = el;\n          },\n          contentEditable: \"true\",\n          suppressContentEditableWarning: true,\n          spellCheck: false,\n          onInput: e => {\n            console.log('üéØ WYSIWYG onInput d√©clench√©!');\n            handleWysiwygChange(e);\n          },\n          onKeyUp: e => {\n            console.log('‚å®Ô∏è WYSIWYG onKeyUp d√©clench√©! Touche:', e.key);\n            handleWysiwygChange(e);\n          },\n          onPaste: e => {\n            console.log('üìã WYSIWYG onPaste d√©clench√©!');\n            setTimeout(() => handleWysiwygChange(e), 10); // D√©lai pour laisser le paste s'appliquer\n          },\n          onMouseUp: e => {\n            console.log('üñ±Ô∏è WYSIWYG onMouseUp - S√©lection chang√©e - ignoreFlag:', ignoreSelectionChangeRef === null || ignoreSelectionChangeRef === void 0 ? void 0 : ignoreSelectionChangeRef.current);\n            if (onSelectionChange && !(ignoreSelectionChangeRef !== null && ignoreSelectionChangeRef !== void 0 && ignoreSelectionChangeRef.current)) {\n              console.log('‚úÖ EDITOR onMouseUp - VA APPELER onSelectionChange dans 10ms');\n              setTimeout(onSelectionChange, 10);\n            } else {\n              console.log('‚ùå EDITOR onMouseUp - onSelectionChange BLOQU√â');\n            }\n          },\n          onKeyDown: e => {\n            // Protection contre les √©v√©nements undefined\n            if (!e || !e.key) {\n              console.warn('‚ö†Ô∏è √âv√©nement onKeyDown invalide:', e);\n              return;\n            }\n            console.log('üîΩ WYSIWYG onKeyDown d√©clench√©! Touche:', e.key);\n\n            // Gestion des touches pour les images s√©lectionn√©es\n            if (selectedImage) {\n              if (e.key === 'Delete' || e.key === 'Backspace') {\n                e.preventDefault();\n                // Supprimer l'image directement\n                const wrapper = selectedImage.closest('.resizable-image');\n                const elementToRemove = wrapper || selectedImage;\n                elementToRemove.remove();\n\n                // D√©s√©lectionner l'image\n                if (onImageClick) {\n                  onImageClick(null);\n                }\n\n                // D√©clencher la sauvegarde\n                if (onInput) {\n                  const event = new Event('input', {\n                    bubbles: true\n                  });\n                  editorRef.current.dispatchEvent(event);\n                }\n                return;\n              } else if (e.key === 'Enter') {\n                e.preventDefault();\n                // Ins√©rer une nouvelle ligne apr√®s l'image s√©lectionn√©e\n                const wrapper = selectedImage.closest('.resizable-image');\n                if (wrapper) {\n                  const newParagraph = document.createElement('p');\n                  newParagraph.innerHTML = '<br>';\n                  wrapper.parentNode.insertBefore(newParagraph, wrapper.nextSibling);\n                  console.log('üìç ENTER Image - Cr√©ation du paragraphe:', newParagraph);\n\n                  // Attendre que tous les √©v√©nements (onInput, handleWysiwygChange, etc.) se stabilisent\n                  setTimeout(() => {\n                    var _editorRef$current6;\n                    console.log('üìç ENTER Image - Positionnement curseur APR√àS stabilisation');\n                    const selection = window.getSelection();\n                    const range = document.createRange();\n                    console.log('üìç ENTER Image - Selection avant (delayed):', selection.rangeCount);\n\n                    // Positionner au d√©but du paragraphe\n                    range.setStart(newParagraph, 0);\n                    range.collapse(true);\n                    console.log('üìç ENTER Image - Range (delayed) startContainer:', range.startContainer);\n                    console.log('üìç ENTER Image - Range (delayed) startOffset:', range.startOffset);\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                    console.log('üìç ENTER Image - Selection (delayed) apr√®s:', selection.rangeCount);\n\n                    // Focus pour s'assurer que le curseur est visible\n                    (_editorRef$current6 = editorRef.current) === null || _editorRef$current6 === void 0 ? void 0 : _editorRef$current6.focus();\n                    console.log('üìç ENTER Image - Positionnement termin√© avec succ√®s!');\n                  }, 100); // D√©lai pour laisser les √©v√©nements se stabiliser\n\n                  // D√©clencher la sauvegarde\n                  if (onInput) {\n                    const event = new Event('input', {\n                      bubbles: true\n                    });\n                    editorRef.current.dispatchEvent(event);\n                  }\n\n                  // D√©s√©lectionner l'image\n                  if (onImageClick) {\n                    onImageClick(null);\n                  }\n                }\n                return;\n              }\n            }\n\n            // Mise √† jour du formatage pour les touches de navigation\n            if (e && e.key && (e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {\n              setTimeout(() => {\n                console.log('üîº EDITOR onKeyDown Navigation - ignoreFlag:', ignoreSelectionChangeRef === null || ignoreSelectionChangeRef === void 0 ? void 0 : ignoreSelectionChangeRef.current);\n                if (onSelectionChange && !(ignoreSelectionChangeRef !== null && ignoreSelectionChangeRef !== void 0 && ignoreSelectionChangeRef.current)) {\n                  console.log('‚úÖ EDITOR Navigation - VA APPELER onSelectionChange');\n                  onSelectionChange();\n                } else {\n                  console.log('‚ùå EDITOR Navigation - onSelectionChange BLOQU√â');\n                }\n              }, 10);\n            }\n          },\n          onFocus: e => {\n            console.log('üîç WYSIWYG onFocus - Mise √† jour formatage - ignoreFlag:', ignoreSelectionChangeRef === null || ignoreSelectionChangeRef === void 0 ? void 0 : ignoreSelectionChangeRef.current);\n            if (onSelectionChange && !(ignoreSelectionChangeRef !== null && ignoreSelectionChangeRef !== void 0 && ignoreSelectionChangeRef.current)) {\n              console.log('‚úÖ EDITOR onFocus - VA APPELER onSelectionChange dans 10ms');\n              setTimeout(onSelectionChange, 10);\n            } else {\n              console.log('‚ùå EDITOR onFocus - onSelectionChange BLOQU√â');\n            }\n          },\n          onChange: e => {\n            console.log('üîÑ onChange d√©clench√©!');\n          },\n          onClick: onEditorClick,\n          style: {\n            minHeight: '384px',\n            outline: 'none',\n            padding: '20px',\n            lineHeight: 'var(--dys-line-height)',\n            fontFamily: 'var(--dys-font-family)',\n            fontSize: 'var(--dys-font-size)',\n            color: 'var(--dys-text-color)',\n            backgroundColor: 'var(--dys-bg-color)',\n            overflow: 'auto',\n            wordWrap: 'break-word',\n            whiteSpace: 'pre-wrap',\n            border: '1px solid #e5e7eb'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 949,\n          columnNumber: 11\n        }, this)]\n      }, \"wysiwyg\", true, {\n        fileName: _jsxFileName,\n        lineNumber: 840,\n        columnNumber: 9\n      }, this);\n    case 'markdown':\n      {\n        console.log('üìù SWITCH - Vue MARKDOWN');\n        const displayContent = content;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n            ref: el => {\n              if (editorRef) editorRef.current = el;\n            },\n            value: displayContent,\n            onChange: e => {\n              const newValue = e.target.value;\n              const originalContent = content;\n              if (newValue !== originalContent) {\n                onInput({\n                  ...e,\n                  target: {\n                    ...e.target,\n                    value: newValue\n                  }\n                });\n              }\n            },\n            spellCheck: false,\n            className: \"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",\n            style: {\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              lineHeight: 'var(--dys-line-height)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              paddingBottom: '2rem'\n            },\n            placeholder: \"\\xC9crivez en Markdown... # Titre 1\\n## Titre 2\\n### Titre 3 **Gras** *Italique* - Liste \\xE0 puces\\n1. Liste num\\xE9rot\\xE9e\\na. Liste alphab\\xE9tique $E = mc^2$ (formule inline)\\n$$\\\\\\\\int_{-\\\\\\\\infty}^{\\\\\\\\infty} e^{-x^2} dx = \\\\\\\\sqrt{\\\\\\\\pi}$$ (formule block)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1107,\n            columnNumber: 11\n          }, this)\n        }, \"markdown\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 1106,\n          columnNumber: 9\n        }, this);\n      }\n    case 'html':\n      {\n        console.log('üîß SWITCH - Vue HTML');\n        const htmlDisplayContent = formatHtmlForSource(content);\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n            ref: el => {\n              if (editorRef) editorRef.current = el;\n            },\n            value: htmlDisplayContent,\n            onChange: e => {\n              const newValue = e.target.value;\n              const originalWithCollapse = formatHtmlForSource(content);\n              if (newValue !== originalWithCollapse) {\n                onInput({\n                  ...e,\n                  target: {\n                    ...e.target,\n                    value: newValue\n                  }\n                });\n              }\n            },\n            className: \"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",\n            style: {\n              fontFamily: 'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n              paddingBottom: '2rem'\n            },\n            placeholder: \"Code source HTML...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1158,\n            columnNumber: 11\n          }, this)\n        }, \"html\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 1157,\n          columnNumber: 9\n        }, this);\n      }\n    default:\n      console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:', viewMode);\n      return null;\n  }\n}, \"G19JO5wWndquTblUWbIv5Vl41sI=\")), \"G19JO5wWndquTblUWbIv5Vl41sI=\");\n_c2 = Editor;\nexport default Editor;\nvar _c, _c2;\n$RefreshReg$(_c, \"Editor$forwardRef\");\n$RefreshReg$(_c2, \"Editor\");","map":{"version":3,"names":["React","useCallback","useEffect","useRef","forwardRef","convertAllPromptoDysUrlsToBlobs","getCurrentProject","loadImage","saveImage","requestPersistentStorage","jsxDEV","_jsxDEV","Editor","_s","_c","content","setContent","viewMode","onInput","currentFormat","onFormatChange","mathJaxReady","ignoreSelectionChangeRef","selectedImage","onImageClick","onEditorClick","onDeleteSelectedImage","onSelectionChange","storeBlobForUrl","editorRef","ref","isInitializedRef","previousContentRef","createUniqueBlob","file","uniqueId","Date","now","Math","random","toString","substr","uniqueName","name","uniqueFile","File","type","blobUrl","URL","createObjectURL","console","log","forceVerifyImagePersistence","container","imagesWithId","querySelectorAll","length","img","imageId","getAttribute","blob","round","size","error","src","startsWith","response","fetch","newBlob","rehydrateImages","warn","images","objectUrl","width","height","alt","oldSrc","newSrc","processImageBlobs","blobImages","originalUrl","base64Images","dataUrl","timestamp","toISOString","replace","slice","filename","crypto","randomUUID","setAttribute","substring","setTimeout","migrateOldBlobImages","oldImages","oldBlobUrl","ok","status","fileName","newObjectUrl","revokeObjectURL","revokeError","oldUrl","newImageId","innerHTML","event","Event","bubbles","dispatchEvent","handleTextareaResize","textarea","style","max","scrollHeight","initImageSystem","current","rehydrationDelay","process","env","NODE_ENV","formatHtmlForSource","html","indentLevel","indentSize","match","result","repeat","split","map","line","index","trim","currentIndent","join","handleWysiwygChange","e","cleanContent","newContent","target","handleSelectionChange","document","activeElement","initializeContent","hasFocus","hasSelection","window","getSelection","rangeCount","currentProject","displayContent","directory","MathJax","typesetPromise","catch","err","_editorRef$current","_editorRef$current2","addResizeHandlesToImage","forEach","removeAttribute","existingWrapper","closest","parent","parentNode","insertBefore","remove","handleCopy","tempDiv","createElement","clonedImg","cloneNode","appendChild","clipboardData","setData","preventDefault","selection","range","getRangeAt","selectedContent","cloneContents","htmlContent","textContent","handlePaste","hasEditor","newImages","debugPaste","tagName","currentTarget","hasClipboardData","addEventListener","_editorRef$current3","_editorRef$current4","_editorRef$current5","removeEventListener","allImages","wrapper","classList","add","_img$parentElement","parentElement","contains","complete","naturalWidth","once","className","stopPropagation","currentWidth","currentHeight","attrWidth","attrHeight","styleWidth","styleHeight","parseInt","naturalHeight","MAX_HEIGHT","aspectRatio","corner","handle","dataset","startX","clientX","startY","clientY","startWidth","offsetWidth","startHeight","offsetHeight","handleMouseMove","deltaX","deltaY","newWidth","newHeight","handleMouseUp","handleMutation","mutations","mutation","addedNodes","node","nodeName","observer","MutationObserver","observe","childList","subtree","disconnect","children","_jsxFileName","lineNumber","columnNumber","el","contentEditable","suppressContentEditableWarning","spellCheck","onKeyUp","key","onPaste","onMouseUp","onKeyDown","elementToRemove","newParagraph","nextSibling","_editorRef$current6","createRange","setStart","collapse","startContainer","startOffset","removeAllRanges","addRange","focus","onFocus","onChange","onClick","minHeight","outline","padding","lineHeight","fontFamily","fontSize","color","backgroundColor","overflow","wordWrap","whiteSpace","border","value","newValue","originalContent","paddingBottom","placeholder","htmlDisplayContent","originalWithCollapse","_c2","$RefreshReg$"],"sources":["C:/Users/JEAN-NOELLEFEBVRE-SA/CascadeProjects/editor/src/components/Editor.js"],"sourcesContent":["import React, { useCallback, useEffect, useRef, forwardRef } from 'react';\nimport { convertAllPromptoDysUrlsToBlobs, getCurrentProject } from '../utils/promptoDysManager';\nimport { loadImage, saveImage, requestPersistentStorage } from '../utils/imageStore';\n\nconst Editor = forwardRef(({ \n  content, \n  setContent, \n  viewMode, \n  onInput, \n  currentFormat, \n  onFormatChange, \n  mathJaxReady, \n  ignoreSelectionChangeRef,\n  selectedImage,\n  onImageClick,\n  onEditorClick,\n  onDeleteSelectedImage,\n  onSelectionChange,\n  storeBlobForUrl,\n  editorRef\n}, ref) => {\n  \n  \n  // Utilise editorRef pass√©e en props (pas de ref locale)\n  const isInitializedRef = useRef(false);\n  const previousContentRef = useRef('');\n  \n  // Fonction pour cr√©er des blobs uniques (mutualisation avec Toolbar)\n  const createUniqueBlob = useCallback((file, storeBlobForUrl) => {\n    const uniqueId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    const uniqueName = `${uniqueId}_${file.name}`;\n    const uniqueFile = new File([file], uniqueName, { type: file.type });\n    const blobUrl = URL.createObjectURL(uniqueFile);\n    \n    console.log('üéØ [createUniqueBlob] Cr√©ation blob unique:', uniqueName, '->', blobUrl);\n    storeBlobForUrl(blobUrl, uniqueFile);\n    \n    return { blobUrl, uniqueFile };\n  }, []);\n\n  // Fonction de v√©rification force de la persistance des images\n  const forceVerifyImagePersistence = useCallback(async (container) => {\n    console.log('üîç [forceVerify] V√©rification persistance images...');\n    \n    const imagesWithId = container.querySelectorAll('img[data-image-id]');\n    console.log(`üîç [forceVerify] ${imagesWithId.length} images avec data-image-id trouv√©es`);\n    \n    for (const img of imagesWithId) {\n      const imageId = img.getAttribute('data-image-id');\n      try {\n        const blob = await loadImage(imageId);\n        if (blob) {\n          console.log(`‚úÖ [forceVerify] Image ${imageId} OK en IndexedDB (${Math.round(blob.size/1024)}KB)`);\n        } else {\n          console.error(`‚ùå [forceVerify] Image ${imageId} MANQUANTE en IndexedDB`);\n          // Re-sauvegarder depuis l'URL actuelle si possible\n          if (img.src.startsWith('blob:')) {\n            try {\n              const response = await fetch(img.src);\n              const newBlob = await response.blob();\n              await saveImage(imageId, newBlob);\n              console.log(`üîÑ [forceVerify] Re-sauvegarde OK pour ${imageId}`);\n            } catch (error) {\n              console.error(`‚ùå [forceVerify] √âchec re-sauvegarde ${imageId}:`, error);\n            }\n          }\n        }\n      } catch (error) {\n        console.error(` [forceVerify] Erreur v√©rification ${imageId}:`, error);\n      }\n    }\n  }, []);\n\n  // Fonction de r√©hydratation des images depuis IndexedDB\n  const rehydrateImages = useCallback(async (container) => {\n    console.log(' [rehydrateImages] D√©but r√©hydratation des images...');\n    \n    if (!container) {\n      console.warn(' [rehydrateImages] Pas de conteneur fourni');\n      return;\n    }\n\n    // Trouver toutes les images avec data-image-id\n    const images = container.querySelectorAll('img[data-image-id]');\n    console.log(` [rehydrateImages] ${images.length} images avec data-image-id trouv√©es`);\n\n    // Traiter chaque image\n    for (const img of images) {\n      const imageId = img.getAttribute('data-image-id');\n      console.log(' [rehydrateImages] Traitement image:', imageId);\n\n      try {\n        // Charger l'image depuis IndexedDB\n        const objectUrl = await loadImage(imageId);\n        \n        if (objectUrl) {\n          // Conserver les attributs existants\n          const width = img.getAttribute('width');\n          const height = img.getAttribute('height');\n          const alt = img.getAttribute('alt') || '';\n          \n          console.log(' [rehydrateImages] Image charg√©e:', {\n            imageId,\n            oldSrc: img.src,\n            newSrc: objectUrl,\n            width,\n            height,\n            alt\n          });\n          \n          // Mettre √† jour la source\n          img.src = objectUrl;\n          \n          console.log(' [rehydrateImages] Image r√©hydrat√©e avec succ√®s:', imageId);\n        } else {\n          console.warn(' [rehydrateImages] Image non trouv√©e en IndexedDB:', imageId);\n          // On garde l'image avec son data-image-id pour un essai ult√©rieur\n        }\n      } catch (error) {\n        console.error(' [rehydrateImages] Erreur r√©hydratation:', imageId, error);\n      }\n    }\n\n    console.log(' [rehydrateImages] R√©hydratation termin√©e');\n  }, []);\n\n  // Fonction mutualis√©e pour traiter les images coll√©es et les rendre uniques\n  const processImageBlobs = useCallback(async (container, storeBlobForUrl) => {\n    console.log(' [processImageBlobs] Traitement des images...');\n    \n    // Traiter les images blob: temporaires\n    const blobImages = container.querySelectorAll('img[src^=\"blob:\"]');\n    console.log('üîç [processImageBlobs] Images blob trouv√©es:', blobImages.length);\n    \n    for (const img of blobImages) {\n      const originalUrl = img.src;\n      \n      try {\n        console.log('üì• [processImageBlobs] Traitement blob:', originalUrl);\n        \n        // R√©cup√©rer le blob original\n        const response = await fetch(originalUrl);\n        const blob = await response.blob();\n        \n        // Cr√©er un nouveau File avec un nom unique\n        const file = new File([blob], 'pasted-image.png', { type: blob.type });\n        const { blobUrl } = createUniqueBlob(file, storeBlobForUrl);\n        \n        // Remplacer l'URL dans l'image\n        img.src = blobUrl;\n        console.log('‚úÖ [processImageBlobs] Image blob mise √† jour:', originalUrl, '->', blobUrl);\n        \n      } catch (error) {\n        console.error('‚ùå [processImageBlobs] Erreur blob pour:', originalUrl, error);\n      }\n    }\n    \n    // Traiter les images base64 coll√©es (copie d'√©cran Windows)\n    const base64Images = container.querySelectorAll('img[src^=\"data:image/\"]');\n    console.log('üîç [processImageBlobs] Images base64 trouv√©es:', base64Images.length);\n    \n    for (const img of base64Images) {\n      const dataUrl = img.src;\n      \n      try {\n        console.log('üì• [processImageBlobs] Traitement base64 (longueur:', dataUrl.length, 'chars)');\n        \n        // Convertir data URL en blob\n        const response = await fetch(dataUrl);\n        const blob = await response.blob();\n        \n        // G√©n√©rer nom de fichier unique\n        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n        const filename = `pasted-screenshot-${timestamp}.png`;\n        \n        // G√©n√©rer ID unique et stocker dans IndexedDB\n        const imageId = crypto.randomUUID();\n        await saveImage(imageId, blob);\n        \n        // Cr√©er blob URL temporaire pour affichage\n        const blobUrl = URL.createObjectURL(blob);\n        \n        // Stocker le mapping URL->File pour compatibilit√©\n        const file = new File([blob], filename, { type: blob.type });\n        if (storeBlobForUrl) {\n          storeBlobForUrl(blobUrl, file);\n        }\n        \n        // Remplacer l'image base64 par blob + data-image-id\n        img.src = blobUrl;\n        img.setAttribute('data-image-id', imageId);\n        img.setAttribute('alt', filename);\n        \n        console.log(' [processImageBlobs] Image base64 convertie:', dataUrl.substring(0, 50) + '...', '->', blobUrl, 'ID:', imageId);\n        \n      } catch (error) {\n        console.error(' [processImageBlobs] Erreur base64 pour:', dataUrl.substring(0, 50), error);\n      }\n    }\n    \n    // OPTION B: Force v√©rification + double check apr√®s processus\n    console.log(' [processImageBlobs] OPTION B - Force v√©rification persistance...');\n    await forceVerifyImagePersistence(container);\n    \n    // Double r√©hydratation apr√®s 500ms\n    setTimeout(async () => {\n      console.log(' [processImageBlobs] OPTION B - Double r√©hydratation...');\n      await rehydrateImages(container);\n    }, 500);\n    \n    console.log(' [processImageBlobs] Traitement termin√©');\n  }, [forceVerifyImagePersistence, rehydrateImages, createUniqueBlob]);\n\n\n  // Fonction de migration des anciennes images blob: vers IndexedDB\n  const migrateOldBlobImages = useCallback(async (container) => {\n    console.log(' [migrateOldBlobImages] D√©but migration des anciennes images...');\n    \n    if (!container) {\n      console.warn('‚ö†Ô∏è [migrateOldBlobImages] Pas de conteneur fourni');\n      return;\n    }\n\n    // Trouver toutes les images avec src blob: SANS data-image-id (anciennes)\n    const oldImages = container.querySelectorAll('img[src^=\"blob:\"]:not([data-image-id])');\n    console.log(`üîç [migrateOldBlobImages] ${oldImages.length} anciennes images blob trouv√©es`);\n\n    if (oldImages.length === 0) {\n      console.log('‚úÖ [migrateOldBlobImages] Aucune migration n√©cessaire');\n      return;\n    }\n\n    // Traiter chaque ancienne image\n    for (const img of oldImages) {\n      const oldBlobUrl = img.src;\n      console.log('üîÑ [migrateOldBlobImages] Migration image:', oldBlobUrl);\n\n      try {\n        // R√©cup√©rer le blob depuis l'URL\n        const response = await fetch(oldBlobUrl);\n        if (!response.ok) {\n          console.warn('‚ö†Ô∏è [migrateOldBlobImages] Impossible de r√©cup√©rer le blob:', response.status);\n          continue;\n        }\n        \n        const blob = await response.blob();\n        console.log('üì¶ [migrateOldBlobImages] Blob r√©cup√©r√©:', {\n          size: `${Math.round(blob.size/1024)}KB`,\n          type: blob.type\n        });\n\n        // Cr√©er un File pour saveImage()\n        const fileName = img.alt || `migrated_image_${Date.now()}.png`;\n        const file = new File([blob], fileName, { type: blob.type });\n        \n        // G√©n√©rer UUID et sauvegarder en IndexedDB\n        const imageId = crypto.randomUUID();\n        await saveImage(imageId, file);\n        console.log('üíæ [migrateOldBlobImages] Image migr√©e vers IndexedDB:', imageId);\n        \n        // Mettre √† jour l'√©l√©ment img avec data-image-id\n        img.setAttribute('data-image-id', imageId);\n        \n        // Cr√©er nouvelle Object URL\n        const newObjectUrl = URL.createObjectURL(blob);\n        img.src = newObjectUrl;\n        \n        // R√©voquer l'ancienne URL si possible\n        try {\n          URL.revokeObjectURL(oldBlobUrl);\n          console.log('üßπ [migrateOldBlobImages] Ancienne URL r√©voqu√©e:', oldBlobUrl);\n        } catch (revokeError) {\n          console.warn('‚ö†Ô∏è [migrateOldBlobImages] Impossible de r√©voquer ancienne URL:', revokeError);\n        }\n        \n        console.log('‚úÖ [migrateOldBlobImages] Image migr√©e avec succ√®s:', {\n          oldUrl: oldBlobUrl,\n          newImageId: imageId,\n          fileName\n        });\n        \n      } catch (error) {\n        console.error('‚ùå [migrateOldBlobImages] Erreur migration:', oldBlobUrl, error);\n        // On garde l'ancienne image m√™me en cas d'erreur\n      }\n    }\n\n    console.log('‚úÖ [migrateOldBlobImages] Migration termin√©e');\n    \n    // D√©clencher une sauvegarde du contenu apr√®s migration\n    if (onInput && container.innerHTML) {\n      console.log('üíæ [migrateOldBlobImages] D√©clenchement sauvegarde apr√®s migration...');\n      const event = new Event('input', { bubbles: true });\n      container.dispatchEvent(event);\n    }\n  }, [onInput]);\n  \n  // Gestionnaire pour l'auto-redimensionnement (toujours d√©clar√©)\n  const handleTextareaResize = useCallback((textarea) => {\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.max(384, textarea.scrollHeight) + 'px';\n    }\n  }, []);\n\n  // Effect pour la r√©hydratation des images au chargement\n  useEffect(() => {\n    console.log(' [Editor] Effect r√©hydratation - Chargement initial');\n    \n    const initImageSystem = async () => {\n      console.log(' [Editor] Demande stockage persistant...');\n      // Demander le stockage persistant\n      await requestPersistentStorage();\n      \n      // R√©hydrater les images si l'√©diteur est pr√™t\n      if (editorRef.current) {\n        console.log(' [Editor] D√©clenchement r√©hydratation...');\n        await rehydrateImages(editorRef.current);\n        \n        console.log(' [Editor] D√©clenchement migration anciennes images...');\n        await migrateOldBlobImages(editorRef.current);\n      } else {\n        console.warn(' [Editor] editorRef pas encore pr√™t pour r√©hydratation');\n      }\n    };\n    \n    initImageSystem();\n  }, [rehydrateImages, migrateOldBlobImages]);\n\n  // Effect pour r√©hydrater quand le contenu change (nouveau document charg√©)\n  useEffect(() => {\n    if (content && content !== previousContentRef.current && editorRef.current) {\n      console.log(' [Editor] Contenu chang√© - V√©rification r√©hydratation...');\n      previousContentRef.current = content;\n      \n      // D√©lai pour laisser le DOM se mettre √† jour (plus long en production)\n      const rehydrationDelay = process.env.NODE_ENV === 'production' ? 1000 : 100;\n      console.log(` [Editor] D√©lai r√©hydratation: ${rehydrationDelay}ms (env: ${process.env.NODE_ENV})`);\n      \n      setTimeout(async () => {\n        await rehydrateImages(editorRef.current);\n        await migrateOldBlobImages(editorRef.current);\n      }, rehydrationDelay);\n    }\n  }, [content, rehydrateImages, migrateOldBlobImages]);\n\n  // Fonction pour formater le HTML avec des retours √† la ligne et indentation\n  const formatHtmlForSource = useCallback((html) => {\n    let indentLevel = 0;\n    const indentSize = 2; // 2 espaces par niveau\n    \n    return html\n      .replace(/<br\\s*\\/?>/gi, '<br>\\n')\n      .replace(/<\\/?(h[1-6]|p|div|ul|ol|li|strong|em|span)[^>]*>/gi, (match) => {\n        if (match.startsWith('</')) {\n          // Balise fermante : diminuer l'indentation puis ajouter la balise\n          indentLevel = Math.max(0, indentLevel - 1);\n          return match + '\\n';\n        } else {\n          // Balise ouvrante : ajouter la balise puis augmenter l'indentation\n          const result = '\\n' + ' '.repeat(indentLevel * indentSize) + match;\n          // Augmenter l'indentation pour les balises conteneurs\n          if (match.match(/<(ul|ol|li|div|p|h[1-6])[^>]*>/i)) {\n            indentLevel++;\n          }\n          return result;\n        }\n      })\n      .split('\\n')\n      .map((line, index) => {\n        if (index === 0) return line.trim(); // Premi√®re ligne sans indentation\n        if (line.trim() === '') return ''; // Ligne vide\n        if (line.trim().startsWith('</')) {\n          // Balise fermante : r√©duire l'indentation\n          const currentIndent = Math.max(0, indentLevel - 1);\n          return ' '.repeat(currentIndent * indentSize) + line.trim();\n        }\n        // Contenu texte : utiliser l'indentation actuelle\n        return line.startsWith(' ') ? line : ' '.repeat(indentLevel * indentSize) + line.trim();\n      })\n      .join('\\n')\n      .replace(/^\\n+/, '') // Supprimer les retours √† la ligne en d√©but\n      .replace(/\\n{2,}/g, '\\n') // Supprimer toutes les lignes vides multiples\n      .trim();\n  }, []);\n\n  // Gestionnaire unifi√© WYSIWYG - connect√© directement √† onInput\n  const handleWysiwygChange = useCallback((e) => {\n    console.log('üìù handleWysiwygChange d√©clench√©');\n    \n    if (!editorRef.current) return;\n    \n    // Nettoyer les spans vides et les &nbsp; en trop\n    const cleanContent = (html) => {\n      return html\n        .replace(/<span(?![^>]*style=\"[^\"]*color:)[^>]*>\\s*<\\/span>/g, '') // Supprimer spans vides SAUF les spans color√©s\n        .replace(/(&nbsp;\\s*){2,}/g, '&nbsp;') // R√©duire les &nbsp; multiples\n        .replace(/<font[^>]*color=\"([^\"]*)\"[^>]*>(.*?)<\\/font>/g, '<span style=\"color: $1;\">$2</span>') // Convertir font en span\n        .replace(/<b\\b[^>]*>(.*?)<\\/b>/g, '<strong>$1</strong>') // Convertir b en strong\n        .replace(/<i\\b[^>]*>(.*?)<\\/i>/g, '<em>$1</em>'); // Convertir i en em\n    };\n    \n    const newContent = cleanContent(editorRef.current.innerHTML);\n    console.log('üîç Contenu actuel vs nouveau:', content.length, 'vs', newContent.length);\n    \n    // Appel direct vers onInput du hook useEditor\n    if (newContent !== content) {\n      console.log('‚úÖ WYSIWYG Changement - Appel onInput direct');\n      onInput({ target: { innerHTML: newContent } });\n    }\n    \n    // D√©clencher mise √† jour du formatage apr√®s un d√©lai\n    if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n      console.log('üîÑ EDITOR handleWysiwygChange - Va appeler onSelectionChange dans 50ms');\n      setTimeout(onSelectionChange, 50);\n    } else {\n      console.log('‚ùå EDITOR handleWysiwygChange - onSelectionChange BLOQU√â - ignoreFlag:', ignoreSelectionChangeRef?.current);\n    }\n  }, [content, onInput, onSelectionChange]);\n\n  // Gestionnaire pour les √©v√©nements de s√©lection/curseur\n  const handleSelectionChange = useCallback(() => {\n    console.log('üìç EDITOR handleSelectionChange - ignoreFlag:', ignoreSelectionChangeRef?.current);\n    if (ignoreSelectionChangeRef?.current) {\n      console.log('‚ùå EDITOR handleSelectionChange - BLOQU√â par ignoreFlag');\n      return;\n    }\n    if (viewMode === 'wysiwyg' && document.activeElement === editorRef.current) {\n      console.log('‚úÖ EDITOR handleSelectionChange - VA APPELER onSelectionChange');\n      onSelectionChange();\n    } else {\n      console.log('‚ö†Ô∏è EDITOR handleSelectionChange - SKIP conditions');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, onSelectionChange, ignoreSelectionChangeRef]);\n\n\n  // Initialiser le contenu uniquement si n√©cessaire\n  useEffect(() => {\n    const initializeContent = async () => {\n      if (viewMode === 'wysiwyg' && editorRef.current && editorRef.current.innerHTML !== content) {\n        // Ne pas modifier le contenu si l'utilisateur interagit activement\n        const hasFocus = document.activeElement === editorRef.current;\n        const hasSelection = window.getSelection().rangeCount > 0;\n        \n        // √âviter les mises √† jour pendant l'interaction utilisateur\n        if (hasFocus && hasSelection) {\n          return; // Ne pas perturber l'utilisateur\n        }\n        \n        // Convertir les URLs relatives PromptoDYS en Blob URLs pour affichage\n        const currentProject = getCurrentProject();\n        let displayContent = content;\n        \n        if (currentProject.directory) {\n          displayContent = await convertAllPromptoDysUrlsToBlobs(content, currentProject.directory);\n        }\n        \n        // Mise √† jour avec le contenu converti\n        editorRef.current.innerHTML = displayContent;\n        \n        // Re-rendre MathJax apr√®s mise √† jour du contenu\n        if (window.MathJax && window.MathJax.typesetPromise) {\n          window.MathJax.typesetPromise([editorRef.current]).catch((err) => {\n            console.warn('Erreur MathJax:', err);\n          });\n        }\n        \n        // SOLUTION F5: Forcer le retraitement des poign√©es apr√®s initialisation\n        setTimeout(() => {\n          console.log('üîÑ [F5 Fix] Retraitement forc√© des poign√©es d\\'images apr√®s initialisation');\n          const images = editorRef.current?.querySelectorAll('img');\n          if (images && editorRef.current?.addResizeHandlesToImage) {\n            images.forEach(img => {\n              // Retirer le marqueur data-resizable pour forcer le retraitement\n              img.removeAttribute('data-resizable');\n              // Retirer le wrapper s'il existe d√©j√†\n              const existingWrapper = img.closest('.resizable-image');\n              if (existingWrapper) {\n                const parent = existingWrapper.parentNode;\n                parent.insertBefore(img, existingWrapper);\n                existingWrapper.remove();\n              }\n              // Retraiter l'image\n              editorRef.current.addResizeHandlesToImage(img);\n            });\n            console.log('‚úÖ [F5 Fix] Poign√©es retrait√©es pour', images.length, 'image(s)');\n          }\n        }, 300); // D√©lai pour s'assurer que tout est bien initialis√©\n      }\n    };\n    \n    initializeContent();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, content]);\n\n  // Gestionnaire pour la copie - convertir HTML en texte propre et g√©rer les images s√©lectionn√©es\n  const handleCopy = useCallback((e) => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Priorit√© 1: Si une image est s√©lectionn√©e, copier l'image\n      if (selectedImage) {\n        try {\n          // Cr√©er un √©l√©ment temporaire avec l'image\n          const tempDiv = document.createElement('div');\n          const clonedImg = selectedImage.cloneNode(true);\n          tempDiv.appendChild(clonedImg);\n          \n          // Copier au format HTML pour pr√©server la structure\n          e.clipboardData.setData('text/html', tempDiv.innerHTML);\n          // Copier aussi le src comme texte de fallback\n          e.clipboardData.setData('text/plain', selectedImage.src);\n          e.preventDefault();\n          return;\n        } catch (error) {\n          console.warn('Erreur copie image:', error);\n        }\n      }\n      \n      // Priorit√© 2: S√©lection de texte classique\n      const selection = window.getSelection();\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const selectedContent = range.cloneContents();\n        const tempDiv = document.createElement('div');\n        tempDiv.appendChild(selectedContent);\n        \n        // Convertir HTML en texte avec retours √† la ligne pr√©serv√©s\n        const htmlContent = tempDiv.innerHTML;\n        const textContent = htmlContent\n          .replace(/<div[^>]*>/gi, '')\n          .replace(/<\\/div>/gi, '\\n')\n          .replace(/<br\\s*\\/?>/gi, '\\n')\n          .replace(/<p[^>]*>/gi, '')\n          .replace(/<\\/p>/gi, '\\n')\n          .replace(/<[^>]+>/g, '') // Supprimer toutes les autres balises\n          .replace(/&nbsp;/g, ' ')\n          .replace(/&amp;/g, '&')\n          .replace(/&lt;/g, '<')\n          .replace(/&gt;/g, '>')\n          .replace(/&quot;/g, '\"')\n          .replace(/&#39;/g, \"'\")\n          .replace(/\\n+$/, ''); // Supprimer les retours √† la ligne en fin\n        \n        // Mettre le texte propre dans le presse-papier\n        e.clipboardData.setData('text/plain', textContent);\n        e.preventDefault();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, selectedImage]);\n\n\n  // Gestionnaire pour forcer le refresh apr√®s coller\n  const handlePaste = useCallback((e) => {\n    console.log('üìã [DEBUG] handlePaste D√âCLENCH√â!', { viewMode, hasEditor: !!editorRef.current });\n    \n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Attendre que le contenu soit coll√©\n      setTimeout(async () => {\n        console.log('üîÑ Refresh forc√© apr√®s coller');\n        \n        // Traiter les images coll√©es pour leur donner des URLs blob uniques\n        if (storeBlobForUrl) {\n          await processImageBlobs(editorRef.current, storeBlobForUrl);\n        }\n        \n        console.log('‚úÖ [handlePaste] Images trait√©es par processImageBlobs (Option B incluse)');\n        \n        // Ajouter les poign√©es aux nouvelles images coll√©es\n        const newImages = editorRef.current.querySelectorAll('img:not([data-resizable])');\n        newImages.forEach(img => {\n          if (editorRef.current.addResizeHandlesToImage) {\n            editorRef.current.addResizeHandlesToImage(img);\n          }\n        });\n        \n        // D√©clencher sauvegarde\n        if (onInput) {\n          const event = new Event('input', { bubbles: true });\n          editorRef.current.dispatchEvent(event);\n        }\n      }, 100); // setTimeout\n    }\n    console.log('üìã [DEBUG] handlePaste termin√©');\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMode, handleSelectionChange, handleCopy]);\n\n  // Effect pour redimensionner au changement de contenu (toujours d√©clar√©)\n  useEffect(() => {\n    if (viewMode !== 'wysiwyg' && editorRef.current) {\n      handleTextareaResize(editorRef.current);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [content, viewMode, handleTextareaResize]);\n\n\n\n  // Effect pour attacher les gestionnaires d'√©v√©nements\n  useEffect(() => {\n    console.log('üîó [DEBUG] Attachement events, viewMode:', viewMode, 'editorRef:', !!editorRef.current);\n    \n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      // Debug g√©n√©rique pour TOUS les events paste\n      const debugPaste = (e) => {\n        console.log('üî• [DEBUG] PASTE EVENT D√âTECT√â!', { \n          target: e.target.tagName, \n          currentTarget: e.currentTarget.tagName,\n          hasClipboardData: !!e.clipboardData \n        });\n      };\n      \n      document.addEventListener('selectionchange', handleSelectionChange);\n      editorRef.current.addEventListener('copy', handleCopy);\n      editorRef.current.addEventListener('paste', handlePaste);\n      editorRef.current.addEventListener('paste', debugPaste); // DEBUG GLOBAL\n      \n      console.log('‚úÖ [DEBUG] Event paste attach√© √† editorRef.current + debug global');\n      \n      return () => {\n        console.log('üóëÔ∏è [DEBUG] Nettoyage events');\n        document.removeEventListener('selectionchange', handleSelectionChange);\n        editorRef.current?.removeEventListener('copy', handleCopy);\n        editorRef.current?.removeEventListener('paste', handlePaste);\n        editorRef.current?.removeEventListener('paste', debugPaste);\n      };\n    }\n  }, [viewMode, handleSelectionChange, handleCopy]);\n\n// Effect pour appliquer le style de s√©lection d'image\nuseEffect(() => {\n  if (viewMode === 'wysiwyg' && editorRef.current) {\n    // Supprimer la classe de toutes les images\n    const allImages = editorRef.current.querySelectorAll('img');\n    allImages.forEach(img => {\n      const wrapper = img.closest('.resizable-image');\n      if (wrapper) {\n        wrapper.classList.remove('image-selected');\n      }\n    });\n\n    // Ajouter la classe √† l'image s√©lectionn√©e\n    if (selectedImage) {\n      const wrapper = selectedImage.closest('.resizable-image');\n      if (wrapper) {\n        wrapper.classList.add('image-selected');\n      }\n    }\n  }\n}, [selectedImage, viewMode, content]);\n\n  // Gestion des poign√©es de redimensionnement pour les images\n  useEffect(() => {\n    if (viewMode === 'wysiwyg' && editorRef.current) {\n      const addResizeHandlesToImage = (img) => {\n        // Exposer la fonction pour r√©utilisation\n        editorRef.current.addResizeHandlesToImage = addResizeHandlesToImage;\n        // Toutes les images sont trait√©es normalement\n        \n        // V√©rifier si d√©j√† trait√©\n        if (img.getAttribute('data-resizable') || img.parentElement?.classList.contains('resizable-image')) {\n          return;\n        }\n        \n        // Attendre que l'image soit charg√©e\n        if (!img.complete || img.naturalWidth === 0) {\n          img.addEventListener('load', () => addResizeHandlesToImage(img), { once: true });\n          return;\n        }\n        \n        img.setAttribute('data-resizable', 'true');\n        \n        // Wrapper l'image dans un conteneur redimensionnable\n        const wrapper = document.createElement('div');\n        wrapper.className = 'resizable-image';\n        \n        // Ajouter gestionnaire de clic pour s√©lection d'image\n        img.addEventListener('click', (e) => {\n          e.stopPropagation();\n          if (onImageClick) {\n            onImageClick(img);\n          }\n        });\n        \n        // Extraire les dimensions depuis le style inline ou les attributs\n        let currentWidth, currentHeight;\n        \n        // Priorit√© 1: attributs HTML (ex: width=\"300px\")\n        const attrWidth = img.getAttribute('width');\n        const attrHeight = img.getAttribute('height');\n        \n        // Priorit√© 2: style inline (ex: style=\"width: 300px\")\n        const styleWidth = img.style.width;\n        const styleHeight = img.style.height;\n        \n        if (attrWidth && attrHeight) {\n          currentWidth = parseInt(attrWidth);\n          currentHeight = parseInt(attrHeight);\n          console.log('üìè Dimensions depuis attributs:', currentWidth, 'x', currentHeight);\n        } else if (styleWidth && styleHeight) {\n          currentWidth = parseInt(styleWidth);\n          currentHeight = parseInt(styleHeight);\n          console.log('üìè Dimensions depuis style:', currentWidth, 'x', currentHeight);\n        } else {\n          // Fallback: dimensions naturelles\n          currentWidth = img.naturalWidth || 300;\n          currentHeight = img.naturalHeight || 200;\n          console.log('üìè Dimensions naturelles:', currentWidth, 'x', currentHeight);\n        }\n        \n        // Limiter la hauteur maximale √† 300px en pr√©servant le ratio d'aspect\n        const MAX_HEIGHT = 300;\n        if (currentHeight > MAX_HEIGHT) {\n          const aspectRatio = currentWidth / currentHeight;\n          currentHeight = MAX_HEIGHT;\n          currentWidth = Math.round(currentHeight * aspectRatio);\n          console.log('üîÑ Image redimensionn√©e pour hauteur max 300px:', currentWidth, 'x', currentHeight);\n          \n          // Appliquer les nouvelles dimensions √† l'image\n          img.setAttribute('width', currentWidth + 'px');\n          img.setAttribute('height', currentHeight + 'px');\n          img.style.width = currentWidth + 'px';\n          img.style.height = currentHeight + 'px';\n        }\n        \n        wrapper.style.width = currentWidth + 'px';\n        wrapper.style.height = currentHeight + 'px';\n          \n          // Ins√©rer le wrapper\n          img.parentNode.insertBefore(wrapper, img);\n          wrapper.appendChild(img);\n          \n          // Cr√©er les 4 poign√©es\n          ['nw', 'ne', 'sw', 'se'].forEach((corner) => {\n            const handle = document.createElement('div');\n            handle.className = `resize-handle ${corner}`;\n            handle.dataset.corner = corner;\n            \n            handle.addEventListener('mousedown', (e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              \n              const startX = e.clientX;\n              const startY = e.clientY;\n              const startWidth = wrapper.offsetWidth;\n              const startHeight = wrapper.offsetHeight;\n              const aspectRatio = startWidth / startHeight;\n              \n              const handleMouseMove = (e) => {\n                const deltaX = e.clientX - startX;\n                const deltaY = e.clientY - startY;\n                \n                let newWidth = startWidth;\n                let newHeight = startHeight;\n                \n                // Calculer les nouvelles dimensions selon le coin\n                switch(corner) {\n                  case 'se': // Sud-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'sw': // Sud-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'ne': // Nord-Est\n                    newWidth = Math.max(50, startWidth + deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                  case 'nw': // Nord-Ouest\n                    newWidth = Math.max(50, startWidth - deltaX);\n                    newHeight = newWidth / aspectRatio;\n                    break;\n                }\n                \n                // Appliquer les nouvelles dimensions\n                wrapper.style.width = newWidth + 'px';\n                wrapper.style.height = newHeight + 'px';\n                img.style.width = '100%';\n                img.style.height = '100%';\n                \n                // Ajouter les attributs HTML width/height pour persistance lors des conversions\n                img.setAttribute('width', Math.round(newWidth) + 'px');\n                img.setAttribute('height', Math.round(newHeight) + 'px');\n              };\n              \n              const handleMouseUp = () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n                \n                // D√©clencher l'√©v√©nement de changement pour sauvegarder\n                if (onInput) {\n                  const event = new Event('input', { bubbles: true });\n                  editorRef.current.dispatchEvent(event);\n                }\n              };\n              \n              document.addEventListener('mousemove', handleMouseMove);\n              document.addEventListener('mouseup', handleMouseUp);\n            });\n            \n            wrapper.appendChild(handle);\n          });\n      };\n      \n      // Observer pour d√©tecter les nouvelles images\n      const handleMutation = (mutations) => {\n        mutations.forEach(mutation => {\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeName === 'IMG') {\n              addResizeHandlesToImage(node);\n            } else if (node.querySelectorAll) {\n              node.querySelectorAll('img').forEach(addResizeHandlesToImage);\n            }\n          });\n        });\n      };\n      \n      const observer = new MutationObserver(handleMutation);\n      observer.observe(editorRef.current, {\n        childList: true,\n        subtree: true\n      });\n      \n      // Traiter les images existantes\n      editorRef.current.querySelectorAll('img').forEach(addResizeHandlesToImage);\n      \n      return () => observer.disconnect();\n    }\n  }, [viewMode, onInput, content]);\n  \n  // Effect supprim√© - La gestion des poign√©es est maintenant dans l'effect pr√©c√©dent\n\n  // Rendu conditionnel avec switch/case pour garantir une seule vue\n  console.log('üîÑ Editor.js - Rendu switch/case, viewMode:', viewMode);\n  \n  switch (viewMode) {\n    case 'wysiwyg':\n      console.log('üéØ SWITCH - Vue WYSIWYG');\n      return (\n        <div key=\"wysiwyg\">\n          <style>{`\n            .editor-content h1 { \n              font-size: 2em; \n              font-weight: bold; \n              margin: 0.67em 0; \n              line-height: 1.2;\n            }\n            .editor-content h2 { \n              font-size: 1.5em; \n              font-weight: bold; \n              margin: 0.75em 0; \n              line-height: 1.3;\n            }\n            .editor-content h3 { \n              font-size: 1.17em; \n              font-weight: bold; \n              margin: 0.83em 0; \n              line-height: 1.4;\n            }\n            .editor-content p {\n              margin: 0.5em 0;\n            }\n            .editor-content ul {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: disc;\n            }\n            .editor-content ol {\n              margin: 0.5em 0;\n              padding-left: 2em;\n              list-style-type: decimal;\n            }\n            .editor-content ol[style*=\"lower-alpha\"] {\n              list-style-type: lower-alpha;\n            }\n            .editor-content li {\n              margin: 0.25em 0;\n            }\n            \n            /* Styles pour images redimensionnables */\n            .editor-content img {\n              max-width: 100%;\n              height: auto;\n              position: relative;\n              cursor: pointer;\n            }\n            \n            .resizable-image {\n              position: relative;\n              display: inline-block;\n              border: 2px solid transparent;\n            }\n            \n            .resizable-image:hover {\n              border: 2px solid #3b82f6;\n            }\n            \n            /* Style pour image s√©lectionn√©e - SOLUTION RADICALE */\n            .image-selected {\n              position: relative;\n            }\n            \n            .image-selected::after {\n              content: '';\n              position: absolute;\n              top: -4px;\n              left: -4px;\n              right: -4px;\n              bottom: -4px;\n              border: 4px solid #1d4ed8;\n              box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.3), 0 0 12px rgba(29, 78, 216, 0.4);\n              background: rgba(29, 78, 216, 0.05);\n              outline: 2px solid #ffffff;\n              outline-offset: 2px;\n              pointer-events: none;\n              z-index: 1;\n            }\n            \n            .resizable-image img {\n              width: 100%;\n              height: 100%;\n              display: block;\n              position: relative;\n              z-index: 0;\n            }\n            \n            .resizable-image .resize-handle {\n              position: absolute;\n              width: 10px;\n              height: 10px;\n              background: #3b82f6;\n              border: 2px solid white;\n              border-radius: 50%;\n              opacity: 0;\n              cursor: nw-resize;\n              transition: opacity 0.2s;\n            }\n            \n            .resizable-image:hover .resize-handle,\n            .image-selected .resize-handle {\n              opacity: 1;\n            }\n            \n            .resize-handle.nw { top: -2px; left: -2px; cursor: nw-resize; }\n            .resize-handle.ne { top: -2px; right: -2px; cursor: ne-resize; }\n            .resize-handle.sw { bottom: -2px; left: -2px; cursor: sw-resize; }\n            .resize-handle.se { bottom: -2px; right: -2px; cursor: se-resize; }\n          `}</style>\n          <div\n            ref={(el) => { editorRef.current = el; }}\n            contentEditable=\"true\"\n            suppressContentEditableWarning={true}\n            spellCheck={false}\n            onInput={(e) => {\n              console.log('üéØ WYSIWYG onInput d√©clench√©!');\n              handleWysiwygChange(e);\n            }}\n            onKeyUp={(e) => {\n              console.log('‚å®Ô∏è WYSIWYG onKeyUp d√©clench√©! Touche:', e.key);\n              handleWysiwygChange(e);\n            }}\n            onPaste={(e) => {\n              console.log('üìã WYSIWYG onPaste d√©clench√©!');\n              setTimeout(() => handleWysiwygChange(e), 10); // D√©lai pour laisser le paste s'appliquer\n            }}\n            onMouseUp={(e) => {\n              console.log('üñ±Ô∏è WYSIWYG onMouseUp - S√©lection chang√©e - ignoreFlag:', ignoreSelectionChangeRef?.current);\n              if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n                console.log('‚úÖ EDITOR onMouseUp - VA APPELER onSelectionChange dans 10ms');\n                setTimeout(onSelectionChange, 10);\n              } else {\n                console.log('‚ùå EDITOR onMouseUp - onSelectionChange BLOQU√â');\n              }\n            }}\n            onKeyDown={(e) => {\n              // Protection contre les √©v√©nements undefined\n              if (!e || !e.key) {\n                console.warn('‚ö†Ô∏è √âv√©nement onKeyDown invalide:', e);\n                return;\n              }\n              \n              console.log('üîΩ WYSIWYG onKeyDown d√©clench√©! Touche:', e.key);\n              \n              // Gestion des touches pour les images s√©lectionn√©es\n              if (selectedImage) {\n                if (e.key === 'Delete' || e.key === 'Backspace') {\n                  e.preventDefault();\n                  // Supprimer l'image directement\n                  const wrapper = selectedImage.closest('.resizable-image');\n                  const elementToRemove = wrapper || selectedImage;\n                  elementToRemove.remove();\n                  \n                  // D√©s√©lectionner l'image\n                  if (onImageClick) {\n                    onImageClick(null);\n                  }\n                  \n                  // D√©clencher la sauvegarde\n                  if (onInput) {\n                    const event = new Event('input', { bubbles: true });\n                    editorRef.current.dispatchEvent(event);\n                  }\n                  return;\n                } else if (e.key === 'Enter') {\n                  e.preventDefault();\n                  // Ins√©rer une nouvelle ligne apr√®s l'image s√©lectionn√©e\n                  const wrapper = selectedImage.closest('.resizable-image');\n                  if (wrapper) {\n                    const newParagraph = document.createElement('p');\n                    newParagraph.innerHTML = '<br>';\n                    wrapper.parentNode.insertBefore(newParagraph, wrapper.nextSibling);\n                    \n                    console.log('üìç ENTER Image - Cr√©ation du paragraphe:', newParagraph);\n                    \n                    // Attendre que tous les √©v√©nements (onInput, handleWysiwygChange, etc.) se stabilisent\n                    setTimeout(() => {\n                      console.log('üìç ENTER Image - Positionnement curseur APR√àS stabilisation');\n                      \n                      const selection = window.getSelection();\n                      const range = document.createRange();\n                      \n                      console.log('üìç ENTER Image - Selection avant (delayed):', selection.rangeCount);\n                      \n                      // Positionner au d√©but du paragraphe\n                      range.setStart(newParagraph, 0);\n                      range.collapse(true);\n                      \n                      console.log('üìç ENTER Image - Range (delayed) startContainer:', range.startContainer);\n                      console.log('üìç ENTER Image - Range (delayed) startOffset:', range.startOffset);\n                      \n                      selection.removeAllRanges();\n                      selection.addRange(range);\n                      \n                      console.log('üìç ENTER Image - Selection (delayed) apr√®s:', selection.rangeCount);\n                      \n                      // Focus pour s'assurer que le curseur est visible\n                      editorRef.current?.focus();\n                      \n                      console.log('üìç ENTER Image - Positionnement termin√© avec succ√®s!');\n                    }, 100); // D√©lai pour laisser les √©v√©nements se stabiliser\n                    \n                    // D√©clencher la sauvegarde\n                    if (onInput) {\n                      const event = new Event('input', { bubbles: true });\n                      editorRef.current.dispatchEvent(event);\n                    }\n                    \n                    // D√©s√©lectionner l'image\n                    if (onImageClick) {\n                      onImageClick(null);\n                    }\n                  }\n                  return;\n                }\n              }\n              \n              // Mise √† jour du formatage pour les touches de navigation\n              if (e && e.key && (e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {\n                setTimeout(() => {\n                  console.log('üîº EDITOR onKeyDown Navigation - ignoreFlag:', ignoreSelectionChangeRef?.current);\n                  if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n                    console.log('‚úÖ EDITOR Navigation - VA APPELER onSelectionChange');\n                    onSelectionChange();\n                  } else {\n                    console.log('‚ùå EDITOR Navigation - onSelectionChange BLOQU√â');\n                  }\n                }, 10);\n              }\n            }}\n            onFocus={(e) => {\n              console.log('üîç WYSIWYG onFocus - Mise √† jour formatage - ignoreFlag:', ignoreSelectionChangeRef?.current);\n              if (onSelectionChange && !ignoreSelectionChangeRef?.current) {\n                console.log('‚úÖ EDITOR onFocus - VA APPELER onSelectionChange dans 10ms');\n                setTimeout(onSelectionChange, 10);\n              } else {\n                console.log('‚ùå EDITOR onFocus - onSelectionChange BLOQU√â');\n              }\n            }}\n            onChange={(e) => {\n              console.log('üîÑ onChange d√©clench√©!');\n            }}\n            onClick={onEditorClick}\n            style={{\n              minHeight: '384px',\n              outline: 'none',\n              padding: '20px',\n              lineHeight: 'var(--dys-line-height)',\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n            }}\n          />\n        </div>\n      );\n\n    case 'markdown': {\n      console.log('üìù SWITCH - Vue MARKDOWN');\n      const displayContent = content;\n      \n      return (\n        <div key=\"markdown\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              if (editorRef) editorRef.current = el;\n            }}\n            value={displayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalContent = content;\n              \n              if (newValue !== originalContent) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            spellCheck={false}\n            className=\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            style={{\n              fontFamily: 'var(--dys-font-family)',\n              fontSize: 'var(--dys-font-size)',\n              lineHeight: 'var(--dys-line-height)',\n              color: 'var(--dys-text-color)',\n              backgroundColor: 'var(--dys-bg-color)',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"√âcrivez en Markdown...\n\n# Titre 1\n## Titre 2\n### Titre 3\n\n**Gras** *Italique*\n\n- Liste √† puces\n1. Liste num√©rot√©e\na. Liste alphab√©tique\n\n$E = mc^2$ (formule inline)\n$$\\\\int_{-\\\\infty}^{\\\\infty} e^{-x^2} dx = \\\\sqrt{\\\\pi}$$ (formule block)\"\n          />\n        </div>\n      );\n    }\n\n    case 'html': {\n      console.log('üîß SWITCH - Vue HTML');\n      const htmlDisplayContent = formatHtmlForSource(content);\n    \n      return (\n        <div key=\"html\" className=\"relative\">\n          <textarea\n            ref={(el) => {\n              if (editorRef) editorRef.current = el;\n            }}\n            value={htmlDisplayContent}\n            onChange={(e) => {\n              const newValue = e.target.value;\n              const originalWithCollapse = formatHtmlForSource(content);\n              \n              if (newValue !== originalWithCollapse) {\n                onInput({ ...e, target: { ...e.target, value: newValue } });\n              }\n            }}\n            className=\"editor-content p-2 w-full h-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            style={{ \n              fontFamily: 'Monaco, \"Cascadia Code\", \"Roboto Mono\", monospace',\n              overflow: 'auto',\n              wordWrap: 'break-word',\n              whiteSpace: 'pre-wrap',\n              border: '1px solid #e5e7eb',\n              paddingBottom: '2rem'\n            }}\n            placeholder=\"Code source HTML...\"\n          />\n        </div>\n      );\n    }\n\n    default:\n      console.log('‚ùå SWITCH - AUCUNE VUE CORRESPONDANTE, viewMode:', viewMode);\n      return null;\n  }\n});\n\nexport default Editor;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}